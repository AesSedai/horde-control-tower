import{c as re,a as As,b as Gs,p as $s,d as Es,e as Rs,s as Hs,f as Bs,F as Ks,R as Ns,P as qs,g as Vs,h as zs,i as Qs,j as Oe,u as k,k as e,B as h,l as ne,T as x,L as es,m as Zs,n as Js,r as b,D as xe,o as G,q as ie,t as Ue,v as Ie,w as V,x as ss,y as z,z as H,A as C,C as L,I as $,E as Xs,M as Ys,G as Q,H as he,J as et,K as ze,N as pe,O as ge,Q as me,S as te,U as st,V as tt,W as m,X as w,Y as nt,Z as rt,_ as Le,$ as ce,a0 as ae,a1 as Pe,a2 as ee,a3 as le,a4 as bs,a5 as _e,a6 as at,a7 as Fe,a8 as vs,a9 as Me,aa as Ae,ab as it,ac as lt,ad as ot,ae as We,af as Qe,ag as Ze,ah as dt,ai as ct,aj as O,ak as ut,al as xt,am as ts,an as ns,ao as rs,ap as ht,aq as pt,ar as mt,as as jt,at as se,au as gt,av as ft,aw as yt,ax as bt,ay as oe,az as ks,aA as vt,aB as kt,aC as Ct,aD as St,aE as R,aF as S,aG as as,aH as is,aI as ls,aJ as os,aK as wt,aL as It,aM as Pt,aN as De,aO as ds,aP as cs,aQ as Ge,aR as _t,aS as Ft,aT as J,aU as X,aV as Tt,aW as Ot,aX as Wt,aY as Ut,aZ as Dt,a_ as Lt,a$ as Mt,b0 as At,b1 as Gt,b2 as $t,b3 as Et,b4 as Rt,b5 as Ht}from"./vendor-bae53fe8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const Bt={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},$e=re({name:"comparatorPanel",initialState:Bt,reducers:{setSelectedModel:(s,t)=>{s.selectedModel=t.payload},setSelectedWorkers:(s,t)=>{s.selectedWorkers=t.payload},setGenForm:(s,t)=>{s.genForm=structuredClone(t.payload)},setReload:(s,t)=>{s.reload=t.payload}}}),{setSelectedModel:us,setSelectedWorkers:ke,setGenForm:Cs,setReload:Ss}=$e.actions,Kt={sidebarOpen:!1},Ee=re({name:"localState",initialState:Kt,reducers:{setSidebarOpen:(s,t)=>{s.sidebarOpen=t.payload}}}),{setSidebarOpen:ws}=Ee.actions,Re={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},je=re({name:"persist",initialState:Re,reducers:{setKey:(s,t)=>{s.apikey=t.payload},setSelectedTab:(s,t)=>{s.selectedTab=t.payload},resetImageGens:s=>{s.imageGens=[]},addImageGen:(s,t)=>{s.imageGens.find(l=>l.id===t.payload.id)||s.imageGens.push(t.payload)},updateImageGen:(s,t)=>{const r=s.imageGens.findIndex(l=>l.id===t.payload.id);r!=null&&(s.imageGens[r]=t.payload)},addGenFavorite:(s,t)=>{s.genFavorites.push(t.payload)},updateGenFavorite:(s,t)=>{s.genFavorites[t.payload.idx]={name:s.genFavorites[t.payload.idx].name,form:t.payload.form}},deleteGenFavorite:(s,t)=>{s.genFavorites.splice(t.payload)},resetExceptApiKey:s=>(s={...Re,apikey:s.apikey},s)}}),{setKey:Nt,setSelectedTab:Is,resetImageGens:xs,addImageGen:qt,updateImageGen:we,addGenFavorite:Vt,resetExceptApiKey:xr,updateGenFavorite:zt,deleteGenFavorite:Qt}=je.actions,Zt={showPassword:!1},He=re({name:"settingsPanel",initialState:Zt,reducers:{setShowPassword:(s,t)=>{s.showPassword=t.payload}}}),{setShowPassword:Be}=He.actions,Jt={expandedPanel:"workers"},Te=re({name:"userPanel",initialState:Jt,reducers:{setUser:(s,t)=>{s.selectedUser=t.payload},setExpandedPanel:(s,t)=>{s.expandedPanel=t.payload}}}),{setUser:Ke,setExpandedPanel:Xt}=Te.actions,Yt={prompt:"",ipAddr:""},Ne=re({name:"utilityPanel",initialState:Yt,reducers:{setPrompt:(s,t)=>{s.prompt=t.payload},setIpAddr:(s,t)=>{s.ipAddr=t.payload}}}),{setPrompt:en,setIpAddr:sn}=Ne.actions,tn={workerType:"image",sortKey:"name",order:"asc"},qe=re({name:"workerPanel",initialState:tn,reducers:{setWorkerType:(s,t)=>{s.workerType=t.payload},setWorkerFilter:(s,t)=>{s.workerFilter=t.payload},setSortKey:(s,t)=>{s.sortKey=t.payload},setOrder:(s,t)=>{s.order=t.payload}}}),{setWorkerType:nn,setWorkerFilter:rn,setSortKey:hs,setOrder:an}=qe.actions,ln=As((s,t)=>s,(s,t)=>Object.assign({},Re,s),{whitelist:[je.name]}),on={key:"root",storage:Bs,whitelist:[je.name,Te.name],transforms:[ln]},dn=Gs({[je.name]:je.reducer,[Ee.name]:Ee.reducer,[He.name]:He.reducer,[Te.name]:Te.reducer,[Ne.name]:Ne.reducer,[qe.name]:qe.reducer,[$e.name]:$e.reducer}),cn=$s(on,dn),fe=Es({reducer:cn,middleware:s=>s({serializableCheck:{ignoredActions:[Ks,Ns,qs,Vs,zs,Qs]}}),devTools:!1}),un=Rs(fe);Hs(fe.dispatch);const P=Oe.create({baseURL:"https://aihorde.net/api/v2/"});P.interceptors.request.use(function(s){const t=fe.getState().persist.apikey;return s.headers!=null&&(t!=null&&(s.headers.apikey=t),s.headers["Client-Agent"]="HordeControlTower/0.0.9"),s},function(s){return Promise.reject(s)});const xn=Oe.create({baseURL:"/horde-control-tower/"}),de=Oe.create({baseURL:"https://ratings.aihorde.net/api/v1/"});de.interceptors.request.use(function(s){const t=fe.getState().persist.apikey;return s.headers!=null&&(t!=null&&(s.headers.apikey=t),s.headers["Client-Agent"]="HordeControlTower/0.0.9"),s},function(s){return Promise.reject(s)});const hn=s=>P.get("find_user",{headers:{apikey:s}}).then(t=>t.data),Ps=()=>P.get("status/modes").then(s=>s.data),_s=()=>P.get("status/performance").then(s=>s.data),Fs=()=>xn.get("users.json").then(s=>s.data),Je=s=>P.get(`users/${s}`).then(t=>t.data),Xe=()=>P.get("workers").then(s=>s.data),pn=s=>P.get(`workers/${s}`).then(t=>t.data),Ts=()=>P.get("status/models").then(s=>s.data),Ye=(s,t)=>P.put(`users/${s}`,t).then(r=>r.data),mn=(s,t)=>P.put(`workers/${s}`,t).then(r=>r.data),jn=s=>P.post("filters",s).then(t=>t.data),gn=s=>P.post("generate/async",s).then(t=>t.data),fn=s=>P.get(`generate/check/${s}`).then(t=>t.data),yn=s=>P.get(`generate/status/${s}`).then(t=>t.data),bn=s=>P.delete(`generate/status/${s}`).then(t=>t.data),vn=s=>P.delete("operations/ipaddr",{data:s}).then(t=>t.data),D={all:["users"],lists:()=>[...D.all,"list"],list:s=>[...D.lists(),{filters:s}],details:()=>[...D.all,"detail"],detail:s=>[...D.details(),s]},B={all:["workers"],lists:()=>[...B.all,"list"],list:s=>[...B.lists(),{filters:s}],details:()=>[...B.all,"detail"],detail:s=>[...B.details(),s]},kn=()=>(k(D.all,Fs,{staleTime:1e3*30,refetchInterval:1e3*30}),k(["performance"],_s,{staleTime:1e3*30,refetchInterval:1e3*30}),k(["mode"],Ps,{staleTime:1e3*30,refetchInterval:1e3*30}),k(["models"],Ts,{staleTime:1e3*30,refetchInterval:1e3*30}),e.jsx(e.Fragment,{})),Cn=()=>e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e.jsx(ne,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"h4",textAlign:"center",children:"About"}),e.jsxs(x,{variant:"body1",children:["Horde Control Tower is an open source"," ",e.jsx(es,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),e.jsxs(x,{variant:"body1",children:["The project source is available on"," ",e.jsx(es,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),F=()=>Js(),g=Zs,Sn=()=>{const s=F(),t=g(I=>I.comparatorPanel.genForm),r=g(I=>I.persist.genFavorites),[l,n]=b.useState(!1),[a,d]=b.useState(-1),[p,c]=b.useState(!1),[i,u]=b.useState(-1),[y,v]=b.useState(!1),[E,K]=b.useState(""),[W,o]=b.useState(null),j=!!W,f=I=>{o(I.currentTarget)},T=()=>{o(null)},M=()=>{v(!1)},N=()=>{s(Vt({name:E,form:t})),K(""),v(!1)},Z=()=>{d(-1),n(!1)},ye=()=>{s(zt({idx:a,form:t})),d(-1),n(!1)},be=()=>{u(-1),c(!1)},ve=()=>{s(Qt(i)),u(-1),c(!1)},_=I=>{s(Cs(I)),s(Ss(!0)),o(null)},Ds=()=>{v(!0),o(null)},Ls=()=>{n(!0),o(null)},Ms=()=>{c(!0),o(null)};return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{open:p,onClose:Z,children:[e.jsx(G,{children:"Delete Preset"}),e.jsxs(ie,{children:[e.jsx(Ue,{children:"Select a preset to delete."}),e.jsx(Ie,{children:r.map((I,q)=>e.jsx(V,{disablePadding:!0,sx:{backgroundColor:i===q?"error.dark":""},onClick:()=>{u(q)},children:e.jsx(ss,{children:e.jsx(z,{primary:I.name})})},q))})]}),e.jsxs(H,{children:[e.jsx(C,{onClick:be,children:"Cancel"}),e.jsx(C,{disabled:i===-1,onClick:ve,children:"Select"})]})]}),e.jsxs(xe,{open:l,onClose:Z,children:[e.jsx(G,{children:"Overwrite Preset"}),e.jsxs(ie,{children:[e.jsx(Ue,{children:"Select a preset to overwrite."}),e.jsx(Ie,{children:r.map((I,q)=>e.jsx(V,{disablePadding:!0,sx:{backgroundColor:a===q?"success.dark":""},onClick:()=>{d(q)},children:e.jsx(ss,{children:e.jsx(z,{primary:I.name})})},q))})]}),e.jsxs(H,{children:[e.jsx(C,{onClick:Z,children:"Cancel"}),e.jsx(C,{disabled:a===-1,onClick:ye,children:"Select"})]})]}),e.jsxs(xe,{open:y,onClose:M,children:[e.jsx(G,{children:"Add New Preset"}),e.jsxs(ie,{children:[e.jsx(Ue,{children:"Enter a friendly name for this new preset."}),e.jsx(L,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:E,onChange:I=>{K(I.target.value)}})]}),e.jsxs(H,{children:[e.jsx(C,{onClick:M,children:"Cancel"}),e.jsx(C,{onClick:N,children:"Create"})]})]}),e.jsx($,{onClick:f,children:e.jsx(Xs,{})}),e.jsxs(Ys,{anchorEl:W,open:j,onClose:T,children:[r.map((I,q)=>e.jsx(Q,{onClick:()=>{_(I.form)},children:I.name},q)),r.length>0?e.jsx(he,{}):null,r.length>0?e.jsx(Q,{onClick:Ms,children:"Delete Preset"}):null,r.length>0?e.jsx(he,{}):null,r.length>0?e.jsx(Q,{onClick:Ls,children:"Overwrite Preset"}):null,r.length>0?e.jsx(he,{}):null,e.jsx(Q,{onClick:Ds,children:"Add New Preset"})]})]})},wn=()=>{const s=g(n=>n.persist.imageGens),{data:t}=k(B.all,()=>Xe(),{refetchInterval:1e3*30,select:n=>et(n.map(a=>[a.id,a.name]))}),r=n=>{const a=n.status!=null?n.status:n.check;return n.state!=="complete"&&a!=null?e.jsxs(pe,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e.jsx(ge,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e.jsx(me,{title:t==null?"":t[n.payload.workers[0]??""],subtitle:`Position: ${a.queue_position}, wait time: ${a.wait_time}`})]},n.id):n.state==="complete"?l(n).length===0?e.jsxs(pe,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e.jsx(x,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e.jsx(me,{title:t==null?"":t[n.payload.workers[0]??""]})]},n.id):e.jsxs(pe,{sx:{paddingTop:l(n).length>0?"0%":"100%",border:"1px solid black"},children:[e.jsx("img",{src:l(n)}),e.jsx(me,{title:t==null?"":t[n.payload.workers[0]??""]})]},n.id):e.jsx(e.Fragment,{})},l=n=>n.status!=null&&n.status.generations.length>0?n.status.generations[0].img:"";return e.jsx(h,{children:e.jsx(ze,{sx:{width:"100%",height:"100%"},cols:4,children:s.map(n=>r(n))})})},In=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Pn=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],U="175px",_n=()=>{const s=F(),t=g(o=>o.comparatorPanel.selectedWorkers),r=g(o=>o.comparatorPanel.selectedModel),l=g(o=>o.comparatorPanel.genForm),n=g(o=>o.persist.imageGens),a=g(o=>o.persist.imageGens.length>0),d=g(o=>o.comparatorPanel.reload),p=g(o=>o.persist.imageGens.some(j=>["pending","check"].includes(j.state))),{mutate:c}=te({mutationFn:gn,onSuccess:(o,j,f)=>{s(qt({id:o.id,payload:j,state:"check",check:null,status:null}))}}),{handleSubmit:i,control:u,formState:{errors:y},watch:v,setValue:E,reset:K}=st({defaultValues:l}),W=o=>{r!=null&&t.length>0&&(s(xs()),t.forEach(j=>{const f={...o,workers:[j.id],models:[r.name]};c(f)}))};return b.useEffect(()=>{const o=v(tt((j,{name:f,type:T})=>{s(Cs(j))},300));return()=>o.unsubscribe()},[v]),b.useEffect(()=>{d&&(s(Ss(!1)),K(l))},[d]),e.jsx(h,{children:e.jsxs("form",{onSubmit:i(W),children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Prompt"}),e.jsx(m,{container:!0,spacing:2,alignItems:"center",children:e.jsx(w,{name:"prompt",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(L,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...o})})})})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Seed"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(w,{name:"params.seed",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(L,{fullWidth:!0,placeholder:"Seed",...o})})}),e.jsx(m,{item:!0,children:e.jsx($,{"aria-label":"randomize seed",onClick:()=>{E("params.seed",nt(1e8,999999999).toString())},children:e.jsx(rt,{})})})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Sampler"}),e.jsx(m,{container:!0,spacing:2,alignItems:"center",children:e.jsx(w,{name:"params.sampler_name",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(Le,{...o,fullWidth:!0,children:Pn.map(j=>e.jsx(Q,{value:j,children:j},j))})})})})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Steps"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(w,{name:"params.steps",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ce,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...o})})}),e.jsx(w,{name:"params.steps",control:u,render:({field:o})=>e.jsx(m,{item:!0,children:e.jsx(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...o,onChange:j=>{o.onChange(parseInt(j.target.value))}})})})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Width"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(w,{name:"params.width",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ce,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...o})})}),e.jsx(w,{name:"params.width",control:u,render:({field:o})=>e.jsx(m,{item:!0,children:e.jsx(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...o,onChange:j=>{o.onChange(parseInt(j.target.value))}})})})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Height"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(w,{name:"params.height",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ce,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...o})})}),e.jsx(w,{name:"params.height",control:u,render:({field:o})=>e.jsx(m,{item:!0,children:e.jsx(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...o,onChange:j=>{o.onChange(parseInt(j.target.value))}})})})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"CFG"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(w,{name:"params.cfg_scale",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ce,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...o})})}),e.jsx(w,{name:"params.cfg_scale",control:u,render:({field:o})=>e.jsx(m,{item:!0,children:e.jsx(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...o,onChange:j=>{o.onChange(parseInt(j.target.value))}})})})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Clip Skip"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(w,{name:"params.clip_skip",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ce,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...o})})}),e.jsx(w,{name:"params.clip_skip",control:u,render:({field:o})=>e.jsx(m,{item:!0,children:e.jsx(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...o,onChange:j=>{o.onChange(parseInt(j.target.value))}})})})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Post-Processors"}),e.jsx(m,{container:!0,spacing:2,alignItems:"center",children:e.jsx(w,{name:"params.post_processing",control:u,render:({field:{onChange:o,onBlur:j,value:f,name:T,ref:M}})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(Pe,{fullWidth:!0,multiple:!0,onBlur:j,ref:M,value:f,onChange:(N,Z)=>{o(Z)},options:In,getOptionLabel:N=>N,renderInput:N=>e.jsx(L,{...N})})})})})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"High Res Fix"}),e.jsx(m,{container:!0,spacing:2,alignItems:"center",children:e.jsx(w,{name:"params.hires_fix",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ee,{...o,checked:o.value})})})})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Karras"}),e.jsx(m,{container:!0,spacing:2,alignItems:"center",children:e.jsx(w,{name:"params.karras",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ee,{...o,checked:o.value})})})})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:U},children:"Tiling"}),e.jsx(m,{container:!0,spacing:2,alignItems:"center",children:e.jsx(w,{name:"params.tiling",control:u,render:({field:o})=>e.jsx(m,{item:!0,xs:!0,children:e.jsx(ee,{...o,checked:o.value})})})})]}),e.jsx(le,{type:"submit",loading:p,variant:"contained",children:"Submit"}),p?e.jsx(C,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{n.filter(o=>["pending","check"].includes(o.state)).forEach(o=>{s(we({...o,state:"delete"}))})},children:"Cancel"}):null,a?e.jsx(C,{sx:{ml:2},variant:"contained",onClick:()=>{s(xs())},children:"Clear Output"}):null]})})},Fn=s=>s!=null&&"name"in s,Tn=s=>s!=null&&bs(s)&&"name"in s[0]&&"id"in s[0],ps="175px",On=()=>{const s=F(),t=g(c=>c.comparatorPanel.selectedWorkers),r=g(c=>c.comparatorPanel.selectedModel),l=(c,i)=>{bs(i)&&i.length===0?s(ke([])):Tn(i)&&s(ke(i))},n=(c,i)=>{i==null?s(us(null)):Fn(i)&&s(us(i))},{data:a}=k(B.all,()=>Xe(),{refetchInterval:1e3*30,select:c=>_e(c,[i=>i.name.toLowerCase()],["asc"])}),{data:d}=k(["models"],Ts,{staleTime:1e3*30,refetchInterval:1e3*30,select:c=>_e(c,[i=>i.name.toLowerCase()],["asc"])});b.useEffect(()=>{if(r!=null&&t.length>0){const c=t.map(y=>y.id),i=t.filter(y=>{var v;return(v=y==null?void 0:y.models)==null?void 0:v.includes(r.name)}),u=i.map(y=>y.id);at(c,u)||s(ke(i))}else r==null&&t.length>0&&s(ke([]))},[a,d,t,r]);const p=(a??[]).filter(c=>{var i;return r==null?!0:(i=c==null?void 0:c.models)==null?void 0:i.includes(r.name)});return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:ps},children:"Model"}),e.jsx(Pe,{fullWidth:!0,disablePortal:!0,options:d??[],blurOnSelect:!0,value:r,autoHighlight:!0,getOptionLabel:c=>Fe(c)?c:c.name,isOptionEqualToValue:(c,i)=>c.name===i.name,filterSelectedOptions:!0,renderInput:c=>e.jsx(L,{...c,label:"Selected Model"}),onChange:n})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",py:1},children:[e.jsx(x,{variant:"body1",sx:{width:ps},children:"Workers"}),e.jsx(Pe,{fullWidth:!0,multiple:!0,disablePortal:!0,options:p,value:t,getOptionLabel:c=>c.name,isOptionEqualToValue:(c,i)=>c.id===i.id,filterSelectedOptions:!0,renderInput:c=>e.jsx(L,{...c,label:"Selected Workers"}),onChange:l})]})]})},Wn=()=>e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,xl:4,children:e.jsxs(ne,{sx:{p:2},children:[e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(x,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e.jsx(h,{sx:{position:"absolute",top:0,right:0},children:e.jsx(Sn,{})})]}),e.jsx(On,{}),e.jsx(_n,{})]})}),e.jsx(m,{item:!0,xs:12,xl:8,children:e.jsxs(ne,{sx:{p:2,height:"100%"},children:[e.jsx(x,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e.jsx(wn,{})]})})]}),Os={format:"json",limit:100},Un=s=>de.get("user/ratings",{params:Object.assign({},Os,s)}).then(t=>t.data),Dn=(s,t)=>de.get(`user/validate/${s}`,{params:Object.assign({},Os,t)}).then(r=>r.data),Ln=s=>de.get(`user/check/${s}`).then(t=>t.data),Mn=s=>de.post(`user/flag/${s}`).then(t=>t.data),An=(s,t)=>de.post(`user/modify/${s}`,t).then(r=>r.data),A={all:["ratings"],lists:()=>[...A.all,"list"],list:s=>[...A.lists(),{filters:s}],details:()=>[...A.all,"detail"],detail:s=>[...A.details(),s],validates:()=>[...A.all,"validate"],validate:s=>[...A.validates(),s],checks:()=>[...A.all,"check"],check:s=>[...A.checks(),s]},Gn=()=>{const{data:s,isLoading:t}=k(["user/ratings"],()=>Un()),r=F();if(t)return e.jsx(h,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e.jsx(h,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e.jsx(ge,{})})});const l=a=>{const d=vs(a.username.split("#"));d!=null&&(r(Ke(parseInt(d))),r(Is("1")))},n=a=>e.jsxs(h,{sx:{display:"flex"},children:[e.jsx(x,{sx:{textDecoration:"underline"},onClick:()=>l(a),children:a.username}),e.jsxs(x,{children:[" - r: ",a.rating,", a: ",a.artifacts,", avg: ",a.average,", n: ",a.times_rated]})]});return s==null?e.jsx(e.Fragment,{}):e.jsx(h,{children:e.jsx(ze,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:s.ratings.map(a=>e.jsxs(pe,{children:[e.jsx("img",{src:a.image}),e.jsx(me,{title:n(a)})]},a.image_id))})})},Ws=()=>{const s=F(),t=g(n=>n.persist.apikey),r=g(n=>n.settingsPanel.showPassword),l=n=>{s(Nt(n.target.value)),s(Be(!1))};return e.jsxs(Me,{sx:{m:1,width:"35ch"},variant:"standard",children:[e.jsx(Ae,{children:"API Key"}),e.jsx(ae,{defaultValue:t,onBlur:l,type:r?"text":"password",endAdornment:e.jsx(it,{position:"end",children:e.jsx($,{onClick:()=>s(Be(!r)),children:r?e.jsx(lt,{}):e.jsx(ot,{})})})})]})},$n=()=>e.jsx(m,{container:!0,spacing:2,children:e.jsx(m,{item:!0,md:12,lg:6,xl:4,children:e.jsx(ne,{children:e.jsx(Ws,{})})})}),Ve="#0583B0",Y="#FF6962",En="#7c0500",Rn="#ef9b0f",ms=s=>s.type==="image"&&parseFloat(s.performance)>3,js=s=>s.type==="image"&&parseFloat(s.performance)<.4,Us=s=>{var W;const{worker:t}=s,r=We(),[l,n]=b.useState(!1),[a,d]=b.useState(!1),[p,c]=b.useState("setFlagged"),[i,u]=b.useState(""),y=o=>o.maintenance_mode||o.paused||o.flagged?En:ms(o)||js(o)?Rn:"background.paper",v=te(o=>mn(o.id,o.data),{onSuccess:(o,j)=>{n(!0),r.invalidateQueries({queryKey:B.detail(j.id)}),r.invalidateQueries({queryKey:B.all})}}),E=(o,j)=>{j!=="clickaway"&&n(!1)},K=o=>{switch(o){case"setFlagged":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['Set "',t.name,'" as Flagged']}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>{d(!1)},children:"Cancel"}),e.jsx(C,{onClick:()=>{d(!1)},children:"Confirm"})]})]});case"unsetFlagged":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['Unset "',t.name,'" as Flagged']}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{d(!1)},children:"Confirm"})]})]});case"setMaintenance":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['Set "',t.name,'" Maintenance Mode']}),e.jsx(ie,{children:e.jsx(L,{value:i,onChange:j=>{u(j.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{const j={maintenance:!0};oe(i)||(j.maintenance_msg=i),v.mutate({id:t.id,data:j}),d(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['Unset "',t.name,'" Maintenance Mode']}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{v.mutate({id:t.id,data:{maintenance:!1,maintenance_msg:""}}),d(!1)},children:"Confirm"})]})]});case"setPaused":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['Set "',t.name,'" Paused Mode']}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{v.mutate({id:t.id,data:{paused:!0}}),d(!1)},children:"Confirm"})]})]});case"unsetPaused":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['Unset "',t.name,'" Paused Mode']}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{v.mutate({id:t.id,data:{paused:!1}}),d(!1)},children:"Confirm"})]})]});case"listModels":return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:['"',t.name,'" Models']}),e.jsx(ie,{children:e.jsx(x,{variant:"body1",children:_e((t==null?void 0:t.models)??[],[j=>j.toLowerCase()]).join(", ")})})]})}};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{open:a,onClose:()=>d(!1),children:K(p)}),e.jsx(Qe,{open:l,autoHideDuration:6e3,onClose:E,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ze,{onClose:E,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e.jsx(m,{item:!0,xs:12,lg:6,xl:3,children:e.jsxs(dt,{sx:{backgroundColor:y(t)},children:[e.jsx(ct,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:t.online&&!t.paused&&!t.maintenance_mode&&!t.flagged?e.jsx(O,{title:"Worker Online",children:e.jsx(ut,{sx:{color:Ve}})}):e.jsx(O,{title:"Worker Issue",children:e.jsx(xt,{sx:{color:Y}})}),action:e.jsxs(h,{children:[js(t)?e.jsx(O,{title:"Worker Low Speed Warning",children:e.jsx(ts,{sx:{color:Y,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,ms(t)?e.jsx(O,{title:"Worker High Speed Warning",children:e.jsx(ts,{sx:{color:Y,mt:.5,mr:1}})}):null,t.paused?e.jsx(O,{title:"Worker Paused",children:e.jsx(ns,{sx:{color:Y,mt:.5,mr:1}})}):null,t.maintenance_mode?e.jsx(O,{title:"Worker Maintenance",children:e.jsx(rs,{sx:{color:Y,mt:.5,mr:1}})}):null,t.flagged?e.jsx(O,{title:"User Flagged",children:e.jsx(ht,{sx:{color:Y,mt:.5,mr:1}})}):null,t.trusted?e.jsx(O,{title:"Trusted Worker",children:e.jsx(pt,{sx:{color:Ve,mt:.5,mr:1}})}):null]}),title:e.jsx(x,{variant:"h5",children:mt(t.name,{length:30})}),subheader:t.id}),e.jsxs(jt,{children:[e.jsxs(x,{variant:"body2",children:["Full Name: ",t.name]}),e.jsxs(x,{variant:"body2",children:["Owner: ",t.owner]}),e.jsxs(x,{variant:"body2",children:["Bridge Agent: ",t.bridge_agent]}),e.jsxs(x,{variant:"body2",children:["Uptime: ",se.fromObject({seconds:t.uptime}).toHuman()]}),t.type!=="interrogation"?e.jsxs(x,{variant:"body2",children:["Models Loaded: ",((W=t==null?void 0:t.models)==null?void 0:W.length)??"None"]}):null,t.type==="image"?e.jsxs(x,{variant:"body2",children:["MPS Generated: ",t.megapixelsteps_generated]}):null,e.jsxs(x,{variant:"body2",children:["Speed: ",t.performance]}),e.jsxs(x,{variant:"body2",children:["Threads: ",t.threads]}),e.jsxs(x,{variant:"body2",children:["Requests Fulfilled: ",t.requests_fulfilled]}),e.jsxs(x,{variant:"body2",children:["NSFW: ",t.nsfw?"true":"false"]})]}),e.jsxs(gt,{disableSpacing:!0,children:[e.jsx(O,{title:"Show Worker Models",children:e.jsx($,{onClick:()=>{c("listModels"),d(!0)},children:e.jsx(ft,{})})}),t.maintenance_mode?e.jsx(O,{title:"Unset Worker Maintenance",children:e.jsx($,{onClick:()=>{c("unsetMaintenance"),d(!0)},children:e.jsx(yt,{})})}):e.jsx(O,{title:"Set Worker Maintenance",children:e.jsx($,{onClick:()=>{c("setMaintenance"),d(!0)},children:e.jsx(rs,{})})}),t.paused?e.jsx(O,{title:"Unset Worker Pause",children:e.jsx($,{onClick:()=>{c("unsetPaused"),d(!0)},children:e.jsx(bt,{})})}):e.jsx(O,{title:"Set Worker Pause",children:e.jsx($,{onClick:()=>{c("setPaused"),d(!0)},children:e.jsx(ns,{})})})]})]})},t.id)]})},Hn=s=>{const{workerId:t}=s,{data:r}=k(B.detail(t),()=>pn(t),{staleTime:1e3*61,select:l=>({...l,performance:l.performance.replace(" megapixelsteps per second","")})});return r==null?e.jsx(e.Fragment,{}):e.jsx(Us,{worker:r})},Bn=s=>{const{userId:t}=s,{data:r}=k(D.detail(t),()=>Je(t));if(r==null)return e.jsx(e.Fragment,{});const l=r.worker_ids;return l==null||(l==null?void 0:l.length)===0?e.jsx(m,{item:!0,md:12,lg:6,xl:4,children:e.jsx(x,{variant:"body1",children:"This user has no workers."})}):e.jsx(e.Fragment,{children:l.map(n=>e.jsx(Hn,{workerId:n},n))})},Kn=s=>s!=null&&"username"in s&&"id"in s,ue=s=>{const t=vs(s.split("#"));return t==null?null:vt(t)},Nn=()=>{const s=F(),[t,r]=b.useState(""),[l]=ks(t,400),{data:n}=k(D.all,Fs),{data:a,refetch:d}=k(D.detail(ue(l)??-1),()=>Je(ue(l)??-1),{enabled:!1});if(b.useEffect(()=>{d()},[l]),n==null)return e.jsx(e.Fragment,{});const p=(c,i)=>{if(Fe(i)){const u=ue(i);i!=="0"&&u!==0&&s(Ke(ue(i)??-1))}else Kn(i)&&i.id!==0&&s(Ke(i.id))};return e.jsx(Pe,{disablePortal:!0,options:[...a!=null&&a.id>4769?[a]:[],...n??[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:n==null,loadingText:"Loading users...",getOptionLabel:c=>Fe(c)?c:c.username,isOptionEqualToValue:(c,i)=>c.id===i.id,renderInput:c=>e.jsx(L,{...c,variant:"standard",label:"User Lookup",size:"small"}),onChange:p,onInputChange:(c,i)=>{i!=="0"&&ue(i)!==0&&r(i)}})},qn=s=>{const t=We(),r=g(i=>i.userPanel.selectedUser??-1),[l,n]=b.useState(s.invites),[a,d]=b.useState(s.invites),p=te(i=>Ye(i.id,i.data),{onSuccess:(i,u)=>{t.setQueryData(D.detail(u.id),y=>y&&{...y,...i}),i.worker_invited!=null&&(d(i.worker_invited),n(i.worker_invited)),s.success!=null&&s.success()}}),c=i=>{d(parseInt(i.target.value))};return e.jsxs(e.Fragment,{children:[l!=a?e.jsx(le,{onClick:()=>{const i={worker_invited:a};p.mutate({id:r,data:i})},loading:p.isLoading,variant:"contained",sx:{mr:4},children:"Save"}):null,e.jsx(L,{variant:"standard",type:"number",sx:{maxWidth:"100px"},onChange:c,value:a,InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})]})},Vn=()=>{const s=g(f=>f.userPanel.selectedUser??-1),t=We(),[r,l]=b.useState("setFlagged"),[n,a]=b.useState(!1),[d,p]=b.useState(!1),[c,i]=b.useState(!1),u=k(D.detail(s),()=>Je(s),{refetchInterval:1e3*15}),y=k(A.check(s),()=>Ln(s),{enabled:!c,onError:f=>i(!0),refetchInterval:1e3*15}),v=te(f=>Ye(f.id,f.data),{onSuccess:(f,T)=>{t.setQueryData(D.detail(T.id),M=>M&&{...M,...f}),a(!0)}}),E=te(f=>Mn(f.id),{onSuccess:(f,T)=>{a(!0)}}),K=te(f=>An(f.id,f.data),{onSuccess:(f,T)=>{t.invalidateQueries({queryKey:A.check(T.id)}),a(!0)}}),W=b.useMemo(()=>{var f,T,M,N,Z,ye,be,ve;return{resetSuspicion:{title:`Reset "${(f=u.data)==null?void 0:f.username}" Suspicion`,confirm:()=>{const _={reset_suspicion:!0};v.mutate({id:s,data:_}),p(!1)}},setFlagged:{title:`Flag "${(T=u.data)==null?void 0:T.username}" ratings and delete?`,body:e.jsx(e.Fragment,{children:e.jsx(x,{variant:"body1",sx:{fontWeight:"bold"},children:"Warning! This cannot be undone. Be sure you want to do this."})}),confirm:()=>{E.mutate({id:s}),p(!1)}},setTrusted:{title:`Set "${(M=u.data)==null?void 0:M.username}" as trusted?`,confirm:()=>{const _={trusted:!0};v.mutate({id:s,data:_}),p(!1)}},unsetTrusted:{title:`Unset "${(N=u.data)==null?void 0:N.username}" as trusted?`,confirm:()=>{const _={trusted:!1};v.mutate({id:s,data:_}),p(!1)}},setValidated:{title:`Set "${(Z=u.data)==null?void 0:Z.username}" ratings as validated`,confirm:()=>{const _={validated:!0};K.mutate({id:s,data:_}),p(!1)}},setUnvalidated:{title:`Set "${(ye=u.data)==null?void 0:ye.username}" ratings as unvalidated`,confirm:()=>{const _={validated:!1};K.mutate({id:s,data:_}),p(!1)}},setVPN:{title:`Allow "${(be=u.data)==null?void 0:be.username}" to use VPNs`,confirm:()=>{const _={vpn:!0};v.mutate({id:s,data:_}),p(!1)}},unsetVPN:{title:`Disallow "${(ve=u.data)==null?void 0:ve.username}" to use VPNs`,confirm:()=>{const _={vpn:!1};v.mutate({id:s,data:_}),p(!1)}}}},[u.data]);if(u.isLoading)return e.jsx(h,{py:4,sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(ge,{})});if(u.data==null)return e.jsx(e.Fragment,{});const o=y.data??null,j=(f,T)=>{T!=="clickaway"&&a(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{open:d,onClose:()=>p(!1),children:[e.jsx(G,{children:W[r].title}),e.jsx(ie,{children:W[r].body!=null?W[r].body:null}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>{p(!1)},children:"Cancel"}),e.jsx(C,{onClick:()=>{W[r].confirm()},children:"Confirm"})]})]}),e.jsx(Qe,{open:n,autoHideDuration:6e3,onClose:j,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ze,{onClose:j,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e.jsx(kt,{component:h,children:e.jsx(Ct,{size:"small",children:e.jsxs(St,{children:[e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Username"})}),e.jsx(S,{align:"right",children:e.jsxs(x,{variant:"body1",children:[u.data.username," ",u.data.moderator?"(moderator)":""]})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Trusted"})}),e.jsx(S,{align:"right",children:e.jsx(ee,{checked:u.data.trusted,onChange:f=>{u.data.trusted?l("unsetTrusted"):l("setTrusted"),p(!0)}})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Flagged"})}),e.jsx(S,{align:"right",children:e.jsx(ee,{checked:u.data.flagged,disabled:u.data.flagged,onChange:f=>{u.data.flagged||l("setFlagged"),p(!0)}})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"VPN Access"})}),e.jsx(S,{align:"right",children:e.jsx(ee,{checked:u.data.vpn,onChange:f=>{u.data.vpn?l("unsetVPN"):l("setVPN"),p(!0)}})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Worker Invites"})}),e.jsx(S,{align:"right",children:e.jsx(qn,{invites:u.data.worker_invited,success:()=>a(!0)})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Worker Count"})}),e.jsx(S,{align:"right",children:e.jsx(x,{variant:"body1",children:u.data.worker_count})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Kudos"})}),e.jsx(S,{align:"right",children:e.jsx(x,{variant:"body1",children:u.data.kudos})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Suspicious"})}),e.jsxs(S,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[e.jsx(x,{sx:{order:0},variant:"body1",children:u.data.suspicious}),u.data.suspicious>0?e.jsx(le,{onClick:async()=>{l("resetSuspicion"),p(!0)},loading:v.isLoading,variant:"contained",color:"error",sx:{ml:4},children:"Reset"}):null]})]}),o!=null?e.jsxs(e.Fragment,{children:[e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Ratings Validated"})}),e.jsx(S,{align:"right",children:e.jsx(ee,{checked:o.validated,onChange:f=>{o.validated?l("setUnvalidated"):l("setValidated"),p(!0)}})})]}),e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(S,{component:"th",scope:"row",children:e.jsx(x,{variant:"body1",children:"Flag User Ratings"})}),e.jsx(S,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:e.jsx(le,{onClick:async()=>{l("setFlagged"),p(!0)},loading:E.isLoading,variant:"contained",color:"error",sx:{order:0},children:"Flag"})})]})]}):null]})})})]})},zn=()=>{const s=We(),t=g(a=>a.userPanel.selectedUser),[r,l]=b.useState(!1);te(a=>Ye(a.id,a.data),{onSuccess:(a,d)=>{s.setQueryData(D.detail(d.id),p=>p!=null?{...p,...a}:a),l(!0)}});const n=(a,d)=>{d!=="clickaway"&&l(!1)};return e.jsxs(ne,{elevation:1,sx:{p:2,height:"100%"},children:[e.jsx(Qe,{open:r,autoHideDuration:6e3,onClose:n,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ze,{onClose:n,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e.jsx(h,{display:"flex",justifyContent:"space-between",children:e.jsx(Nn,{})}),e.jsx(h,{display:"flex",children:t!=null&&t!=-1?e.jsx(Vn,{}):null})]})},Qn=s=>{const{userId:t}=s,[r,l]=b.useState(!1),{data:n,isInitialLoading:a,isLoading:d,isError:p}=k(A.validate(t),()=>Dn(t),{enabled:!r,onError:i=>l(!0),refetchInterval:1e3*15}),c=i=>e.jsx(h,{sx:{display:"flex"},children:e.jsxs(x,{children:["r: ",i.rating,", a: ",i.artifacts,", avg: ",i.average,", n: ",i.times_rated]})});return d?e.jsx(h,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e.jsx(h,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e.jsx(ge,{})})}):p?e.jsx(x,{children:"User has no ratings."}):n==null?e.jsx(e.Fragment,{}):e.jsx(h,{children:e.jsx(ze,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:n.ratings.map(i=>e.jsxs(pe,{children:[e.jsx("img",{src:i.image}),e.jsx(me,{title:c(i)})]},i.image_id))})})},Zn=()=>{const s=F(),t=g(n=>n.userPanel.selectedUser),r=g(n=>n.userPanel.expandedPanel),l=n=>(a,d)=>{(n==="workers"||n==="ratings")&&s(Xt(d?n:!1))};return e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,lg:6,xl:6,children:e.jsx(zn,{})}),e.jsx(m,{item:!0,xs:12,lg:12,xl:12,children:e.jsxs(h,{children:[e.jsxs(as,{expanded:r==="workers",onChange:l("workers"),sx:{boxShadow:"none"},children:[e.jsx(is,{expandIcon:e.jsx(ls,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:e.jsx(x,{sx:{width:"33%",flexShrink:0},children:"Workers"})}),e.jsx(os,{sx:{backgroundColor:"background.default"},children:e.jsx(m,{container:!0,spacing:2,children:t!=null?e.jsx(Bn,{userId:t}):null})})]}),e.jsxs(as,{expanded:r==="ratings",onChange:l("ratings"),sx:{boxShadow:"none"},children:[e.jsx(is,{expandIcon:e.jsx(ls,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:e.jsx(x,{sx:{width:"33%",flexShrink:0},children:"Ratings"})}),e.jsx(os,{sx:{backgroundColor:"background.default"},children:r==="ratings"&&t!=null?e.jsx(Qn,{userId:t}):null})]})]})})]})},Jn=()=>{const s=F(),t=g(d=>d.utilityPanel.ipAddr),{data:r,refetch:l,isFetching:n}=k(["deleteIpAddr",t],()=>vn({ipaddr:t}),{enabled:!1,cacheTime:0}),a=d=>{s(sn(d.target.value))};return e.jsx(ne,{elevation:1,sx:{p:2,height:"100%"},children:e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",children:[e.jsx(x,{variant:"h4",children:"Clear IP Timeout"}),e.jsx(le,{onClick:()=>{oe(t)||l()},loading:n,variant:"contained",children:"Submit"})]}),e.jsx(L,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:a,placeholder:"Enter IP"}),r!=null?e.jsx(h,{pt:2,children:e.jsxs(x,{variant:"body1",children:["Response: ",r.message]})}):null]})})},Xn=()=>{const s=F(),t=g(d=>d.utilityPanel.prompt),{data:r,refetch:l,isFetching:n}=k(["promptCheck",t],()=>jn({filter_type:0,prompt:t}),{enabled:!1}),a=d=>{s(en(d.target.value))};return e.jsx(ne,{elevation:1,sx:{p:2,height:"100%"},children:e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",children:[e.jsx(x,{variant:"h4",children:"Prompt Checker"}),e.jsx(le,{onClick:()=>{oe(t)||l()},loading:n,variant:"contained",children:"Submit"})]}),e.jsx(L,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:a,placeholder:"Enter prompt"}),r!=null?e.jsxs(h,{pt:2,children:[e.jsxs(x,{variant:"body1",children:["Suspicion: ",r.suspicion]}),r.suspicion>0?e.jsxs(x,{variant:"body1",children:["Matches: ",JSON.stringify(r.matches)]}):null]}):null]})})},Yn=()=>e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(Xn,{})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(Jn,{})})]}),er=()=>{const s=g(a=>a.workerPanel.workerFilter),[t,r]=b.useState(s??""),[l]=ks(t,400),n=F();return b.useEffect(()=>{n(rn(l))},[l]),e.jsx(L,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:t,onChange:a=>{r(a.target.value)}})},gs={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},sr=()=>{const s=F(),t=g(i=>i.workerPanel.sortKey),r=g(i=>i.workerPanel.order),l=g(i=>i.workerPanel.workerFilter),n=g(i=>i.workerPanel.workerType),{data:a}=k(B.all,()=>Xe(),{refetchInterval:1e3*30,select:i=>{const u=l==null?void 0:l.toLowerCase();return _e(i.filter(y=>y.type!==n?!1:u==null?!0:y.name.toLowerCase().includes(u)||(y.owner??"").toLowerCase().includes(u)||y.id.toLowerCase().includes(u)||y.bridge_agent.toLowerCase().includes(u)),[y=>{const v=y[t];return Fe(v)?t==="performance"&&parseFloat(v)?parseFloat(v):v.toLowerCase():v}],[r])}}),d=i=>{var y;const u=i.target.value;s(nn(u)),s(hs(((y=Pt(gs[u]))==null?void 0:y.parameter)??"name"))},p=i=>{s(hs(i.target.value))},c=i=>{s(an(i))};return a==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",pb:2,children:[e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e.jsx(er,{})]}),e.jsxs(h,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[e.jsxs(Me,{sx:{mr:1},children:[e.jsx(Ae,{children:"Worker Type"}),e.jsxs(Le,{value:n,label:"Worker Type",onChange:d,sx:{".MuiSelect-select":{py:1}},children:[e.jsx(Q,{value:"image",children:"Image"}),e.jsx(Q,{value:"interrogation",children:"Interrogation"}),e.jsx(Q,{value:"text",children:"Text"})]})]}),e.jsxs(Me,{sx:{mr:1},children:[e.jsx(Ae,{children:"Sort Key"}),e.jsx(Le,{value:t,label:"Sort Key",onChange:p,sx:{".MuiSelect-select":{py:1}},children:gs[n].map(i=>e.jsx(Q,{value:i.parameter,children:i.label},i.label))})]}),r==="asc"?e.jsx($,{onClick:()=>c("desc"),children:e.jsx(wt,{})}):e.jsx($,{onClick:()=>c("asc"),children:e.jsx(It,{})})]})]}),e.jsx(m,{container:!0,spacing:2,children:a.map(i=>e.jsx(Us,{worker:i},i.id))})]})},fs=()=>{const{data:s,isLoading:t,error:r}=k(["mode"],Ps);if(t)return e.jsx(x,{variant:"h6",children:"Loading Horde status ..."});if(s==null||r)return console.log("HordeStatus error",r),e.jsx(x,{variant:"h6",children:"Error loading Horde status"});const l=n=>n?e.jsx(ds,{sx:{color:Y,ml:1}}):e.jsx(ds,{sx:{color:Ve,ml:1}});return e.jsxs(Ie,{children:[e.jsxs(V,{children:[e.jsx(De,{children:l(s.maintenance_mode)}),e.jsx(z,{primary:"Maintenance"})]}),e.jsxs(V,{children:[e.jsx(De,{children:l(s.invite_only_mode)}),e.jsx(z,{primary:"Invite Only"})]}),s.raid_mode!=null?e.jsxs(V,{children:[e.jsx(De,{children:l(s.raid_mode)}),e.jsx(z,{primary:"Raid"})]}):null]})},ys=()=>{const{data:s,isLoading:t,error:r}=k(["performance"],_s);return t?e.jsx(x,{variant:"h6",children:"Loading Horde status ..."}):s==null||r?e.jsx(x,{variant:"h6",children:"Error loading Horde status"}):e.jsxs(Ie,{children:[e.jsx(V,{children:e.jsx(z,{primary:`Queued Requests: ${s.queued_requests}`})}),e.jsx(V,{children:e.jsx(z,{primary:`Queued MPS: ${s.queued_megapixelsteps}`})}),e.jsx(V,{children:e.jsx(z,{primary:`Past Minute MPS: ${s.past_minute_megapixelsteps}`})}),e.jsx(V,{children:e.jsx(z,{primary:`Workers: ${s.worker_count}`})})]})},Ce=240,tr=()=>{const s=F(),t=g(l=>l.localState.sidebarOpen),r=()=>{s(ws(!t))};return e.jsxs(e.Fragment,{children:[e.jsxs(cs,{variant:"temporary",open:t,onClose:r,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:Ce,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:Ce}},children:[e.jsx(Ge,{}),e.jsxs(h,{sx:{overflow:"auto"},children:[e.jsx(ys,{}),e.jsx(he,{}),e.jsx(fs,{})]})]}),e.jsxs(cs,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:Ce,flexShrink:0,["& .MuiDrawer-paper"]:{width:Ce,boxSizing:"border-box"}},children:[e.jsx(Ge,{}),e.jsxs(h,{sx:{overflow:"auto"},children:[e.jsx(ys,{}),e.jsx(he,{}),e.jsx(fs,{})]})]})]})},nr=()=>{const s=F(),t=g(l=>l.persist.selectedTab),r=(l,n)=>{n!="4"&&s(Be(!1)),s(Is(n))};return e.jsxs(h,{display:"flex",children:[e.jsx(tr,{}),e.jsx(h,{sx:{display:"flex",flexDirection:"column",flex:"1 1 auto",maxWidth:"100vw"},children:e.jsxs(_t,{value:t,children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ft,{value:t,onChange:r,scrollButtons:!0,allowScrollButtonsMobile:!0,variant:"scrollable",children:[e.jsx(J,{label:"User Lookup",value:"1"}),e.jsx(J,{label:"Workers",value:"2"}),e.jsx(J,{label:"Comparator",value:"3"}),e.jsx(J,{label:"Ratings",value:"4"}),e.jsx(J,{label:"Utilities",value:"5"}),e.jsx(J,{label:"Settings",value:"6"}),e.jsx(J,{label:"About",value:"7"})]})}),e.jsx(X,{value:"1",children:e.jsx(Zn,{})}),e.jsx(X,{value:"2",children:e.jsx(sr,{})}),e.jsx(X,{value:"3",children:e.jsx(Wn,{})}),e.jsx(X,{value:"4",children:e.jsx(Gn,{})}),e.jsx(X,{value:"5",children:e.jsx(Yn,{})}),e.jsx(X,{value:"6",children:e.jsx($n,{})}),e.jsx(X,{value:"7",children:e.jsx(Cn,{})})]})})]})},Se=()=>{const s=F(),t=g(l=>l.localState.sidebarOpen),r=()=>{s(ws(!t))};return e.jsx(Tt,{position:"sticky",sx:{zIndex:l=>l.zIndex.drawer+1},children:e.jsxs(Ge,{children:[e.jsx($,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:r,sx:{mr:2,display:{md:"none"}},children:e.jsx(Ot,{})}),e.jsxs(x,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Horde Control Tower v","0.0.9"]}),null]})})},rr=async s=>{const t=window.document.createElement("canvas"),r=window.Image,l=(await Promise.allSettled([s].map(async a=>await new Promise((d,p)=>{let c;Wt(a,"src")?c=a:c={src:a};const i=new r;i.onerror=()=>p(new Error("Couldn't load image")),i.onload=()=>d({...c,img:i}),i.src=c.src,i.crossOrigin="anonymous"})))).filter(a=>a.status==="fulfilled").map(a=>a.value),n=t.getContext("2d");if(n==null)throw new Error("Couldn't create canvas context");{const a=d=>Math.max(...l.map(p=>{var c;return((c=p==null?void 0:p.img)==null?void 0:c[d])??0}));return t.width=a("width"),t.height=a("height"),l.forEach(d=>{if(d!=null&&(n.globalAlpha=d.opacity!=null?d.opacity:1,d.img!=null))return n.drawImage(d.img,d.x??0,d.y??0)}),t.toDataURL("image/webp")}},ar=s=>{const{gen:t,...r}=s,l=F();return k(["check",t.id],()=>fn(t.id),{refetchInterval:2e3,enabled:t.state==="check",onSuccess:n=>{if(t.state==="check"){let a=t.state;n.faulted?a="error":n.done&&(a="status"),l(we({...t,state:a,check:n}))}}}),k(["status",t.id],()=>yn(t.id),{refetchInterval:!1,enabled:t.state==="status",onSuccess:async n=>{if(t.state==="status"){let a=t.state;if(n.faulted)a="error";else if(n.done){a="complete";const d=await rr(n.generations[0].img);n.generations[0].img=d}l(we({...t,state:a,status:n}))}}}),k(["delete",t.id],()=>bn(t.id),{refetchInterval:!1,retry:!1,enabled:t.state==="delete",onSuccess:async n=>{l(we({...t,state:"complete",status:n}))}}),e.jsx(e.Fragment,{})},ir=()=>{const s=g(t=>t.persist.imageGens);return oe(s)?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:s.map(t=>e.jsx(ar,{gen:t},t.id))})},lr=()=>{const s=g(n=>n.persist.apikey),{data:t,refetch:r,isLoading:l}=k(["findUser"],()=>hn(s),{enabled:!oe(s),retry:1});return b.useEffect(()=>{r()},[s]),l?e.jsxs(h,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e.jsx(Se,{}),e.jsx(h,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e.jsx(ge,{})})]}):oe(s)||t==null?e.jsxs(h,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e.jsx(Se,{}),e.jsxs(h,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e.jsx(x,{variant:"h4",children:"Please enter your API key."}),e.jsx(Ws,{})]})]}):t.moderator?e.jsxs(h,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(ir,{}),e.jsx(kn,{}),e.jsx(Se,{}),e.jsx(nr,{})]}):e.jsxs(h,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e.jsx(Se,{}),e.jsx(h,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e.jsx(x,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};se.prototype.__toHuman__=se.prototype.toHuman;se.prototype.toHuman=function(s={stripZeroUnits:"all"}){let t=this.normalize(),r=[],l=typeof s.precision=="object"?se.fromObject(s.precision):se.fromMillis(0),n=t;const a=["years","months","days","hours","minutes","seconds","milliseconds"];let d,p;s.smallestUnit&&(d=a.indexOf(s.smallestUnit)),s.biggestUnit&&(p=a.indexOf(s.biggestUnit)),(!d||!(d>=0&&d<a.length))&&(d=a.indexOf("seconds")),(!p||!(p<=d&&p<a.length))&&(p=a.indexOf("years"));for(let c of a.slice(p,d+1)){if(n.as(c)>=1){r.push(c);let u={};if(u[c]=Math.floor(n.as(c)),n=n.minus(se.fromObject(u)).normalize(),n<l)break}if(s.maxUnits&&r.length>=s.maxUnits)break}if(t=t.minus(n).normalize(),t=t.shiftTo(...r),s.stripZeroUnits=="all")r=r.filter(c=>t.values[c]>0);else if(s.stripZeroUnits=="end"){let c=!0;r=r.reverse().filter(i=>c?t.values[i]==0?!1:(c=!1,!0):!0)}return r.length||r.push(a[d]),t.shiftTo(...r).__toHuman__(s)};const or=Ut({key:"mui",prepend:!0}),dr=Dt({palette:{mode:"dark"}}),cr=new Lt({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:(s,t)=>{var r;if(Oe.isAxiosError(t)){if(((r=t.response)==null?void 0:r.status)!=null&&t.response.status>=400&&t.response.status<500)return!1}else return s<3;return s<3}}}});Mt(document.getElementById("root")).render(e.jsx(At,{value:or,children:e.jsxs(Gt,{theme:dr,children:[e.jsx($t,{}),e.jsxs(Et,{client:cr,children:[e.jsx(Rt,{store:fe,children:e.jsx(Ht,{loading:null,persistor:un,children:e.jsx(lr,{})})}),null]})]})}));
