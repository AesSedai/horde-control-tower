import{c as J,a as It,b as Pt,p as _t,d as Ft,e as Ot,s as Dt,f as Tt,F as Wt,R as Lt,P as Mt,g as Gt,h as Ut,i as At,j as Ye,u as C,k as e,l as b,B as m,m as Z,n as r,T as p,L as $e,o as Et,q as $t,r as k,D as he,t as E,v as se,w as ke,x as me,y as H,z as Re,A as q,C as K,E as v,G as W,I as M,H as Rt,M as Kt,J as B,K as ie,N as Ht,O as qt,Q as Ce,S as Xe,U as Se,V as ye,W as Bt,X as Nt,Y as g,Z as w,_ as jt,$ as zt,a0 as et,a1 as re,a2 as te,a3 as ge,a4 as we,a5 as be,a6 as tt,a7 as fe,a8 as Vt,a9 as xe,aa as nt,ab as rt,ac as Qt,ad as Zt,ae as Jt,af as at,ag as j,ah as Ue,ai as st,aj as it,ak as Yt,al as Xt,am as L,an as en,ao as tn,ap as Ke,aq as He,ar as nn,as as rn,at as an,au as sn,av as Q,aw as ln,ax as on,ay as dn,az as cn,aA as un,aB as lt,aC as hn,aD as pn,aE as mn,aF as gn,aG as V,aH as O,aI as qe,aJ as fn,aK as xn,aL as yn,aM as Ie,aN as Be,aO as Ne,aP as Pe,aQ as bn,aR as vn,aS as X,aT as ee,aU as kn,aV as Cn,aW as Sn,aX as wn,aY as In,aZ as Pn,a_ as _n,a$ as Fn,b0 as On,b1 as Dn,b2 as Tn,b3 as Wn,b4 as Ln}from"./vendor.be4059b7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();const Mn={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},_e=J({name:"comparatorPanel",initialState:Mn,reducers:{setSelectedModel:(n,t)=>{n.selectedModel=t.payload},setSelectedWorkers:(n,t)=>{n.selectedWorkers=t.payload},setGenForm:(n,t)=>{n.genForm=structuredClone(t.payload)},setReload:(n,t)=>{n.reload=t.payload}}}),{setSelectedModel:je,setSelectedWorkers:de,setGenForm:ot,setReload:dt}=_e.actions,Gn={sidebarOpen:!1},Fe=J({name:"localState",initialState:Gn,reducers:{setSidebarOpen:(n,t)=>{n.sidebarOpen=t.payload}}}),{setSidebarOpen:ct}=Fe.actions,Oe={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},le=J({name:"persist",initialState:Oe,reducers:{setKey:(n,t)=>{n.apikey=t.payload},setSelectedTab:(n,t)=>{n.selectedTab=t.payload},resetImageGens:n=>{n.imageGens=[]},addImageGen:(n,t)=>{n.imageGens.find(c=>c.id===t.payload.id)||n.imageGens.push(t.payload)},updateImageGen:(n,t)=>{const s=n.imageGens.findIndex(c=>c.id===t.payload.id);s!=null&&(n.imageGens[s]=t.payload)},addGenFavorite:(n,t)=>{n.genFavorites.push(t.payload)},updateGenFavorite:(n,t)=>{n.genFavorites[t.payload.idx]={name:n.genFavorites[t.payload.idx].name,form:t.payload.form}},deleteGenFavorite:(n,t)=>{n.genFavorites.splice(t.payload)},resetExceptApiKey:n=>(n={...Oe,apikey:n.apikey},n)}}),{setKey:Un,setSelectedTab:An,resetImageGens:ze,addImageGen:En,updateImageGen:pe,addGenFavorite:$n,resetExceptApiKey:Yr,updateGenFavorite:Rn,deleteGenFavorite:Kn}=le.actions,Hn={showPassword:!1},De=J({name:"settingsPanel",initialState:Hn,reducers:{setShowPassword:(n,t)=>{n.showPassword=t.payload}}}),{setShowPassword:Te}=De.actions,qn={},We=J({name:"userPanel",initialState:qn,reducers:{setUser:(n,t)=>{n.selectedUser=t.payload}}}),{setUser:Ve}=We.actions,Bn={prompt:"",ipAddr:""},Le=J({name:"utilityPanel",initialState:Bn,reducers:{setPrompt:(n,t)=>{n.prompt=t.payload},setIpAddr:(n,t)=>{n.ipAddr=t.payload}}}),{setPrompt:Nn,setIpAddr:jn}=Le.actions,zn={sortKey:"name",order:"asc"},Me=J({name:"workerPanel",initialState:zn,reducers:{setWorkerFilter:(n,t)=>{n.workerFilter=t.payload},setSortKey:(n,t)=>{n.sortKey=t.payload},setOrder:(n,t)=>{n.order=t.payload}}}),{setWorkerFilter:Vn,setSortKey:Qn,setOrder:Zn}=Me.actions,Jn=It((n,t)=>n,(n,t)=>Object.assign({},Oe,n),{whitelist:[le.name]}),Yn={key:"root",storage:Tt,whitelist:[le.name],transforms:[Jn]},Xn=Pt({[le.name]:le.reducer,[Fe.name]:Fe.reducer,[De.name]:De.reducer,[We.name]:We.reducer,[Le.name]:Le.reducer,[Me.name]:Me.reducer,[_e.name]:_e.reducer}),er=_t(Yn,Xn),ve=Ft({reducer:er,middleware:n=>n({serializableCheck:{ignoredActions:[Wt,Lt,Mt,Gt,Ut,At]}}),devTools:!1}),tr=Ot(ve);Dt(ve.dispatch);const P=Ye.create({baseURL:"https://stablehorde.net/api/v2/"});P.interceptors.request.use(function(n){const t=ve.getState().persist.apikey;return n.headers!=null&&t!=null&&(n.headers.apikey=t),n},function(n){return Promise.reject(n)});const nr=Ye.create({baseURL:"/horde-control-tower/"}),rr=n=>P.get("find_user",{headers:{apikey:n}}).then(t=>t.data),ut=()=>P.get("status/modes").then(n=>n.data),ht=()=>P.get("status/performance").then(n=>n.data),pt=()=>nr.get("users.json").then(n=>n.data),Ae=n=>P.get(`users/${n}`).then(t=>t.data),Ee=()=>P.get("workers").then(n=>n.data),ar=n=>P.get(`workers/${n}`).then(t=>t.data),mt=()=>P.get("status/models").then(n=>n.data),gt=(n,t)=>P.put(`users/${n}`,t).then(s=>s.data),sr=(n,t)=>P.put(`workers/${n}`,t).then(s=>s.data),ir=n=>P.post("filters",n).then(t=>t.data),lr=n=>P.post("generate/async",n).then(t=>t.data),or=n=>P.get(`generate/check/${n}`).then(t=>t.data),dr=n=>P.get(`generate/status/${n}`).then(t=>t.data),cr=n=>P.delete(`generate/status/${n}`).then(t=>t.data),ur=n=>P.delete("operations/ipaddr",{data:n}).then(t=>t.data),G={all:["users"],lists:()=>[...G.all,"list"],list:n=>[...G.lists(),{filters:n}],details:()=>[...G.all,"detail"],detail:n=>[...G.details(),n]},$={all:["workers"],lists:()=>[...$.all,"list"],list:n=>[...$.lists(),{filters:n}],details:()=>[...$.all,"detail"],detail:n=>[...$.details(),n]},hr=()=>(C(G.all,pt,{staleTime:1e3*30,refetchInterval:1e3*30}),C(["performance"],ht,{staleTime:1e3*30,refetchInterval:1e3*30}),C(["mode"],ut,{staleTime:1e3*30,refetchInterval:1e3*30}),C(["models"],mt,{staleTime:1e3*30,refetchInterval:1e3*30}),e(b,{})),pr=()=>e(m,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(Z,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(m,{children:[e(p,{variant:"h4",textAlign:"center",children:"About"}),r(p,{variant:"body1",children:["Horde Control Tower is an open source"," ",e($e,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(p,{variant:"body1",children:["The project source is available on"," ",e($e,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),D=()=>$t(),y=Et,mr=()=>{const n=D(),t=y(I=>I.comparatorPanel.genForm),s=y(I=>I.persist.genFavorites),[c,a]=k.exports.useState(!1),[o,i]=k.exports.useState(-1),[h,l]=k.exports.useState(!1),[u,f]=k.exports.useState(-1),[_,S]=k.exports.useState(!1),[U,N]=k.exports.useState(""),[z,d]=k.exports.useState(null),x=Boolean(z),F=I=>{d(I.currentTarget)},A=()=>{d(null)},oe=()=>{S(!1)},Y=()=>{n($n({name:U,form:t})),N(""),S(!1)},ne=()=>{i(-1),a(!1)},yt=()=>{n(Rn({idx:o,form:t})),i(-1),a(!1)},bt=()=>{f(-1),l(!1)},vt=()=>{n(Kn(u)),f(-1),l(!1)},kt=I=>{n(ot(I)),n(dt(!0)),d(null)},Ct=()=>{S(!0),d(null)},St=()=>{a(!0),d(null)},wt=()=>{l(!0),d(null)};return r(b,{children:[r(he,{open:h,onClose:ne,children:[e(E,{children:"Delete Preset"}),r(se,{children:[e(ke,{children:"Select a preset to delete."}),e(me,{children:s.map((I,R)=>e(H,{disablePadding:!0,sx:{backgroundColor:u===R?"error.dark":""},onClick:()=>{f(R)},children:e(Re,{children:e(q,{primary:I.name})})},R))})]}),r(K,{children:[e(v,{onClick:bt,children:"Cancel"}),e(v,{disabled:u===-1,onClick:vt,children:"Select"})]})]}),r(he,{open:c,onClose:ne,children:[e(E,{children:"Overwrite Preset"}),r(se,{children:[e(ke,{children:"Select a preset to overwrite."}),e(me,{children:s.map((I,R)=>e(H,{disablePadding:!0,sx:{backgroundColor:o===R?"success.dark":""},onClick:()=>{i(R)},children:e(Re,{children:e(q,{primary:I.name})})},R))})]}),r(K,{children:[e(v,{onClick:ne,children:"Cancel"}),e(v,{disabled:o===-1,onClick:yt,children:"Select"})]})]}),r(he,{open:_,onClose:oe,children:[e(E,{children:"Add New Preset"}),r(se,{children:[e(ke,{children:"Enter a friendly name for this new preset."}),e(W,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:U,onChange:I=>{N(I.target.value)}})]}),r(K,{children:[e(v,{onClick:oe,children:"Cancel"}),e(v,{onClick:Y,children:"Create"})]})]}),e(M,{onClick:F,children:e(Rt,{})}),r(Kt,{anchorEl:z,open:x,onClose:A,children:[s.map((I,R)=>e(B,{onClick:()=>{kt(I.form)},children:I.name},R)),s.length>0?e(ie,{}):null,s.length>0?e(B,{onClick:wt,children:"Delete Preset"}):null,s.length>0?e(ie,{}):null,s.length>0?e(B,{onClick:St,children:"Overwrite Preset"}):null,s.length>0?e(ie,{}):null,e(B,{onClick:Ct,children:"Add New Preset"})]})]})},gr=()=>{const n=y(a=>a.persist.imageGens),{data:t}=C($.all,()=>Ee(),{refetchInterval:1e3*30,select:a=>Ht(a.map(o=>[o.id,o.name]))}),s=a=>{var i,h,l;const o=a.status!=null?a.status:a.check;return a.state!=="complete"&&o!=null?r(Ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(Xe,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(Se,{title:t==null?"":t[(i=a.payload.workers[0])!=null?i:""],subtitle:`Position: ${o.queue_position}, wait time: ${o.wait_time}`})]},a.id):a.state==="complete"?c(a).length===0?r(Ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(p,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(Se,{title:t==null?"":t[(h=a.payload.workers[0])!=null?h:""]})]},a.id):r(Ce,{sx:{paddingTop:c(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:c(a)}),e(Se,{title:t==null?"":t[(l=a.payload.workers[0])!=null?l:""]})]},a.id):e(b,{})},c=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(m,{children:e(qt,{sx:{width:"100%",height:"100%"},cols:4,children:n.map(a=>s(a))})})},fr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],xr=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],T="175px",yr=()=>{const n=D(),t=y(d=>d.comparatorPanel.selectedWorkers),s=y(d=>d.comparatorPanel.selectedModel),c=y(d=>d.comparatorPanel.genForm),a=y(d=>d.persist.imageGens),o=y(d=>d.persist.imageGens.length>0),i=y(d=>d.comparatorPanel.reload),h=y(d=>d.persist.imageGens.some(x=>["pending","check"].includes(x.state))),{mutate:l}=ye({mutationFn:lr,onSuccess:(d,x,F)=>{n(En({id:d.id,payload:x,state:"check",check:null,status:null}))}}),{handleSubmit:u,control:f,formState:{errors:_},watch:S,setValue:U,reset:N}=Bt({defaultValues:c}),z=d=>{s!=null&&t.length>0&&(n(ze()),t.forEach(x=>{const F={...d,workers:[x.id],models:[s.name]};l(F)}))};return k.exports.useEffect(()=>{const d=S(Nt((x,{name:F,type:A})=>{n(ot(x))},300));return()=>d.unsubscribe()},[S]),k.exports.useEffect(()=>{i&&(n(dt(!1)),N(c))},[i]),e(m,{children:r("form",{onSubmit:u(z),children:[r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Prompt"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"prompt",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(W,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...d})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Seed"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.seed",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(W,{fullWidth:!0,placeholder:"Seed",...d})})}),e(g,{item:!0,children:e(M,{"aria-label":"randomize seed",onClick:()=>{U("params.seed",jt(1e8,999999999).toString())},children:e(zt,{})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Sampler"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.sampler_name",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(et,{...d,fullWidth:!0,children:xr.map(x=>e(B,{value:x,children:x},x))})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Steps"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.steps",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(re,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...d})})}),e(w,{name:"params.steps",control:f,render:({field:d})=>e(g,{item:!0,children:e(te,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Width"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.width",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(re,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(w,{name:"params.width",control:f,render:({field:d})=>e(g,{item:!0,children:e(te,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Height"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.height",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(re,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(w,{name:"params.height",control:f,render:({field:d})=>e(g,{item:!0,children:e(te,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"CFG"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.cfg_scale",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(re,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...d})})}),e(w,{name:"params.cfg_scale",control:f,render:({field:d})=>e(g,{item:!0,children:e(te,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Clip Skip"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.clip_skip",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(re,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...d})})}),e(w,{name:"params.clip_skip",control:f,render:({field:d})=>e(g,{item:!0,children:e(te,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Post-Processors"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.post_processing",control:f,render:({field:{onChange:d,onBlur:x,value:F,name:A,ref:oe}})=>e(g,{item:!0,xs:!0,children:e(ge,{fullWidth:!0,multiple:!0,onBlur:x,ref:oe,value:F,onChange:(Y,ne)=>{d(ne)},options:fr,getOptionLabel:Y=>Y,renderInput:Y=>e(W,{...Y})})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"High Res Fix"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.hires_fix",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(we,{...d,checked:d.value})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Karras"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.karras",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(we,{...d,checked:d.value})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:T},children:"Tiling"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.tiling",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(we,{...d,checked:d.value})})})})]}),e(be,{type:"submit",loading:h,variant:"contained",children:"Submit"}),h?e(v,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(d=>["pending","check"].includes(d.state)).forEach(d=>{n(pe({...d,state:"delete"}))})},children:"Cancel"}):null,o?e(v,{sx:{ml:2},variant:"contained",onClick:()=>{n(ze())},children:"Clear Output"}):null]})})},br=n=>n!=null&&"name"in n,vr=n=>n!=null&&tt(n)&&"name"in n[0]&&"id"in n[0],Qe="175px",kr=()=>{const n=D(),t=y(l=>l.comparatorPanel.selectedWorkers),s=y(l=>l.comparatorPanel.selectedModel),c=(l,u)=>{tt(u)&&u.length===0?n(de([])):vr(u)&&n(de(u))},a=(l,u)=>{u==null?n(je(null)):br(u)&&n(je(u))},{data:o}=C($.all,()=>Ee(),{refetchInterval:1e3*30,select:l=>fe(l,[u=>u.name.toLowerCase()],["asc"])}),{data:i}=C(["models"],mt,{staleTime:1e3*30,refetchInterval:1e3*30,select:l=>fe(l,[u=>u.name.toLowerCase()],["asc"])});k.exports.useEffect(()=>{if(s!=null&&t.length>0){const l=t.map(_=>_.id),u=t.filter(_=>{var S;return(S=_==null?void 0:_.models)==null?void 0:S.includes(s.name)}),f=u.map(_=>_.id);Vt(l,f)||n(de(u))}else s==null&&t.length>0&&n(de([]))},[o,i,t,s]);const h=(o!=null?o:[]).filter(l=>{var u;return s==null?!0:(u=l==null?void 0:l.models)==null?void 0:u.includes(s.name)});return r(m,{children:[r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:Qe},children:"Model"}),e(ge,{fullWidth:!0,disablePortal:!0,options:i!=null?i:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:l=>xe(l)?l:l.name,isOptionEqualToValue:(l,u)=>l.name===u.name,filterSelectedOptions:!0,renderInput:l=>e(W,{...l,label:"Selected Model"}),onChange:a})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:Qe},children:"Workers"}),e(ge,{fullWidth:!0,multiple:!0,disablePortal:!0,options:h,value:t,getOptionLabel:l=>l.name,isOptionEqualToValue:(l,u)=>l.id===u.id,filterSelectedOptions:!0,renderInput:l=>e(W,{...l,label:"Selected Workers"}),onChange:c})]})]})},Cr=()=>r(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,xl:4,children:r(Z,{sx:{p:2},children:[r(m,{sx:{position:"relative"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(m,{sx:{position:"absolute",top:0,right:0},children:e(mr,{})})]}),e(kr,{}),e(yr,{})]})}),e(g,{item:!0,xs:12,xl:8,children:r(Z,{sx:{p:2,height:"100%"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(gr,{})]})})]}),ft=()=>{const n=D(),t=y(a=>a.persist.apikey),s=y(a=>a.settingsPanel.showPassword);return r(nt,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(rt,{children:"API Key"}),e(te,{defaultValue:t,onBlur:a=>{n(Un(a.target.value)),n(Te(!1))},type:s?"text":"password",endAdornment:e(Qt,{position:"end",children:e(M,{onClick:()=>n(Te(!s)),children:s?e(Zt,{}):e(Jt,{})})})})]})},Sr=()=>e(g,{container:!0,spacing:2,children:e(g,{item:!0,md:12,lg:6,xl:4,children:e(Z,{children:e(ft,{})})})}),Ge="#0583B0",ae="#FF6962",wr="#7c0500",Ir="#ef9b0f",Pr=n=>at(n)||!j(n)&&!isNaN(parseFloat(n)),xt=n=>{var z,d;const{worker:t}=n,s=Ue(),[c,a]=k.exports.useState(!1),[o,i]=k.exports.useState(!1),[h,l]=k.exports.useState("setFlagged"),[u,f]=k.exports.useState(""),_=x=>parseFloat(x.performance)>3?Ir:x.maintenance_mode||x.paused||x.flagged?wr:"background.paper",S=ye(x=>sr(x.id,x.data),{onSuccess:(x,F)=>{a(!0),s.invalidateQueries({queryKey:$.detail(F.id)}),s.invalidateQueries({queryKey:$.all})}}),U=(x,F)=>{F!=="clickaway"&&a(!1)};return r(b,{children:[e(he,{open:o,onClose:()=>i(!1),children:(x=>{var F;switch(x){case"setFlagged":return r(b,{children:[r(E,{children:['Set "',t.name,'" as Flagged']}),r(K,{children:[e(v,{onClick:()=>{i(!1)},children:"Cancel"}),e(v,{onClick:()=>{i(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(b,{children:[r(E,{children:['Unset "',t.name,'" as Flagged']}),r(K,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{i(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(b,{children:[r(E,{children:['Set "',t.name,'" Maintenance Mode']}),e(se,{children:e(W,{value:u,onChange:A=>{f(A.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(K,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{const A={maintenance:!0};j(u)||(A.maintenance_msg=u),S.mutate({id:t.id,data:A}),i(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(b,{children:[r(E,{children:['Unset "',t.name,'" Maintenance Mode']}),r(K,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{S.mutate({id:t.id,data:{maintenance:!1,maintenance_msg:""}}),i(!1)},children:"Confirm"})]})]});case"setPaused":return r(b,{children:[r(E,{children:['Set "',t.name,'" Paused Mode']}),r(K,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{S.mutate({id:t.id,data:{paused:!0}}),i(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(b,{children:[r(E,{children:['Unset "',t.name,'" Paused Mode']}),r(K,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{S.mutate({id:t.id,data:{paused:!1}}),i(!1)},children:"Confirm"})]})]});case"listModels":return r(b,{children:[r(E,{children:['"',t.name,'" Models']}),e(se,{children:e(p,{variant:"body1",children:fe((F=t==null?void 0:t.models)!=null?F:[],[A=>A.toLowerCase()]).join(", ")})})]})}})(h)}),e(st,{open:c,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(it,{onClose:U,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(g,{item:!0,xs:12,lg:6,xl:3,children:r(Yt,{sx:{backgroundColor:_(t)},children:[e(Xt,{avatar:t.online&&!t.paused&&!t.maintenance_mode&&!t.flagged?e(L,{title:"Worker Online",children:e(en,{sx:{color:Ge}})}):e(L,{title:"Worker Issue",children:e(tn,{sx:{color:ae}})}),action:r(m,{children:[t.paused?e(L,{title:"Worker Paused",children:e(Ke,{sx:{color:ae,mt:.5,mr:1}})}):null,t.maintenance_mode?e(L,{title:"Worker Maintenance",children:e(He,{sx:{color:ae,mt:.5,mr:1}})}):null,t.flagged?e(L,{title:"User Flagged",children:e(nn,{sx:{color:ae,mt:.5,mr:1}})}):null,t.trusted?e(L,{title:"Trusted Worker",children:e(rn,{sx:{color:Ge,mt:.5,mr:1}})}):null]}),title:e(p,{variant:"h5",children:an(t.name,{length:30})}),subheader:t.id}),r(sn,{children:[r(p,{variant:"body2",children:["Full Name: ",t.name]}),r(p,{variant:"body2",children:["Owner: ",t.owner]}),r(p,{variant:"body2",children:["Uptime: ",Q.fromObject({seconds:t.uptime}).toHuman()]}),r(p,{variant:"body2",children:["Models Loaded: ",(d=(z=t==null?void 0:t.models)==null?void 0:z.length)!=null?d:"None"]}),r(p,{variant:"body2",children:["MPS Generated: ",t.megapixelsteps_generated]}),r(p,{variant:"body2",children:["Speed: ",t.performance," ",Pr(t.performance)?"MPS":null]}),r(p,{variant:"body2",children:["Threads: ",t.threads]}),r(p,{variant:"body2",children:["Requests Fulfilled: ",t.requests_fulfilled]}),r(p,{variant:"body2",children:["NSFW: ",t.nsfw?"true":"false"]})]}),r(ln,{disableSpacing:!0,children:[e(L,{title:"Show Worker Models",children:e(M,{onClick:()=>{l("listModels"),i(!0)},children:e(on,{})})}),t.maintenance_mode?e(L,{title:"Unset Worker Maintenance",children:e(M,{onClick:()=>{l("unsetMaintenance"),i(!0)},children:e(dn,{})})}):e(L,{title:"Set Worker Maintenance",children:e(M,{onClick:()=>{l("setMaintenance"),i(!0)},children:e(He,{})})}),t.paused?e(L,{title:"Unset Worker Pause",children:e(M,{onClick:()=>{l("unsetPaused"),i(!0)},children:e(cn,{})})}):e(L,{title:"Set Worker Pause",children:e(M,{onClick:()=>{l("setPaused"),i(!0)},children:e(Ke,{})})})]})]})},t.id)]})},_r=n=>{const{workerId:t}=n,{data:s}=C($.detail(t),()=>ar(t),{staleTime:1e3*61,select:c=>({...c,performance:c.performance.replace(" megapixelsteps per second","")})});return s==null?e(b,{}):e(xt,{worker:s})},Fr=n=>{const{userId:t}=n,{data:s}=C(G.detail(t),()=>Ae(t));return s==null?e(b,{}):s.worker_ids.length===0?e(g,{item:!0,md:12,lg:6,xl:4,children:e(p,{variant:"body1",children:"This user has no workers."})}):e(b,{children:s.worker_ids.map(c=>e(_r,{workerId:c},c))})},[Or,Dr,Tr]=un(),Wr=n=>n!=null&&"username"in n&&"id"in n,Lr=()=>{const n=D(),[t,s]=k.exports.useState(-1),[c]=lt(t,400),{data:a}=C(G.all,pt),{data:o,refetch:i}=C(G.detail(c),()=>Ae(c),{enabled:!1});if(k.exports.useEffect(()=>{at(c)&&c>=4770&&i()},[c]),a==null)return e(b,{});const h=(l,u)=>{xe(u)?n(Ve(parseInt(u))):Wr(u)&&n(Ve(u.id))};return e(ge,{disablePortal:!0,options:[...o!=null?[o]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:l=>xe(l)?l:l.username,isOptionEqualToValue:(l,u)=>l.id===u.id,renderInput:l=>e(W,{...l,variant:"standard",label:"User Lookup",size:"small"}),onChange:h,onInputChange:(l,u)=>{s(hn(u))}})},Mr=()=>{const n=y(i=>{var h;return(h=i.userPanel.selectedUser)!=null?h:-1}),t=Ue(),{data:s,isInitialLoading:c}=C(G.detail(n),()=>Ae(n),{refetchInterval:1e3*15}),a=ye(i=>gt(i.id,i.data),{onSuccess:(i,h)=>{t.invalidateQueries({queryKey:G.detail(h.id)})}}),o=Dr();return k.exports.useEffect(()=>{if(s!=null){const i={trusted:s.trusted,flagged:s.flagged,worker_invite:s.worker_invited.toString()};o.setValues(i),o.resetDirty(i)}},[c]),s==null?e(b,{}):e(pn,{component:m,children:e(mn,{size:"small",children:r(gn,{children:[r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Username"})}),e(O,{align:"right",children:r(p,{variant:"body1",children:[s.username," ",s.moderator?"(moderator)":""]})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Trusted"})}),e(O,{align:"right",children:e(qe,{...o.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Flagged"})}),e(O,{align:"right",children:e(qe,{...o.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Invites"})}),e(O,{align:"right",children:e(W,{variant:"standard",type:"number",...o.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Count"})}),e(O,{align:"right",children:e(p,{variant:"body1",children:s.worker_count})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Kudos"})}),e(O,{align:"right",children:e(p,{variant:"body1",children:s.kudos})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Suspicious"})}),r(O,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[s.suspicious>0?e(be,{onClick:async()=>{const i={reset_suspicion:!0};a.mutate({id:n,data:i})},loading:a.isLoading,variant:"contained",color:"error",sx:{order:0,mr:4},children:"Reset"}):null,e(p,{sx:{order:1},variant:"body1",children:s.suspicious})]})]})]})})})},Gr=()=>{const n=Ue(),t=y(h=>h.userPanel.selectedUser),[s,c]=k.exports.useState(!1),a=Tr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),o=ye(h=>gt(h.id,h.data),{onSuccess:(h,l)=>{var f,_,S,U;n.setQueryData(G.detail(l.id),N=>N!=null?{...N,...h}:h);const u={trusted:(f=h.trusted)!=null?f:!1,flagged:(_=h.flagged)!=null?_:!1,worker_invite:(U=(S=h.worker_invite)==null?void 0:S.toString())!=null?U:"0"};j(u)||(a.setValues(u),a.resetDirty(u)),c(!0)}}),i=(h,l)=>{l!=="clickaway"&&c(!1)};return r(Z,{elevation:1,sx:{p:2,height:"100%"},children:[e(st,{open:s,autoHideDuration:6e3,onClose:i,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(it,{onClose:i,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((h,l)=>{if(t!=null){const u={trusted:h.trusted,flagged:h.flagged,worker_invite:parseInt(h.worker_invite)};o.mutate({id:t,data:u})}}),children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(Lr,{}),t!=null?r(m,{display:"flex",alignItems:"center",children:[a.isDirty()?e(v,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null,e(fn,{})]}):null]}),e(Or,{form:a,children:e(m,{display:"flex",children:t!=null&&t!=-1?e(Mr,{}):null})})]})]})},Ur=()=>{const n=y(t=>t.userPanel.selectedUser);return r(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e(Gr,{})}),n!=null?e(Fr,{userId:n}):null]})},Ar=()=>{const n=D(),t=y(i=>i.utilityPanel.ipAddr),{data:s,refetch:c,isFetching:a}=C(["deleteIpAddr",t],()=>ur({ipaddr:t}),{enabled:!1,cacheTime:0});return e(Z,{elevation:1,sx:{p:2,height:"100%"},children:r(m,{children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Clear IP Timeout"}),e(be,{onClick:()=>{j(t)||c()},loading:a,variant:"contained",children:"Submit"})]}),e(W,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:i=>{n(jn(i.target.value))},placeholder:"Enter IP"}),s!=null?e(m,{pt:2,children:r(p,{variant:"body1",children:["Response: ",s.message]})}):null]})})},Er=()=>{const n=D(),t=y(i=>i.utilityPanel.prompt),{data:s,refetch:c,isFetching:a}=C(["promptCheck",t],()=>ir({filter_type:0,prompt:t}),{enabled:!1});return e(Z,{elevation:1,sx:{p:2,height:"100%"},children:r(m,{children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Prompt Checker"}),e(be,{onClick:()=>{j(t)||c()},loading:a,variant:"contained",children:"Submit"})]}),e(W,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:i=>{n(Nn(i.target.value))},placeholder:"Enter prompt"}),s!=null?r(m,{pt:2,children:[r(p,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(p,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},$r=()=>r(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e(Er,{})}),e(g,{item:!0,md:12,lg:6,xl:4,children:e(Ar,{})})]}),Rr=()=>{const n=y(o=>o.workerPanel.workerFilter),[t,s]=k.exports.useState(n!=null?n:""),[c]=lt(t,400),a=D();return k.exports.useEffect(()=>{a(Vn(c))},[c]),e(W,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:t,onChange:o=>{s(o.target.value)}})},Kr=()=>{const n=D(),t=y(h=>h.workerPanel.sortKey),s=y(h=>h.workerPanel.order),c=y(h=>h.workerPanel.workerFilter),{data:a}=C($.all,()=>Ee(),{refetchInterval:1e3*30,select:h=>{const l=c==null?void 0:c.toLowerCase();return fe(h.filter(u=>{var f;return u.performance.includes("per form")||u.performance.includes("tokens")?!1:l==null?!0:u.name.toLowerCase().includes(l)||((f=u.owner)!=null?f:"").toLowerCase().includes(l)||u.id.toLowerCase().includes(l)}).map(u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})),[u=>{const f=u[t];return xe(f)?f.toLowerCase():f}],[s])}}),o=h=>{n(Qn(h.target.value))},i=h=>{n(Zn(h))};return a==null?e(b,{}):r(b,{children:[r(m,{display:"flex",justifyContent:"space-between",pb:2,children:[r(m,{display:"flex",alignItems:"center",children:[e(p,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(Rr,{})]}),r(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(nt,{sx:{mr:1},children:[e(rt,{children:"Sort Key"}),r(et,{value:t,label:"Sort Key",onChange:o,sx:{".MuiSelect-select":{py:1}},children:[e(B,{value:"name",children:"Name"}),e(B,{value:"performance",children:"Performance"}),e(B,{value:"uptime",children:"Uptime"}),e(B,{value:"megapixelsteps_generated",children:"MPS Generated"})]})]}),s==="asc"?e(M,{onClick:()=>i("desc"),children:e(xn,{})}):e(M,{onClick:()=>i("asc"),children:e(yn,{})})]})]}),e(g,{container:!0,spacing:2,children:a.map(h=>e(xt,{worker:h},h.id))})]})},Ze=()=>{const{data:n,isLoading:t,error:s}=C(["mode"],ut);if(t)return e(p,{variant:"h6",children:"Loading Horde status ..."});if(n==null||s)return console.log("HordeStatus error",s),e(p,{variant:"h6",children:"Error loading Horde status"});const c=a=>a?e(Be,{sx:{color:ae,ml:1}}):e(Be,{sx:{color:Ge,ml:1}});return r(me,{children:[r(H,{children:[e(Ie,{children:c(n.maintenance_mode)}),e(q,{primary:"Maintenance"})]}),r(H,{children:[e(Ie,{children:c(n.invite_only_mode)}),e(q,{primary:"Invite Only"})]}),n.raid_mode!=null?r(H,{children:[e(Ie,{children:c(n.raid_mode)}),e(q,{primary:"Raid"})]}):null]})},Je=()=>{const{data:n,isLoading:t,error:s}=C(["performance"],ht);return t?e(p,{variant:"h6",children:"Loading Horde status ..."}):n==null||s?e(p,{variant:"h6",children:"Error loading Horde status"}):r(me,{children:[e(H,{children:e(q,{primary:`Queued Requests: ${n.queued_requests}`})}),e(H,{children:e(q,{primary:`Queued MPS: ${n.queued_megapixelsteps}`})}),e(H,{children:e(q,{primary:`Past Minute MPS: ${n.past_minute_megapixelsteps}`})}),e(H,{children:e(q,{primary:`Workers: ${n.worker_count}`})})]})},ce=240,Hr=()=>{const n=D(),t=y(c=>c.localState.sidebarOpen);return r(b,{children:[r(Ne,{variant:"temporary",open:t,onClose:()=>{n(ct(!t))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ce,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ce}},children:[e(Pe,{}),r(m,{sx:{overflow:"auto"},children:[e(Je,{}),e(ie,{}),e(Ze,{})]})]}),r(Ne,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ce,flexShrink:0,["& .MuiDrawer-paper"]:{width:ce,boxSizing:"border-box"}},children:[e(Pe,{}),r(m,{sx:{overflow:"auto"},children:[e(Je,{}),e(ie,{}),e(Ze,{})]})]})]})},qr=()=>{const n=D(),t=y(c=>c.persist.selectedTab);return r(m,{display:"flex",children:[e(Hr,{}),e(m,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(bn,{value:t,children:[e(m,{sx:{borderBottom:1,borderColor:"divider"},children:r(vn,{onChange:(c,a)=>{a!="4"&&n(Te(!1)),n(An(a))},"aria-label":"lab API tabs example",children:[e(X,{label:"User Lookup",value:"1"}),e(X,{label:"Workers",value:"2"}),e(X,{label:"Comparator",value:"3"}),e(X,{label:"Utilities",value:"4"}),e(X,{label:"Settings",value:"5"}),e(X,{label:"About",value:"6"})]})}),e(ee,{value:"1",children:e(Ur,{})}),e(ee,{value:"2",children:e(Kr,{})}),e(ee,{value:"3",children:e(Cr,{})}),e(ee,{value:"4",children:e($r,{})}),e(ee,{value:"5",children:e(Sr,{})}),e(ee,{value:"6",children:e(pr,{})})]})})]})},ue=()=>{const n=D(),t=y(c=>c.localState.sidebarOpen);return e(kn,{position:"sticky",sx:{zIndex:c=>c.zIndex.drawer+1},children:r(Pe,{children:[e(M,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{n(ct(!t))},sx:{mr:2,display:{md:"none"}},children:e(Cn,{})}),e(p,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Horde Control Tower"}),null]})})},Br=async n=>{const t=window.document.createElement("canvas"),s=window.Image,c=(await Promise.allSettled([n].map(async o=>await new Promise((i,h)=>{let l;Sn(o,"src")?l=o:l={src:o};const u=new s;u.onerror=()=>h(new Error("Couldn't load image")),u.onload=()=>i({...l,img:u}),u.src=l.src,u.crossOrigin="anonymous"})))).filter(o=>o.status==="fulfilled").map(o=>o.value),a=t.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const o=i=>Math.max(...c.map(h=>{var l,u;return(u=(l=h==null?void 0:h.img)==null?void 0:l[i])!=null?u:0}));return t.width=o("width"),t.height=o("height"),c.forEach(i=>{var h,l;if(i!=null&&(a.globalAlpha=i.opacity!=null?i.opacity:1,i.img!=null))return a.drawImage(i.img,(h=i.x)!=null?h:0,(l=i.y)!=null?l:0)}),t.toDataURL("image/webp")}},Nr=n=>{const{gen:t,...s}=n,c=D();return C(["check",t.id],()=>or(t.id),{refetchInterval:2e3,enabled:t.state==="check",onSuccess:a=>{if(t.state==="check"){let o=t.state;a.faulted?o="error":a.done&&(o="status"),c(pe({...t,state:o,check:a}))}}}),C(["status",t.id],()=>dr(t.id),{refetchInterval:!1,enabled:t.state==="status",onSuccess:async a=>{if(t.state==="status"){let o=t.state;if(a.faulted)o="error";else if(a.done){o="complete";const i=await Br(a.generations[0].img);a.generations[0].img=i}c(pe({...t,state:o,status:a}))}}}),C(["delete",t.id],()=>cr(t.id),{refetchInterval:!1,retry:!1,enabled:t.state==="delete",onSuccess:async a=>{c(pe({...t,state:"complete",status:a}))}}),e(b,{})},jr=()=>{const n=y(t=>t.persist.imageGens);return j(n)?e(b,{}):e(b,{children:n.map(t=>e(Nr,{gen:t},t.id))})},zr=()=>{const n=y(a=>a.persist.apikey),{data:t,refetch:s,isLoading:c}=C(["findUser"],()=>rr(n),{enabled:!j(n),retry:1});return k.exports.useEffect(()=>{s()},[n]),c?r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ue,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(Xe,{})})]}):j(n)||t==null?r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ue,{}),r(m,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(p,{variant:"h4",children:"Please enter your API key."}),e(ft,{})]})]}):t.moderator?r(m,{sx:{display:"flex",flexDirection:"column"},children:[e(jr,{}),e(hr,{}),e(ue,{}),e(qr,{})]}):r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ue,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(p,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};Q.prototype.__toHuman__=Q.prototype.toHuman;Q.prototype.toHuman=function(n={stripZeroUnits:"all"}){let t=this.normalize(),s=[],c=typeof n.precision=="object"?Q.fromObject(n.precision):Q.fromMillis(0),a=t;const o=["years","months","days","hours","minutes","seconds","milliseconds"];let i,h;n.smallestUnit&&(i=o.indexOf(n.smallestUnit)),n.biggestUnit&&(h=o.indexOf(n.biggestUnit)),(!i||!(i>=0&&i<o.length))&&(i=o.indexOf("seconds")),(!h||!(h<=i&&h<o.length))&&(h=o.indexOf("years"));for(let l of o.slice(h,i+1)){if(a.as(l)>=1){s.push(l);let f={};if(f[l]=Math.floor(a.as(l)),a=a.minus(Q.fromObject(f)).normalize(),a<c)break}if(n.maxUnits&&s.length>=n.maxUnits)break}if(t=t.minus(a).normalize(),t=t.shiftTo(...s),n.stripZeroUnits=="all")s=s.filter(l=>t.values[l]>0);else if(n.stripZeroUnits=="end"){let l=!0;s=s.reverse().filter(u=>l?t.values[u]==0?!1:(l=!1,!0):!0)}return s.length||s.push(o[i]),t.shiftTo(...s).__toHuman__(n)};const Vr=wn({key:"mui",prepend:!0}),Qr=In({palette:{mode:"dark"}}),Zr=new Pn({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});_n(document.getElementById("root")).render(e(Fn,{value:Vr,children:r(On,{theme:Qr,children:[e(Dn,{}),r(Tn,{client:Zr,children:[e(Wn,{store:ve,children:e(Ln,{loading:null,persistor:tr,children:e(zr,{})})}),null]})]})}));
