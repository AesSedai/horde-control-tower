import{c as X,a as Ft,b as Wt,p as Ot,d as Dt,e as Lt,s as Mt,f as At,F as Ut,R as Gt,P as $t,g as Et,h as Rt,i as Ht,j as Ee,u as w,k as e,l as k,B as m,m as Z,n,T as h,L as Ke,o as Bt,q as Kt,r as S,D as pe,t as $,v as se,w as ke,x as ge,y as B,z as qe,A as K,C as H,E as C,G as L,I as M,H as qt,M as jt,J as q,K as le,N as Nt,O as zt,Q as Ce,S as it,U as Se,V as be,W as Vt,X as Qt,Y as g,Z as I,_ as Zt,$ as Jt,a0 as Pe,a1 as ae,a2 as re,a3 as fe,a4 as we,a5 as ve,a6 as ot,a7 as ye,a8 as Xt,a9 as xe,aa as _e,ab as Te,ac as Yt,ad as er,ae as tr,af as Re,ag as dt,ah as ct,ai as rr,aj as nr,ak as W,al as ar,am as sr,an as je,ao as Ne,ap as ze,aq as lr,ar as ir,as as or,at as dr,au as Q,av as cr,aw as ur,ax as hr,ay as pr,az as J,aA as mr,aB as ut,aC as gr,aD as fr,aE as yr,aF as xr,aG as br,aH as z,aI as F,aJ as Ve,aK as vr,aL as kr,aM as Cr,aN as Sr,aO as Ie,aP as Qe,aQ as Ze,aR as Fe,aS as wr,aT as Ir,aU as ee,aV as te,aW as Pr,aX as _r,aY as Tr,aZ as Fr,a_ as Wr,a$ as Or,b0 as Dr,b1 as Lr,b2 as Mr,b3 as Ar,b4 as Ur,b5 as Gr,b6 as $r}from"./vendor.810a66ac.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&u(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function u(a){if(a.ep)return;a.ep=!0;const d=s(a);fetch(a.href,d)}})();const Er={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},We=X({name:"comparatorPanel",initialState:Er,reducers:{setSelectedModel:(r,t)=>{r.selectedModel=t.payload},setSelectedWorkers:(r,t)=>{r.selectedWorkers=t.payload},setGenForm:(r,t)=>{r.genForm=structuredClone(t.payload)},setReload:(r,t)=>{r.reload=t.payload}}}),{setSelectedModel:Je,setSelectedWorkers:ce,setGenForm:ht,setReload:pt}=We.actions,Rr={sidebarOpen:!1},Oe=X({name:"localState",initialState:Rr,reducers:{setSidebarOpen:(r,t)=>{r.sidebarOpen=t.payload}}}),{setSidebarOpen:mt}=Oe.actions,De={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},ie=X({name:"persist",initialState:De,reducers:{setKey:(r,t)=>{r.apikey=t.payload},setSelectedTab:(r,t)=>{r.selectedTab=t.payload},resetImageGens:r=>{r.imageGens=[]},addImageGen:(r,t)=>{r.imageGens.find(u=>u.id===t.payload.id)||r.imageGens.push(t.payload)},updateImageGen:(r,t)=>{const s=r.imageGens.findIndex(u=>u.id===t.payload.id);s!=null&&(r.imageGens[s]=t.payload)},addGenFavorite:(r,t)=>{r.genFavorites.push(t.payload)},updateGenFavorite:(r,t)=>{r.genFavorites[t.payload.idx]={name:r.genFavorites[t.payload.idx].name,form:t.payload.form}},deleteGenFavorite:(r,t)=>{r.genFavorites.splice(t.payload)},resetExceptApiKey:r=>(r={...De,apikey:r.apikey},r)}}),{setKey:Hr,setSelectedTab:Br,resetImageGens:Xe,addImageGen:Kr,updateImageGen:me,addGenFavorite:qr,resetExceptApiKey:aa,updateGenFavorite:jr,deleteGenFavorite:Nr}=ie.actions,zr={showPassword:!1},Le=X({name:"settingsPanel",initialState:zr,reducers:{setShowPassword:(r,t)=>{r.showPassword=t.payload}}}),{setShowPassword:Me}=Le.actions,Vr={},Ae=X({name:"userPanel",initialState:Vr,reducers:{setUser:(r,t)=>{r.selectedUser=t.payload}}}),{setUser:Ye}=Ae.actions,Qr={prompt:"",ipAddr:""},Ue=X({name:"utilityPanel",initialState:Qr,reducers:{setPrompt:(r,t)=>{r.prompt=t.payload},setIpAddr:(r,t)=>{r.ipAddr=t.payload}}}),{setPrompt:Zr,setIpAddr:Jr}=Ue.actions,Xr={workerType:"image",sortKey:"name",order:"asc"},Ge=X({name:"workerPanel",initialState:Xr,reducers:{setWorkerType:(r,t)=>{r.workerType=t.payload},setWorkerFilter:(r,t)=>{r.workerFilter=t.payload},setSortKey:(r,t)=>{r.sortKey=t.payload},setOrder:(r,t)=>{r.order=t.payload}}}),{setWorkerType:Yr,setWorkerFilter:en,setSortKey:et,setOrder:tn}=Ge.actions,rn=Ft((r,t)=>r,(r,t)=>Object.assign({},De,r),{whitelist:[ie.name]}),nn={key:"root",storage:At,whitelist:[ie.name],transforms:[rn]},an=Wt({[ie.name]:ie.reducer,[Oe.name]:Oe.reducer,[Le.name]:Le.reducer,[Ae.name]:Ae.reducer,[Ue.name]:Ue.reducer,[Ge.name]:Ge.reducer,[We.name]:We.reducer}),sn=Ot(nn,an),oe=Dt({reducer:sn,middleware:r=>r({serializableCheck:{ignoredActions:[Ut,Gt,$t,Et,Rt,Ht]}}),devTools:!1}),ln=Lt(oe);Mt(oe.dispatch);const _=Ee.create({baseURL:"https://aihorde.net/api/v2/"});_.interceptors.request.use(function(r){const t=oe.getState().persist.apikey;return r.headers!=null&&(t!=null&&(r.headers.apikey=t),r.headers["Client-Agent"]="HordeControlTower/0.0.3"),r},function(r){return Promise.reject(r)});const on=Ee.create({baseURL:"/horde-control-tower/"}),dn=Ee.create({baseURL:"https://ratings.aihorde.net/api/"});dn.interceptors.request.use(function(r){const t=oe.getState().persist.apikey;return r.headers!=null&&(t!=null&&(r.headers.apikey=t),r.headers["Client-Agent"]="HordeControlTower/0.0.3"),r},function(r){return Promise.reject(r)});const cn=r=>_.get("find_user",{headers:{apikey:r}}).then(t=>t.data),gt=()=>_.get("status/modes").then(r=>r.data),ft=()=>_.get("status/performance").then(r=>r.data),yt=()=>on.get("users.json").then(r=>r.data),He=r=>_.get(`users/${r}`).then(t=>t.data),Be=()=>_.get("workers").then(r=>r.data),un=r=>_.get(`workers/${r}`).then(t=>t.data),xt=()=>_.get("status/models").then(r=>r.data),bt=(r,t)=>_.put(`users/${r}`,t).then(s=>s.data),hn=(r,t)=>_.put(`workers/${r}`,t).then(s=>s.data),pn=r=>_.post("filters",r).then(t=>t.data),mn=r=>_.post("generate/async",r).then(t=>t.data),gn=r=>_.get(`generate/check/${r}`).then(t=>t.data),fn=r=>_.get(`generate/status/${r}`).then(t=>t.data),yn=r=>_.delete(`generate/status/${r}`).then(t=>t.data),xn=r=>_.delete("operations/ipaddr",{data:r}).then(t=>t.data),A={all:["users"],lists:()=>[...A.all,"list"],list:r=>[...A.lists(),{filters:r}],details:()=>[...A.all,"detail"],detail:r=>[...A.details(),r]},E={all:["workers"],lists:()=>[...E.all,"list"],list:r=>[...E.lists(),{filters:r}],details:()=>[...E.all,"detail"],detail:r=>[...E.details(),r]},bn=()=>(w(A.all,yt,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["performance"],ft,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["mode"],gt,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["models"],xt,{staleTime:1e3*30,refetchInterval:1e3*30}),e(k,{})),vn=()=>e(m,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(Z,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:n(m,{children:[e(h,{variant:"h4",textAlign:"center",children:"About"}),n(h,{variant:"body1",children:["Horde Control Tower is an open source"," ",e(Ke,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),n(h,{variant:"body1",children:["The project source is available on"," ",e(Ke,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),O=()=>Kt(),b=Bt,kn=()=>{const r=O(),t=b(P=>P.comparatorPanel.genForm),s=b(P=>P.persist.genFavorites),[u,a]=S.exports.useState(!1),[d,l]=S.exports.useState(-1),[p,i]=S.exports.useState(!1),[o,f]=S.exports.useState(-1),[v,x]=S.exports.useState(!1),[U,j]=S.exports.useState(""),[N,c]=S.exports.useState(null),y=Boolean(N),T=P=>{c(P.currentTarget)},G=()=>{c(null)},de=()=>{x(!1)},Y=()=>{r(qr({name:U,form:t})),j(""),x(!1)},ne=()=>{l(-1),a(!1)},Ct=()=>{r(jr({idx:d,form:t})),l(-1),a(!1)},St=()=>{f(-1),i(!1)},wt=()=>{r(Nr(o)),f(-1),i(!1)},It=P=>{r(ht(P)),r(pt(!0)),c(null)},Pt=()=>{x(!0),c(null)},_t=()=>{a(!0),c(null)},Tt=()=>{i(!0),c(null)};return n(k,{children:[n(pe,{open:p,onClose:ne,children:[e($,{children:"Delete Preset"}),n(se,{children:[e(ke,{children:"Select a preset to delete."}),e(ge,{children:s.map((P,R)=>e(B,{disablePadding:!0,sx:{backgroundColor:o===R?"error.dark":""},onClick:()=>{f(R)},children:e(qe,{children:e(K,{primary:P.name})})},R))})]}),n(H,{children:[e(C,{onClick:St,children:"Cancel"}),e(C,{disabled:o===-1,onClick:wt,children:"Select"})]})]}),n(pe,{open:u,onClose:ne,children:[e($,{children:"Overwrite Preset"}),n(se,{children:[e(ke,{children:"Select a preset to overwrite."}),e(ge,{children:s.map((P,R)=>e(B,{disablePadding:!0,sx:{backgroundColor:d===R?"success.dark":""},onClick:()=>{l(R)},children:e(qe,{children:e(K,{primary:P.name})})},R))})]}),n(H,{children:[e(C,{onClick:ne,children:"Cancel"}),e(C,{disabled:d===-1,onClick:Ct,children:"Select"})]})]}),n(pe,{open:v,onClose:de,children:[e($,{children:"Add New Preset"}),n(se,{children:[e(ke,{children:"Enter a friendly name for this new preset."}),e(L,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:U,onChange:P=>{j(P.target.value)}})]}),n(H,{children:[e(C,{onClick:de,children:"Cancel"}),e(C,{onClick:Y,children:"Create"})]})]}),e(M,{onClick:T,children:e(qt,{})}),n(jt,{anchorEl:N,open:y,onClose:G,children:[s.map((P,R)=>e(q,{onClick:()=>{It(P.form)},children:P.name},R)),s.length>0?e(le,{}):null,s.length>0?e(q,{onClick:Tt,children:"Delete Preset"}):null,s.length>0?e(le,{}):null,s.length>0?e(q,{onClick:_t,children:"Overwrite Preset"}):null,s.length>0?e(le,{}):null,e(q,{onClick:Pt,children:"Add New Preset"})]})]})},Cn=()=>{const r=b(a=>a.persist.imageGens),{data:t}=w(E.all,()=>Be(),{refetchInterval:1e3*30,select:a=>Nt(a.map(d=>[d.id,d.name]))}),s=a=>{var l,p,i;const d=a.status!=null?a.status:a.check;return a.state!=="complete"&&d!=null?n(Ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(it,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(Se,{title:t==null?"":t[(l=a.payload.workers[0])!=null?l:""],subtitle:`Position: ${d.queue_position}, wait time: ${d.wait_time}`})]},a.id):a.state==="complete"?u(a).length===0?n(Ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(h,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(Se,{title:t==null?"":t[(p=a.payload.workers[0])!=null?p:""]})]},a.id):n(Ce,{sx:{paddingTop:u(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:u(a)}),e(Se,{title:t==null?"":t[(i=a.payload.workers[0])!=null?i:""]})]},a.id):e(k,{})},u=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(m,{children:e(zt,{sx:{width:"100%",height:"100%"},cols:4,children:r.map(a=>s(a))})})},Sn=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],wn=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],D="175px",In=()=>{const r=O(),t=b(c=>c.comparatorPanel.selectedWorkers),s=b(c=>c.comparatorPanel.selectedModel),u=b(c=>c.comparatorPanel.genForm),a=b(c=>c.persist.imageGens),d=b(c=>c.persist.imageGens.length>0),l=b(c=>c.comparatorPanel.reload),p=b(c=>c.persist.imageGens.some(y=>["pending","check"].includes(y.state))),{mutate:i}=be({mutationFn:mn,onSuccess:(c,y,T)=>{r(Kr({id:c.id,payload:y,state:"check",check:null,status:null}))}}),{handleSubmit:o,control:f,formState:{errors:v},watch:x,setValue:U,reset:j}=Vt({defaultValues:u}),N=c=>{s!=null&&t.length>0&&(r(Xe()),t.forEach(y=>{const T={...c,workers:[y.id],models:[s.name]};i(T)}))};return S.exports.useEffect(()=>{const c=x(Qt((y,{name:T,type:G})=>{r(ht(y))},300));return()=>c.unsubscribe()},[x]),S.exports.useEffect(()=>{l&&(r(pt(!1)),j(u))},[l]),e(m,{children:n("form",{onSubmit:o(N),children:[n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Prompt"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"prompt",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(L,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...c})})})})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Seed"}),n(g,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.seed",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(L,{fullWidth:!0,placeholder:"Seed",...c})})}),e(g,{item:!0,children:e(M,{"aria-label":"randomize seed",onClick:()=>{U("params.seed",Zt(1e8,999999999).toString())},children:e(Jt,{})})})]})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Sampler"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.sampler_name",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(Pe,{...c,fullWidth:!0,children:wn.map(y=>e(q,{value:y,children:y},y))})})})})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Steps"}),n(g,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.steps",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...c})})}),e(I,{name:"params.steps",control:f,render:({field:c})=>e(g,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...c,onChange:y=>{c.onChange(parseInt(y.target.value))}})})})]})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Width"}),n(g,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.width",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...c})})}),e(I,{name:"params.width",control:f,render:({field:c})=>e(g,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...c,onChange:y=>{c.onChange(parseInt(y.target.value))}})})})]})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Height"}),n(g,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.height",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...c})})}),e(I,{name:"params.height",control:f,render:({field:c})=>e(g,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...c,onChange:y=>{c.onChange(parseInt(y.target.value))}})})})]})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"CFG"}),n(g,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.cfg_scale",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...c})})}),e(I,{name:"params.cfg_scale",control:f,render:({field:c})=>e(g,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...c,onChange:y=>{c.onChange(parseInt(y.target.value))}})})})]})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Clip Skip"}),n(g,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.clip_skip",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...c})})}),e(I,{name:"params.clip_skip",control:f,render:({field:c})=>e(g,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...c,onChange:y=>{c.onChange(parseInt(y.target.value))}})})})]})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Post-Processors"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.post_processing",control:f,render:({field:{onChange:c,onBlur:y,value:T,name:G,ref:de}})=>e(g,{item:!0,xs:!0,children:e(fe,{fullWidth:!0,multiple:!0,onBlur:y,ref:de,value:T,onChange:(Y,ne)=>{c(ne)},options:Sn,getOptionLabel:Y=>Y,renderInput:Y=>e(L,{...Y})})})})})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"High Res Fix"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.hires_fix",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(we,{...c,checked:c.value})})})})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Karras"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.karras",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(we,{...c,checked:c.value})})})})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:D},children:"Tiling"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.tiling",control:f,render:({field:c})=>e(g,{item:!0,xs:!0,children:e(we,{...c,checked:c.value})})})})]}),e(ve,{type:"submit",loading:p,variant:"contained",children:"Submit"}),p?e(C,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(c=>["pending","check"].includes(c.state)).forEach(c=>{r(me({...c,state:"delete"}))})},children:"Cancel"}):null,d?e(C,{sx:{ml:2},variant:"contained",onClick:()=>{r(Xe())},children:"Clear Output"}):null]})})},Pn=r=>r!=null&&"name"in r,_n=r=>r!=null&&ot(r)&&"name"in r[0]&&"id"in r[0],tt="175px",Tn=()=>{const r=O(),t=b(i=>i.comparatorPanel.selectedWorkers),s=b(i=>i.comparatorPanel.selectedModel),u=(i,o)=>{ot(o)&&o.length===0?r(ce([])):_n(o)&&r(ce(o))},a=(i,o)=>{o==null?r(Je(null)):Pn(o)&&r(Je(o))},{data:d}=w(E.all,()=>Be(),{refetchInterval:1e3*30,select:i=>ye(i,[o=>o.name.toLowerCase()],["asc"])}),{data:l}=w(["models"],xt,{staleTime:1e3*30,refetchInterval:1e3*30,select:i=>ye(i,[o=>o.name.toLowerCase()],["asc"])});S.exports.useEffect(()=>{if(s!=null&&t.length>0){const i=t.map(v=>v.id),o=t.filter(v=>{var x;return(x=v==null?void 0:v.models)==null?void 0:x.includes(s.name)}),f=o.map(v=>v.id);Xt(i,f)||r(ce(o))}else s==null&&t.length>0&&r(ce([]))},[d,l,t,s]);const p=(d!=null?d:[]).filter(i=>{var o;return s==null?!0:(o=i==null?void 0:i.models)==null?void 0:o.includes(s.name)});return n(m,{children:[n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:tt},children:"Model"}),e(fe,{fullWidth:!0,disablePortal:!0,options:l!=null?l:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:i=>xe(i)?i:i.name,isOptionEqualToValue:(i,o)=>i.name===o.name,filterSelectedOptions:!0,renderInput:i=>e(L,{...i,label:"Selected Model"}),onChange:a})]}),n(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:tt},children:"Workers"}),e(fe,{fullWidth:!0,multiple:!0,disablePortal:!0,options:p,value:t,getOptionLabel:i=>i.name,isOptionEqualToValue:(i,o)=>i.id===o.id,filterSelectedOptions:!0,renderInput:i=>e(L,{...i,label:"Selected Workers"}),onChange:u})]})]})},Fn=()=>n(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,xl:4,children:n(Z,{sx:{p:2},children:[n(m,{sx:{position:"relative"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(m,{sx:{position:"absolute",top:0,right:0},children:e(kn,{})})]}),e(Tn,{}),e(In,{})]})}),e(g,{item:!0,xs:12,xl:8,children:n(Z,{sx:{p:2,height:"100%"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(Cn,{})]})})]}),vt=()=>{const r=O(),t=b(a=>a.persist.apikey),s=b(a=>a.settingsPanel.showPassword);return n(_e,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(Te,{children:"API Key"}),e(re,{defaultValue:t,onBlur:a=>{r(Hr(a.target.value)),r(Me(!1))},type:s?"text":"password",endAdornment:e(Yt,{position:"end",children:e(M,{onClick:()=>r(Me(!s)),children:s?e(er,{}):e(tr,{})})})})]})},Wn=()=>e(g,{container:!0,spacing:2,children:e(g,{item:!0,md:12,lg:6,xl:4,children:e(Z,{children:e(vt,{})})})}),$e="#0583B0",V="#FF6962",On="#7c0500",Dn="#ef9b0f",rt=r=>r.type==="image"&&parseFloat(r.performance)>3,nt=r=>r.type==="image"&&parseFloat(r.performance)<.4,kt=r=>{var N,c;const{worker:t}=r,s=Re(),[u,a]=S.exports.useState(!1),[d,l]=S.exports.useState(!1),[p,i]=S.exports.useState("setFlagged"),[o,f]=S.exports.useState(""),v=y=>y.maintenance_mode||y.paused||y.flagged?On:rt(y)||nt(y)?Dn:"background.paper",x=be(y=>hn(y.id,y.data),{onSuccess:(y,T)=>{a(!0),s.invalidateQueries({queryKey:E.detail(T.id)}),s.invalidateQueries({queryKey:E.all})}}),U=(y,T)=>{T!=="clickaway"&&a(!1)};return n(k,{children:[e(pe,{open:d,onClose:()=>l(!1),children:(y=>{var T;switch(y){case"setFlagged":return n(k,{children:[n($,{children:['Set "',t.name,'" as Flagged']}),n(H,{children:[e(C,{onClick:()=>{l(!1)},children:"Cancel"}),e(C,{onClick:()=>{l(!1)},children:"Confirm"})]})]});case"unsetFlagged":return n(k,{children:[n($,{children:['Unset "',t.name,'" as Flagged']}),n(H,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{l(!1)},children:"Confirm"})]})]});case"setMaintenance":return n(k,{children:[n($,{children:['Set "',t.name,'" Maintenance Mode']}),e(se,{children:e(L,{value:o,onChange:G=>{f(G.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),n(H,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{const G={maintenance:!0};J(o)||(G.maintenance_msg=o),x.mutate({id:t.id,data:G}),l(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return n(k,{children:[n($,{children:['Unset "',t.name,'" Maintenance Mode']}),n(H,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{x.mutate({id:t.id,data:{maintenance:!1,maintenance_msg:""}}),l(!1)},children:"Confirm"})]})]});case"setPaused":return n(k,{children:[n($,{children:['Set "',t.name,'" Paused Mode']}),n(H,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{x.mutate({id:t.id,data:{paused:!0}}),l(!1)},children:"Confirm"})]})]});case"unsetPaused":return n(k,{children:[n($,{children:['Unset "',t.name,'" Paused Mode']}),n(H,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{x.mutate({id:t.id,data:{paused:!1}}),l(!1)},children:"Confirm"})]})]});case"listModels":return n(k,{children:[n($,{children:['"',t.name,'" Models']}),e(se,{children:e(h,{variant:"body1",children:ye((T=t==null?void 0:t.models)!=null?T:[],[G=>G.toLowerCase()]).join(", ")})})]})}})(p)}),e(dt,{open:u,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ct,{onClose:U,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(g,{item:!0,xs:12,lg:6,xl:3,children:n(rr,{sx:{backgroundColor:v(t)},children:[e(nr,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:t.online&&!t.paused&&!t.maintenance_mode&&!t.flagged?e(W,{title:"Worker Online",children:e(ar,{sx:{color:$e}})}):e(W,{title:"Worker Issue",children:e(sr,{sx:{color:V}})}),action:n(m,{children:[nt(t)?e(W,{title:"Worker Low Speed Warning",children:e(je,{sx:{color:V,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,rt(t)?e(W,{title:"Worker High Speed Warning",children:e(je,{sx:{color:V,mt:.5,mr:1}})}):null,t.paused?e(W,{title:"Worker Paused",children:e(Ne,{sx:{color:V,mt:.5,mr:1}})}):null,t.maintenance_mode?e(W,{title:"Worker Maintenance",children:e(ze,{sx:{color:V,mt:.5,mr:1}})}):null,t.flagged?e(W,{title:"User Flagged",children:e(lr,{sx:{color:V,mt:.5,mr:1}})}):null,t.trusted?e(W,{title:"Trusted Worker",children:e(ir,{sx:{color:$e,mt:.5,mr:1}})}):null]}),title:e(h,{variant:"h5",children:or(t.name,{length:30})}),subheader:t.id}),n(dr,{children:[n(h,{variant:"body2",children:["Full Name: ",t.name]}),n(h,{variant:"body2",children:["Owner: ",t.owner]}),n(h,{variant:"body2",children:["Bridge Agent: ",t.bridge_agent]}),n(h,{variant:"body2",children:["Uptime: ",Q.fromObject({seconds:t.uptime}).toHuman()]}),t.type!=="interrogation"?n(h,{variant:"body2",children:["Models Loaded: ",(c=(N=t==null?void 0:t.models)==null?void 0:N.length)!=null?c:"None"]}):null,t.type==="image"?n(h,{variant:"body2",children:["MPS Generated: ",t.megapixelsteps_generated]}):null,n(h,{variant:"body2",children:["Speed: ",t.performance]}),n(h,{variant:"body2",children:["Threads: ",t.threads]}),n(h,{variant:"body2",children:["Requests Fulfilled: ",t.requests_fulfilled]}),n(h,{variant:"body2",children:["NSFW: ",t.nsfw?"true":"false"]})]}),n(cr,{disableSpacing:!0,children:[e(W,{title:"Show Worker Models",children:e(M,{onClick:()=>{i("listModels"),l(!0)},children:e(ur,{})})}),t.maintenance_mode?e(W,{title:"Unset Worker Maintenance",children:e(M,{onClick:()=>{i("unsetMaintenance"),l(!0)},children:e(hr,{})})}):e(W,{title:"Set Worker Maintenance",children:e(M,{onClick:()=>{i("setMaintenance"),l(!0)},children:e(ze,{})})}),t.paused?e(W,{title:"Unset Worker Pause",children:e(M,{onClick:()=>{i("unsetPaused"),l(!0)},children:e(pr,{})})}):e(W,{title:"Set Worker Pause",children:e(M,{onClick:()=>{i("setPaused"),l(!0)},children:e(Ne,{})})})]})]})},t.id)]})},Ln=r=>{const{workerId:t}=r,{data:s}=w(E.detail(t),()=>un(t),{staleTime:1e3*61,select:u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})});return s==null?e(k,{}):e(kt,{worker:s})},Mn=r=>{const{userId:t}=r,{data:s}=w(A.detail(t),()=>He(t));return s==null?e(k,{}):s.worker_ids.length===0?e(g,{item:!0,md:12,lg:6,xl:4,children:e(h,{variant:"body1",children:"This user has no workers."})}):e(k,{children:s.worker_ids.map(u=>e(Ln,{workerId:u},u))})},[An,Un,Gn]=mr(),$n=r=>r!=null&&"username"in r&&"id"in r,En=()=>{const r=O(),[t,s]=S.exports.useState(-1),[u]=ut(t,400),{data:a}=w(A.all,yt),{data:d,refetch:l}=w(A.detail(u),()=>He(u),{enabled:!1});if(S.exports.useEffect(()=>{gr(u)&&u>=4770&&l()},[u]),a==null)return e(k,{});const p=(i,o)=>{xe(o)?r(Ye(parseInt(o))):$n(o)&&r(Ye(o.id))};return e(fe,{disablePortal:!0,options:[...d!=null?[d]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:i=>xe(i)?i:i.username,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e(L,{...i,variant:"standard",label:"User Lookup",size:"small"}),onChange:p,onInputChange:(i,o)=>{s(fr(o))}})},Rn=()=>{const r=b(l=>{var p;return(p=l.userPanel.selectedUser)!=null?p:-1}),t=Re(),{data:s,isInitialLoading:u}=w(A.detail(r),()=>He(r),{refetchInterval:1e3*15}),a=be(l=>bt(l.id,l.data),{onSuccess:(l,p)=>{t.invalidateQueries({queryKey:A.detail(p.id)})}}),d=Un();return S.exports.useEffect(()=>{if(s!=null){const l={trusted:s.trusted,flagged:s.flagged,worker_invite:s.worker_invited.toString()};d.setValues(l),d.resetDirty(l)}},[u]),s==null?e(k,{}):e(yr,{component:m,children:e(xr,{size:"small",children:n(br,{children:[n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Username"})}),e(F,{align:"right",children:n(h,{variant:"body1",children:[s.username," ",s.moderator?"(moderator)":""]})})]}),n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Trusted"})}),e(F,{align:"right",children:e(Ve,{...d.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flagged"})}),e(F,{align:"right",children:e(Ve,{...d.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Invites"})}),e(F,{align:"right",children:e(L,{variant:"standard",type:"number",...d.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Count"})}),e(F,{align:"right",children:e(h,{variant:"body1",children:s.worker_count})})]}),n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Kudos"})}),e(F,{align:"right",children:e(h,{variant:"body1",children:s.kudos})})]}),n(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Suspicious"})}),n(F,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[s.suspicious>0?e(ve,{onClick:async()=>{const l={reset_suspicion:!0};a.mutate({id:r,data:l})},loading:a.isLoading,variant:"contained",color:"error",sx:{order:0,mr:4},children:"Reset"}):null,e(h,{sx:{order:1},variant:"body1",children:s.suspicious})]})]})]})})})},Hn=()=>{const r=Re(),t=b(p=>p.userPanel.selectedUser),[s,u]=S.exports.useState(!1),a=Gn({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),d=be(p=>bt(p.id,p.data),{onSuccess:(p,i)=>{var f,v,x,U;r.setQueryData(A.detail(i.id),j=>j!=null?{...j,...p}:p);const o={trusted:(f=p.trusted)!=null?f:!1,flagged:(v=p.flagged)!=null?v:!1,worker_invite:(U=(x=p.worker_invite)==null?void 0:x.toString())!=null?U:"0"};J(o)||(a.setValues(o),a.resetDirty(o)),u(!0)}}),l=(p,i)=>{i!=="clickaway"&&u(!1)};return n(Z,{elevation:1,sx:{p:2,height:"100%"},children:[e(dt,{open:s,autoHideDuration:6e3,onClose:l,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ct,{onClose:l,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),n("form",{onSubmit:a.onSubmit((p,i)=>{if(t!=null){const o={trusted:p.trusted,flagged:p.flagged,worker_invite:parseInt(p.worker_invite)};d.mutate({id:t,data:o})}}),children:[n(m,{display:"flex",justifyContent:"space-between",children:[e(En,{}),t!=null?n(m,{display:"flex",alignItems:"center",children:[a.isDirty()?e(C,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null,e(vr,{})]}):null]}),e(An,{form:a,children:e(m,{display:"flex",children:t!=null&&t!=-1?e(Rn,{}):null})})]})]})},Bn=()=>{const r=b(t=>t.userPanel.selectedUser);return n(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e(Hn,{})}),r!=null?e(Mn,{userId:r}):null]})},Kn=()=>{const r=O(),t=b(l=>l.utilityPanel.ipAddr),{data:s,refetch:u,isFetching:a}=w(["deleteIpAddr",t],()=>xn({ipaddr:t}),{enabled:!1,cacheTime:0});return e(Z,{elevation:1,sx:{p:2,height:"100%"},children:n(m,{children:[n(m,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Clear IP Timeout"}),e(ve,{onClick:()=>{J(t)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(L,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:l=>{r(Jr(l.target.value))},placeholder:"Enter IP"}),s!=null?e(m,{pt:2,children:n(h,{variant:"body1",children:["Response: ",s.message]})}):null]})})},qn=()=>{const r=O(),t=b(l=>l.utilityPanel.prompt),{data:s,refetch:u,isFetching:a}=w(["promptCheck",t],()=>pn({filter_type:0,prompt:t}),{enabled:!1});return e(Z,{elevation:1,sx:{p:2,height:"100%"},children:n(m,{children:[n(m,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Prompt Checker"}),e(ve,{onClick:()=>{J(t)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(L,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:l=>{r(Zr(l.target.value))},placeholder:"Enter prompt"}),s!=null?n(m,{pt:2,children:[n(h,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?n(h,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},jn=()=>n(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e(qn,{})}),e(g,{item:!0,md:12,lg:6,xl:4,children:e(Kn,{})})]}),Nn=()=>{const r=b(d=>d.workerPanel.workerFilter),[t,s]=S.exports.useState(r!=null?r:""),[u]=ut(t,400),a=O();return S.exports.useEffect(()=>{a(en(u))},[u]),e(L,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:t,onChange:d=>{s(d.target.value)}})},at={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},zn=()=>{const r=O(),t=b(o=>o.workerPanel.sortKey),s=b(o=>o.workerPanel.order),u=b(o=>o.workerPanel.workerFilter),a=b(o=>o.workerPanel.workerType),{data:d}=w(E.all,()=>Be(),{refetchInterval:1e3*30,select:o=>{const f=u==null?void 0:u.toLowerCase();return ye(o.filter(v=>{var x;return v.type!==a?!1:f==null?!0:v.name.toLowerCase().includes(f)||((x=v.owner)!=null?x:"").toLowerCase().includes(f)||v.id.toLowerCase().includes(f)||v.bridge_agent.toLowerCase().includes(f)}),[v=>{const x=v[t];return xe(x)?t==="performance"&&parseFloat(x)?parseFloat(x):x.toLowerCase():x}],[s])}}),l=o=>{var v,x;const f=o.target.value;r(Yr(f)),r(et((x=(v=Sr(at[f]))==null?void 0:v.parameter)!=null?x:"name"))},p=o=>{r(et(o.target.value))},i=o=>{r(tn(o))};return d==null?e(k,{}):n(k,{children:[n(m,{display:"flex",justifyContent:"space-between",pb:2,children:[n(m,{display:"flex",alignItems:"center",children:[e(h,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(Nn,{})]}),n(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[n(_e,{sx:{mr:1},children:[e(Te,{children:"Worker Type"}),n(Pe,{value:a,label:"Worker Type",onChange:l,sx:{".MuiSelect-select":{py:1}},children:[e(q,{value:"image",children:"Image"}),e(q,{value:"interrogation",children:"Interrogation"}),e(q,{value:"text",children:"Text"})]})]}),n(_e,{sx:{mr:1},children:[e(Te,{children:"Sort Key"}),e(Pe,{value:t,label:"Sort Key",onChange:p,sx:{".MuiSelect-select":{py:1}},children:at[a].map(o=>e(q,{value:o.parameter,children:o.label}))})]}),s==="asc"?e(M,{onClick:()=>i("desc"),children:e(kr,{})}):e(M,{onClick:()=>i("asc"),children:e(Cr,{})})]})]}),e(g,{container:!0,spacing:2,children:d.map(o=>e(kt,{worker:o},o.id))})]})},st=()=>{const{data:r,isLoading:t,error:s}=w(["mode"],gt);if(t)return e(h,{variant:"h6",children:"Loading Horde status ..."});if(r==null||s)return console.log("HordeStatus error",s),e(h,{variant:"h6",children:"Error loading Horde status"});const u=a=>a?e(Qe,{sx:{color:V,ml:1}}):e(Qe,{sx:{color:$e,ml:1}});return n(ge,{children:[n(B,{children:[e(Ie,{children:u(r.maintenance_mode)}),e(K,{primary:"Maintenance"})]}),n(B,{children:[e(Ie,{children:u(r.invite_only_mode)}),e(K,{primary:"Invite Only"})]}),r.raid_mode!=null?n(B,{children:[e(Ie,{children:u(r.raid_mode)}),e(K,{primary:"Raid"})]}):null]})},lt=()=>{const{data:r,isLoading:t,error:s}=w(["performance"],ft);return t?e(h,{variant:"h6",children:"Loading Horde status ..."}):r==null||s?e(h,{variant:"h6",children:"Error loading Horde status"}):n(ge,{children:[e(B,{children:e(K,{primary:`Queued Requests: ${r.queued_requests}`})}),e(B,{children:e(K,{primary:`Queued MPS: ${r.queued_megapixelsteps}`})}),e(B,{children:e(K,{primary:`Past Minute MPS: ${r.past_minute_megapixelsteps}`})}),e(B,{children:e(K,{primary:`Workers: ${r.worker_count}`})})]})},ue=240,Vn=()=>{const r=O(),t=b(u=>u.localState.sidebarOpen);return n(k,{children:[n(Ze,{variant:"temporary",open:t,onClose:()=>{r(mt(!t))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ue,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ue}},children:[e(Fe,{}),n(m,{sx:{overflow:"auto"},children:[e(lt,{}),e(le,{}),e(st,{})]})]}),n(Ze,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ue,flexShrink:0,["& .MuiDrawer-paper"]:{width:ue,boxSizing:"border-box"}},children:[e(Fe,{}),n(m,{sx:{overflow:"auto"},children:[e(lt,{}),e(le,{}),e(st,{})]})]})]})},Qn=()=>{const r=O(),t=b(u=>u.persist.selectedTab);return n(m,{display:"flex",children:[e(Vn,{}),e(m,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:n(wr,{value:t,children:[e(m,{sx:{borderBottom:1,borderColor:"divider"},children:n(Ir,{onChange:(u,a)=>{a!="4"&&r(Me(!1)),r(Br(a))},"aria-label":"lab API tabs example",children:[e(ee,{label:"User Lookup",value:"1"}),e(ee,{label:"Workers",value:"2"}),e(ee,{label:"Comparator",value:"3"}),e(ee,{label:"Utilities",value:"4"}),e(ee,{label:"Settings",value:"5"}),e(ee,{label:"About",value:"6"})]})}),e(te,{value:"1",children:e(Bn,{})}),e(te,{value:"2",children:e(zn,{})}),e(te,{value:"3",children:e(Fn,{})}),e(te,{value:"4",children:e(jn,{})}),e(te,{value:"5",children:e(Wn,{})}),e(te,{value:"6",children:e(vn,{})})]})})]})},he=()=>{const r=O(),t=b(u=>u.localState.sidebarOpen);return e(Pr,{position:"sticky",sx:{zIndex:u=>u.zIndex.drawer+1},children:n(Fe,{children:[e(M,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{r(mt(!t))},sx:{mr:2,display:{md:"none"}},children:e(_r,{})}),e(h,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Horde Control Tower"}),null]})})},Zn=async r=>{const t=window.document.createElement("canvas"),s=window.Image,u=(await Promise.allSettled([r].map(async d=>await new Promise((l,p)=>{let i;Tr(d,"src")?i=d:i={src:d};const o=new s;o.onerror=()=>p(new Error("Couldn't load image")),o.onload=()=>l({...i,img:o}),o.src=i.src,o.crossOrigin="anonymous"})))).filter(d=>d.status==="fulfilled").map(d=>d.value),a=t.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const d=l=>Math.max(...u.map(p=>{var i,o;return(o=(i=p==null?void 0:p.img)==null?void 0:i[l])!=null?o:0}));return t.width=d("width"),t.height=d("height"),u.forEach(l=>{var p,i;if(l!=null&&(a.globalAlpha=l.opacity!=null?l.opacity:1,l.img!=null))return a.drawImage(l.img,(p=l.x)!=null?p:0,(i=l.y)!=null?i:0)}),t.toDataURL("image/webp")}},Jn=r=>{const{gen:t,...s}=r,u=O();return w(["check",t.id],()=>gn(t.id),{refetchInterval:2e3,enabled:t.state==="check",onSuccess:a=>{if(t.state==="check"){let d=t.state;a.faulted?d="error":a.done&&(d="status"),u(me({...t,state:d,check:a}))}}}),w(["status",t.id],()=>fn(t.id),{refetchInterval:!1,enabled:t.state==="status",onSuccess:async a=>{if(t.state==="status"){let d=t.state;if(a.faulted)d="error";else if(a.done){d="complete";const l=await Zn(a.generations[0].img);a.generations[0].img=l}u(me({...t,state:d,status:a}))}}}),w(["delete",t.id],()=>yn(t.id),{refetchInterval:!1,retry:!1,enabled:t.state==="delete",onSuccess:async a=>{u(me({...t,state:"complete",status:a}))}}),e(k,{})},Xn=()=>{const r=b(t=>t.persist.imageGens);return J(r)?e(k,{}):e(k,{children:r.map(t=>e(Jn,{gen:t},t.id))})},Yn=()=>{const r=b(a=>a.persist.apikey),{data:t,refetch:s,isLoading:u}=w(["findUser"],()=>cn(r),{enabled:!J(r),retry:1});return S.exports.useEffect(()=>{s()},[r]),u?n(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(he,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(it,{})})]}):J(r)||t==null?n(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(he,{}),n(m,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(h,{variant:"h4",children:"Please enter your API key."}),e(vt,{})]})]}):t.moderator?n(m,{sx:{display:"flex",flexDirection:"column"},children:[e(Xn,{}),e(bn,{}),e(he,{}),e(Qn,{})]}):n(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(he,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(h,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};Q.prototype.__toHuman__=Q.prototype.toHuman;Q.prototype.toHuman=function(r={stripZeroUnits:"all"}){let t=this.normalize(),s=[],u=typeof r.precision=="object"?Q.fromObject(r.precision):Q.fromMillis(0),a=t;const d=["years","months","days","hours","minutes","seconds","milliseconds"];let l,p;r.smallestUnit&&(l=d.indexOf(r.smallestUnit)),r.biggestUnit&&(p=d.indexOf(r.biggestUnit)),(!l||!(l>=0&&l<d.length))&&(l=d.indexOf("seconds")),(!p||!(p<=l&&p<d.length))&&(p=d.indexOf("years"));for(let i of d.slice(p,l+1)){if(a.as(i)>=1){s.push(i);let f={};if(f[i]=Math.floor(a.as(i)),a=a.minus(Q.fromObject(f)).normalize(),a<u)break}if(r.maxUnits&&s.length>=r.maxUnits)break}if(t=t.minus(a).normalize(),t=t.shiftTo(...s),r.stripZeroUnits=="all")s=s.filter(i=>t.values[i]>0);else if(r.stripZeroUnits=="end"){let i=!0;s=s.reverse().filter(o=>i?t.values[o]==0?!1:(i=!1,!0):!0)}return s.length||s.push(d[l]),t.shiftTo(...s).__toHuman__(r)};const ea=Fr({key:"mui",prepend:!0}),ta=Wr({palette:{mode:"dark"}}),ra=new Or({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});Dr(document.getElementById("root")).render(e(Lr,{value:ea,children:n(Mr,{theme:ta,children:[e(Ar,{}),n(Ur,{client:ra,children:[e(Gr,{store:oe,children:e($r,{loading:null,persistor:ln,children:e(Yn,{})})}),null]})]})}));
