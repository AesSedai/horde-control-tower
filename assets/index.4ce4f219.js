import{c as X,a as Pt,b as _t,p as Ft,d as Ot,e as Tt,s as Dt,f as Wt,F as Lt,R as Mt,P as At,g as Gt,h as Ut,i as Et,j as Ye,u as C,k as e,l as b,B as m,m as J,n as r,T as p,L as $e,o as $t,q as Rt,r as k,D as he,t as E,v as se,w as ke,x as me,y as K,z as Re,A as q,C as B,E as v,G as L,I as M,H as Ht,M as Bt,J as $,K as ie,N as Kt,O as qt,Q as Ce,S as et,U as Se,V as ye,W as Nt,X as jt,Y as g,Z as w,_ as zt,$ as Vt,a0 as tt,a1 as ae,a2 as ne,a3 as ge,a4 as we,a5 as be,a6 as nt,a7 as fe,a8 as Qt,a9 as xe,aa as rt,ab as at,ac as Zt,ad as Jt,ae as Xt,af as st,ag as j,ah as Ge,ai as it,aj as lt,ak as Yt,al as en,am as T,an as tn,ao as nn,ap as He,aq as Be,ar as Ke,as as rn,at as an,au as sn,av as ln,aw as Z,ax as on,ay as dn,az as cn,aA as un,aB as hn,aC as ot,aD as pn,aE as mn,aF as gn,aG as fn,aH as V,aI as O,aJ as qe,aK as xn,aL as yn,aM as bn,aN as Ie,aO as Ne,aP as je,aQ as Pe,aR as vn,aS as kn,aT as ee,aU as te,aV as Cn,aW as Sn,aX as wn,aY as In,aZ as Pn,a_ as _n,a$ as Fn,b0 as On,b1 as Tn,b2 as Dn,b3 as Wn,b4 as Ln,b5 as Mn}from"./vendor.2ac00804.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();const An={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},_e=X({name:"comparatorPanel",initialState:An,reducers:{setSelectedModel:(n,t)=>{n.selectedModel=t.payload},setSelectedWorkers:(n,t)=>{n.selectedWorkers=t.payload},setGenForm:(n,t)=>{n.genForm=structuredClone(t.payload)},setReload:(n,t)=>{n.reload=t.payload}}}),{setSelectedModel:ze,setSelectedWorkers:de,setGenForm:dt,setReload:ct}=_e.actions,Gn={sidebarOpen:!1},Fe=X({name:"localState",initialState:Gn,reducers:{setSidebarOpen:(n,t)=>{n.sidebarOpen=t.payload}}}),{setSidebarOpen:ut}=Fe.actions,Oe={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},le=X({name:"persist",initialState:Oe,reducers:{setKey:(n,t)=>{n.apikey=t.payload},setSelectedTab:(n,t)=>{n.selectedTab=t.payload},resetImageGens:n=>{n.imageGens=[]},addImageGen:(n,t)=>{n.imageGens.find(c=>c.id===t.payload.id)||n.imageGens.push(t.payload)},updateImageGen:(n,t)=>{const s=n.imageGens.findIndex(c=>c.id===t.payload.id);s!=null&&(n.imageGens[s]=t.payload)},addGenFavorite:(n,t)=>{n.genFavorites.push(t.payload)},updateGenFavorite:(n,t)=>{n.genFavorites[t.payload.idx]={name:n.genFavorites[t.payload.idx].name,form:t.payload.form}},deleteGenFavorite:(n,t)=>{n.genFavorites.splice(t.payload)},resetExceptApiKey:n=>(n={...Oe,apikey:n.apikey},n)}}),{setKey:Un,setSelectedTab:En,resetImageGens:Ve,addImageGen:$n,updateImageGen:pe,addGenFavorite:Rn,resetExceptApiKey:Yr,updateGenFavorite:Hn,deleteGenFavorite:Bn}=le.actions,Kn={showPassword:!1},Te=X({name:"settingsPanel",initialState:Kn,reducers:{setShowPassword:(n,t)=>{n.showPassword=t.payload}}}),{setShowPassword:De}=Te.actions,qn={},We=X({name:"userPanel",initialState:qn,reducers:{setUser:(n,t)=>{n.selectedUser=t.payload}}}),{setUser:Qe}=We.actions,Nn={prompt:"",ipAddr:""},Le=X({name:"utilityPanel",initialState:Nn,reducers:{setPrompt:(n,t)=>{n.prompt=t.payload},setIpAddr:(n,t)=>{n.ipAddr=t.payload}}}),{setPrompt:jn,setIpAddr:zn}=Le.actions,Vn={sortKey:"name",order:"asc"},Me=X({name:"workerPanel",initialState:Vn,reducers:{setWorkerFilter:(n,t)=>{n.workerFilter=t.payload},setSortKey:(n,t)=>{n.sortKey=t.payload},setOrder:(n,t)=>{n.order=t.payload}}}),{setWorkerFilter:Qn,setSortKey:Zn,setOrder:Jn}=Me.actions,Xn=Pt((n,t)=>n,(n,t)=>Object.assign({},Oe,n),{whitelist:[le.name]}),Yn={key:"root",storage:Wt,whitelist:[le.name],transforms:[Xn]},er=_t({[le.name]:le.reducer,[Fe.name]:Fe.reducer,[Te.name]:Te.reducer,[We.name]:We.reducer,[Le.name]:Le.reducer,[Me.name]:Me.reducer,[_e.name]:_e.reducer}),tr=Ft(Yn,er),ve=Ot({reducer:tr,middleware:n=>n({serializableCheck:{ignoredActions:[Lt,Mt,At,Gt,Ut,Et]}}),devTools:!1}),nr=Tt(ve);Dt(ve.dispatch);const P=Ye.create({baseURL:"https://stablehorde.net/api/v2/"});P.interceptors.request.use(function(n){const t=ve.getState().persist.apikey;return n.headers!=null&&(t!=null&&(n.headers.apikey=t),n.headers["Client-Agent"]="HordeControlTower/0.0.2"),n},function(n){return Promise.reject(n)});const rr=Ye.create({baseURL:"/horde-control-tower/"}),ar=n=>P.get("find_user",{headers:{apikey:n}}).then(t=>t.data),ht=()=>P.get("status/modes").then(n=>n.data),pt=()=>P.get("status/performance").then(n=>n.data),mt=()=>rr.get("users.json").then(n=>n.data),Ue=n=>P.get(`users/${n}`).then(t=>t.data),Ee=()=>P.get("workers").then(n=>n.data),sr=n=>P.get(`workers/${n}`).then(t=>t.data),gt=()=>P.get("status/models").then(n=>n.data),ft=(n,t)=>P.put(`users/${n}`,t).then(s=>s.data),ir=(n,t)=>P.put(`workers/${n}`,t).then(s=>s.data),lr=n=>P.post("filters",n).then(t=>t.data),or=n=>P.post("generate/async",n).then(t=>t.data),dr=n=>P.get(`generate/check/${n}`).then(t=>t.data),cr=n=>P.get(`generate/status/${n}`).then(t=>t.data),ur=n=>P.delete(`generate/status/${n}`).then(t=>t.data),hr=n=>P.delete("operations/ipaddr",{data:n}).then(t=>t.data),A={all:["users"],lists:()=>[...A.all,"list"],list:n=>[...A.lists(),{filters:n}],details:()=>[...A.all,"detail"],detail:n=>[...A.details(),n]},R={all:["workers"],lists:()=>[...R.all,"list"],list:n=>[...R.lists(),{filters:n}],details:()=>[...R.all,"detail"],detail:n=>[...R.details(),n]},pr=()=>(C(A.all,mt,{staleTime:1e3*30,refetchInterval:1e3*30}),C(["performance"],pt,{staleTime:1e3*30,refetchInterval:1e3*30}),C(["mode"],ht,{staleTime:1e3*30,refetchInterval:1e3*30}),C(["models"],gt,{staleTime:1e3*30,refetchInterval:1e3*30}),e(b,{})),mr=()=>e(m,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(J,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(m,{children:[e(p,{variant:"h4",textAlign:"center",children:"About"}),r(p,{variant:"body1",children:["Horde Control Tower is an open source"," ",e($e,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(p,{variant:"body1",children:["The project source is available on"," ",e($e,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),D=()=>Rt(),y=$t,gr=()=>{const n=D(),t=y(I=>I.comparatorPanel.genForm),s=y(I=>I.persist.genFavorites),[c,a]=k.exports.useState(!1),[o,i]=k.exports.useState(-1),[h,l]=k.exports.useState(!1),[u,f]=k.exports.useState(-1),[_,S]=k.exports.useState(!1),[G,N]=k.exports.useState(""),[z,d]=k.exports.useState(null),x=Boolean(z),F=I=>{d(I.currentTarget)},U=()=>{d(null)},oe=()=>{S(!1)},Y=()=>{n(Rn({name:G,form:t})),N(""),S(!1)},re=()=>{i(-1),a(!1)},bt=()=>{n(Hn({idx:o,form:t})),i(-1),a(!1)},vt=()=>{f(-1),l(!1)},kt=()=>{n(Bn(u)),f(-1),l(!1)},Ct=I=>{n(dt(I)),n(ct(!0)),d(null)},St=()=>{S(!0),d(null)},wt=()=>{a(!0),d(null)},It=()=>{l(!0),d(null)};return r(b,{children:[r(he,{open:h,onClose:re,children:[e(E,{children:"Delete Preset"}),r(se,{children:[e(ke,{children:"Select a preset to delete."}),e(me,{children:s.map((I,H)=>e(K,{disablePadding:!0,sx:{backgroundColor:u===H?"error.dark":""},onClick:()=>{f(H)},children:e(Re,{children:e(q,{primary:I.name})})},H))})]}),r(B,{children:[e(v,{onClick:vt,children:"Cancel"}),e(v,{disabled:u===-1,onClick:kt,children:"Select"})]})]}),r(he,{open:c,onClose:re,children:[e(E,{children:"Overwrite Preset"}),r(se,{children:[e(ke,{children:"Select a preset to overwrite."}),e(me,{children:s.map((I,H)=>e(K,{disablePadding:!0,sx:{backgroundColor:o===H?"success.dark":""},onClick:()=>{i(H)},children:e(Re,{children:e(q,{primary:I.name})})},H))})]}),r(B,{children:[e(v,{onClick:re,children:"Cancel"}),e(v,{disabled:o===-1,onClick:bt,children:"Select"})]})]}),r(he,{open:_,onClose:oe,children:[e(E,{children:"Add New Preset"}),r(se,{children:[e(ke,{children:"Enter a friendly name for this new preset."}),e(L,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:G,onChange:I=>{N(I.target.value)}})]}),r(B,{children:[e(v,{onClick:oe,children:"Cancel"}),e(v,{onClick:Y,children:"Create"})]})]}),e(M,{onClick:F,children:e(Ht,{})}),r(Bt,{anchorEl:z,open:x,onClose:U,children:[s.map((I,H)=>e($,{onClick:()=>{Ct(I.form)},children:I.name},H)),s.length>0?e(ie,{}):null,s.length>0?e($,{onClick:It,children:"Delete Preset"}):null,s.length>0?e(ie,{}):null,s.length>0?e($,{onClick:wt,children:"Overwrite Preset"}):null,s.length>0?e(ie,{}):null,e($,{onClick:St,children:"Add New Preset"})]})]})},fr=()=>{const n=y(a=>a.persist.imageGens),{data:t}=C(R.all,()=>Ee(),{refetchInterval:1e3*30,select:a=>Kt(a.map(o=>[o.id,o.name]))}),s=a=>{var i,h,l;const o=a.status!=null?a.status:a.check;return a.state!=="complete"&&o!=null?r(Ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(et,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(Se,{title:t==null?"":t[(i=a.payload.workers[0])!=null?i:""],subtitle:`Position: ${o.queue_position}, wait time: ${o.wait_time}`})]},a.id):a.state==="complete"?c(a).length===0?r(Ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(p,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(Se,{title:t==null?"":t[(h=a.payload.workers[0])!=null?h:""]})]},a.id):r(Ce,{sx:{paddingTop:c(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:c(a)}),e(Se,{title:t==null?"":t[(l=a.payload.workers[0])!=null?l:""]})]},a.id):e(b,{})},c=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(m,{children:e(qt,{sx:{width:"100%",height:"100%"},cols:4,children:n.map(a=>s(a))})})},xr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],yr=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],W="175px",br=()=>{const n=D(),t=y(d=>d.comparatorPanel.selectedWorkers),s=y(d=>d.comparatorPanel.selectedModel),c=y(d=>d.comparatorPanel.genForm),a=y(d=>d.persist.imageGens),o=y(d=>d.persist.imageGens.length>0),i=y(d=>d.comparatorPanel.reload),h=y(d=>d.persist.imageGens.some(x=>["pending","check"].includes(x.state))),{mutate:l}=ye({mutationFn:or,onSuccess:(d,x,F)=>{n($n({id:d.id,payload:x,state:"check",check:null,status:null}))}}),{handleSubmit:u,control:f,formState:{errors:_},watch:S,setValue:G,reset:N}=Nt({defaultValues:c}),z=d=>{s!=null&&t.length>0&&(n(Ve()),t.forEach(x=>{const F={...d,workers:[x.id],models:[s.name]};l(F)}))};return k.exports.useEffect(()=>{const d=S(jt((x,{name:F,type:U})=>{n(dt(x))},300));return()=>d.unsubscribe()},[S]),k.exports.useEffect(()=>{i&&(n(ct(!1)),N(c))},[i]),e(m,{children:r("form",{onSubmit:u(z),children:[r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Prompt"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"prompt",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(L,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...d})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Seed"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.seed",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(L,{fullWidth:!0,placeholder:"Seed",...d})})}),e(g,{item:!0,children:e(M,{"aria-label":"randomize seed",onClick:()=>{G("params.seed",zt(1e8,999999999).toString())},children:e(Vt,{})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Sampler"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.sampler_name",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(tt,{...d,fullWidth:!0,children:yr.map(x=>e($,{value:x,children:x},x))})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Steps"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.steps",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...d})})}),e(w,{name:"params.steps",control:f,render:({field:d})=>e(g,{item:!0,children:e(ne,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Width"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.width",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(w,{name:"params.width",control:f,render:({field:d})=>e(g,{item:!0,children:e(ne,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Height"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.height",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(w,{name:"params.height",control:f,render:({field:d})=>e(g,{item:!0,children:e(ne,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"CFG"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.cfg_scale",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...d})})}),e(w,{name:"params.cfg_scale",control:f,render:({field:d})=>e(g,{item:!0,children:e(ne,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Clip Skip"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(w,{name:"params.clip_skip",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(ae,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...d})})}),e(w,{name:"params.clip_skip",control:f,render:({field:d})=>e(g,{item:!0,children:e(ne,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...d,onChange:x=>{d.onChange(parseInt(x.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Post-Processors"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.post_processing",control:f,render:({field:{onChange:d,onBlur:x,value:F,name:U,ref:oe}})=>e(g,{item:!0,xs:!0,children:e(ge,{fullWidth:!0,multiple:!0,onBlur:x,ref:oe,value:F,onChange:(Y,re)=>{d(re)},options:xr,getOptionLabel:Y=>Y,renderInput:Y=>e(L,{...Y})})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"High Res Fix"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.hires_fix",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(we,{...d,checked:d.value})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Karras"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.karras",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(we,{...d,checked:d.value})})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:W},children:"Tiling"}),e(g,{container:!0,spacing:2,alignItems:"center",children:e(w,{name:"params.tiling",control:f,render:({field:d})=>e(g,{item:!0,xs:!0,children:e(we,{...d,checked:d.value})})})})]}),e(be,{type:"submit",loading:h,variant:"contained",children:"Submit"}),h?e(v,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(d=>["pending","check"].includes(d.state)).forEach(d=>{n(pe({...d,state:"delete"}))})},children:"Cancel"}):null,o?e(v,{sx:{ml:2},variant:"contained",onClick:()=>{n(Ve())},children:"Clear Output"}):null]})})},vr=n=>n!=null&&"name"in n,kr=n=>n!=null&&nt(n)&&"name"in n[0]&&"id"in n[0],Ze="175px",Cr=()=>{const n=D(),t=y(l=>l.comparatorPanel.selectedWorkers),s=y(l=>l.comparatorPanel.selectedModel),c=(l,u)=>{nt(u)&&u.length===0?n(de([])):kr(u)&&n(de(u))},a=(l,u)=>{u==null?n(ze(null)):vr(u)&&n(ze(u))},{data:o}=C(R.all,()=>Ee(),{refetchInterval:1e3*30,select:l=>fe(l,[u=>u.name.toLowerCase()],["asc"])}),{data:i}=C(["models"],gt,{staleTime:1e3*30,refetchInterval:1e3*30,select:l=>fe(l,[u=>u.name.toLowerCase()],["asc"])});k.exports.useEffect(()=>{if(s!=null&&t.length>0){const l=t.map(_=>_.id),u=t.filter(_=>{var S;return(S=_==null?void 0:_.models)==null?void 0:S.includes(s.name)}),f=u.map(_=>_.id);Qt(l,f)||n(de(u))}else s==null&&t.length>0&&n(de([]))},[o,i,t,s]);const h=(o!=null?o:[]).filter(l=>{var u;return s==null?!0:(u=l==null?void 0:l.models)==null?void 0:u.includes(s.name)});return r(m,{children:[r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:Ze},children:"Model"}),e(ge,{fullWidth:!0,disablePortal:!0,options:i!=null?i:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:l=>xe(l)?l:l.name,isOptionEqualToValue:(l,u)=>l.name===u.name,filterSelectedOptions:!0,renderInput:l=>e(L,{...l,label:"Selected Model"}),onChange:a})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:Ze},children:"Workers"}),e(ge,{fullWidth:!0,multiple:!0,disablePortal:!0,options:h,value:t,getOptionLabel:l=>l.name,isOptionEqualToValue:(l,u)=>l.id===u.id,filterSelectedOptions:!0,renderInput:l=>e(L,{...l,label:"Selected Workers"}),onChange:c})]})]})},Sr=()=>r(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,xl:4,children:r(J,{sx:{p:2},children:[r(m,{sx:{position:"relative"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(m,{sx:{position:"absolute",top:0,right:0},children:e(gr,{})})]}),e(Cr,{}),e(br,{})]})}),e(g,{item:!0,xs:12,xl:8,children:r(J,{sx:{p:2,height:"100%"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(fr,{})]})})]}),xt=()=>{const n=D(),t=y(a=>a.persist.apikey),s=y(a=>a.settingsPanel.showPassword);return r(rt,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(at,{children:"API Key"}),e(ne,{defaultValue:t,onBlur:a=>{n(Un(a.target.value)),n(De(!1))},type:s?"text":"password",endAdornment:e(Zt,{position:"end",children:e(M,{onClick:()=>n(De(!s)),children:s?e(Jt,{}):e(Xt,{})})})})]})},wr=()=>e(g,{container:!0,spacing:2,children:e(g,{item:!0,md:12,lg:6,xl:4,children:e(J,{children:e(xt,{})})})}),Ae="#0583B0",Q="#FF6962",Ir="#7c0500",Pr="#ef9b0f",_r=n=>st(n)||!j(n)&&!isNaN(parseFloat(n)),yt=n=>{var z,d;const{worker:t}=n,s=Ge(),[c,a]=k.exports.useState(!1),[o,i]=k.exports.useState(!1),[h,l]=k.exports.useState("setFlagged"),[u,f]=k.exports.useState(""),_=x=>x.maintenance_mode||x.paused||x.flagged?Ir:parseFloat(x.performance)>3||parseFloat(x.performance)<.4?Pr:"background.paper",S=ye(x=>ir(x.id,x.data),{onSuccess:(x,F)=>{a(!0),s.invalidateQueries({queryKey:R.detail(F.id)}),s.invalidateQueries({queryKey:R.all})}}),G=(x,F)=>{F!=="clickaway"&&a(!1)};return r(b,{children:[e(he,{open:o,onClose:()=>i(!1),children:(x=>{var F;switch(x){case"setFlagged":return r(b,{children:[r(E,{children:['Set "',t.name,'" as Flagged']}),r(B,{children:[e(v,{onClick:()=>{i(!1)},children:"Cancel"}),e(v,{onClick:()=>{i(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(b,{children:[r(E,{children:['Unset "',t.name,'" as Flagged']}),r(B,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{i(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(b,{children:[r(E,{children:['Set "',t.name,'" Maintenance Mode']}),e(se,{children:e(L,{value:u,onChange:U=>{f(U.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(B,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{const U={maintenance:!0};j(u)||(U.maintenance_msg=u),S.mutate({id:t.id,data:U}),i(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(b,{children:[r(E,{children:['Unset "',t.name,'" Maintenance Mode']}),r(B,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{S.mutate({id:t.id,data:{maintenance:!1,maintenance_msg:""}}),i(!1)},children:"Confirm"})]})]});case"setPaused":return r(b,{children:[r(E,{children:['Set "',t.name,'" Paused Mode']}),r(B,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{S.mutate({id:t.id,data:{paused:!0}}),i(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(b,{children:[r(E,{children:['Unset "',t.name,'" Paused Mode']}),r(B,{children:[e(v,{onClick:()=>i(!1),children:"Cancel"}),e(v,{onClick:()=>{S.mutate({id:t.id,data:{paused:!1}}),i(!1)},children:"Confirm"})]})]});case"listModels":return r(b,{children:[r(E,{children:['"',t.name,'" Models']}),e(se,{children:e(p,{variant:"body1",children:fe((F=t==null?void 0:t.models)!=null?F:[],[U=>U.toLowerCase()]).join(", ")})})]})}})(h)}),e(it,{open:c,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(lt,{onClose:G,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(g,{item:!0,xs:12,lg:6,xl:3,children:r(Yt,{sx:{backgroundColor:_(t)},children:[e(en,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:t.online&&!t.paused&&!t.maintenance_mode&&!t.flagged?e(T,{title:"Worker Online",children:e(tn,{sx:{color:Ae}})}):e(T,{title:"Worker Issue",children:e(nn,{sx:{color:Q}})}),action:r(m,{children:[parseFloat(t.performance)<.4?e(T,{title:"Worker Low Speed Warning",children:e(He,{sx:{color:Q,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,parseFloat(t.performance)>3?e(T,{title:"Worker High Speed Warning",children:e(He,{sx:{color:Q,mt:.5,mr:1}})}):null,t.paused?e(T,{title:"Worker Paused",children:e(Be,{sx:{color:Q,mt:.5,mr:1}})}):null,t.maintenance_mode?e(T,{title:"Worker Maintenance",children:e(Ke,{sx:{color:Q,mt:.5,mr:1}})}):null,t.flagged?e(T,{title:"User Flagged",children:e(rn,{sx:{color:Q,mt:.5,mr:1}})}):null,t.trusted?e(T,{title:"Trusted Worker",children:e(an,{sx:{color:Ae,mt:.5,mr:1}})}):null]}),title:e(p,{variant:"h5",children:sn(t.name,{length:30})}),subheader:t.id}),r(ln,{children:[r(p,{variant:"body2",children:["Full Name: ",t.name]}),r(p,{variant:"body2",children:["Owner: ",t.owner]}),r(p,{variant:"body2",children:["Bridge Agent: ",t.bridge_agent]}),r(p,{variant:"body2",children:["Uptime: ",Z.fromObject({seconds:t.uptime}).toHuman()]}),r(p,{variant:"body2",children:["Models Loaded: ",(d=(z=t==null?void 0:t.models)==null?void 0:z.length)!=null?d:"None"]}),r(p,{variant:"body2",children:["MPS Generated: ",t.megapixelsteps_generated]}),r(p,{variant:"body2",children:["Speed: ",t.performance," ",_r(t.performance)?"MPS":null]}),r(p,{variant:"body2",children:["Threads: ",t.threads]}),r(p,{variant:"body2",children:["Requests Fulfilled: ",t.requests_fulfilled]}),r(p,{variant:"body2",children:["NSFW: ",t.nsfw?"true":"false"]})]}),r(on,{disableSpacing:!0,children:[e(T,{title:"Show Worker Models",children:e(M,{onClick:()=>{l("listModels"),i(!0)},children:e(dn,{})})}),t.maintenance_mode?e(T,{title:"Unset Worker Maintenance",children:e(M,{onClick:()=>{l("unsetMaintenance"),i(!0)},children:e(cn,{})})}):e(T,{title:"Set Worker Maintenance",children:e(M,{onClick:()=>{l("setMaintenance"),i(!0)},children:e(Ke,{})})}),t.paused?e(T,{title:"Unset Worker Pause",children:e(M,{onClick:()=>{l("unsetPaused"),i(!0)},children:e(un,{})})}):e(T,{title:"Set Worker Pause",children:e(M,{onClick:()=>{l("setPaused"),i(!0)},children:e(Be,{})})})]})]})},t.id)]})},Fr=n=>{const{workerId:t}=n,{data:s}=C(R.detail(t),()=>sr(t),{staleTime:1e3*61,select:c=>({...c,performance:c.performance.replace(" megapixelsteps per second","")})});return s==null?e(b,{}):e(yt,{worker:s})},Or=n=>{const{userId:t}=n,{data:s}=C(A.detail(t),()=>Ue(t));return s==null?e(b,{}):s.worker_ids.length===0?e(g,{item:!0,md:12,lg:6,xl:4,children:e(p,{variant:"body1",children:"This user has no workers."})}):e(b,{children:s.worker_ids.map(c=>e(Fr,{workerId:c},c))})},[Tr,Dr,Wr]=hn(),Lr=n=>n!=null&&"username"in n&&"id"in n,Mr=()=>{const n=D(),[t,s]=k.exports.useState(-1),[c]=ot(t,400),{data:a}=C(A.all,mt),{data:o,refetch:i}=C(A.detail(c),()=>Ue(c),{enabled:!1});if(k.exports.useEffect(()=>{st(c)&&c>=4770&&i()},[c]),a==null)return e(b,{});const h=(l,u)=>{xe(u)?n(Qe(parseInt(u))):Lr(u)&&n(Qe(u.id))};return e(ge,{disablePortal:!0,options:[...o!=null?[o]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:l=>xe(l)?l:l.username,isOptionEqualToValue:(l,u)=>l.id===u.id,renderInput:l=>e(L,{...l,variant:"standard",label:"User Lookup",size:"small"}),onChange:h,onInputChange:(l,u)=>{s(pn(u))}})},Ar=()=>{const n=y(i=>{var h;return(h=i.userPanel.selectedUser)!=null?h:-1}),t=Ge(),{data:s,isInitialLoading:c}=C(A.detail(n),()=>Ue(n),{refetchInterval:1e3*15}),a=ye(i=>ft(i.id,i.data),{onSuccess:(i,h)=>{t.invalidateQueries({queryKey:A.detail(h.id)})}}),o=Dr();return k.exports.useEffect(()=>{if(s!=null){const i={trusted:s.trusted,flagged:s.flagged,worker_invite:s.worker_invited.toString()};o.setValues(i),o.resetDirty(i)}},[c]),s==null?e(b,{}):e(mn,{component:m,children:e(gn,{size:"small",children:r(fn,{children:[r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Username"})}),e(O,{align:"right",children:r(p,{variant:"body1",children:[s.username," ",s.moderator?"(moderator)":""]})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Trusted"})}),e(O,{align:"right",children:e(qe,{...o.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Flagged"})}),e(O,{align:"right",children:e(qe,{...o.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Invites"})}),e(O,{align:"right",children:e(L,{variant:"standard",type:"number",...o.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Count"})}),e(O,{align:"right",children:e(p,{variant:"body1",children:s.worker_count})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Kudos"})}),e(O,{align:"right",children:e(p,{variant:"body1",children:s.kudos})})]}),r(V,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(O,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Suspicious"})}),r(O,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[s.suspicious>0?e(be,{onClick:async()=>{const i={reset_suspicion:!0};a.mutate({id:n,data:i})},loading:a.isLoading,variant:"contained",color:"error",sx:{order:0,mr:4},children:"Reset"}):null,e(p,{sx:{order:1},variant:"body1",children:s.suspicious})]})]})]})})})},Gr=()=>{const n=Ge(),t=y(h=>h.userPanel.selectedUser),[s,c]=k.exports.useState(!1),a=Wr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),o=ye(h=>ft(h.id,h.data),{onSuccess:(h,l)=>{var f,_,S,G;n.setQueryData(A.detail(l.id),N=>N!=null?{...N,...h}:h);const u={trusted:(f=h.trusted)!=null?f:!1,flagged:(_=h.flagged)!=null?_:!1,worker_invite:(G=(S=h.worker_invite)==null?void 0:S.toString())!=null?G:"0"};j(u)||(a.setValues(u),a.resetDirty(u)),c(!0)}}),i=(h,l)=>{l!=="clickaway"&&c(!1)};return r(J,{elevation:1,sx:{p:2,height:"100%"},children:[e(it,{open:s,autoHideDuration:6e3,onClose:i,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(lt,{onClose:i,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((h,l)=>{if(t!=null){const u={trusted:h.trusted,flagged:h.flagged,worker_invite:parseInt(h.worker_invite)};o.mutate({id:t,data:u})}}),children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(Mr,{}),t!=null?r(m,{display:"flex",alignItems:"center",children:[a.isDirty()?e(v,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null,e(xn,{})]}):null]}),e(Tr,{form:a,children:e(m,{display:"flex",children:t!=null&&t!=-1?e(Ar,{}):null})})]})]})},Ur=()=>{const n=y(t=>t.userPanel.selectedUser);return r(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e(Gr,{})}),n!=null?e(Or,{userId:n}):null]})},Er=()=>{const n=D(),t=y(i=>i.utilityPanel.ipAddr),{data:s,refetch:c,isFetching:a}=C(["deleteIpAddr",t],()=>hr({ipaddr:t}),{enabled:!1,cacheTime:0});return e(J,{elevation:1,sx:{p:2,height:"100%"},children:r(m,{children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Clear IP Timeout"}),e(be,{onClick:()=>{j(t)||c()},loading:a,variant:"contained",children:"Submit"})]}),e(L,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:i=>{n(zn(i.target.value))},placeholder:"Enter IP"}),s!=null?e(m,{pt:2,children:r(p,{variant:"body1",children:["Response: ",s.message]})}):null]})})},$r=()=>{const n=D(),t=y(i=>i.utilityPanel.prompt),{data:s,refetch:c,isFetching:a}=C(["promptCheck",t],()=>lr({filter_type:0,prompt:t}),{enabled:!1});return e(J,{elevation:1,sx:{p:2,height:"100%"},children:r(m,{children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Prompt Checker"}),e(be,{onClick:()=>{j(t)||c()},loading:a,variant:"contained",children:"Submit"})]}),e(L,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:i=>{n(jn(i.target.value))},placeholder:"Enter prompt"}),s!=null?r(m,{pt:2,children:[r(p,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(p,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},Rr=()=>r(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e($r,{})}),e(g,{item:!0,md:12,lg:6,xl:4,children:e(Er,{})})]}),Hr=()=>{const n=y(o=>o.workerPanel.workerFilter),[t,s]=k.exports.useState(n!=null?n:""),[c]=ot(t,400),a=D();return k.exports.useEffect(()=>{a(Qn(c))},[c]),e(L,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:t,onChange:o=>{s(o.target.value)}})},Br=()=>{const n=D(),t=y(h=>h.workerPanel.sortKey),s=y(h=>h.workerPanel.order),c=y(h=>h.workerPanel.workerFilter),{data:a}=C(R.all,()=>Ee(),{refetchInterval:1e3*30,select:h=>{const l=c==null?void 0:c.toLowerCase();return fe(h.filter(u=>{var f;return u.type!=="image"?!1:l==null?!0:u.name.toLowerCase().includes(l)||((f=u.owner)!=null?f:"").toLowerCase().includes(l)||u.id.toLowerCase().includes(l)||u.bridge_agent.toLowerCase().includes(l)}).map(u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})),[u=>{const f=u[t];return xe(f)?f.toLowerCase():f}],[s])}}),o=h=>{n(Zn(h.target.value))},i=h=>{n(Jn(h))};return a==null?e(b,{}):r(b,{children:[r(m,{display:"flex",justifyContent:"space-between",pb:2,children:[r(m,{display:"flex",alignItems:"center",children:[e(p,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(Hr,{})]}),r(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(rt,{sx:{mr:1},children:[e(at,{children:"Sort Key"}),r(tt,{value:t,label:"Sort Key",onChange:o,sx:{".MuiSelect-select":{py:1}},children:[e($,{value:"name",children:"Name"}),e($,{value:"performance",children:"Performance"}),e($,{value:"bridge_agent",children:"Bridge Agent"}),e($,{value:"uptime",children:"Uptime"}),e($,{value:"megapixelsteps_generated",children:"MPS Generated"})]})]}),s==="asc"?e(M,{onClick:()=>i("desc"),children:e(yn,{})}):e(M,{onClick:()=>i("asc"),children:e(bn,{})})]})]}),e(g,{container:!0,spacing:2,children:a.map(h=>e(yt,{worker:h},h.id))})]})},Je=()=>{const{data:n,isLoading:t,error:s}=C(["mode"],ht);if(t)return e(p,{variant:"h6",children:"Loading Horde status ..."});if(n==null||s)return console.log("HordeStatus error",s),e(p,{variant:"h6",children:"Error loading Horde status"});const c=a=>a?e(Ne,{sx:{color:Q,ml:1}}):e(Ne,{sx:{color:Ae,ml:1}});return r(me,{children:[r(K,{children:[e(Ie,{children:c(n.maintenance_mode)}),e(q,{primary:"Maintenance"})]}),r(K,{children:[e(Ie,{children:c(n.invite_only_mode)}),e(q,{primary:"Invite Only"})]}),n.raid_mode!=null?r(K,{children:[e(Ie,{children:c(n.raid_mode)}),e(q,{primary:"Raid"})]}):null]})},Xe=()=>{const{data:n,isLoading:t,error:s}=C(["performance"],pt);return t?e(p,{variant:"h6",children:"Loading Horde status ..."}):n==null||s?e(p,{variant:"h6",children:"Error loading Horde status"}):r(me,{children:[e(K,{children:e(q,{primary:`Queued Requests: ${n.queued_requests}`})}),e(K,{children:e(q,{primary:`Queued MPS: ${n.queued_megapixelsteps}`})}),e(K,{children:e(q,{primary:`Past Minute MPS: ${n.past_minute_megapixelsteps}`})}),e(K,{children:e(q,{primary:`Workers: ${n.worker_count}`})})]})},ce=240,Kr=()=>{const n=D(),t=y(c=>c.localState.sidebarOpen);return r(b,{children:[r(je,{variant:"temporary",open:t,onClose:()=>{n(ut(!t))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ce,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ce}},children:[e(Pe,{}),r(m,{sx:{overflow:"auto"},children:[e(Xe,{}),e(ie,{}),e(Je,{})]})]}),r(je,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ce,flexShrink:0,["& .MuiDrawer-paper"]:{width:ce,boxSizing:"border-box"}},children:[e(Pe,{}),r(m,{sx:{overflow:"auto"},children:[e(Xe,{}),e(ie,{}),e(Je,{})]})]})]})},qr=()=>{const n=D(),t=y(c=>c.persist.selectedTab);return r(m,{display:"flex",children:[e(Kr,{}),e(m,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(vn,{value:t,children:[e(m,{sx:{borderBottom:1,borderColor:"divider"},children:r(kn,{onChange:(c,a)=>{a!="4"&&n(De(!1)),n(En(a))},"aria-label":"lab API tabs example",children:[e(ee,{label:"User Lookup",value:"1"}),e(ee,{label:"Workers",value:"2"}),e(ee,{label:"Comparator",value:"3"}),e(ee,{label:"Utilities",value:"4"}),e(ee,{label:"Settings",value:"5"}),e(ee,{label:"About",value:"6"})]})}),e(te,{value:"1",children:e(Ur,{})}),e(te,{value:"2",children:e(Br,{})}),e(te,{value:"3",children:e(Sr,{})}),e(te,{value:"4",children:e(Rr,{})}),e(te,{value:"5",children:e(wr,{})}),e(te,{value:"6",children:e(mr,{})})]})})]})},ue=()=>{const n=D(),t=y(c=>c.localState.sidebarOpen);return e(Cn,{position:"sticky",sx:{zIndex:c=>c.zIndex.drawer+1},children:r(Pe,{children:[e(M,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{n(ut(!t))},sx:{mr:2,display:{md:"none"}},children:e(Sn,{})}),e(p,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Horde Control Tower"}),null]})})},Nr=async n=>{const t=window.document.createElement("canvas"),s=window.Image,c=(await Promise.allSettled([n].map(async o=>await new Promise((i,h)=>{let l;wn(o,"src")?l=o:l={src:o};const u=new s;u.onerror=()=>h(new Error("Couldn't load image")),u.onload=()=>i({...l,img:u}),u.src=l.src,u.crossOrigin="anonymous"})))).filter(o=>o.status==="fulfilled").map(o=>o.value),a=t.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const o=i=>Math.max(...c.map(h=>{var l,u;return(u=(l=h==null?void 0:h.img)==null?void 0:l[i])!=null?u:0}));return t.width=o("width"),t.height=o("height"),c.forEach(i=>{var h,l;if(i!=null&&(a.globalAlpha=i.opacity!=null?i.opacity:1,i.img!=null))return a.drawImage(i.img,(h=i.x)!=null?h:0,(l=i.y)!=null?l:0)}),t.toDataURL("image/webp")}},jr=n=>{const{gen:t,...s}=n,c=D();return C(["check",t.id],()=>dr(t.id),{refetchInterval:2e3,enabled:t.state==="check",onSuccess:a=>{if(t.state==="check"){let o=t.state;a.faulted?o="error":a.done&&(o="status"),c(pe({...t,state:o,check:a}))}}}),C(["status",t.id],()=>cr(t.id),{refetchInterval:!1,enabled:t.state==="status",onSuccess:async a=>{if(t.state==="status"){let o=t.state;if(a.faulted)o="error";else if(a.done){o="complete";const i=await Nr(a.generations[0].img);a.generations[0].img=i}c(pe({...t,state:o,status:a}))}}}),C(["delete",t.id],()=>ur(t.id),{refetchInterval:!1,retry:!1,enabled:t.state==="delete",onSuccess:async a=>{c(pe({...t,state:"complete",status:a}))}}),e(b,{})},zr=()=>{const n=y(t=>t.persist.imageGens);return j(n)?e(b,{}):e(b,{children:n.map(t=>e(jr,{gen:t},t.id))})},Vr=()=>{const n=y(a=>a.persist.apikey),{data:t,refetch:s,isLoading:c}=C(["findUser"],()=>ar(n),{enabled:!j(n),retry:1});return k.exports.useEffect(()=>{s()},[n]),c?r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ue,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(et,{})})]}):j(n)||t==null?r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ue,{}),r(m,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(p,{variant:"h4",children:"Please enter your API key."}),e(xt,{})]})]}):t.moderator?r(m,{sx:{display:"flex",flexDirection:"column"},children:[e(zr,{}),e(pr,{}),e(ue,{}),e(qr,{})]}):r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ue,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(p,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};Z.prototype.__toHuman__=Z.prototype.toHuman;Z.prototype.toHuman=function(n={stripZeroUnits:"all"}){let t=this.normalize(),s=[],c=typeof n.precision=="object"?Z.fromObject(n.precision):Z.fromMillis(0),a=t;const o=["years","months","days","hours","minutes","seconds","milliseconds"];let i,h;n.smallestUnit&&(i=o.indexOf(n.smallestUnit)),n.biggestUnit&&(h=o.indexOf(n.biggestUnit)),(!i||!(i>=0&&i<o.length))&&(i=o.indexOf("seconds")),(!h||!(h<=i&&h<o.length))&&(h=o.indexOf("years"));for(let l of o.slice(h,i+1)){if(a.as(l)>=1){s.push(l);let f={};if(f[l]=Math.floor(a.as(l)),a=a.minus(Z.fromObject(f)).normalize(),a<c)break}if(n.maxUnits&&s.length>=n.maxUnits)break}if(t=t.minus(a).normalize(),t=t.shiftTo(...s),n.stripZeroUnits=="all")s=s.filter(l=>t.values[l]>0);else if(n.stripZeroUnits=="end"){let l=!0;s=s.reverse().filter(u=>l?t.values[u]==0?!1:(l=!1,!0):!0)}return s.length||s.push(o[i]),t.shiftTo(...s).__toHuman__(n)};const Qr=In({key:"mui",prepend:!0}),Zr=Pn({palette:{mode:"dark"}}),Jr=new _n({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});Fn(document.getElementById("root")).render(e(On,{value:Qr,children:r(Tn,{theme:Zr,children:[e(Dn,{}),r(Wn,{client:Jr,children:[e(Ln,{store:ve,children:e(Mn,{loading:null,persistor:nr,children:e(Vr,{})})}),null]})]})}));
