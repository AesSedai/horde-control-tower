import{c as ae,a as Rt,b as Ht,p as Nt,d as jt,e as Kt,s as Bt,f as Vt,F as qt,R as zt,P as Qt,g as Zt,h as Jt,i as Xt,j as Fe,u as I,k as e,l as v,B as g,m as ne,n as r,T as m,L as Je,o as Yt,q as en,r as S,D as ue,t as D,v as he,w as De,x as Se,y as z,z as Xe,A as Q,C as L,E as b,G as H,I as j,H as tn,M as nn,J as Z,K as pe,N as rn,O as Ve,Q as me,S as xe,U as ge,V as ie,W as an,X as sn,Y as f,Z as F,_ as ln,$ as on,a0 as Le,a1 as de,a2 as se,a3 as we,a4 as Oe,a5 as J,a6 as yt,a7 as Ie,a8 as dn,a9 as Pe,aa as bt,ab as We,ac as Ae,ad as cn,ae as un,af as hn,ag as Te,ah as qe,ai as ze,aj as pn,ak as mn,al as $,am as gn,an as fn,ao as Ye,ap as et,aq as tt,ar as xn,as as yn,at as bn,au as vn,av as te,aw as kn,ax as Cn,ay as Sn,az as wn,aA as re,aB as In,aC as vt,aD as Pn,aE as _n,aF as Fn,aG as Tn,aH as B,aI as _,aJ as nt,aK as rt,aL as at,aM as st,aN as it,aO as Dn,aP as On,aQ as Un,aR as Ue,aS as lt,aT as ot,aU as Me,aV as Ln,aW as Wn,aX as X,aY as Y,aZ as An,a_ as Mn,a$ as Gn,b0 as En,b1 as $n,b2 as Rn,b3 as Hn,b4 as Nn,b5 as jn,b6 as Kn,b7 as Bn,b8 as Vn,b9 as qn}from"./vendor.0884a784.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}})();const zn={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},Ge=ae({name:"comparatorPanel",initialState:zn,reducers:{setSelectedModel:(t,n)=>{t.selectedModel=n.payload},setSelectedWorkers:(t,n)=>{t.selectedWorkers=n.payload},setGenForm:(t,n)=>{t.genForm=structuredClone(n.payload)},setReload:(t,n)=>{t.reload=n.payload}}}),{setSelectedModel:dt,setSelectedWorkers:be,setGenForm:kt,setReload:Ct}=Ge.actions,Qn={sidebarOpen:!1},Ee=ae({name:"localState",initialState:Qn,reducers:{setSidebarOpen:(t,n)=>{t.sidebarOpen=n.payload}}}),{setSidebarOpen:St}=Ee.actions,$e={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},fe=ae({name:"persist",initialState:$e,reducers:{setKey:(t,n)=>{t.apikey=n.payload},setSelectedTab:(t,n)=>{t.selectedTab=n.payload},resetImageGens:t=>{t.imageGens=[]},addImageGen:(t,n)=>{t.imageGens.find(o=>o.id===n.payload.id)||t.imageGens.push(n.payload)},updateImageGen:(t,n)=>{const s=t.imageGens.findIndex(o=>o.id===n.payload.id);s!=null&&(t.imageGens[s]=n.payload)},addGenFavorite:(t,n)=>{t.genFavorites.push(n.payload)},updateGenFavorite:(t,n)=>{t.genFavorites[n.payload.idx]={name:t.genFavorites[n.payload.idx].name,form:n.payload.form}},deleteGenFavorite:(t,n)=>{t.genFavorites.splice(n.payload)},resetExceptApiKey:t=>(t={...$e,apikey:t.apikey},t)}}),{setKey:Zn,setSelectedTab:wt,resetImageGens:ct,addImageGen:Jn,updateImageGen:Ce,addGenFavorite:Xn,resetExceptApiKey:ya,updateGenFavorite:Yn,deleteGenFavorite:er}=fe.actions,tr={showPassword:!1},Re=ae({name:"settingsPanel",initialState:tr,reducers:{setShowPassword:(t,n)=>{t.showPassword=n.payload}}}),{setShowPassword:He}=Re.actions,nr={expandedPanel:"workers"},_e=ae({name:"userPanel",initialState:nr,reducers:{setUser:(t,n)=>{t.selectedUser=n.payload},setExpandedPanel:(t,n)=>{t.expandedPanel=n.payload}}}),{setUser:Ne,setExpandedPanel:rr}=_e.actions,ar={prompt:"",ipAddr:""},je=ae({name:"utilityPanel",initialState:ar,reducers:{setPrompt:(t,n)=>{t.prompt=n.payload},setIpAddr:(t,n)=>{t.ipAddr=n.payload}}}),{setPrompt:sr,setIpAddr:ir}=je.actions,lr={workerType:"image",sortKey:"name",order:"asc"},Ke=ae({name:"workerPanel",initialState:lr,reducers:{setWorkerType:(t,n)=>{t.workerType=n.payload},setWorkerFilter:(t,n)=>{t.workerFilter=n.payload},setSortKey:(t,n)=>{t.sortKey=n.payload},setOrder:(t,n)=>{t.order=n.payload}}}),{setWorkerType:or,setWorkerFilter:dr,setSortKey:ut,setOrder:cr}=Ke.actions,ur=Rt((t,n)=>t,(t,n)=>Object.assign({},$e,t),{whitelist:[fe.name]}),hr={key:"root",storage:Vt,whitelist:[fe.name,_e.name],transforms:[ur]},pr=Ht({[fe.name]:fe.reducer,[Ee.name]:Ee.reducer,[Re.name]:Re.reducer,[_e.name]:_e.reducer,[je.name]:je.reducer,[Ke.name]:Ke.reducer,[Ge.name]:Ge.reducer}),mr=Nt(hr,pr),ye=jt({reducer:mr,middleware:t=>t({serializableCheck:{ignoredActions:[qt,zt,Qt,Zt,Jt,Xt]}}),devTools:!1}),gr=Kt(ye);Bt(ye.dispatch);const O=Fe.create({baseURL:"https://aihorde.net/api/v2/"});O.interceptors.request.use(function(t){const n=ye.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.8"),t},function(t){return Promise.reject(t)});const fr=Fe.create({baseURL:"/horde-control-tower/"}),le=Fe.create({baseURL:"https://ratings.aihorde.net/api/v1/"});le.interceptors.request.use(function(t){const n=ye.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.8"),t},function(t){return Promise.reject(t)});const xr=t=>O.get("find_user",{headers:{apikey:t}}).then(n=>n.data),It=()=>O.get("status/modes").then(t=>t.data),Pt=()=>O.get("status/performance").then(t=>t.data),_t=()=>fr.get("users.json").then(t=>t.data),Qe=t=>O.get(`users/${t}`).then(n=>n.data),Ze=()=>O.get("workers").then(t=>t.data),yr=t=>O.get(`workers/${t}`).then(n=>n.data),Ft=()=>O.get("status/models").then(t=>t.data),Tt=(t,n)=>O.put(`users/${t}`,n).then(s=>s.data),br=(t,n)=>O.put(`workers/${t}`,n).then(s=>s.data),vr=t=>O.post("filters",t).then(n=>n.data),kr=t=>O.post("generate/async",t).then(n=>n.data),Cr=t=>O.get(`generate/check/${t}`).then(n=>n.data),Sr=t=>O.get(`generate/status/${t}`).then(n=>n.data),wr=t=>O.delete(`generate/status/${t}`).then(n=>n.data),Ir=t=>O.delete("operations/ipaddr",{data:t}).then(n=>n.data),K={all:["users"],lists:()=>[...K.all,"list"],list:t=>[...K.lists(),{filters:t}],details:()=>[...K.all,"detail"],detail:t=>[...K.details(),t]},V={all:["workers"],lists:()=>[...V.all,"list"],list:t=>[...V.lists(),{filters:t}],details:()=>[...V.all,"detail"],detail:t=>[...V.details(),t]},Pr=()=>(I(K.all,_t,{staleTime:1e3*30,refetchInterval:1e3*30}),I(["performance"],Pt,{staleTime:1e3*30,refetchInterval:1e3*30}),I(["mode"],It,{staleTime:1e3*30,refetchInterval:1e3*30}),I(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30}),e(v,{})),_r=()=>e(g,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(ne,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(g,{children:[e(m,{variant:"h4",textAlign:"center",children:"About"}),r(m,{variant:"body1",children:["Horde Control Tower is an open source"," ",e(Je,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(m,{variant:"body1",children:["The project source is available on"," ",e(Je,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),W=()=>en(),C=Yt,Fr=()=>{const t=W(),n=C(T=>T.comparatorPanel.genForm),s=C(T=>T.persist.genFavorites),[o,a]=S.exports.useState(!1),[l,d]=S.exports.useState(-1),[p,u]=S.exports.useState(!1),[i,h]=S.exports.useState(-1),[k,y]=S.exports.useState(!1),[M,A]=S.exports.useState(""),[G,c]=S.exports.useState(null),x=Boolean(G),U=T=>{c(T.currentTarget)},E=()=>{c(null)},P=()=>{y(!1)},w=()=>{t(Xn({name:M,form:n})),A(""),y(!1)},oe=()=>{d(-1),a(!1)},Lt=()=>{t(Yn({idx:l,form:n})),d(-1),a(!1)},Wt=()=>{h(-1),u(!1)},At=()=>{t(er(i)),h(-1),u(!1)},Mt=T=>{t(kt(T)),t(Ct(!0)),c(null)},Gt=()=>{y(!0),c(null)},Et=()=>{a(!0),c(null)},$t=()=>{u(!0),c(null)};return r(v,{children:[r(ue,{open:p,onClose:oe,children:[e(D,{children:"Delete Preset"}),r(he,{children:[e(De,{children:"Select a preset to delete."}),e(Se,{children:s.map((T,q)=>e(z,{disablePadding:!0,sx:{backgroundColor:i===q?"error.dark":""},onClick:()=>{h(q)},children:e(Xe,{children:e(Q,{primary:T.name})})},q))})]}),r(L,{children:[e(b,{onClick:Wt,children:"Cancel"}),e(b,{disabled:i===-1,onClick:At,children:"Select"})]})]}),r(ue,{open:o,onClose:oe,children:[e(D,{children:"Overwrite Preset"}),r(he,{children:[e(De,{children:"Select a preset to overwrite."}),e(Se,{children:s.map((T,q)=>e(z,{disablePadding:!0,sx:{backgroundColor:l===q?"success.dark":""},onClick:()=>{d(q)},children:e(Xe,{children:e(Q,{primary:T.name})})},q))})]}),r(L,{children:[e(b,{onClick:oe,children:"Cancel"}),e(b,{disabled:l===-1,onClick:Lt,children:"Select"})]})]}),r(ue,{open:k,onClose:P,children:[e(D,{children:"Add New Preset"}),r(he,{children:[e(De,{children:"Enter a friendly name for this new preset."}),e(H,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:M,onChange:T=>{A(T.target.value)}})]}),r(L,{children:[e(b,{onClick:P,children:"Cancel"}),e(b,{onClick:w,children:"Create"})]})]}),e(j,{onClick:U,children:e(tn,{})}),r(nn,{anchorEl:G,open:x,onClose:E,children:[s.map((T,q)=>e(Z,{onClick:()=>{Mt(T.form)},children:T.name},q)),s.length>0?e(pe,{}):null,s.length>0?e(Z,{onClick:$t,children:"Delete Preset"}):null,s.length>0?e(pe,{}):null,s.length>0?e(Z,{onClick:Et,children:"Overwrite Preset"}):null,s.length>0?e(pe,{}):null,e(Z,{onClick:Gt,children:"Add New Preset"})]})]})},Tr=()=>{const t=C(a=>a.persist.imageGens),{data:n}=I(V.all,()=>Ze(),{refetchInterval:1e3*30,select:a=>rn(a.map(l=>[l.id,l.name]))}),s=a=>{var d,p,u;const l=a.status!=null?a.status:a.check;return a.state!=="complete"&&l!=null?r(me,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(xe,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(ge,{title:n==null?"":n[(d=a.payload.workers[0])!=null?d:""],subtitle:`Position: ${l.queue_position}, wait time: ${l.wait_time}`})]},a.id):a.state==="complete"?o(a).length===0?r(me,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(m,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(ge,{title:n==null?"":n[(p=a.payload.workers[0])!=null?p:""]})]},a.id):r(me,{sx:{paddingTop:o(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:o(a)}),e(ge,{title:n==null?"":n[(u=a.payload.workers[0])!=null?u:""]})]},a.id):e(v,{})},o=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(g,{children:e(Ve,{sx:{width:"100%",height:"100%"},cols:4,children:t.map(a=>s(a))})})},Dr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Or=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],R="175px",Ur=()=>{const t=W(),n=C(c=>c.comparatorPanel.selectedWorkers),s=C(c=>c.comparatorPanel.selectedModel),o=C(c=>c.comparatorPanel.genForm),a=C(c=>c.persist.imageGens),l=C(c=>c.persist.imageGens.length>0),d=C(c=>c.comparatorPanel.reload),p=C(c=>c.persist.imageGens.some(x=>["pending","check"].includes(x.state))),{mutate:u}=ie({mutationFn:kr,onSuccess:(c,x,U)=>{t(Jn({id:c.id,payload:x,state:"check",check:null,status:null}))}}),{handleSubmit:i,control:h,formState:{errors:k},watch:y,setValue:M,reset:A}=an({defaultValues:o}),G=c=>{s!=null&&n.length>0&&(t(ct()),n.forEach(x=>{const U={...c,workers:[x.id],models:[s.name]};u(U)}))};return S.exports.useEffect(()=>{const c=y(sn((x,{name:U,type:E})=>{t(kt(x))},300));return()=>c.unsubscribe()},[y]),S.exports.useEffect(()=>{d&&(t(Ct(!1)),A(o))},[d]),e(g,{children:r("form",{onSubmit:i(G),children:[r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Prompt"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"prompt",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(H,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...c})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Seed"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.seed",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(H,{fullWidth:!0,placeholder:"Seed",...c})})}),e(f,{item:!0,children:e(j,{"aria-label":"randomize seed",onClick:()=>{M("params.seed",ln(1e8,999999999).toString())},children:e(on,{})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Sampler"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.sampler_name",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Le,{...c,fullWidth:!0,children:Or.map(x=>e(Z,{value:x,children:x},x))})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Steps"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.steps",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...c})})}),e(F,{name:"params.steps",control:h,render:({field:c})=>e(f,{item:!0,children:e(se,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Width"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.width",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...c})})}),e(F,{name:"params.width",control:h,render:({field:c})=>e(f,{item:!0,children:e(se,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Height"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.height",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...c})})}),e(F,{name:"params.height",control:h,render:({field:c})=>e(f,{item:!0,children:e(se,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"CFG"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.cfg_scale",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...c})})}),e(F,{name:"params.cfg_scale",control:h,render:({field:c})=>e(f,{item:!0,children:e(se,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Clip Skip"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.clip_skip",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...c})})}),e(F,{name:"params.clip_skip",control:h,render:({field:c})=>e(f,{item:!0,children:e(se,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Post-Processors"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.post_processing",control:h,render:({field:{onChange:c,onBlur:x,value:U,name:E,ref:P}})=>e(f,{item:!0,xs:!0,children:e(we,{fullWidth:!0,multiple:!0,onBlur:x,ref:P,value:U,onChange:(w,oe)=>{c(oe)},options:Dr,getOptionLabel:w=>w,renderInput:w=>e(H,{...w})})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"High Res Fix"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.hires_fix",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Oe,{...c,checked:c.value})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Karras"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.karras",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Oe,{...c,checked:c.value})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:R},children:"Tiling"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.tiling",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Oe,{...c,checked:c.value})})})})]}),e(J,{type:"submit",loading:p,variant:"contained",children:"Submit"}),p?e(b,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(c=>["pending","check"].includes(c.state)).forEach(c=>{t(Ce({...c,state:"delete"}))})},children:"Cancel"}):null,l?e(b,{sx:{ml:2},variant:"contained",onClick:()=>{t(ct())},children:"Clear Output"}):null]})})},Lr=t=>t!=null&&"name"in t,Wr=t=>t!=null&&yt(t)&&"name"in t[0]&&"id"in t[0],ht="175px",Ar=()=>{const t=W(),n=C(u=>u.comparatorPanel.selectedWorkers),s=C(u=>u.comparatorPanel.selectedModel),o=(u,i)=>{yt(i)&&i.length===0?t(be([])):Wr(i)&&t(be(i))},a=(u,i)=>{i==null?t(dt(null)):Lr(i)&&t(dt(i))},{data:l}=I(V.all,()=>Ze(),{refetchInterval:1e3*30,select:u=>Ie(u,[i=>i.name.toLowerCase()],["asc"])}),{data:d}=I(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30,select:u=>Ie(u,[i=>i.name.toLowerCase()],["asc"])});S.exports.useEffect(()=>{if(s!=null&&n.length>0){const u=n.map(k=>k.id),i=n.filter(k=>{var y;return(y=k==null?void 0:k.models)==null?void 0:y.includes(s.name)}),h=i.map(k=>k.id);dn(u,h)||t(be(i))}else s==null&&n.length>0&&t(be([]))},[l,d,n,s]);const p=(l!=null?l:[]).filter(u=>{var i;return s==null?!0:(i=u==null?void 0:u.models)==null?void 0:i.includes(s.name)});return r(g,{children:[r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:ht},children:"Model"}),e(we,{fullWidth:!0,disablePortal:!0,options:d!=null?d:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:u=>Pe(u)?u:u.name,isOptionEqualToValue:(u,i)=>u.name===i.name,filterSelectedOptions:!0,renderInput:u=>e(H,{...u,label:"Selected Model"}),onChange:a})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(m,{variant:"body1",sx:{width:ht},children:"Workers"}),e(we,{fullWidth:!0,multiple:!0,disablePortal:!0,options:p,value:n,getOptionLabel:u=>u.name,isOptionEqualToValue:(u,i)=>u.id===i.id,filterSelectedOptions:!0,renderInput:u=>e(H,{...u,label:"Selected Workers"}),onChange:o})]})]})},Mr=()=>r(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,xl:4,children:r(ne,{sx:{p:2},children:[r(g,{sx:{position:"relative"},children:[e(m,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(g,{sx:{position:"absolute",top:0,right:0},children:e(Fr,{})})]}),e(Ar,{}),e(Ur,{})]})}),e(f,{item:!0,xs:12,xl:8,children:r(ne,{sx:{p:2,height:"100%"},children:[e(m,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(Tr,{})]})})]}),Dt={format:"json",limit:100},Gr=t=>le.get("user/ratings",{params:Object.assign({},Dt,t)}).then(n=>n.data),Er=(t,n)=>le.get(`user/validate/${t}`,{params:Object.assign({},Dt,n)}).then(s=>s.data),$r=t=>le.get(`user/check/${t}`).then(n=>n.data),Rr=t=>le.post(`user/flag/${t}`).then(n=>n.data),Hr=(t,n)=>le.post(`user/modify/${t}`,n).then(s=>s.data),N={all:["ratings"],lists:()=>[...N.all,"list"],list:t=>[...N.lists(),{filters:t}],details:()=>[...N.all,"detail"],detail:t=>[...N.details(),t],validates:()=>[...N.all,"validate"],validate:t=>[...N.validates(),t],checks:()=>[...N.all,"check"],check:t=>[...N.checks(),t]},Nr=()=>{const{data:t,isLoading:n}=I(["user/ratings"],()=>Gr()),s=W();if(n)return e(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(xe,{})})});const o=l=>{const d=bt(l.username.split("#"));d!=null&&(s(Ne(parseInt(d))),s(wt("1")))},a=l=>r(g,{sx:{display:"flex"},children:[e(m,{sx:{textDecoration:"underline"},onClick:()=>o(l),children:l.username}),r(m,{children:["\xA0- r: ",l.rating,", a: ",l.artifacts,", avg: ",l.average,", n: ",l.times_rated]})]});return t==null?e(v,{}):e(g,{children:e(Ve,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:t.ratings.map(l=>r(me,{children:[e("img",{src:l.image}),e(ge,{title:a(l)})]},l.image_id))})})},Ot=()=>{const t=W(),n=C(a=>a.persist.apikey),s=C(a=>a.settingsPanel.showPassword);return r(We,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(Ae,{children:"API Key"}),e(se,{defaultValue:n,onBlur:a=>{t(Zn(a.target.value)),t(He(!1))},type:s?"text":"password",endAdornment:e(cn,{position:"end",children:e(j,{onClick:()=>t(He(!s)),children:s?e(un,{}):e(hn,{})})})})]})},jr=()=>e(f,{container:!0,spacing:2,children:e(f,{item:!0,md:12,lg:6,xl:4,children:e(ne,{children:e(Ot,{})})})}),Be="#0583B0",ee="#FF6962",Kr="#7c0500",Br="#ef9b0f",pt=t=>t.type==="image"&&parseFloat(t.performance)>3,mt=t=>t.type==="image"&&parseFloat(t.performance)<.4,Ut=t=>{var G,c;const{worker:n}=t,s=Te(),[o,a]=S.exports.useState(!1),[l,d]=S.exports.useState(!1),[p,u]=S.exports.useState("setFlagged"),[i,h]=S.exports.useState(""),k=x=>x.maintenance_mode||x.paused||x.flagged?Kr:pt(x)||mt(x)?Br:"background.paper",y=ie(x=>br(x.id,x.data),{onSuccess:(x,U)=>{a(!0),s.invalidateQueries({queryKey:V.detail(U.id)}),s.invalidateQueries({queryKey:V.all})}}),M=(x,U)=>{U!=="clickaway"&&a(!1)};return r(v,{children:[e(ue,{open:l,onClose:()=>d(!1),children:(x=>{var U;switch(x){case"setFlagged":return r(v,{children:[r(D,{children:['Set "',n.name,'" as Flagged']}),r(L,{children:[e(b,{onClick:()=>{d(!1)},children:"Cancel"}),e(b,{onClick:()=>{d(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(v,{children:[r(D,{children:['Unset "',n.name,'" as Flagged']}),r(L,{children:[e(b,{onClick:()=>d(!1),children:"Cancel"}),e(b,{onClick:()=>{d(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(v,{children:[r(D,{children:['Set "',n.name,'" Maintenance Mode']}),e(he,{children:e(H,{value:i,onChange:E=>{h(E.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(L,{children:[e(b,{onClick:()=>d(!1),children:"Cancel"}),e(b,{onClick:()=>{const E={maintenance:!0};re(i)||(E.maintenance_msg=i),y.mutate({id:n.id,data:E}),d(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(v,{children:[r(D,{children:['Unset "',n.name,'" Maintenance Mode']}),r(L,{children:[e(b,{onClick:()=>d(!1),children:"Cancel"}),e(b,{onClick:()=>{y.mutate({id:n.id,data:{maintenance:!1,maintenance_msg:""}}),d(!1)},children:"Confirm"})]})]});case"setPaused":return r(v,{children:[r(D,{children:['Set "',n.name,'" Paused Mode']}),r(L,{children:[e(b,{onClick:()=>d(!1),children:"Cancel"}),e(b,{onClick:()=>{y.mutate({id:n.id,data:{paused:!0}}),d(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(v,{children:[r(D,{children:['Unset "',n.name,'" Paused Mode']}),r(L,{children:[e(b,{onClick:()=>d(!1),children:"Cancel"}),e(b,{onClick:()=>{y.mutate({id:n.id,data:{paused:!1}}),d(!1)},children:"Confirm"})]})]});case"listModels":return r(v,{children:[r(D,{children:['"',n.name,'" Models']}),e(he,{children:e(m,{variant:"body1",children:Ie((U=n==null?void 0:n.models)!=null?U:[],[E=>E.toLowerCase()]).join(", ")})})]})}})(p)}),e(qe,{open:o,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ze,{onClose:M,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(f,{item:!0,xs:12,lg:6,xl:3,children:r(pn,{sx:{backgroundColor:k(n)},children:[e(mn,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:n.online&&!n.paused&&!n.maintenance_mode&&!n.flagged?e($,{title:"Worker Online",children:e(gn,{sx:{color:Be}})}):e($,{title:"Worker Issue",children:e(fn,{sx:{color:ee}})}),action:r(g,{children:[mt(n)?e($,{title:"Worker Low Speed Warning",children:e(Ye,{sx:{color:ee,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,pt(n)?e($,{title:"Worker High Speed Warning",children:e(Ye,{sx:{color:ee,mt:.5,mr:1}})}):null,n.paused?e($,{title:"Worker Paused",children:e(et,{sx:{color:ee,mt:.5,mr:1}})}):null,n.maintenance_mode?e($,{title:"Worker Maintenance",children:e(tt,{sx:{color:ee,mt:.5,mr:1}})}):null,n.flagged?e($,{title:"User Flagged",children:e(xn,{sx:{color:ee,mt:.5,mr:1}})}):null,n.trusted?e($,{title:"Trusted Worker",children:e(yn,{sx:{color:Be,mt:.5,mr:1}})}):null]}),title:e(m,{variant:"h5",children:bn(n.name,{length:30})}),subheader:n.id}),r(vn,{children:[r(m,{variant:"body2",children:["Full Name: ",n.name]}),r(m,{variant:"body2",children:["Owner: ",n.owner]}),r(m,{variant:"body2",children:["Bridge Agent: ",n.bridge_agent]}),r(m,{variant:"body2",children:["Uptime: ",te.fromObject({seconds:n.uptime}).toHuman()]}),n.type!=="interrogation"?r(m,{variant:"body2",children:["Models Loaded: ",(c=(G=n==null?void 0:n.models)==null?void 0:G.length)!=null?c:"None"]}):null,n.type==="image"?r(m,{variant:"body2",children:["MPS Generated: ",n.megapixelsteps_generated]}):null,r(m,{variant:"body2",children:["Speed: ",n.performance]}),r(m,{variant:"body2",children:["Threads: ",n.threads]}),r(m,{variant:"body2",children:["Requests Fulfilled: ",n.requests_fulfilled]}),r(m,{variant:"body2",children:["NSFW: ",n.nsfw?"true":"false"]})]}),r(kn,{disableSpacing:!0,children:[e($,{title:"Show Worker Models",children:e(j,{onClick:()=>{u("listModels"),d(!0)},children:e(Cn,{})})}),n.maintenance_mode?e($,{title:"Unset Worker Maintenance",children:e(j,{onClick:()=>{u("unsetMaintenance"),d(!0)},children:e(Sn,{})})}):e($,{title:"Set Worker Maintenance",children:e(j,{onClick:()=>{u("setMaintenance"),d(!0)},children:e(tt,{})})}),n.paused?e($,{title:"Unset Worker Pause",children:e(j,{onClick:()=>{u("unsetPaused"),d(!0)},children:e(wn,{})})}):e($,{title:"Set Worker Pause",children:e(j,{onClick:()=>{u("setPaused"),d(!0)},children:e(et,{})})})]})]})},n.id)]})},Vr=t=>{const{workerId:n}=t,{data:s}=I(V.detail(n),()=>yr(n),{staleTime:1e3*61,select:o=>({...o,performance:o.performance.replace(" megapixelsteps per second","")})});return s==null?e(v,{}):e(Ut,{worker:s})},qr=t=>{const{userId:n}=t,{data:s}=I(K.detail(n),()=>Qe(n));if(s==null)return e(v,{});const o=s.worker_ids;return o==null||(o==null?void 0:o.length)===0?e(f,{item:!0,md:12,lg:6,xl:4,children:e(m,{variant:"body1",children:"This user has no workers."})}):e(v,{children:o.map(a=>e(Vr,{workerId:a},a))})},[zr,Qr,Zr]=In(),Jr=t=>t!=null&&"username"in t&&"id"in t,ce=t=>{const n=bt(t.split("#"));return n==null?null:Pn(n)},Xr=()=>{var u;const t=W(),[n,s]=S.exports.useState(""),[o]=vt(n,400),{data:a}=I(K.all,_t),{data:l,refetch:d}=I(K.detail((u=ce(o))!=null?u:-1),()=>{var i;return Qe((i=ce(o))!=null?i:-1)},{enabled:!1});if(S.exports.useEffect(()=>{d()},[o]),a==null)return e(v,{});const p=(i,h)=>{var k;if(Pe(h)){const y=ce(h);h!=="0"&&y!==0&&t(Ne((k=ce(h))!=null?k:-1))}else Jr(h)&&h.id!==0&&t(Ne(h.id))};return e(we,{disablePortal:!0,options:[...l!=null&&l.id>4769?[l]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:i=>Pe(i)?i:i.username,isOptionEqualToValue:(i,h)=>i.id===h.id,renderInput:i=>e(H,{...i,variant:"standard",label:"User Lookup",size:"small"}),onChange:p,onInputChange:(i,h)=>{h!=="0"&&ce(h)!==0&&s(h)}})},Yr=()=>{var E;const t=C(P=>{var w;return(w=P.userPanel.selectedUser)!=null?w:-1}),n=Te(),[s,o]=S.exports.useState("setFlagged"),[a,l]=S.exports.useState(!1),[d,p]=S.exports.useState(!1),[u,i]=S.exports.useState(!1),h=I(K.detail(t),()=>Qe(t),{refetchInterval:1e3*15}),k=I(N.check(t),()=>$r(t),{enabled:!u,onError:P=>i(!0),refetchInterval:1e3*15}),y=ie(P=>Tt(P.id,P.data),{onSuccess:(P,w)=>{n.invalidateQueries({queryKey:K.detail(w.id)})}}),M=ie(P=>Rr(P.id),{}),A=ie(P=>Hr(P.id,P.data),{onSuccess:(P,w)=>{n.invalidateQueries({queryKey:N.check(w.id)})}}),G=Qr();if(S.exports.useEffect(()=>{if(h.data!=null){const P={trusted:h.data.trusted,flagged:h.data.flagged,worker_invite:h.data.worker_invited.toString()};G.setValues(P),G.resetDirty(P)}},[h.isInitialLoading]),h.isLoading)return e(g,{py:4,sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(xe,{})});if(h.data==null)return e(v,{});const c=(E=k.data)!=null?E:null,x=(P,w)=>{w!=="clickaway"&&l(!1)};return r(v,{children:[e(ue,{open:d,onClose:()=>p(!1),children:(P=>{switch(P){case"resetSuspicion":return r(v,{children:[r(D,{children:['Reset "',h.data.username,'" Suspicion']}),r(L,{children:[e(b,{onClick:()=>{p(!1)},children:"Cancel"}),e(b,{onClick:()=>{const w={reset_suspicion:!0};y.mutate({id:t,data:w}),p(!1)},children:"Confirm"})]})]});case"setFlagged":return r(v,{children:[r(D,{children:['Flag "',h.data.username,'" ratings and delete?']}),r(L,{children:[e(b,{onClick:()=>{p(!1)},children:"Cancel"}),e(b,{onClick:()=>{M.mutate({id:t}),p(!1)},children:"Confirm"})]})]});case"setValidated":return r(v,{children:[r(D,{children:['Set "',h.data.username,'" ratings as validated']}),r(L,{children:[e(b,{onClick:()=>{p(!1)},children:"Cancel"}),e(b,{onClick:async()=>{const w={validated:!0};await A.mutate({id:t,data:w}),p(!1)},children:"Confirm"})]})]});case"setUnvalidated":return r(v,{children:[r(D,{children:['Set "',h.data.username,'" ratings as unvalidated']}),r(L,{children:[e(b,{onClick:()=>{p(!1)},children:"Cancel"}),e(b,{onClick:async()=>{const w={validated:!1};await A.mutate({id:t,data:w}),p(!1)},children:"Confirm"})]})]});case"setVPN":return r(v,{children:[r(D,{children:['Allow "',h.data.username,'" to use VPNs']}),r(L,{children:[e(b,{onClick:()=>{p(!1)},children:"Cancel"}),e(b,{onClick:async()=>{const w={vpn:!0};y.mutate({id:t,data:w}),l(!0),p(!1)},children:"Confirm"})]})]});case"unsetVPN":return r(v,{children:[r(D,{children:['Disallow "',h.data.username,'" to use VPNs']}),r(L,{children:[e(b,{onClick:()=>{p(!1)},children:"Cancel"}),e(b,{onClick:async()=>{const w={vpn:!1};y.mutate({id:t,data:w}),l(!0),p(!1)},children:"Confirm"})]})]})}})(s)}),e(qe,{open:a,autoHideDuration:6e3,onClose:x,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ze,{onClose:x,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(_n,{component:g,children:e(Fn,{size:"small",children:r(Tn,{children:[r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Username"})}),e(_,{align:"right",children:r(m,{variant:"body1",children:[h.data.username," ",h.data.moderator?"(moderator)":""]})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Trusted"})}),e(_,{align:"right",children:e(nt,{...G.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Flagged"})}),e(_,{align:"right",children:e(nt,{...G.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"VPN Access"})}),r(_,{align:"right",sx:{display:"flex",alignItems:"center"},children:[e(J,{onClick:async()=>{o("setVPN"),p(!0)},loading:A.isLoading,variant:"contained",color:"success",sx:{order:1,ml:4},children:"Enable VPN"}),e(J,{onClick:async()=>{o("unsetVPN"),p(!0)},loading:A.isLoading,variant:"contained",color:"error",sx:{order:0,ml:4},children:"Disable VPN"})]})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Worker Invites"})}),e(_,{align:"right",children:e(H,{variant:"standard",type:"number",...G.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Worker Count"})}),e(_,{align:"right",children:e(m,{variant:"body1",children:h.data.worker_count})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Kudos"})}),e(_,{align:"right",children:e(m,{variant:"body1",children:h.data.kudos})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Suspicious"})}),r(_,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[e(m,{sx:{order:0},variant:"body1",children:h.data.suspicious}),h.data.suspicious>0?e(J,{onClick:async()=>{o("resetSuspicion"),p(!0)},loading:y.isLoading,variant:"contained",color:"error",sx:{ml:4},children:"Reset"}):null]})]}),c!=null?r(v,{children:[r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Ratings Validated"})}),r(_,{align:"right",sx:{display:"flex",alignItems:"center"},children:[e(m,{sx:{order:1},variant:"body1",children:c.validated?"True":"False"}),e(J,{onClick:async()=>{c.validated?o("setUnvalidated"):o("setValidated"),p(!0)},loading:A.isLoading,variant:"contained",color:c.validated?"error":"success",sx:{order:0,ml:4},children:c.validated?"Unvalidate":"Validate"})]})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(m,{variant:"body1",children:"Flag User Ratings"})}),e(_,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:e(J,{onClick:async()=>{o("setFlagged"),p(!0)},loading:M.isLoading,variant:"contained",color:"error",sx:{order:0},children:"Flag"})})]})]}):null]})})})]})},ea=()=>{const t=Te(),n=C(p=>p.userPanel.selectedUser),[s,o]=S.exports.useState(!1),a=Zr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),l=ie(p=>Tt(p.id,p.data),{onSuccess:(p,u)=>{var h,k,y,M;t.setQueryData(K.detail(u.id),A=>A!=null?{...A,...p}:p);const i={trusted:(h=p.trusted)!=null?h:!1,flagged:(k=p.flagged)!=null?k:!1,worker_invite:(M=(y=p.worker_invite)==null?void 0:y.toString())!=null?M:"0"};re(i)||(a.setValues(i),a.resetDirty(i)),o(!0)}}),d=(p,u)=>{u!=="clickaway"&&o(!1)};return r(ne,{elevation:1,sx:{p:2,height:"100%"},children:[e(qe,{open:s,autoHideDuration:6e3,onClose:d,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ze,{onClose:d,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((p,u)=>{if(n!=null){const i={trusted:p.trusted,flagged:p.flagged,worker_invite:parseInt(p.worker_invite)};l.mutate({id:n,data:i})}}),children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(Xr,{}),n!=null?e(g,{display:"flex",alignItems:"center",children:a.isDirty()?e(b,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null}):null]}),e(zr,{form:a,children:e(g,{display:"flex",children:n!=null&&n!=-1?e(Yr,{}):null})})]})]})},ta=t=>{Te();const{userId:n}=t;S.exports.useState(!1);const[s,o]=S.exports.useState(!1),{data:a,isInitialLoading:l,isLoading:d,isError:p}=I(N.validate(n),()=>Er(n),{enabled:!s,onError:i=>o(!0),refetchInterval:1e3*15}),u=i=>e(g,{sx:{display:"flex"},children:r(m,{children:["r: ",i.rating,", a: ",i.artifacts,", avg: ",i.average,", n: ",i.times_rated]})});return d?e(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(xe,{})})}):p?e(m,{children:"User has no ratings."}):a==null?e(v,{}):e(g,{children:e(Ve,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:a.ratings.map(i=>r(me,{children:[e("img",{src:i.image}),e(ge,{title:u(i)})]},i.image_id))})})},na=()=>{const t=W(),n=C(a=>a.userPanel.selectedUser),s=C(a=>a.userPanel.expandedPanel),o=a=>(l,d)=>{(a==="workers"||a==="ratings")&&t(rr(d?a:!1))};return r(f,{container:!0,spacing:2,children:[e(f,{item:!0,md:12,lg:6,xl:4,children:e(ea,{})}),e(f,{item:!0,md:12,lg:12,xl:12,children:r(g,{children:[r(rt,{expanded:s==="workers",onChange:o("workers"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:e(m,{sx:{width:"33%",flexShrink:0},children:"Workers"})}),e(it,{sx:{backgroundColor:"background.default"},children:e(f,{container:!0,spacing:2,children:n!=null?e(qr,{userId:n}):null})})]}),r(rt,{expanded:s==="ratings",onChange:o("ratings"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:e(m,{sx:{width:"33%",flexShrink:0},children:"Ratings"})}),e(it,{sx:{backgroundColor:"background.default"},children:s==="ratings"&&n!=null?e(ta,{userId:n}):null})]})]})})]})},ra=()=>{const t=W(),n=C(d=>d.utilityPanel.ipAddr),{data:s,refetch:o,isFetching:a}=I(["deleteIpAddr",n],()=>Ir({ipaddr:n}),{enabled:!1,cacheTime:0});return e(ne,{elevation:1,sx:{p:2,height:"100%"},children:r(g,{children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(m,{variant:"h4",children:"Clear IP Timeout"}),e(J,{onClick:()=>{re(n)||o()},loading:a,variant:"contained",children:"Submit"})]}),e(H,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:d=>{t(ir(d.target.value))},placeholder:"Enter IP"}),s!=null?e(g,{pt:2,children:r(m,{variant:"body1",children:["Response: ",s.message]})}):null]})})},aa=()=>{const t=W(),n=C(d=>d.utilityPanel.prompt),{data:s,refetch:o,isFetching:a}=I(["promptCheck",n],()=>vr({filter_type:0,prompt:n}),{enabled:!1});return e(ne,{elevation:1,sx:{p:2,height:"100%"},children:r(g,{children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(m,{variant:"h4",children:"Prompt Checker"}),e(J,{onClick:()=>{re(n)||o()},loading:a,variant:"contained",children:"Submit"})]}),e(H,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:d=>{t(sr(d.target.value))},placeholder:"Enter prompt"}),s!=null?r(g,{pt:2,children:[r(m,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(m,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},sa=()=>r(f,{container:!0,spacing:2,children:[e(f,{item:!0,md:12,lg:6,xl:4,children:e(aa,{})}),e(f,{item:!0,md:12,lg:6,xl:4,children:e(ra,{})})]}),ia=()=>{const t=C(l=>l.workerPanel.workerFilter),[n,s]=S.exports.useState(t!=null?t:""),[o]=vt(n,400),a=W();return S.exports.useEffect(()=>{a(dr(o))},[o]),e(H,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:n,onChange:l=>{s(l.target.value)}})},gt={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},la=()=>{const t=W(),n=C(i=>i.workerPanel.sortKey),s=C(i=>i.workerPanel.order),o=C(i=>i.workerPanel.workerFilter),a=C(i=>i.workerPanel.workerType),{data:l}=I(V.all,()=>Ze(),{refetchInterval:1e3*30,select:i=>{const h=o==null?void 0:o.toLowerCase();return Ie(i.filter(k=>{var y;return k.type!==a?!1:h==null?!0:k.name.toLowerCase().includes(h)||((y=k.owner)!=null?y:"").toLowerCase().includes(h)||k.id.toLowerCase().includes(h)||k.bridge_agent.toLowerCase().includes(h)}),[k=>{const y=k[n];return Pe(y)?n==="performance"&&parseFloat(y)?parseFloat(y):y.toLowerCase():y}],[s])}}),d=i=>{var k,y;const h=i.target.value;t(or(h)),t(ut((y=(k=Un(gt[h]))==null?void 0:k.parameter)!=null?y:"name"))},p=i=>{t(ut(i.target.value))},u=i=>{t(cr(i))};return l==null?e(v,{}):r(v,{children:[r(g,{display:"flex",justifyContent:"space-between",pb:2,children:[r(g,{display:"flex",alignItems:"center",children:[e(m,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(ia,{})]}),r(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(We,{sx:{mr:1},children:[e(Ae,{children:"Worker Type"}),r(Le,{value:a,label:"Worker Type",onChange:d,sx:{".MuiSelect-select":{py:1}},children:[e(Z,{value:"image",children:"Image"}),e(Z,{value:"interrogation",children:"Interrogation"}),e(Z,{value:"text",children:"Text"})]})]}),r(We,{sx:{mr:1},children:[e(Ae,{children:"Sort Key"}),e(Le,{value:n,label:"Sort Key",onChange:p,sx:{".MuiSelect-select":{py:1}},children:gt[a].map(i=>e(Z,{value:i.parameter,children:i.label},i.label))})]}),s==="asc"?e(j,{onClick:()=>u("desc"),children:e(Dn,{})}):e(j,{onClick:()=>u("asc"),children:e(On,{})})]})]}),e(f,{container:!0,spacing:2,children:l.map(i=>e(Ut,{worker:i},i.id))})]})},ft=()=>{const{data:t,isLoading:n,error:s}=I(["mode"],It);if(n)return e(m,{variant:"h6",children:"Loading Horde status ..."});if(t==null||s)return console.log("HordeStatus error",s),e(m,{variant:"h6",children:"Error loading Horde status"});const o=a=>a?e(lt,{sx:{color:ee,ml:1}}):e(lt,{sx:{color:Be,ml:1}});return r(Se,{children:[r(z,{children:[e(Ue,{children:o(t.maintenance_mode)}),e(Q,{primary:"Maintenance"})]}),r(z,{children:[e(Ue,{children:o(t.invite_only_mode)}),e(Q,{primary:"Invite Only"})]}),t.raid_mode!=null?r(z,{children:[e(Ue,{children:o(t.raid_mode)}),e(Q,{primary:"Raid"})]}):null]})},xt=()=>{const{data:t,isLoading:n,error:s}=I(["performance"],Pt);return n?e(m,{variant:"h6",children:"Loading Horde status ..."}):t==null||s?e(m,{variant:"h6",children:"Error loading Horde status"}):r(Se,{children:[e(z,{children:e(Q,{primary:`Queued Requests: ${t.queued_requests}`})}),e(z,{children:e(Q,{primary:`Queued MPS: ${t.queued_megapixelsteps}`})}),e(z,{children:e(Q,{primary:`Past Minute MPS: ${t.past_minute_megapixelsteps}`})}),e(z,{children:e(Q,{primary:`Workers: ${t.worker_count}`})})]})},ve=240,oa=()=>{const t=W(),n=C(o=>o.localState.sidebarOpen);return r(v,{children:[r(ot,{variant:"temporary",open:n,onClose:()=>{t(St(!n))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ve,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ve}},children:[e(Me,{}),r(g,{sx:{overflow:"auto"},children:[e(xt,{}),e(pe,{}),e(ft,{})]})]}),r(ot,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ve,flexShrink:0,["& .MuiDrawer-paper"]:{width:ve,boxSizing:"border-box"}},children:[e(Me,{}),r(g,{sx:{overflow:"auto"},children:[e(xt,{}),e(pe,{}),e(ft,{})]})]})]})},da=()=>{const t=W(),n=C(o=>o.persist.selectedTab);return r(g,{display:"flex",children:[e(oa,{}),e(g,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(Ln,{value:n,children:[e(g,{sx:{borderBottom:1,borderColor:"divider"},children:r(Wn,{onChange:(o,a)=>{a!="4"&&t(He(!1)),t(wt(a))},"aria-label":"lab API tabs example",children:[e(X,{label:"User Lookup",value:"1"}),e(X,{label:"Workers",value:"2"}),e(X,{label:"Comparator",value:"3"}),e(X,{label:"Ratings",value:"4"}),e(X,{label:"Utilities",value:"5"}),e(X,{label:"Settings",value:"6"}),e(X,{label:"About",value:"7"})]})}),e(Y,{value:"1",children:e(na,{})}),e(Y,{value:"2",children:e(la,{})}),e(Y,{value:"3",children:e(Mr,{})}),e(Y,{value:"4",children:e(Nr,{})}),e(Y,{value:"5",children:e(sa,{})}),e(Y,{value:"6",children:e(jr,{})}),e(Y,{value:"7",children:e(_r,{})})]})})]})},ke=()=>{const t=W(),n=C(o=>o.localState.sidebarOpen);return e(An,{position:"sticky",sx:{zIndex:o=>o.zIndex.drawer+1},children:r(Me,{children:[e(j,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{t(St(!n))},sx:{mr:2,display:{md:"none"}},children:e(Mn,{})}),r(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Horde Control Tower v","0.0.8"]}),null]})})},ca=async t=>{const n=window.document.createElement("canvas"),s=window.Image,o=(await Promise.allSettled([t].map(async l=>await new Promise((d,p)=>{let u;Gn(l,"src")?u=l:u={src:l};const i=new s;i.onerror=()=>p(new Error("Couldn't load image")),i.onload=()=>d({...u,img:i}),i.src=u.src,i.crossOrigin="anonymous"})))).filter(l=>l.status==="fulfilled").map(l=>l.value),a=n.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const l=d=>Math.max(...o.map(p=>{var u,i;return(i=(u=p==null?void 0:p.img)==null?void 0:u[d])!=null?i:0}));return n.width=l("width"),n.height=l("height"),o.forEach(d=>{var p,u;if(d!=null&&(a.globalAlpha=d.opacity!=null?d.opacity:1,d.img!=null))return a.drawImage(d.img,(p=d.x)!=null?p:0,(u=d.y)!=null?u:0)}),n.toDataURL("image/webp")}},ua=t=>{const{gen:n,...s}=t,o=W();return I(["check",n.id],()=>Cr(n.id),{refetchInterval:2e3,enabled:n.state==="check",onSuccess:a=>{if(n.state==="check"){let l=n.state;a.faulted?l="error":a.done&&(l="status"),o(Ce({...n,state:l,check:a}))}}}),I(["status",n.id],()=>Sr(n.id),{refetchInterval:!1,enabled:n.state==="status",onSuccess:async a=>{if(n.state==="status"){let l=n.state;if(a.faulted)l="error";else if(a.done){l="complete";const d=await ca(a.generations[0].img);a.generations[0].img=d}o(Ce({...n,state:l,status:a}))}}}),I(["delete",n.id],()=>wr(n.id),{refetchInterval:!1,retry:!1,enabled:n.state==="delete",onSuccess:async a=>{o(Ce({...n,state:"complete",status:a}))}}),e(v,{})},ha=()=>{const t=C(n=>n.persist.imageGens);return re(t)?e(v,{}):e(v,{children:t.map(n=>e(ua,{gen:n},n.id))})},pa=()=>{const t=C(a=>a.persist.apikey),{data:n,refetch:s,isLoading:o}=I(["findUser"],()=>xr(t),{enabled:!re(t),retry:1});return S.exports.useEffect(()=>{s()},[t]),o?r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(xe,{})})]}):re(t)||n==null?r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),r(g,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(m,{variant:"h4",children:"Please enter your API key."}),e(Ot,{})]})]}):n.moderator?r(g,{sx:{display:"flex",flexDirection:"column"},children:[e(ha,{}),e(Pr,{}),e(ke,{}),e(da,{})]}):r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(m,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};te.prototype.__toHuman__=te.prototype.toHuman;te.prototype.toHuman=function(t={stripZeroUnits:"all"}){let n=this.normalize(),s=[],o=typeof t.precision=="object"?te.fromObject(t.precision):te.fromMillis(0),a=n;const l=["years","months","days","hours","minutes","seconds","milliseconds"];let d,p;t.smallestUnit&&(d=l.indexOf(t.smallestUnit)),t.biggestUnit&&(p=l.indexOf(t.biggestUnit)),(!d||!(d>=0&&d<l.length))&&(d=l.indexOf("seconds")),(!p||!(p<=d&&p<l.length))&&(p=l.indexOf("years"));for(let u of l.slice(p,d+1)){if(a.as(u)>=1){s.push(u);let h={};if(h[u]=Math.floor(a.as(u)),a=a.minus(te.fromObject(h)).normalize(),a<o)break}if(t.maxUnits&&s.length>=t.maxUnits)break}if(n=n.minus(a).normalize(),n=n.shiftTo(...s),t.stripZeroUnits=="all")s=s.filter(u=>n.values[u]>0);else if(t.stripZeroUnits=="end"){let u=!0;s=s.reverse().filter(i=>u?n.values[i]==0?!1:(u=!1,!0):!0)}return s.length||s.push(l[d]),n.shiftTo(...s).__toHuman__(t)};const ma=En({key:"mui",prepend:!0}),ga=$n({palette:{mode:"dark"}}),fa=new Rn({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:(t,n)=>{var s;if(Fe.isAxiosError(n)){if(((s=n.response)==null?void 0:s.status)!=null&&n.response.status>=400&&n.response.status<500)return!1}else return t<3;return t<3}}}});Hn(document.getElementById("root")).render(e(Nn,{value:ma,children:r(jn,{theme:ga,children:[e(Kn,{}),r(Bn,{client:fa,children:[e(Vn,{store:ye,children:e(qn,{loading:null,persistor:gr,children:e(pa,{})})}),null]})]})}));
