import{c as te,a as $t,b as Et,p as Rt,d as Ht,e as jt,s as Bt,f as Kt,F as qt,R as Nt,P as zt,g as Vt,h as Qt,i as Zt,j as Ke,u as w,k as e,l as k,B as p,m as Y,n as r,T as h,L as Ze,o as Jt,q as Xt,r as S,D as le,t as U,v as ie,w as Fe,x as ke,y as B,z as Je,A as K,C as G,E as C,G as A,I as $,H as Yt,M as en,J as q,K as oe,N as tn,O as qe,Q as de,S as me,U as ce,V as ue,W as nn,X as rn,Y as f,Z as I,_ as an,$ as sn,a0 as Oe,a1 as se,a2 as re,a3 as Ce,a4 as Te,a5 as he,a6 as xt,a7 as Se,a8 as ln,a9 as we,aa as on,ab as We,ac as Le,ad as dn,ae as cn,af as un,ag as Pe,ah as Ne,ai as ze,aj as hn,ak as pn,al as W,am as mn,an as gn,ao as Xe,ap as Ye,aq as et,ar as fn,as as xn,at as yn,au as bn,av as X,aw as vn,ax as kn,ay as Cn,az as Sn,aA as ee,aB as wn,aC as yt,aD as In,aE as Pn,aF as _n,aG as Fn,aH as Tn,aI as z,aJ as F,aK as tt,aL as nt,aM as rt,aN as at,aO as st,aP as Dn,aQ as On,aR as Wn,aS as De,aT as lt,aU as it,aV as Ue,aW as Ln,aX as Un,aY as V,aZ as Q,a_ as An,a$ as Mn,b0 as Gn,b1 as $n,b2 as En,b3 as Rn,b4 as Hn,b5 as jn,b6 as Bn,b7 as Kn,b8 as qn,b9 as Nn,ba as zn}from"./vendor.8c50898c.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&u(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const Vn={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},Ae=te({name:"comparatorPanel",initialState:Vn,reducers:{setSelectedModel:(t,n)=>{t.selectedModel=n.payload},setSelectedWorkers:(t,n)=>{t.selectedWorkers=n.payload},setGenForm:(t,n)=>{t.genForm=structuredClone(n.payload)},setReload:(t,n)=>{t.reload=n.payload}}}),{setSelectedModel:ot,setSelectedWorkers:xe,setGenForm:bt,setReload:vt}=Ae.actions,Qn={sidebarOpen:!1},Me=te({name:"localState",initialState:Qn,reducers:{setSidebarOpen:(t,n)=>{t.sidebarOpen=n.payload}}}),{setSidebarOpen:kt}=Me.actions,Ge={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},pe=te({name:"persist",initialState:Ge,reducers:{setKey:(t,n)=>{t.apikey=n.payload},setSelectedTab:(t,n)=>{t.selectedTab=n.payload},resetImageGens:t=>{t.imageGens=[]},addImageGen:(t,n)=>{t.imageGens.find(u=>u.id===n.payload.id)||t.imageGens.push(n.payload)},updateImageGen:(t,n)=>{const s=t.imageGens.findIndex(u=>u.id===n.payload.id);s!=null&&(t.imageGens[s]=n.payload)},addGenFavorite:(t,n)=>{t.genFavorites.push(n.payload)},updateGenFavorite:(t,n)=>{t.genFavorites[n.payload.idx]={name:t.genFavorites[n.payload.idx].name,form:n.payload.form}},deleteGenFavorite:(t,n)=>{t.genFavorites.splice(n.payload)},resetExceptApiKey:t=>(t={...Ge,apikey:t.apikey},t)}}),{setKey:Zn,setSelectedTab:Ct,resetImageGens:dt,addImageGen:Jn,updateImageGen:ve,addGenFavorite:Xn,resetExceptApiKey:fa,updateGenFavorite:Yn,deleteGenFavorite:er}=pe.actions,tr={showPassword:!1},$e=te({name:"settingsPanel",initialState:tr,reducers:{setShowPassword:(t,n)=>{t.showPassword=n.payload}}}),{setShowPassword:Ee}=$e.actions,nr={expandedPanel:"workers"},Ie=te({name:"userPanel",initialState:nr,reducers:{setUser:(t,n)=>{t.selectedUser=n.payload},setExpandedPanel:(t,n)=>{t.expandedPanel=n.payload}}}),{setUser:Re,setExpandedPanel:rr}=Ie.actions,ar={prompt:"",ipAddr:""},He=te({name:"utilityPanel",initialState:ar,reducers:{setPrompt:(t,n)=>{t.prompt=n.payload},setIpAddr:(t,n)=>{t.ipAddr=n.payload}}}),{setPrompt:sr,setIpAddr:lr}=He.actions,ir={workerType:"image",sortKey:"name",order:"asc"},je=te({name:"workerPanel",initialState:ir,reducers:{setWorkerType:(t,n)=>{t.workerType=n.payload},setWorkerFilter:(t,n)=>{t.workerFilter=n.payload},setSortKey:(t,n)=>{t.sortKey=n.payload},setOrder:(t,n)=>{t.order=n.payload}}}),{setWorkerType:or,setWorkerFilter:dr,setSortKey:ct,setOrder:cr}=je.actions,ur=$t((t,n)=>t,(t,n)=>Object.assign({},Ge,t),{whitelist:[pe.name]}),hr={key:"root",storage:Kt,whitelist:[pe.name,Ie.name],transforms:[ur]},pr=Et({[pe.name]:pe.reducer,[Me.name]:Me.reducer,[$e.name]:$e.reducer,[Ie.name]:Ie.reducer,[He.name]:He.reducer,[je.name]:je.reducer,[Ae.name]:Ae.reducer}),mr=Rt(hr,pr),ge=Ht({reducer:mr,middleware:t=>t({serializableCheck:{ignoredActions:[qt,Nt,zt,Vt,Qt,Zt]}}),devTools:!1}),gr=jt(ge);Bt(ge.dispatch);const T=Ke.create({baseURL:"https://aihorde.net/api/v2/"});T.interceptors.request.use(function(t){const n=ge.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.4"),t},function(t){return Promise.reject(t)});const fr=Ke.create({baseURL:"/horde-control-tower/"}),_e=Ke.create({baseURL:"https://ratings.aihorde.net/api/v1/"});_e.interceptors.request.use(function(t){const n=ge.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.4"),t},function(t){return Promise.reject(t)});const xr=t=>T.get("find_user",{headers:{apikey:t}}).then(n=>n.data),St=()=>T.get("status/modes").then(t=>t.data),wt=()=>T.get("status/performance").then(t=>t.data),It=()=>fr.get("users.json").then(t=>t.data),Ve=t=>T.get(`users/${t}`).then(n=>n.data),Qe=()=>T.get("workers").then(t=>t.data),yr=t=>T.get(`workers/${t}`).then(n=>n.data),Pt=()=>T.get("status/models").then(t=>t.data),_t=(t,n)=>T.put(`users/${t}`,n).then(s=>s.data),br=(t,n)=>T.put(`workers/${t}`,n).then(s=>s.data),vr=t=>T.post("filters",t).then(n=>n.data),kr=t=>T.post("generate/async",t).then(n=>n.data),Cr=t=>T.get(`generate/check/${t}`).then(n=>n.data),Sr=t=>T.get(`generate/status/${t}`).then(n=>n.data),wr=t=>T.delete(`generate/status/${t}`).then(n=>n.data),Ir=t=>T.delete("operations/ipaddr",{data:t}).then(n=>n.data),E={all:["users"],lists:()=>[...E.all,"list"],list:t=>[...E.lists(),{filters:t}],details:()=>[...E.all,"detail"],detail:t=>[...E.details(),t]},H={all:["workers"],lists:()=>[...H.all,"list"],list:t=>[...H.lists(),{filters:t}],details:()=>[...H.all,"detail"],detail:t=>[...H.details(),t]},Pr=()=>(w(E.all,It,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["performance"],wt,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["mode"],St,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["models"],Pt,{staleTime:1e3*30,refetchInterval:1e3*30}),e(k,{})),_r=()=>e(p,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(Y,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(p,{children:[e(h,{variant:"h4",textAlign:"center",children:"About"}),r(h,{variant:"body1",children:["Horde Control Tower is an open source"," ",e(Ze,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(h,{variant:"body1",children:["The project source is available on"," ",e(Ze,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),D=()=>Xt(),b=Jt,Fr=()=>{const t=D(),n=b(_=>_.comparatorPanel.genForm),s=b(_=>_.persist.genFavorites),[u,a]=S.exports.useState(!1),[i,o]=S.exports.useState(-1),[m,l]=S.exports.useState(!1),[c,x]=S.exports.useState(-1),[v,y]=S.exports.useState(!1),[P,M]=S.exports.useState(""),[N,d]=S.exports.useState(null),g=Boolean(N),O=_=>{d(_.currentTarget)},R=()=>{d(null)},fe=()=>{y(!1)},ne=()=>{t(Xn({name:P,form:n})),M(""),y(!1)},ae=()=>{o(-1),a(!1)},Ot=()=>{t(Yn({idx:i,form:n})),o(-1),a(!1)},Wt=()=>{x(-1),l(!1)},Lt=()=>{t(er(c)),x(-1),l(!1)},Ut=_=>{t(bt(_)),t(vt(!0)),d(null)},At=()=>{y(!0),d(null)},Mt=()=>{a(!0),d(null)},Gt=()=>{l(!0),d(null)};return r(k,{children:[r(le,{open:m,onClose:ae,children:[e(U,{children:"Delete Preset"}),r(ie,{children:[e(Fe,{children:"Select a preset to delete."}),e(ke,{children:s.map((_,j)=>e(B,{disablePadding:!0,sx:{backgroundColor:c===j?"error.dark":""},onClick:()=>{x(j)},children:e(Je,{children:e(K,{primary:_.name})})},j))})]}),r(G,{children:[e(C,{onClick:Wt,children:"Cancel"}),e(C,{disabled:c===-1,onClick:Lt,children:"Select"})]})]}),r(le,{open:u,onClose:ae,children:[e(U,{children:"Overwrite Preset"}),r(ie,{children:[e(Fe,{children:"Select a preset to overwrite."}),e(ke,{children:s.map((_,j)=>e(B,{disablePadding:!0,sx:{backgroundColor:i===j?"success.dark":""},onClick:()=>{o(j)},children:e(Je,{children:e(K,{primary:_.name})})},j))})]}),r(G,{children:[e(C,{onClick:ae,children:"Cancel"}),e(C,{disabled:i===-1,onClick:Ot,children:"Select"})]})]}),r(le,{open:v,onClose:fe,children:[e(U,{children:"Add New Preset"}),r(ie,{children:[e(Fe,{children:"Enter a friendly name for this new preset."}),e(A,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:P,onChange:_=>{M(_.target.value)}})]}),r(G,{children:[e(C,{onClick:fe,children:"Cancel"}),e(C,{onClick:ne,children:"Create"})]})]}),e($,{onClick:O,children:e(Yt,{})}),r(en,{anchorEl:N,open:g,onClose:R,children:[s.map((_,j)=>e(q,{onClick:()=>{Ut(_.form)},children:_.name},j)),s.length>0?e(oe,{}):null,s.length>0?e(q,{onClick:Gt,children:"Delete Preset"}):null,s.length>0?e(oe,{}):null,s.length>0?e(q,{onClick:Mt,children:"Overwrite Preset"}):null,s.length>0?e(oe,{}):null,e(q,{onClick:At,children:"Add New Preset"})]})]})},Tr=()=>{const t=b(a=>a.persist.imageGens),{data:n}=w(H.all,()=>Qe(),{refetchInterval:1e3*30,select:a=>tn(a.map(i=>[i.id,i.name]))}),s=a=>{var o,m,l;const i=a.status!=null?a.status:a.check;return a.state!=="complete"&&i!=null?r(de,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(me,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(ce,{title:n==null?"":n[(o=a.payload.workers[0])!=null?o:""],subtitle:`Position: ${i.queue_position}, wait time: ${i.wait_time}`})]},a.id):a.state==="complete"?u(a).length===0?r(de,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(h,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(ce,{title:n==null?"":n[(m=a.payload.workers[0])!=null?m:""]})]},a.id):r(de,{sx:{paddingTop:u(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:u(a)}),e(ce,{title:n==null?"":n[(l=a.payload.workers[0])!=null?l:""]})]},a.id):e(k,{})},u=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(p,{children:e(qe,{sx:{width:"100%",height:"100%"},cols:4,children:t.map(a=>s(a))})})},Dr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Or=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],L="175px",Wr=()=>{const t=D(),n=b(d=>d.comparatorPanel.selectedWorkers),s=b(d=>d.comparatorPanel.selectedModel),u=b(d=>d.comparatorPanel.genForm),a=b(d=>d.persist.imageGens),i=b(d=>d.persist.imageGens.length>0),o=b(d=>d.comparatorPanel.reload),m=b(d=>d.persist.imageGens.some(g=>["pending","check"].includes(g.state))),{mutate:l}=ue({mutationFn:kr,onSuccess:(d,g,O)=>{t(Jn({id:d.id,payload:g,state:"check",check:null,status:null}))}}),{handleSubmit:c,control:x,formState:{errors:v},watch:y,setValue:P,reset:M}=nn({defaultValues:u}),N=d=>{s!=null&&n.length>0&&(t(dt()),n.forEach(g=>{const O={...d,workers:[g.id],models:[s.name]};l(O)}))};return S.exports.useEffect(()=>{const d=y(rn((g,{name:O,type:R})=>{t(bt(g))},300));return()=>d.unsubscribe()},[y]),S.exports.useEffect(()=>{o&&(t(vt(!1)),M(u))},[o]),e(p,{children:r("form",{onSubmit:c(N),children:[r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Prompt"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"prompt",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(A,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...d})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Seed"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.seed",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(A,{fullWidth:!0,placeholder:"Seed",...d})})}),e(f,{item:!0,children:e($,{"aria-label":"randomize seed",onClick:()=>{P("params.seed",an(1e8,999999999).toString())},children:e(sn,{})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Sampler"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.sampler_name",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(Oe,{...d,fullWidth:!0,children:Or.map(g=>e(q,{value:g,children:g},g))})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Steps"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.steps",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...d})})}),e(I,{name:"params.steps",control:x,render:({field:d})=>e(f,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...d,onChange:g=>{d.onChange(parseInt(g.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Width"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.width",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(I,{name:"params.width",control:x,render:({field:d})=>e(f,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:g=>{d.onChange(parseInt(g.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Height"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.height",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(I,{name:"params.height",control:x,render:({field:d})=>e(f,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:g=>{d.onChange(parseInt(g.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"CFG"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.cfg_scale",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...d})})}),e(I,{name:"params.cfg_scale",control:x,render:({field:d})=>e(f,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...d,onChange:g=>{d.onChange(parseInt(g.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Clip Skip"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.clip_skip",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...d})})}),e(I,{name:"params.clip_skip",control:x,render:({field:d})=>e(f,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...d,onChange:g=>{d.onChange(parseInt(g.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Post-Processors"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.post_processing",control:x,render:({field:{onChange:d,onBlur:g,value:O,name:R,ref:fe}})=>e(f,{item:!0,xs:!0,children:e(Ce,{fullWidth:!0,multiple:!0,onBlur:g,ref:fe,value:O,onChange:(ne,ae)=>{d(ae)},options:Dr,getOptionLabel:ne=>ne,renderInput:ne=>e(A,{...ne})})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"High Res Fix"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.hires_fix",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(Te,{...d,checked:d.value})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Karras"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.karras",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(Te,{...d,checked:d.value})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Tiling"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.tiling",control:x,render:({field:d})=>e(f,{item:!0,xs:!0,children:e(Te,{...d,checked:d.value})})})})]}),e(he,{type:"submit",loading:m,variant:"contained",children:"Submit"}),m?e(C,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(d=>["pending","check"].includes(d.state)).forEach(d=>{t(ve({...d,state:"delete"}))})},children:"Cancel"}):null,i?e(C,{sx:{ml:2},variant:"contained",onClick:()=>{t(dt())},children:"Clear Output"}):null]})})},Lr=t=>t!=null&&"name"in t,Ur=t=>t!=null&&xt(t)&&"name"in t[0]&&"id"in t[0],ut="175px",Ar=()=>{const t=D(),n=b(l=>l.comparatorPanel.selectedWorkers),s=b(l=>l.comparatorPanel.selectedModel),u=(l,c)=>{xt(c)&&c.length===0?t(xe([])):Ur(c)&&t(xe(c))},a=(l,c)=>{c==null?t(ot(null)):Lr(c)&&t(ot(c))},{data:i}=w(H.all,()=>Qe(),{refetchInterval:1e3*30,select:l=>Se(l,[c=>c.name.toLowerCase()],["asc"])}),{data:o}=w(["models"],Pt,{staleTime:1e3*30,refetchInterval:1e3*30,select:l=>Se(l,[c=>c.name.toLowerCase()],["asc"])});S.exports.useEffect(()=>{if(s!=null&&n.length>0){const l=n.map(v=>v.id),c=n.filter(v=>{var y;return(y=v==null?void 0:v.models)==null?void 0:y.includes(s.name)}),x=c.map(v=>v.id);ln(l,x)||t(xe(c))}else s==null&&n.length>0&&t(xe([]))},[i,o,n,s]);const m=(i!=null?i:[]).filter(l=>{var c;return s==null?!0:(c=l==null?void 0:l.models)==null?void 0:c.includes(s.name)});return r(p,{children:[r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:ut},children:"Model"}),e(Ce,{fullWidth:!0,disablePortal:!0,options:o!=null?o:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:l=>we(l)?l:l.name,isOptionEqualToValue:(l,c)=>l.name===c.name,filterSelectedOptions:!0,renderInput:l=>e(A,{...l,label:"Selected Model"}),onChange:a})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:ut},children:"Workers"}),e(Ce,{fullWidth:!0,multiple:!0,disablePortal:!0,options:m,value:n,getOptionLabel:l=>l.name,isOptionEqualToValue:(l,c)=>l.id===c.id,filterSelectedOptions:!0,renderInput:l=>e(A,{...l,label:"Selected Workers"}),onChange:u})]})]})},Mr=()=>r(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,xl:4,children:r(Y,{sx:{p:2},children:[r(p,{sx:{position:"relative"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(p,{sx:{position:"absolute",top:0,right:0},children:e(Fr,{})})]}),e(Ar,{}),e(Wr,{})]})}),e(f,{item:!0,xs:12,xl:8,children:r(Y,{sx:{p:2,height:"100%"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(Tr,{})]})})]}),Ft={format:"json",limit:100},Gr=t=>_e.get("user/ratings",{params:Object.assign({},Ft,t)}).then(n=>n.data),$r=(t,n)=>_e.get(`user/validate/${t}`,{params:Object.assign({},Ft,n)}).then(s=>s.data),Er=t=>_e.post(`user/flag/${t}`).then(n=>n.data),Z={all:["ratings"],lists:()=>[...Z.all,"list"],list:t=>[...Z.lists(),{filters:t}],details:()=>[...Z.all,"detail"],detail:t=>[...Z.details(),t],validates:()=>[...Z.all,"validate"],validate:t=>[...Z.validates(),t]},Rr=()=>{const{data:t,isLoading:n}=w(["user/ratings"],()=>Gr()),s=D();if(n)return e(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(me,{})})});const u=i=>{const o=on(i.username.split("#"));o!=null&&(s(Re(parseInt(o))),s(Ct("1")))},a=i=>r(p,{sx:{display:"flex"},children:[e(h,{sx:{textDecoration:"underline"},onClick:()=>u(i),children:i.username}),r(h,{children:["\xA0- r: ",i.rating,", a: ",i.artifacts,", avg: ",i.average,", n: ",i.times_rated]})]});return t==null?e(k,{}):e(p,{children:e(qe,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:t.ratings.map(i=>r(de,{children:[e("img",{src:i.image}),e(ce,{title:a(i)})]},i.image_id))})})},Tt=()=>{const t=D(),n=b(a=>a.persist.apikey),s=b(a=>a.settingsPanel.showPassword);return r(We,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(Le,{children:"API Key"}),e(re,{defaultValue:n,onBlur:a=>{t(Zn(a.target.value)),t(Ee(!1))},type:s?"text":"password",endAdornment:e(dn,{position:"end",children:e($,{onClick:()=>t(Ee(!s)),children:s?e(cn,{}):e(un,{})})})})]})},Hr=()=>e(f,{container:!0,spacing:2,children:e(f,{item:!0,md:12,lg:6,xl:4,children:e(Y,{children:e(Tt,{})})})}),Be="#0583B0",J="#FF6962",jr="#7c0500",Br="#ef9b0f",ht=t=>t.type==="image"&&parseFloat(t.performance)>3,pt=t=>t.type==="image"&&parseFloat(t.performance)<.4,Dt=t=>{var N,d;const{worker:n}=t,s=Pe(),[u,a]=S.exports.useState(!1),[i,o]=S.exports.useState(!1),[m,l]=S.exports.useState("setFlagged"),[c,x]=S.exports.useState(""),v=g=>g.maintenance_mode||g.paused||g.flagged?jr:ht(g)||pt(g)?Br:"background.paper",y=ue(g=>br(g.id,g.data),{onSuccess:(g,O)=>{a(!0),s.invalidateQueries({queryKey:H.detail(O.id)}),s.invalidateQueries({queryKey:H.all})}}),P=(g,O)=>{O!=="clickaway"&&a(!1)};return r(k,{children:[e(le,{open:i,onClose:()=>o(!1),children:(g=>{var O;switch(g){case"setFlagged":return r(k,{children:[r(U,{children:['Set "',n.name,'" as Flagged']}),r(G,{children:[e(C,{onClick:()=>{o(!1)},children:"Cancel"}),e(C,{onClick:()=>{o(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(k,{children:[r(U,{children:['Unset "',n.name,'" as Flagged']}),r(G,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{o(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(k,{children:[r(U,{children:['Set "',n.name,'" Maintenance Mode']}),e(ie,{children:e(A,{value:c,onChange:R=>{x(R.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(G,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{const R={maintenance:!0};ee(c)||(R.maintenance_msg=c),y.mutate({id:n.id,data:R}),o(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(k,{children:[r(U,{children:['Unset "',n.name,'" Maintenance Mode']}),r(G,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{maintenance:!1,maintenance_msg:""}}),o(!1)},children:"Confirm"})]})]});case"setPaused":return r(k,{children:[r(U,{children:['Set "',n.name,'" Paused Mode']}),r(G,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{paused:!0}}),o(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(k,{children:[r(U,{children:['Unset "',n.name,'" Paused Mode']}),r(G,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{paused:!1}}),o(!1)},children:"Confirm"})]})]});case"listModels":return r(k,{children:[r(U,{children:['"',n.name,'" Models']}),e(ie,{children:e(h,{variant:"body1",children:Se((O=n==null?void 0:n.models)!=null?O:[],[R=>R.toLowerCase()]).join(", ")})})]})}})(m)}),e(Ne,{open:u,autoHideDuration:6e3,onClose:P,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ze,{onClose:P,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(f,{item:!0,xs:12,lg:6,xl:3,children:r(hn,{sx:{backgroundColor:v(n)},children:[e(pn,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:n.online&&!n.paused&&!n.maintenance_mode&&!n.flagged?e(W,{title:"Worker Online",children:e(mn,{sx:{color:Be}})}):e(W,{title:"Worker Issue",children:e(gn,{sx:{color:J}})}),action:r(p,{children:[pt(n)?e(W,{title:"Worker Low Speed Warning",children:e(Xe,{sx:{color:J,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,ht(n)?e(W,{title:"Worker High Speed Warning",children:e(Xe,{sx:{color:J,mt:.5,mr:1}})}):null,n.paused?e(W,{title:"Worker Paused",children:e(Ye,{sx:{color:J,mt:.5,mr:1}})}):null,n.maintenance_mode?e(W,{title:"Worker Maintenance",children:e(et,{sx:{color:J,mt:.5,mr:1}})}):null,n.flagged?e(W,{title:"User Flagged",children:e(fn,{sx:{color:J,mt:.5,mr:1}})}):null,n.trusted?e(W,{title:"Trusted Worker",children:e(xn,{sx:{color:Be,mt:.5,mr:1}})}):null]}),title:e(h,{variant:"h5",children:yn(n.name,{length:30})}),subheader:n.id}),r(bn,{children:[r(h,{variant:"body2",children:["Full Name: ",n.name]}),r(h,{variant:"body2",children:["Owner: ",n.owner]}),r(h,{variant:"body2",children:["Bridge Agent: ",n.bridge_agent]}),r(h,{variant:"body2",children:["Uptime: ",X.fromObject({seconds:n.uptime}).toHuman()]}),n.type!=="interrogation"?r(h,{variant:"body2",children:["Models Loaded: ",(d=(N=n==null?void 0:n.models)==null?void 0:N.length)!=null?d:"None"]}):null,n.type==="image"?r(h,{variant:"body2",children:["MPS Generated: ",n.megapixelsteps_generated]}):null,r(h,{variant:"body2",children:["Speed: ",n.performance]}),r(h,{variant:"body2",children:["Threads: ",n.threads]}),r(h,{variant:"body2",children:["Requests Fulfilled: ",n.requests_fulfilled]}),r(h,{variant:"body2",children:["NSFW: ",n.nsfw?"true":"false"]})]}),r(vn,{disableSpacing:!0,children:[e(W,{title:"Show Worker Models",children:e($,{onClick:()=>{l("listModels"),o(!0)},children:e(kn,{})})}),n.maintenance_mode?e(W,{title:"Unset Worker Maintenance",children:e($,{onClick:()=>{l("unsetMaintenance"),o(!0)},children:e(Cn,{})})}):e(W,{title:"Set Worker Maintenance",children:e($,{onClick:()=>{l("setMaintenance"),o(!0)},children:e(et,{})})}),n.paused?e(W,{title:"Unset Worker Pause",children:e($,{onClick:()=>{l("unsetPaused"),o(!0)},children:e(Sn,{})})}):e(W,{title:"Set Worker Pause",children:e($,{onClick:()=>{l("setPaused"),o(!0)},children:e(Ye,{})})})]})]})},n.id)]})},Kr=t=>{const{workerId:n}=t,{data:s}=w(H.detail(n),()=>yr(n),{staleTime:1e3*61,select:u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})});return s==null?e(k,{}):e(Dt,{worker:s})},qr=t=>{const{userId:n}=t,{data:s}=w(E.detail(n),()=>Ve(n));if(s==null)return e(k,{});const u=s.worker_ids;return u==null||(u==null?void 0:u.length)===0?e(f,{item:!0,md:12,lg:6,xl:4,children:e(h,{variant:"body1",children:"This user has no workers."})}):e(k,{children:u.map(a=>e(Kr,{workerId:a},a))})},[Nr,zr,Vr]=wn(),Qr=t=>t!=null&&"username"in t&&"id"in t,Zr=()=>{const t=D(),[n,s]=S.exports.useState(-1),[u]=yt(n,400),{data:a}=w(E.all,It),{data:i,refetch:o}=w(E.detail(u),()=>Ve(u),{enabled:!1});if(S.exports.useEffect(()=>{In(u)&&u>=4770&&o()},[u]),a==null)return e(k,{});const m=(l,c)=>{we(c)?t(Re(parseInt(c))):Qr(c)&&t(Re(c.id))};return e(Ce,{disablePortal:!0,options:[...i!=null?[i]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:l=>we(l)?l:l.username,isOptionEqualToValue:(l,c)=>l.id===c.id,renderInput:l=>e(A,{...l,variant:"standard",label:"User Lookup",size:"small"}),onChange:m,onInputChange:(l,c)=>{s(Pn(c))}})},Jr=()=>{const t=b(d=>{var g;return(g=d.userPanel.selectedUser)!=null?g:-1}),n=Pe(),[s,u]=S.exports.useState("setFlagged"),[a,i]=S.exports.useState(!1),[o,m]=S.exports.useState(!1),{data:l,isInitialLoading:c,isLoading:x}=w(E.detail(t),()=>Ve(t),{refetchInterval:1e3*15}),v=ue(d=>_t(d.id,d.data),{onSuccess:(d,g)=>{n.invalidateQueries({queryKey:E.detail(g.id)})}}),y=ue(d=>Er(d.id),{}),P=zr();if(S.exports.useEffect(()=>{if(l!=null){const d={trusted:l.trusted,flagged:l.flagged,worker_invite:l.worker_invited.toString()};P.setValues(d),P.resetDirty(d)}},[c]),x)return e(p,{py:4,sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(me,{})});if(l==null)return e(k,{});const M=(d,g)=>{g!=="clickaway"&&i(!1)};return r(k,{children:[e(le,{open:o,onClose:()=>m(!1),children:(d=>{switch(d){case"resetSuspicion":return r(k,{children:[r(U,{children:['Reset "',l.username,'" Suspicion']}),r(G,{children:[e(C,{onClick:()=>{m(!1)},children:"Cancel"}),e(C,{onClick:()=>{const g={reset_suspicion:!0};v.mutate({id:t,data:g}),m(!1)},children:"Confirm"})]})]});case"setFlagged":return r(k,{children:[r(U,{children:['Flag "',l.username,'" ratings and delete?']}),r(G,{children:[e(C,{onClick:()=>{m(!1)},children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:t}),m(!1)},children:"Confirm"})]})]})}})(s)}),e(Ne,{open:a,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ze,{onClose:M,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(_n,{component:p,children:e(Fn,{size:"small",children:r(Tn,{children:[r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Username"})}),e(F,{align:"right",children:r(h,{variant:"body1",children:[l.username," ",l.moderator?"(moderator)":""]})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Trusted"})}),e(F,{align:"right",children:e(tt,{...P.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flagged"})}),e(F,{align:"right",children:e(tt,{...P.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Invites"})}),e(F,{align:"right",children:e(A,{variant:"standard",type:"number",...P.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Count"})}),e(F,{align:"right",children:e(h,{variant:"body1",children:l.worker_count})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Kudos"})}),e(F,{align:"right",children:e(h,{variant:"body1",children:l.kudos})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Suspicious"})}),r(F,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[e(h,{sx:{order:0},variant:"body1",children:l.suspicious}),l.suspicious>0?e(he,{onClick:async()=>{u("resetSuspicion"),m(!0)},loading:v.isLoading,variant:"contained",color:"error",sx:{ml:4},children:"Reset"}):null]})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flag User Ratings"})}),e(F,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:e(he,{onClick:async()=>{u("setFlagged"),m(!0)},loading:y.isLoading,variant:"contained",color:"error",sx:{order:0},children:"Flag"})})]})]})})})]})},Xr=()=>{const t=Pe(),n=b(m=>m.userPanel.selectedUser),[s,u]=S.exports.useState(!1),a=Vr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),i=ue(m=>_t(m.id,m.data),{onSuccess:(m,l)=>{var x,v,y,P;t.setQueryData(E.detail(l.id),M=>M!=null?{...M,...m}:m);const c={trusted:(x=m.trusted)!=null?x:!1,flagged:(v=m.flagged)!=null?v:!1,worker_invite:(P=(y=m.worker_invite)==null?void 0:y.toString())!=null?P:"0"};ee(c)||(a.setValues(c),a.resetDirty(c)),u(!0)}}),o=(m,l)=>{l!=="clickaway"&&u(!1)};return r(Y,{elevation:1,sx:{p:2,height:"100%"},children:[e(Ne,{open:s,autoHideDuration:6e3,onClose:o,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(ze,{onClose:o,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((m,l)=>{if(n!=null){const c={trusted:m.trusted,flagged:m.flagged,worker_invite:parseInt(m.worker_invite)};i.mutate({id:n,data:c})}}),children:[r(p,{display:"flex",justifyContent:"space-between",children:[e(Zr,{}),n!=null?e(p,{display:"flex",alignItems:"center",children:a.isDirty()?e(C,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null}):null]}),e(Nr,{form:a,children:e(p,{display:"flex",children:n!=null&&n!=-1?e(Jr,{}):null})})]})]})},Yr=t=>{Pe();const{userId:n}=t;S.exports.useState(!1);const{data:s,isInitialLoading:u,isLoading:a}=w(Z.validate(n),()=>$r(n),{refetchInterval:1e3*15}),i=o=>e(p,{sx:{display:"flex"},children:r(h,{children:["r: ",o.rating,", a: ",o.artifacts,", avg: ",o.average,", n: ",o.times_rated]})});return a?e(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(me,{})})}):s==null?e(k,{}):e(p,{children:e(qe,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:s.ratings.map(o=>r(de,{children:[e("img",{src:o.image}),e(ce,{title:i(o)})]},o.image_id))})})},ea=()=>{const t=D(),n=b(a=>a.userPanel.selectedUser),s=b(a=>a.userPanel.expandedPanel),u=a=>(i,o)=>{(a==="workers"||a==="ratings")&&t(rr(o?a:!1))};return r(f,{container:!0,spacing:2,children:[e(f,{item:!0,md:12,lg:6,xl:4,children:e(Xr,{})}),e(f,{item:!0,md:12,lg:12,xl:12,children:r(p,{children:[r(nt,{expanded:s==="workers",onChange:u("workers"),sx:{boxShadow:"none"},children:[e(rt,{expandIcon:e(at,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:e(h,{sx:{width:"33%",flexShrink:0},children:"Workers"})}),e(st,{sx:{backgroundColor:"background.default"},children:e(f,{container:!0,spacing:2,children:n!=null?e(qr,{userId:n}):null})})]}),r(nt,{expanded:s==="ratings",onChange:u("ratings"),sx:{boxShadow:"none"},children:[e(rt,{expandIcon:e(at,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:e(h,{sx:{width:"33%",flexShrink:0},children:"Ratings"})}),e(st,{sx:{backgroundColor:"background.default"},children:s==="ratings"&&n!=null?e(Yr,{userId:n}):null})]})]})})]})},ta=()=>{const t=D(),n=b(o=>o.utilityPanel.ipAddr),{data:s,refetch:u,isFetching:a}=w(["deleteIpAddr",n],()=>Ir({ipaddr:n}),{enabled:!1,cacheTime:0});return e(Y,{elevation:1,sx:{p:2,height:"100%"},children:r(p,{children:[r(p,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Clear IP Timeout"}),e(he,{onClick:()=>{ee(n)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(A,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:o=>{t(lr(o.target.value))},placeholder:"Enter IP"}),s!=null?e(p,{pt:2,children:r(h,{variant:"body1",children:["Response: ",s.message]})}):null]})})},na=()=>{const t=D(),n=b(o=>o.utilityPanel.prompt),{data:s,refetch:u,isFetching:a}=w(["promptCheck",n],()=>vr({filter_type:0,prompt:n}),{enabled:!1});return e(Y,{elevation:1,sx:{p:2,height:"100%"},children:r(p,{children:[r(p,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Prompt Checker"}),e(he,{onClick:()=>{ee(n)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(A,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:o=>{t(sr(o.target.value))},placeholder:"Enter prompt"}),s!=null?r(p,{pt:2,children:[r(h,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(h,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},ra=()=>r(f,{container:!0,spacing:2,children:[e(f,{item:!0,md:12,lg:6,xl:4,children:e(na,{})}),e(f,{item:!0,md:12,lg:6,xl:4,children:e(ta,{})})]}),aa=()=>{const t=b(i=>i.workerPanel.workerFilter),[n,s]=S.exports.useState(t!=null?t:""),[u]=yt(n,400),a=D();return S.exports.useEffect(()=>{a(dr(u))},[u]),e(A,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:n,onChange:i=>{s(i.target.value)}})},mt={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},sa=()=>{const t=D(),n=b(c=>c.workerPanel.sortKey),s=b(c=>c.workerPanel.order),u=b(c=>c.workerPanel.workerFilter),a=b(c=>c.workerPanel.workerType),{data:i}=w(H.all,()=>Qe(),{refetchInterval:1e3*30,select:c=>{const x=u==null?void 0:u.toLowerCase();return Se(c.filter(v=>{var y;return v.type!==a?!1:x==null?!0:v.name.toLowerCase().includes(x)||((y=v.owner)!=null?y:"").toLowerCase().includes(x)||v.id.toLowerCase().includes(x)||v.bridge_agent.toLowerCase().includes(x)}),[v=>{const y=v[n];return we(y)?n==="performance"&&parseFloat(y)?parseFloat(y):y.toLowerCase():y}],[s])}}),o=c=>{var v,y;const x=c.target.value;t(or(x)),t(ct((y=(v=Wn(mt[x]))==null?void 0:v.parameter)!=null?y:"name"))},m=c=>{t(ct(c.target.value))},l=c=>{t(cr(c))};return i==null?e(k,{}):r(k,{children:[r(p,{display:"flex",justifyContent:"space-between",pb:2,children:[r(p,{display:"flex",alignItems:"center",children:[e(h,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(aa,{})]}),r(p,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(We,{sx:{mr:1},children:[e(Le,{children:"Worker Type"}),r(Oe,{value:a,label:"Worker Type",onChange:o,sx:{".MuiSelect-select":{py:1}},children:[e(q,{value:"image",children:"Image"}),e(q,{value:"interrogation",children:"Interrogation"}),e(q,{value:"text",children:"Text"})]})]}),r(We,{sx:{mr:1},children:[e(Le,{children:"Sort Key"}),e(Oe,{value:n,label:"Sort Key",onChange:m,sx:{".MuiSelect-select":{py:1}},children:mt[a].map(c=>e(q,{value:c.parameter,children:c.label},c.label))})]}),s==="asc"?e($,{onClick:()=>l("desc"),children:e(Dn,{})}):e($,{onClick:()=>l("asc"),children:e(On,{})})]})]}),e(f,{container:!0,spacing:2,children:i.map(c=>e(Dt,{worker:c},c.id))})]})},gt=()=>{const{data:t,isLoading:n,error:s}=w(["mode"],St);if(n)return e(h,{variant:"h6",children:"Loading Horde status ..."});if(t==null||s)return console.log("HordeStatus error",s),e(h,{variant:"h6",children:"Error loading Horde status"});const u=a=>a?e(lt,{sx:{color:J,ml:1}}):e(lt,{sx:{color:Be,ml:1}});return r(ke,{children:[r(B,{children:[e(De,{children:u(t.maintenance_mode)}),e(K,{primary:"Maintenance"})]}),r(B,{children:[e(De,{children:u(t.invite_only_mode)}),e(K,{primary:"Invite Only"})]}),t.raid_mode!=null?r(B,{children:[e(De,{children:u(t.raid_mode)}),e(K,{primary:"Raid"})]}):null]})},ft=()=>{const{data:t,isLoading:n,error:s}=w(["performance"],wt);return n?e(h,{variant:"h6",children:"Loading Horde status ..."}):t==null||s?e(h,{variant:"h6",children:"Error loading Horde status"}):r(ke,{children:[e(B,{children:e(K,{primary:`Queued Requests: ${t.queued_requests}`})}),e(B,{children:e(K,{primary:`Queued MPS: ${t.queued_megapixelsteps}`})}),e(B,{children:e(K,{primary:`Past Minute MPS: ${t.past_minute_megapixelsteps}`})}),e(B,{children:e(K,{primary:`Workers: ${t.worker_count}`})})]})},ye=240,la=()=>{const t=D(),n=b(u=>u.localState.sidebarOpen);return r(k,{children:[r(it,{variant:"temporary",open:n,onClose:()=>{t(kt(!n))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ye,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ye}},children:[e(Ue,{}),r(p,{sx:{overflow:"auto"},children:[e(ft,{}),e(oe,{}),e(gt,{})]})]}),r(it,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ye,flexShrink:0,["& .MuiDrawer-paper"]:{width:ye,boxSizing:"border-box"}},children:[e(Ue,{}),r(p,{sx:{overflow:"auto"},children:[e(ft,{}),e(oe,{}),e(gt,{})]})]})]})},ia=()=>{const t=D(),n=b(u=>u.persist.selectedTab);return r(p,{display:"flex",children:[e(la,{}),e(p,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(Ln,{value:n,children:[e(p,{sx:{borderBottom:1,borderColor:"divider"},children:r(Un,{onChange:(u,a)=>{a!="4"&&t(Ee(!1)),t(Ct(a))},"aria-label":"lab API tabs example",children:[e(V,{label:"User Lookup",value:"1"}),e(V,{label:"Workers",value:"2"}),e(V,{label:"Comparator",value:"3"}),e(V,{label:"Ratings",value:"4"}),e(V,{label:"Utilities",value:"5"}),e(V,{label:"Settings",value:"6"}),e(V,{label:"About",value:"7"})]})}),e(Q,{value:"1",children:e(ea,{})}),e(Q,{value:"2",children:e(sa,{})}),e(Q,{value:"3",children:e(Mr,{})}),e(Q,{value:"4",children:e(Rr,{})}),e(Q,{value:"5",children:e(ra,{})}),e(Q,{value:"6",children:e(Hr,{})}),e(Q,{value:"7",children:e(_r,{})})]})})]})},be=()=>{const t=D(),n=b(u=>u.localState.sidebarOpen);return e(An,{position:"sticky",sx:{zIndex:u=>u.zIndex.drawer+1},children:r(Ue,{children:[e($,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{t(kt(!n))},sx:{mr:2,display:{md:"none"}},children:e(Mn,{})}),e(h,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Horde Control Tower"}),null]})})},oa=async t=>{const n=window.document.createElement("canvas"),s=window.Image,u=(await Promise.allSettled([t].map(async i=>await new Promise((o,m)=>{let l;Gn(i,"src")?l=i:l={src:i};const c=new s;c.onerror=()=>m(new Error("Couldn't load image")),c.onload=()=>o({...l,img:c}),c.src=l.src,c.crossOrigin="anonymous"})))).filter(i=>i.status==="fulfilled").map(i=>i.value),a=n.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const i=o=>Math.max(...u.map(m=>{var l,c;return(c=(l=m==null?void 0:m.img)==null?void 0:l[o])!=null?c:0}));return n.width=i("width"),n.height=i("height"),u.forEach(o=>{var m,l;if(o!=null&&(a.globalAlpha=o.opacity!=null?o.opacity:1,o.img!=null))return a.drawImage(o.img,(m=o.x)!=null?m:0,(l=o.y)!=null?l:0)}),n.toDataURL("image/webp")}},da=t=>{const{gen:n,...s}=t,u=D();return w(["check",n.id],()=>Cr(n.id),{refetchInterval:2e3,enabled:n.state==="check",onSuccess:a=>{if(n.state==="check"){let i=n.state;a.faulted?i="error":a.done&&(i="status"),u(ve({...n,state:i,check:a}))}}}),w(["status",n.id],()=>Sr(n.id),{refetchInterval:!1,enabled:n.state==="status",onSuccess:async a=>{if(n.state==="status"){let i=n.state;if(a.faulted)i="error";else if(a.done){i="complete";const o=await oa(a.generations[0].img);a.generations[0].img=o}u(ve({...n,state:i,status:a}))}}}),w(["delete",n.id],()=>wr(n.id),{refetchInterval:!1,retry:!1,enabled:n.state==="delete",onSuccess:async a=>{u(ve({...n,state:"complete",status:a}))}}),e(k,{})},ca=()=>{const t=b(n=>n.persist.imageGens);return ee(t)?e(k,{}):e(k,{children:t.map(n=>e(da,{gen:n},n.id))})},ua=()=>{const t=b(a=>a.persist.apikey),{data:n,refetch:s,isLoading:u}=w(["findUser"],()=>xr(t),{enabled:!ee(t),retry:1});return S.exports.useEffect(()=>{s()},[t]),u?r(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(be,{}),e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(me,{})})]}):ee(t)||n==null?r(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(be,{}),r(p,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(h,{variant:"h4",children:"Please enter your API key."}),e(Tt,{})]})]}):n.moderator?r(p,{sx:{display:"flex",flexDirection:"column"},children:[e(ca,{}),e(Pr,{}),e(be,{}),e(ia,{})]}):r(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(be,{}),e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(h,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};X.prototype.__toHuman__=X.prototype.toHuman;X.prototype.toHuman=function(t={stripZeroUnits:"all"}){let n=this.normalize(),s=[],u=typeof t.precision=="object"?X.fromObject(t.precision):X.fromMillis(0),a=n;const i=["years","months","days","hours","minutes","seconds","milliseconds"];let o,m;t.smallestUnit&&(o=i.indexOf(t.smallestUnit)),t.biggestUnit&&(m=i.indexOf(t.biggestUnit)),(!o||!(o>=0&&o<i.length))&&(o=i.indexOf("seconds")),(!m||!(m<=o&&m<i.length))&&(m=i.indexOf("years"));for(let l of i.slice(m,o+1)){if(a.as(l)>=1){s.push(l);let x={};if(x[l]=Math.floor(a.as(l)),a=a.minus(X.fromObject(x)).normalize(),a<u)break}if(t.maxUnits&&s.length>=t.maxUnits)break}if(n=n.minus(a).normalize(),n=n.shiftTo(...s),t.stripZeroUnits=="all")s=s.filter(l=>n.values[l]>0);else if(t.stripZeroUnits=="end"){let l=!0;s=s.reverse().filter(c=>l?n.values[c]==0?!1:(l=!1,!0):!0)}return s.length||s.push(i[o]),n.shiftTo(...s).__toHuman__(t)};const ha=$n({key:"mui",prepend:!0}),pa=En({palette:{mode:"dark"}}),ma=new Rn({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});Hn(document.getElementById("root")).render(e(jn,{value:ha,children:r(Bn,{theme:pa,children:[e(Kn,{}),r(qn,{client:ma,children:[e(Nn,{store:ge,children:e(zn,{loading:null,persistor:gr,children:e(ua,{})})}),null]})]})}));
