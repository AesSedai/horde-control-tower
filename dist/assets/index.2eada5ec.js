import{c as K,a as et,b as tt,p as nt,d as rt,e as at,s as st,f as it,F as lt,R as ot,P as dt,g as ct,h as ut,i as ht,j as Ge,u as b,k as e,l as y,m as pt,n as mt,o as ft,B as m,I as gt,q as r,r as yt,t as xt,v as se,w as bt,x as P,y as kt,T as p,C as k,z as O,A as xe,S as Ee,M as Q,G as g,D as z,E as B,H as ne,J as le,K as w,L as $e,N as re,O as vt,Q as ae,U as J,V as Ae,W as wt,X as F,Y as St,Z as Ct,_ as be,$ as It,a0 as Re,a1 as Ke,a2 as Pt,a3 as _t,a4 as W,a5 as Lt,a6 as Wt,a7 as we,a8 as Se,a9 as Mt,aa as Tt,ab as Ut,ac as Ot,ad as $,ae as Ft,af as Dt,ag as Gt,ah as Et,ai as G,aj as Ce,ak as q,al as H,am as $t,an as qe,ao as At,ap as Rt,aq as Kt,ar as qt,as as Bt,at as E,au as S,av as Ie,aw as Be,ax as Ht,ay as jt,az as zt,aA as He,aB as A,aC as oe,aD as R,aE as Pe,aF as _e,aG as de,aH as Le,aI as Nt,aJ as Vt,aK as N,aL as V,aM as Qt,aN as Zt,aO as Jt,aP as Yt,aQ as Xt,aR as en,aS as tn,aT as nn,aU as rn,aV as an,aW as sn,aX as ln,aY as on,aZ as dn}from"./vendor.3af8f2fd.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))d(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function a(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerpolicy&&(c.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?c.credentials="include":i.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(i){if(i.ep)return;i.ep=!0;const c=a(i);fetch(i.href,c)}})();const cn={selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},ce=K({name:"comparatorPanel",initialState:cn,reducers:{setSelectedModel:(n,t)=>{n.selectedModel=t.payload},setSelectedWorkers:(n,t)=>{n.selectedWorkers=t.payload},setGenForm:(n,t)=>{n.genForm=structuredClone(t.payload)}}}),{setSelectedModel:We,setSelectedWorkers:X,setGenForm:un}=ce.actions,hn={sidebarOpen:!1},ue=K({name:"localState",initialState:hn,reducers:{setSidebarOpen:(n,t)=>{n.sidebarOpen=t.payload}}}),{setSidebarOpen:je}=ue.actions,ze={apikey:"",selectedTab:"1",favorites:[],imageGens:[]},Y=K({name:"persist",initialState:ze,reducers:{setKey:(n,t)=>{n.apikey=t.payload},setSelectedTab:(n,t)=>{n.selectedTab=t.payload},resetImageGens:n=>{n.imageGens=[]},addImageGen:(n,t)=>{n.imageGens.find(d=>d.id===t.payload.id)||n.imageGens.push(t.payload)},updateImageGen:(n,t)=>{const a=n.imageGens.findIndex(d=>d.id===t.payload.id);a!=null&&(n.imageGens[a]=t.payload)}}}),{setKey:pn,setSelectedTab:mn,resetImageGens:Me,addImageGen:fn,updateImageGen:Te}=Y.actions,gn={showPassword:!1},he=K({name:"settingsPanel",initialState:gn,reducers:{setShowPassword:(n,t)=>{n.showPassword=t.payload}}}),{setShowPassword:pe}=he.actions,yn={},me=K({name:"userPanel",initialState:yn,reducers:{setUser:(n,t)=>{n.selectedUser=t.payload}}}),{setUser:Ue}=me.actions,xn={prompt:""},fe=K({name:"utilityPanel",initialState:xn,reducers:{setPrompt:(n,t)=>{n.prompt=t.payload}}}),{setPrompt:bn}=fe.actions,kn={sortKey:"name",order:"asc"},ge=K({name:"workerPanel",initialState:kn,reducers:{setWorkerFilter:(n,t)=>{n.workerFilter=t.payload},setSortKey:(n,t)=>{n.sortKey=t.payload},setOrder:(n,t)=>{n.order=t.payload}}}),{setWorkerFilter:vn,setSortKey:wn,setOrder:Sn}=ge.actions,Cn=et((n,t)=>n,(n,t)=>Object.assign({},ze,n),{whitelist:[Y.name]}),In={key:"root",storage:it,whitelist:[Y.name],transforms:[Cn]},Pn=tt({[Y.name]:Y.reducer,[ue.name]:ue.reducer,[he.name]:he.reducer,[me.name]:me.reducer,[fe.name]:fe.reducer,[ge.name]:ge.reducer,[ce.name]:ce.reducer}),_n=nt(In,Pn),ie=rt({reducer:_n,middleware:n=>n({serializableCheck:{ignoredActions:[lt,ot,dt,ct,ut,ht]}}),devTools:!1}),Ln=at(ie);st(ie.dispatch);const C=Ge.create({baseURL:"https://stablehorde.net/api/v2/"});C.interceptors.request.use(function(n){const t=ie.getState().persist.apikey;return n.headers!=null&&t!=null&&(n.headers.apikey=t),n},function(n){return Promise.reject(n)});const Wn=Ge.create({baseURL:"/horde-control-tower/"}),Mn=n=>C.get("find_user",{headers:{apikey:n}}).then(t=>t.data),Ne=()=>C.get("status/modes").then(n=>n.data),Ve=()=>C.get("status/performance").then(n=>n.data),Qe=()=>Wn.get("users.json").then(n=>n.data),ke=n=>C.get(`users/${n}`).then(t=>t.data),ve=()=>C.get("workers").then(n=>n.data),Tn=n=>C.get(`workers/${n}`).then(t=>t.data),Ze=()=>C.get("status/models").then(n=>n.data),Je=(n,t)=>C.put(`users/${n}`,t).then(a=>a.data),Un=(n,t)=>C.put(`workers/${n}`,t).then(a=>a.data),On=n=>C.post("filters",n).then(t=>t.data),Fn=n=>C.post("generate/async",n).then(t=>t.data),Dn=n=>C.get(`generate/check/${n}`).then(t=>t.data),Gn=n=>C.get(`generate/status/${n}`).then(t=>t.data),M={all:["users"],lists:()=>[...M.all,"list"],list:n=>[...M.lists(),{filters:n}],details:()=>[...M.all,"detail"],detail:n=>[...M.details(),n]},U={all:["workers"],lists:()=>[...U.all,"list"],list:n=>[...U.lists(),{filters:n}],details:()=>[...U.all,"detail"],detail:n=>[...U.details(),n]},En=()=>(b(M.all,Qe,{staleTime:1e3*30,refetchInterval:1e3*30}),b(["performance"],Ve,{staleTime:1e3*30,refetchInterval:1e3*30}),b(["mode"],Ne,{staleTime:1e3*30,refetchInterval:1e3*30}),b(["models"],Ze,{staleTime:1e3*30,refetchInterval:1e3*30}),e(y,{})),T=()=>mt(),x=pt,$n=()=>{const n=x(a=>a.persist.imageGens),{data:t}=b(U.all,()=>ve(),{refetchInterval:1e3*30,select:a=>ft(a.map(d=>[d.id,d.name]))});return e(m,{children:e(gt,{sx:{width:"100%",height:"100%"},cols:4,children:n.map(a=>{var d;return r(yt,{children:[e("img",{src:a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:""}),e(xt,{title:t==null?"":t[(d=a.payload.workers[0])!=null?d:""],position:"below"})]},a.id)})})})},An=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Rn=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],L="175px",Kn=()=>{const n=T(),t=x(o=>o.comparatorPanel.selectedWorkers),a=x(o=>o.comparatorPanel.selectedModel),d=x(o=>o.comparatorPanel.genForm),{mutate:i}=se({mutationFn:Fn,onSuccess:(o,f,I)=>{n(fn({id:o.id,payload:f,state:"check",check:null,status:null}))}}),{handleSubmit:c,control:s,formState:{errors:h},watch:l}=bt({defaultValues:d}),u=o=>{a!=null&&t.length>0&&(n(Me()),t.forEach(f=>{const I={...o,workers:[f.id],models:[a.name]};i(I)}))};return P.exports.useEffect(()=>{const o=l(kt((f,{name:I,type:D})=>{n(un(f))},300));return()=>o.unsubscribe()},[l]),e(m,{children:r("form",{onSubmit:c(u),children:[r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Prompt"}),e(k,{name:"prompt",control:s,render:({field:o})=>e(O,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...o})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Seed"}),e(k,{name:"params.seed",control:s,render:({field:o})=>e(O,{fullWidth:!0,placeholder:"Seed",...o})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Sampler"}),e(xe,{fullWidth:!0,children:e(k,{name:"params.sampler_name",control:s,render:({field:o})=>e(Ee,{...o,children:Rn.map(f=>e(Q,{value:f,children:f},f))})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Steps"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(k,{name:"params.steps",control:s,render:({field:o})=>e(g,{item:!0,xs:!0,children:e(z,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...o})})}),e(k,{name:"params.steps",control:s,render:({field:o})=>e(g,{item:!0,children:e(B,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Width"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(k,{name:"params.width",control:s,render:({field:o})=>e(g,{item:!0,xs:!0,children:e(z,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...o})})}),e(k,{name:"params.width",control:s,render:({field:o})=>e(g,{item:!0,children:e(B,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Height"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(k,{name:"params.height",control:s,render:({field:o})=>e(g,{item:!0,xs:!0,children:e(z,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...o})})}),e(k,{name:"params.height",control:s,render:({field:o})=>e(g,{item:!0,children:e(B,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"CFG"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(k,{name:"params.cfg_scale",control:s,render:({field:o})=>e(g,{item:!0,xs:!0,children:e(z,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...o})})}),e(k,{name:"params.cfg_scale",control:s,render:({field:o})=>e(g,{item:!0,children:e(B,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Clip Skip"}),r(g,{container:!0,spacing:2,alignItems:"center",children:[e(k,{name:"params.clip_skip",control:s,render:({field:o})=>e(g,{item:!0,xs:!0,children:e(z,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...o})})}),e(k,{name:"params.clip_skip",control:s,render:({field:o})=>e(g,{item:!0,children:e(B,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Post-Processors"}),e(k,{name:"params.post_processing",control:s,render:({field:{onChange:o,onBlur:f,value:I,name:D,ref:j}})=>e(ne,{fullWidth:!0,multiple:!0,onBlur:f,ref:j,value:I,onChange:(v,_)=>{o(_)},options:An,getOptionLabel:v=>v,renderInput:v=>e(O,{...v})})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"High Res Fix"}),e(k,{name:"params.hires_fix",control:s,render:({field:o})=>e(le,{...o,checked:o.value})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Karras"}),e(k,{name:"params.karras",control:s,render:({field:o})=>e(le,{...o,checked:o.value})})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:L},children:"Tiling"}),e(k,{name:"params.tiling",control:s,render:({field:o})=>e(le,{...o,checked:o.value})})]}),e(w,{variant:"contained",type:"submit",children:"Generate"}),e(w,{sx:{ml:2},variant:"contained",onClick:()=>{n(Me())},children:"Clear Output"})]})})},qn=n=>n!=null&&"name"in n,Bn=n=>n!=null&&$e(n)&&"name"in n[0]&&"id"in n[0],Oe="175px",Hn=()=>{const n=T(),t=x(l=>l.comparatorPanel.selectedWorkers),a=x(l=>l.comparatorPanel.selectedModel),d=(l,u)=>{$e(u)&&u.length===0?n(X([])):Bn(u)&&n(X(u))},i=(l,u)=>{u==null?n(We(null)):qn(u)&&n(We(u))},{data:c}=b(U.all,()=>ve(),{refetchInterval:1e3*30,select:l=>re(l,[u=>u.name.toLowerCase()],["asc"])}),{data:s}=b(["models"],Ze,{staleTime:1e3*30,refetchInterval:1e3*30,select:l=>re(l,[u=>u.name.toLowerCase()],["asc"])});if(P.exports.useEffect(()=>{if(a!=null&&t.length>0){const l=t.map(f=>f.id),u=t.filter(f=>f.models.includes(a.name)),o=u.map(f=>f.id);vt(l,o)||n(X(u))}else a==null&&t.length>0&&n(X([]))},[c,s,t,a]),c==null||s==null)return e(y,{});const h=c.filter(l=>a==null?!0:l.models.includes(a.name));return r(m,{children:[r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:Oe},children:"Model"}),e(ne,{fullWidth:!0,disablePortal:!0,options:s,blurOnSelect:!0,value:a,autoHighlight:!0,getOptionLabel:l=>ae(l)?l:l.name,isOptionEqualToValue:(l,u)=>l.name===u.name,filterSelectedOptions:!0,renderInput:l=>e(O,{...l,label:"Selected Model"}),onChange:i})]}),r(m,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:Oe},children:"Workers"}),e(ne,{fullWidth:!0,multiple:!0,disablePortal:!0,options:h,value:t,getOptionLabel:l=>l.name,isOptionEqualToValue:(l,u)=>l.id===u.id,filterSelectedOptions:!0,renderInput:l=>e(O,{...l,label:"Selected Workers"}),onChange:d})]})]})},jn=()=>r(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,xl:4,children:r(J,{sx:{p:2},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(Hn,{}),e(Kn,{})]})}),e(g,{item:!0,xs:12,xl:8,children:r(J,{sx:{p:2,height:"100%"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e($n,{})]})})]}),Ye=()=>{const n=T(),t=x(i=>i.persist.apikey),a=x(i=>i.settingsPanel.showPassword);return r(xe,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(Ae,{children:"API Key"}),e(B,{defaultValue:t,onBlur:i=>{n(pn(i.target.value)),n(pe(!1))},type:a?"text":"password",endAdornment:e(wt,{position:"end",children:e(F,{onClick:()=>n(pe(!a)),children:a?e(St,{}):e(Ct,{})})})})]})},zn=()=>e(g,{container:!0,spacing:2,children:e(g,{item:!0,md:12,lg:6,xl:4,children:e(J,{children:e(Ye,{})})})}),ye="#0583B0",Z="#FF6962",Nn="#7c0500",Vn="#ef9b0f",Xe=n=>{const{worker:t}=n,a=be(),[d,i]=P.exports.useState(!1),[c,s]=P.exports.useState(!1),[h,l]=P.exports.useState("setFlagged"),[u,o]=P.exports.useState(""),f=v=>parseFloat(v.performance)>3?Vn:v.maintenance_mode||v.paused||v.flagged?Nn:"background.paper",I=se(v=>Un(v.id,v.data),{onSuccess:(v,_)=>{i(!0),a.invalidateQueries({queryKey:U.detail(_.id)}),a.invalidateQueries({queryKey:U.all})}}),D=(v,_)=>{_!=="clickaway"&&i(!1)};return r(y,{children:[e(It,{open:c,onClose:()=>s(!1),children:(v=>{switch(v){case"setFlagged":return r(y,{children:[r(G,{children:['Set "',t.name,'" as Flagged']}),r(q,{children:[e(w,{onClick:()=>{s(!1)},children:"Cancel"}),e(w,{onClick:()=>{s(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(y,{children:[r(G,{children:['Unset "',t.name,'" as Flagged']}),r(q,{children:[e(w,{onClick:()=>s(!1),children:"Cancel"}),e(w,{onClick:()=>{s(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(y,{children:[r(G,{children:['Set "',t.name,'" Maintenance Mode']}),e(Ce,{children:e(O,{value:u,onChange:_=>{o(_.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(q,{children:[e(w,{onClick:()=>s(!1),children:"Cancel"}),e(w,{onClick:()=>{const _={maintenance:!0};H(u)||(_.maintenance_msg=u),I.mutate({id:t.id,data:_}),s(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(y,{children:[r(G,{children:['Unset "',t.name,'" Maintenance Mode']}),r(q,{children:[e(w,{onClick:()=>s(!1),children:"Cancel"}),e(w,{onClick:()=>{I.mutate({id:t.id,data:{maintenance:!1,maintenance_msg:""}}),s(!1)},children:"Confirm"})]})]});case"setPaused":return r(y,{children:[r(G,{children:['Set "',t.name,'" Paused Mode']}),r(q,{children:[e(w,{onClick:()=>s(!1),children:"Cancel"}),e(w,{onClick:()=>{I.mutate({id:t.id,data:{paused:!0}}),s(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(y,{children:[r(G,{children:['Unset "',t.name,'" Paused Mode']}),r(q,{children:[e(w,{onClick:()=>s(!1),children:"Cancel"}),e(w,{onClick:()=>{I.mutate({id:t.id,data:{paused:!1}}),s(!1)},children:"Confirm"})]})]});case"listModels":return r(y,{children:[r(G,{children:['"',t.name,'" Models']}),e(Ce,{children:e(p,{variant:"body1",children:re(t.models,[_=>_.toLowerCase()]).join(", ")})})]})}})(h)}),e(Re,{open:d,autoHideDuration:6e3,onClose:D,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ke,{onClose:D,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(g,{item:!0,xs:12,lg:6,xl:3,children:r(Pt,{sx:{backgroundColor:f(t)},children:[e(_t,{avatar:t.online&&!t.paused&&!t.maintenance_mode&&!t.flagged?e(W,{title:"Worker Online",children:e(Lt,{sx:{color:ye}})}):e(W,{title:"Worker Issue",children:e(Wt,{sx:{color:Z}})}),action:r(m,{children:[t.paused?e(W,{title:"Worker Paused",children:e(we,{sx:{color:Z,mt:.5,mr:1}})}):null,t.maintenance_mode?e(W,{title:"Worker Maintenance",children:e(Se,{sx:{color:Z,mt:.5,mr:1}})}):null,t.flagged?e(W,{title:"User Flagged",children:e(Mt,{sx:{color:Z,mt:.5,mr:1}})}):null,t.trusted?e(W,{title:"Trusted Worker",children:e(Tt,{sx:{color:ye,mt:.5,mr:1}})}):null]}),title:e(p,{variant:"h5",children:Ut(t.name,{length:30})}),subheader:t.id}),r(Ot,{children:[r(p,{variant:"body2",children:["Full Name: ",t.name]}),r(p,{variant:"body2",children:["Owner: ",t.owner]}),r(p,{variant:"body2",children:["Uptime: ",$.fromObject({seconds:t.uptime}).toHuman()]}),r(p,{variant:"body2",children:["Models Loaded: ",t.models.length]}),r(p,{variant:"body2",children:["MPS Generated: ",t.megapixelsteps_generated]}),r(p,{variant:"body2",children:["Speed: ",t.performance," MPS"]}),r(p,{variant:"body2",children:["Threads: ",t.threads]}),r(p,{variant:"body2",children:["Requests Fulfilled: ",t.requests_fulfilled]}),r(p,{variant:"body2",children:["NSFW: ",t.nsfw?"true":"false"]})]}),r(Ft,{disableSpacing:!0,children:[e(W,{title:"Show Worker Models",children:e(F,{onClick:()=>{l("listModels"),s(!0)},children:e(Dt,{})})}),t.maintenance_mode?e(W,{title:"Unset Worker Maintenance",children:e(F,{onClick:()=>{l("unsetMaintenance"),s(!0)},children:e(Gt,{})})}):e(W,{title:"Set Worker Maintenance",children:e(F,{onClick:()=>{l("setMaintenance"),s(!0)},children:e(Se,{})})}),t.paused?e(W,{title:"Unset Worker Pause",children:e(F,{onClick:()=>{l("unsetPaused"),s(!0)},children:e(Et,{})})}):e(W,{title:"Set Worker Pause",children:e(F,{onClick:()=>{l("setPaused"),s(!0)},children:e(we,{})})})]})]})},t.id)]})},Qn=n=>{const{workerId:t}=n,{data:a}=b(U.detail(t),()=>Tn(t),{staleTime:1e3*61,select:d=>({...d,performance:d.performance.replace(" megapixelsteps per second","")})});return a==null?e(y,{}):e(Xe,{worker:a})},Zn=n=>{const{userId:t}=n,{data:a}=b(M.detail(t),()=>ke(t));return a==null?e(y,{}):a.worker_ids.length===0?e(g,{item:!0,md:12,lg:6,xl:4,children:e(p,{variant:"body1",children:"This user has no workers."})}):e(y,{children:a.worker_ids.map(d=>e(Qn,{workerId:d},d))})},[Jn,Yn,Xn]=$t(),er=n=>n!=null&&"username"in n&&"id"in n,tr=()=>{const n=T(),[t,a]=P.exports.useState(-1),[d]=qe(t,400),{data:i}=b(M.all,Qe),{data:c,refetch:s}=b(M.detail(d),()=>ke(d),{enabled:!1});if(P.exports.useEffect(()=>{At(d)&&d>=4770&&s()},[d]),i==null)return e(y,{});const h=(l,u)=>{ae(u)?n(Ue(parseInt(u))):er(u)&&n(Ue(u.id))};return e(ne,{disablePortal:!0,options:[...c!=null?[c]:[],...i!=null?i:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:i==null,loadingText:"Loading users...",getOptionLabel:l=>ae(l)?l:l.username,isOptionEqualToValue:(l,u)=>l.id===u.id,renderInput:l=>e(O,{...l,variant:"standard",label:"User Lookup",size:"small"}),onChange:h,onInputChange:(l,u)=>{a(Rt(u))}})},nr=()=>{const n=x(s=>{var h;return(h=s.userPanel.selectedUser)!=null?h:-1}),t=be(),{data:a,isInitialLoading:d}=b(M.detail(n),()=>ke(n),{refetchInterval:1e3*15}),i=se(s=>Je(s.id,s.data),{onSuccess:(s,h)=>{t.invalidateQueries({queryKey:M.detail(h.id)})}}),c=Yn();return P.exports.useEffect(()=>{if(a!=null){const s={trusted:a.trusted,flagged:a.flagged,worker_invite:a.worker_invited.toString()};c.setValues(s),c.resetDirty(s)}},[d]),a==null?e(y,{}):e(Kt,{component:m,children:e(qt,{size:"small",children:r(Bt,{children:[r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Username"})}),e(S,{align:"right",children:r(p,{variant:"body1",children:[a.username," ",a.moderator?"(moderator)":""]})})]}),r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Trusted"})}),e(S,{align:"right",children:e(Ie,{...c.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Flagged"})}),e(S,{align:"right",children:e(Ie,{...c.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Invites"})}),e(S,{align:"right",children:e(O,{variant:"standard",type:"number",...c.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Count"})}),e(S,{align:"right",children:e(p,{variant:"body1",children:a.worker_count})})]}),r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Kudos"})}),e(S,{align:"right",children:e(p,{variant:"body1",children:a.kudos})})]}),r(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(S,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Suspicious"})}),r(S,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[a.suspicious>0?e(Be,{onClick:async()=>{const s={reset_suspicion:!0};i.mutate({id:n,data:s})},loading:i.isLoading,variant:"contained",color:"error",sx:{order:0,mr:4},children:"Reset"}):null,e(p,{sx:{order:1},variant:"body1",children:a.suspicious})]})]})]})})})},rr=()=>{const n=be(),t=x(h=>h.userPanel.selectedUser),[a,d]=P.exports.useState(!1),i=Xn({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),c=se(h=>Je(h.id,h.data),{onSuccess:(h,l)=>{var o,f,I,D;n.setQueryData(M.detail(l.id),j=>j!=null?{...j,...h}:h);const u={trusted:(o=h.trusted)!=null?o:!1,flagged:(f=h.flagged)!=null?f:!1,worker_invite:(D=(I=h.worker_invite)==null?void 0:I.toString())!=null?D:"0"};H(u)||(i.setValues(u),i.resetDirty(u)),d(!0)}}),s=(h,l)=>{l!=="clickaway"&&d(!1)};return r(J,{elevation:1,sx:{p:2,height:"100%"},children:[e(Re,{open:a,autoHideDuration:6e3,onClose:s,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ke,{onClose:s,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:i.onSubmit((h,l)=>{if(t!=null){const u={trusted:h.trusted,flagged:h.flagged,worker_invite:parseInt(h.worker_invite)};c.mutate({id:t,data:u})}}),children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(tr,{}),t!=null?r(m,{display:"flex",alignItems:"center",children:[i.isDirty()?e(w,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null,e(Ht,{})]}):null]}),e(Jn,{form:i,children:e(m,{display:"flex",children:t!=null&&t!=-1?e(nr,{}):null})})]})]})},ar=()=>{const n=x(t=>t.userPanel.selectedUser);return r(g,{container:!0,spacing:2,children:[e(g,{item:!0,md:12,lg:6,xl:4,children:e(rr,{})}),n!=null?e(Zn,{userId:n}):null]})},sr=()=>{const n=T(),t=x(s=>s.utilityPanel.prompt),{data:a,refetch:d,isFetching:i}=b(["promptCheck",t],()=>On({filter_type:0,prompt:t}),{enabled:!1});return e(J,{elevation:1,sx:{p:2,height:"100%"},children:r(m,{children:[r(m,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Prompt Checker"}),e(Be,{onClick:()=>{H(t)||d()},loading:i,variant:"contained",children:"Submit"})]}),e(O,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:t,onChange:s=>{n(bn(s.target.value))},placeholder:"Enter prompt"}),a!=null?r(m,{pt:2,children:[r(p,{variant:"body1",children:["Suspicion: ",a.suspicion]}),a.suspicion>0?r(p,{variant:"body1",children:["Matches: ",JSON.stringify(a.matches)]}):null]}):null]})})},ir=()=>e(g,{container:!0,spacing:2,children:e(g,{item:!0,md:12,lg:6,xl:4,children:e(sr,{})})}),lr=()=>{const n=x(c=>c.workerPanel.workerFilter),[t,a]=P.exports.useState(n!=null?n:""),[d]=qe(t,400),i=T();return P.exports.useEffect(()=>{i(vn(d))},[d]),e(O,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:t,onChange:c=>{a(c.target.value)}})},or=()=>{const n=T(),t=x(h=>h.workerPanel.sortKey),a=x(h=>h.workerPanel.order),d=x(h=>h.workerPanel.workerFilter),{data:i}=b(U.all,()=>ve(),{refetchInterval:1e3*30,select:h=>{const l=d==null?void 0:d.toLowerCase();return re(h.filter(u=>{var o;return l==null?!0:u.name.toLowerCase().includes(l)||((o=u.owner)!=null?o:"").toLowerCase().includes(l)||u.id.toLowerCase().includes(l)}).map(u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})),[u=>{const o=u[t];return ae(o)?o.toLowerCase():o}],[a])}}),c=h=>{n(wn(h.target.value))},s=h=>{n(Sn(h))};return i==null?e(y,{}):r(y,{children:[r(m,{display:"flex",justifyContent:"space-between",pb:2,children:[r(m,{display:"flex",alignItems:"center",children:[e(p,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(lr,{})]}),r(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(xe,{sx:{mr:1},children:[e(Ae,{children:"Sort Key"}),r(Ee,{value:t,label:"Sort Key",onChange:c,sx:{".MuiSelect-select":{py:1}},children:[e(Q,{value:"name",children:"Name"}),e(Q,{value:"performance",children:"Performance"}),e(Q,{value:"uptime",children:"Uptime"}),e(Q,{value:"megapixelsteps_generated",children:"MPS Generated"})]})]}),a==="asc"?e(F,{onClick:()=>s("desc"),children:e(jt,{})}):e(F,{onClick:()=>s("asc"),children:e(zt,{})})]})]}),e(g,{container:!0,spacing:2,children:i.map(h=>e(Xe,{worker:h},h.id))})]})},Fe=()=>{const{data:n,isLoading:t,error:a}=b(["mode"],Ne);if(t)return e(p,{variant:"h6",children:"Loading Horde status ..."});if(n==null||a)return console.log("HordeStatus error",a),e(p,{variant:"h6",children:"Error loading Horde status"});const d=i=>i?e(Pe,{sx:{color:Z,ml:1}}):e(Pe,{sx:{color:ye,ml:1}});return r(He,{children:[r(A,{children:[e(oe,{children:d(n.maintenance_mode)}),e(R,{primary:"Maintenance"})]}),r(A,{children:[e(oe,{children:d(n.invite_only_mode)}),e(R,{primary:"Invite Only"})]}),n.raid_mode!=null?r(A,{children:[e(oe,{children:d(n.raid_mode)}),e(R,{primary:"Raid"})]}):null]})},De=()=>{const{data:n,isLoading:t,error:a}=b(["performance"],Ve);return t?e(p,{variant:"h6",children:"Loading Horde status ..."}):n==null||a?e(p,{variant:"h6",children:"Error loading Horde status"}):r(He,{children:[e(A,{children:e(R,{primary:`Queued Requests: ${n.queued_requests}`})}),e(A,{children:e(R,{primary:`Queued MPS: ${n.queued_megapixelsteps}`})}),e(A,{children:e(R,{primary:`Past Minute MPS: ${n.past_minute_megapixelsteps}`})}),e(A,{children:e(R,{primary:`Workers: ${n.worker_count}`})})]})},ee=240,dr=()=>{const n=T(),t=x(d=>d.localState.sidebarOpen);return r(y,{children:[r(_e,{variant:"temporary",open:t,onClose:()=>{n(je(!t))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ee,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ee}},children:[e(de,{}),r(m,{sx:{overflow:"auto"},children:[e(De,{}),e(Le,{}),e(Fe,{})]})]}),r(_e,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ee,flexShrink:0,["& .MuiDrawer-paper"]:{width:ee,boxSizing:"border-box"}},children:[e(de,{}),r(m,{sx:{overflow:"auto"},children:[e(De,{}),e(Le,{}),e(Fe,{})]})]})]})},cr=()=>{const n=T(),t=x(d=>d.persist.selectedTab);return r(m,{display:"flex",children:[e(dr,{}),e(m,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(Nt,{value:t,children:[e(m,{sx:{borderBottom:1,borderColor:"divider"},children:r(Vt,{onChange:(d,i)=>{i!="4"&&n(pe(!1)),n(mn(i))},"aria-label":"lab API tabs example",children:[e(N,{label:"User Lookup",value:"1"}),e(N,{label:"Workers",value:"2"}),e(N,{label:"Comparator",value:"3"}),e(N,{label:"Utilities",value:"4"}),e(N,{label:"Settings",value:"5"})]})}),e(V,{value:"1",children:e(ar,{})}),e(V,{value:"2",children:e(or,{})}),e(V,{value:"3",children:e(jn,{})}),e(V,{value:"4",children:e(ir,{})}),e(V,{value:"5",children:e(zn,{})})]})})]})},te=()=>{const n=T(),t=x(d=>d.localState.sidebarOpen);return e(Qt,{position:"sticky",sx:{zIndex:d=>d.zIndex.drawer+1},children:r(de,{children:[e(F,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{n(je(!t))},sx:{mr:2,display:{md:"none"}},children:e(Zt,{})}),e(p,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Horde Control Tower"})]})})},ur=async n=>{const t=window.document.createElement("canvas"),a=window.Image,d=(await Promise.allSettled([n].map(async c=>await new Promise((s,h)=>{let l;Jt(c,"src")?l=c:l={src:c};const u=new a;u.onerror=()=>h(new Error("Couldn't load image")),u.onload=()=>s({...l,img:u}),u.src=l.src,u.crossOrigin="anonymous"})))).filter(c=>c.status==="fulfilled").map(c=>c.value),i=t.getContext("2d");if(i==null)throw new Error("Couldn't create canvas context");{const c=s=>Math.max(...d.map(h=>{var l,u;return(u=(l=h==null?void 0:h.img)==null?void 0:l[s])!=null?u:0}));return t.width=c("width"),t.height=c("height"),d.forEach(s=>{var h,l;if(s!=null&&(i.globalAlpha=s.opacity!=null?s.opacity:1,s.img!=null))return i.drawImage(s.img,(h=s.x)!=null?h:0,(l=s.y)!=null?l:0)}),t.toDataURL("image/webp")}},hr=n=>{const{gen:t,...a}=n,d=T();return b(["check",t.id],()=>Dn(t.id),{refetchInterval:5e3,enabled:t.state==="check",onSuccess:i=>{if(t.state==="check"){let c=t.state;i.faulted?c="error":i.done&&(c="status"),d(Te({...t,state:c,check:i}))}}}),b(["status",t.id],()=>Gn(t.id),{refetchInterval:5e3,enabled:t.state==="status",onSuccess:async i=>{if(t.state==="status"){let c=t.state;if(i.faulted)c="error";else if(i.done){c="complete";const s=await ur(i.generations[0].img);i.generations[0].img=s}d(Te({...t,state:c,status:i}))}}}),e(y,{})},pr=()=>{const n=x(t=>t.persist.imageGens);return H(n)?e(y,{}):e(y,{children:n.map(t=>e(hr,{gen:t},t.id))})},mr=()=>{const n=x(i=>i.persist.apikey),{data:t,refetch:a,isLoading:d}=b(["findUser"],()=>Mn(n),{enabled:!H(n),retry:1});return P.exports.useEffect(()=>{a()},[n]),d?r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(te,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(Yt,{})})]}):H(n)||t==null?r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(te,{}),r(m,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(p,{variant:"h4",children:"Please enter your API key."}),e(Ye,{})]})]}):t.moderator?r(m,{sx:{display:"flex",flexDirection:"column"},children:[e(pr,{}),e(En,{}),e(te,{}),e(cr,{})]}):r(m,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(te,{}),e(m,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(p,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};$.prototype.__toHuman__=$.prototype.toHuman;$.prototype.toHuman=function(n={stripZeroUnits:"all"}){let t=this.normalize(),a=[],d=typeof n.precision=="object"?$.fromObject(n.precision):$.fromMillis(0),i=t;const c=["years","months","days","hours","minutes","seconds","milliseconds"];let s,h;n.smallestUnit&&(s=c.indexOf(n.smallestUnit)),n.biggestUnit&&(h=c.indexOf(n.biggestUnit)),(!s||!(s>=0&&s<c.length))&&(s=c.indexOf("seconds")),(!h||!(h<=s&&h<c.length))&&(h=c.indexOf("years"));for(let l of c.slice(h,s+1)){if(i.as(l)>=1){a.push(l);let o={};if(o[l]=Math.floor(i.as(l)),i=i.minus($.fromObject(o)).normalize(),i<d)break}if(n.maxUnits&&a.length>=n.maxUnits)break}if(t=t.minus(i).normalize(),t=t.shiftTo(...a),n.stripZeroUnits=="all")a=a.filter(l=>t.values[l]>0);else if(n.stripZeroUnits=="end"){let l=!0;a=a.reverse().filter(u=>l?t.values[u]==0?!1:(l=!1,!0):!0)}return a.length||a.push(c[s]),t.shiftTo(...a).__toHuman__(n)};const fr=Xt({key:"mui",prepend:!0}),gr=en({palette:{mode:"dark"}}),yr=new tn({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});nn(document.getElementById("root")).render(e(rn,{value:fr,children:r(an,{theme:gr,children:[e(sn,{}),r(ln,{client:yr,children:[e(on,{store:ie,children:e(dn,{loading:null,persistor:Ln,children:e(mr,{})})}),null]})]})}));
