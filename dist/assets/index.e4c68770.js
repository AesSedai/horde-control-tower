import{c as te,a as Rt,b as Ht,p as jt,d as Bt,e as Kt,s as qt,f as Nt,F as zt,R as Qt,P as Vt,g as Zt,h as Jt,i as Xt,j as qe,u as w,k as e,l as k,B as p,m as Y,n as r,T as h,L as Je,o as Yt,q as en,r as S,D as le,t as U,v as oe,w as Te,x as Ce,y as B,z as Xe,A as K,C as G,E as C,G as A,I as $,H as tn,M as nn,J as q,K as de,N as rn,O as Ne,Q as ce,S as ge,U as ue,V as he,W as an,X as sn,Y as x,Z as I,_ as ln,$ as on,a0 as We,a1 as se,a2 as re,a3 as Se,a4 as De,a5 as pe,a6 as yt,a7 as we,a8 as dn,a9 as Ie,aa as bt,ab as Le,ac as Ue,ad as cn,ae as un,af as hn,ag as _e,ah as ze,ai as Qe,aj as pn,ak as mn,al as W,am as gn,an as fn,ao as Ye,ap as et,aq as tt,ar as xn,as as yn,at as bn,au as vn,av as X,aw as kn,ax as Cn,ay as Sn,az as wn,aA as ee,aB as In,aC as vt,aD as Pn,aE as _n,aF as Fn,aG as Tn,aH as z,aI as F,aJ as nt,aK as rt,aL as at,aM as st,aN as it,aO as Dn,aP as On,aQ as Wn,aR as Oe,aS as lt,aT as ot,aU as Ae,aV as Ln,aW as Un,aX as Q,aY as V,aZ as An,a_ as Mn,a$ as Gn,b0 as $n,b1 as En,b2 as Rn,b3 as Hn,b4 as jn,b5 as Bn,b6 as Kn,b7 as qn,b8 as Nn,b9 as zn}from"./vendor.5271c6d0.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&u(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const Qn={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},Me=te({name:"comparatorPanel",initialState:Qn,reducers:{setSelectedModel:(t,n)=>{t.selectedModel=n.payload},setSelectedWorkers:(t,n)=>{t.selectedWorkers=n.payload},setGenForm:(t,n)=>{t.genForm=structuredClone(n.payload)},setReload:(t,n)=>{t.reload=n.payload}}}),{setSelectedModel:dt,setSelectedWorkers:ye,setGenForm:kt,setReload:Ct}=Me.actions,Vn={sidebarOpen:!1},Ge=te({name:"localState",initialState:Vn,reducers:{setSidebarOpen:(t,n)=>{t.sidebarOpen=n.payload}}}),{setSidebarOpen:St}=Ge.actions,$e={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},me=te({name:"persist",initialState:$e,reducers:{setKey:(t,n)=>{t.apikey=n.payload},setSelectedTab:(t,n)=>{t.selectedTab=n.payload},resetImageGens:t=>{t.imageGens=[]},addImageGen:(t,n)=>{t.imageGens.find(u=>u.id===n.payload.id)||t.imageGens.push(n.payload)},updateImageGen:(t,n)=>{const s=t.imageGens.findIndex(u=>u.id===n.payload.id);s!=null&&(t.imageGens[s]=n.payload)},addGenFavorite:(t,n)=>{t.genFavorites.push(n.payload)},updateGenFavorite:(t,n)=>{t.genFavorites[n.payload.idx]={name:t.genFavorites[n.payload.idx].name,form:n.payload.form}},deleteGenFavorite:(t,n)=>{t.genFavorites.splice(n.payload)},resetExceptApiKey:t=>(t={...$e,apikey:t.apikey},t)}}),{setKey:Zn,setSelectedTab:wt,resetImageGens:ct,addImageGen:Jn,updateImageGen:ke,addGenFavorite:Xn,resetExceptApiKey:fa,updateGenFavorite:Yn,deleteGenFavorite:er}=me.actions,tr={showPassword:!1},Ee=te({name:"settingsPanel",initialState:tr,reducers:{setShowPassword:(t,n)=>{t.showPassword=n.payload}}}),{setShowPassword:Re}=Ee.actions,nr={expandedPanel:"workers"},Pe=te({name:"userPanel",initialState:nr,reducers:{setUser:(t,n)=>{t.selectedUser=n.payload},setExpandedPanel:(t,n)=>{t.expandedPanel=n.payload}}}),{setUser:He,setExpandedPanel:rr}=Pe.actions,ar={prompt:"",ipAddr:""},je=te({name:"utilityPanel",initialState:ar,reducers:{setPrompt:(t,n)=>{t.prompt=n.payload},setIpAddr:(t,n)=>{t.ipAddr=n.payload}}}),{setPrompt:sr,setIpAddr:ir}=je.actions,lr={workerType:"image",sortKey:"name",order:"asc"},Be=te({name:"workerPanel",initialState:lr,reducers:{setWorkerType:(t,n)=>{t.workerType=n.payload},setWorkerFilter:(t,n)=>{t.workerFilter=n.payload},setSortKey:(t,n)=>{t.sortKey=n.payload},setOrder:(t,n)=>{t.order=n.payload}}}),{setWorkerType:or,setWorkerFilter:dr,setSortKey:ut,setOrder:cr}=Be.actions,ur=Rt((t,n)=>t,(t,n)=>Object.assign({},$e,t),{whitelist:[me.name]}),hr={key:"root",storage:Nt,whitelist:[me.name,Pe.name],transforms:[ur]},pr=Ht({[me.name]:me.reducer,[Ge.name]:Ge.reducer,[Ee.name]:Ee.reducer,[Pe.name]:Pe.reducer,[je.name]:je.reducer,[Be.name]:Be.reducer,[Me.name]:Me.reducer}),mr=jt(hr,pr),fe=Bt({reducer:mr,middleware:t=>t({serializableCheck:{ignoredActions:[zt,Qt,Vt,Zt,Jt,Xt]}}),devTools:!1}),gr=Kt(fe);qt(fe.dispatch);const T=qe.create({baseURL:"https://aihorde.net/api/v2/"});T.interceptors.request.use(function(t){const n=fe.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.5"),t},function(t){return Promise.reject(t)});const fr=qe.create({baseURL:"/horde-control-tower/"}),Fe=qe.create({baseURL:"https://ratings.aihorde.net/api/v1/"});Fe.interceptors.request.use(function(t){const n=fe.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.5"),t},function(t){return Promise.reject(t)});const xr=t=>T.get("find_user",{headers:{apikey:t}}).then(n=>n.data),It=()=>T.get("status/modes").then(t=>t.data),Pt=()=>T.get("status/performance").then(t=>t.data),_t=()=>fr.get("users.json").then(t=>t.data),Ve=t=>T.get(`users/${t}`).then(n=>n.data),Ze=()=>T.get("workers").then(t=>t.data),yr=t=>T.get(`workers/${t}`).then(n=>n.data),Ft=()=>T.get("status/models").then(t=>t.data),Tt=(t,n)=>T.put(`users/${t}`,n).then(s=>s.data),br=(t,n)=>T.put(`workers/${t}`,n).then(s=>s.data),vr=t=>T.post("filters",t).then(n=>n.data),kr=t=>T.post("generate/async",t).then(n=>n.data),Cr=t=>T.get(`generate/check/${t}`).then(n=>n.data),Sr=t=>T.get(`generate/status/${t}`).then(n=>n.data),wr=t=>T.delete(`generate/status/${t}`).then(n=>n.data),Ir=t=>T.delete("operations/ipaddr",{data:t}).then(n=>n.data),E={all:["users"],lists:()=>[...E.all,"list"],list:t=>[...E.lists(),{filters:t}],details:()=>[...E.all,"detail"],detail:t=>[...E.details(),t]},H={all:["workers"],lists:()=>[...H.all,"list"],list:t=>[...H.lists(),{filters:t}],details:()=>[...H.all,"detail"],detail:t=>[...H.details(),t]},Pr=()=>(w(E.all,_t,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["performance"],Pt,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["mode"],It,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30}),e(k,{})),_r=()=>e(p,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(Y,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(p,{children:[e(h,{variant:"h4",textAlign:"center",children:"About"}),r(h,{variant:"body1",children:["Horde Control Tower is an open source"," ",e(Je,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(h,{variant:"body1",children:["The project source is available on"," ",e(Je,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),D=()=>en(),v=Yt,Fr=()=>{const t=D(),n=v(_=>_.comparatorPanel.genForm),s=v(_=>_.persist.genFavorites),[u,a]=S.exports.useState(!1),[i,l]=S.exports.useState(-1),[g,o]=S.exports.useState(!1),[c,m]=S.exports.useState(-1),[b,y]=S.exports.useState(!1),[P,M]=S.exports.useState(""),[N,d]=S.exports.useState(null),f=Boolean(N),O=_=>{d(_.currentTarget)},R=()=>{d(null)},xe=()=>{y(!1)},ne=()=>{t(Xn({name:P,form:n})),M(""),y(!1)},ae=()=>{l(-1),a(!1)},Lt=()=>{t(Yn({idx:i,form:n})),l(-1),a(!1)},Ut=()=>{m(-1),o(!1)},At=()=>{t(er(c)),m(-1),o(!1)},Mt=_=>{t(kt(_)),t(Ct(!0)),d(null)},Gt=()=>{y(!0),d(null)},$t=()=>{a(!0),d(null)},Et=()=>{o(!0),d(null)};return r(k,{children:[r(le,{open:g,onClose:ae,children:[e(U,{children:"Delete Preset"}),r(oe,{children:[e(Te,{children:"Select a preset to delete."}),e(Ce,{children:s.map((_,j)=>e(B,{disablePadding:!0,sx:{backgroundColor:c===j?"error.dark":""},onClick:()=>{m(j)},children:e(Xe,{children:e(K,{primary:_.name})})},j))})]}),r(G,{children:[e(C,{onClick:Ut,children:"Cancel"}),e(C,{disabled:c===-1,onClick:At,children:"Select"})]})]}),r(le,{open:u,onClose:ae,children:[e(U,{children:"Overwrite Preset"}),r(oe,{children:[e(Te,{children:"Select a preset to overwrite."}),e(Ce,{children:s.map((_,j)=>e(B,{disablePadding:!0,sx:{backgroundColor:i===j?"success.dark":""},onClick:()=>{l(j)},children:e(Xe,{children:e(K,{primary:_.name})})},j))})]}),r(G,{children:[e(C,{onClick:ae,children:"Cancel"}),e(C,{disabled:i===-1,onClick:Lt,children:"Select"})]})]}),r(le,{open:b,onClose:xe,children:[e(U,{children:"Add New Preset"}),r(oe,{children:[e(Te,{children:"Enter a friendly name for this new preset."}),e(A,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:P,onChange:_=>{M(_.target.value)}})]}),r(G,{children:[e(C,{onClick:xe,children:"Cancel"}),e(C,{onClick:ne,children:"Create"})]})]}),e($,{onClick:O,children:e(tn,{})}),r(nn,{anchorEl:N,open:f,onClose:R,children:[s.map((_,j)=>e(q,{onClick:()=>{Mt(_.form)},children:_.name},j)),s.length>0?e(de,{}):null,s.length>0?e(q,{onClick:Et,children:"Delete Preset"}):null,s.length>0?e(de,{}):null,s.length>0?e(q,{onClick:$t,children:"Overwrite Preset"}):null,s.length>0?e(de,{}):null,e(q,{onClick:Gt,children:"Add New Preset"})]})]})},Tr=()=>{const t=v(a=>a.persist.imageGens),{data:n}=w(H.all,()=>Ze(),{refetchInterval:1e3*30,select:a=>rn(a.map(i=>[i.id,i.name]))}),s=a=>{var l,g,o;const i=a.status!=null?a.status:a.check;return a.state!=="complete"&&i!=null?r(ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(ge,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(ue,{title:n==null?"":n[(l=a.payload.workers[0])!=null?l:""],subtitle:`Position: ${i.queue_position}, wait time: ${i.wait_time}`})]},a.id):a.state==="complete"?u(a).length===0?r(ce,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(h,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(ue,{title:n==null?"":n[(g=a.payload.workers[0])!=null?g:""]})]},a.id):r(ce,{sx:{paddingTop:u(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:u(a)}),e(ue,{title:n==null?"":n[(o=a.payload.workers[0])!=null?o:""]})]},a.id):e(k,{})},u=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(p,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:4,children:t.map(a=>s(a))})})},Dr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Or=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],L="175px",Wr=()=>{const t=D(),n=v(d=>d.comparatorPanel.selectedWorkers),s=v(d=>d.comparatorPanel.selectedModel),u=v(d=>d.comparatorPanel.genForm),a=v(d=>d.persist.imageGens),i=v(d=>d.persist.imageGens.length>0),l=v(d=>d.comparatorPanel.reload),g=v(d=>d.persist.imageGens.some(f=>["pending","check"].includes(f.state))),{mutate:o}=he({mutationFn:kr,onSuccess:(d,f,O)=>{t(Jn({id:d.id,payload:f,state:"check",check:null,status:null}))}}),{handleSubmit:c,control:m,formState:{errors:b},watch:y,setValue:P,reset:M}=an({defaultValues:u}),N=d=>{s!=null&&n.length>0&&(t(ct()),n.forEach(f=>{const O={...d,workers:[f.id],models:[s.name]};o(O)}))};return S.exports.useEffect(()=>{const d=y(sn((f,{name:O,type:R})=>{t(kt(f))},300));return()=>d.unsubscribe()},[y]),S.exports.useEffect(()=>{l&&(t(Ct(!1)),M(u))},[l]),e(p,{children:r("form",{onSubmit:c(N),children:[r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Prompt"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"prompt",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(A,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...d})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Seed"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.seed",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(A,{fullWidth:!0,placeholder:"Seed",...d})})}),e(x,{item:!0,children:e($,{"aria-label":"randomize seed",onClick:()=>{P("params.seed",ln(1e8,999999999).toString())},children:e(on,{})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Sampler"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.sampler_name",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(We,{...d,fullWidth:!0,children:Or.map(f=>e(q,{value:f,children:f},f))})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Steps"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.steps",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...d})})}),e(I,{name:"params.steps",control:m,render:({field:d})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...d,onChange:f=>{d.onChange(parseInt(f.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Width"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.width",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(I,{name:"params.width",control:m,render:({field:d})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:f=>{d.onChange(parseInt(f.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Height"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.height",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...d})})}),e(I,{name:"params.height",control:m,render:({field:d})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...d,onChange:f=>{d.onChange(parseInt(f.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"CFG"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.cfg_scale",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...d})})}),e(I,{name:"params.cfg_scale",control:m,render:({field:d})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...d,onChange:f=>{d.onChange(parseInt(f.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Clip Skip"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(I,{name:"params.clip_skip",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(se,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...d})})}),e(I,{name:"params.clip_skip",control:m,render:({field:d})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...d,onChange:f=>{d.onChange(parseInt(f.target.value))}})})})]})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Post-Processors"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.post_processing",control:m,render:({field:{onChange:d,onBlur:f,value:O,name:R,ref:xe}})=>e(x,{item:!0,xs:!0,children:e(Se,{fullWidth:!0,multiple:!0,onBlur:f,ref:xe,value:O,onChange:(ne,ae)=>{d(ae)},options:Dr,getOptionLabel:ne=>ne,renderInput:ne=>e(A,{...ne})})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"High Res Fix"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.hires_fix",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(De,{...d,checked:d.value})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Karras"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.karras",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(De,{...d,checked:d.value})})})})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:L},children:"Tiling"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(I,{name:"params.tiling",control:m,render:({field:d})=>e(x,{item:!0,xs:!0,children:e(De,{...d,checked:d.value})})})})]}),e(pe,{type:"submit",loading:g,variant:"contained",children:"Submit"}),g?e(C,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(d=>["pending","check"].includes(d.state)).forEach(d=>{t(ke({...d,state:"delete"}))})},children:"Cancel"}):null,i?e(C,{sx:{ml:2},variant:"contained",onClick:()=>{t(ct())},children:"Clear Output"}):null]})})},Lr=t=>t!=null&&"name"in t,Ur=t=>t!=null&&yt(t)&&"name"in t[0]&&"id"in t[0],ht="175px",Ar=()=>{const t=D(),n=v(o=>o.comparatorPanel.selectedWorkers),s=v(o=>o.comparatorPanel.selectedModel),u=(o,c)=>{yt(c)&&c.length===0?t(ye([])):Ur(c)&&t(ye(c))},a=(o,c)=>{c==null?t(dt(null)):Lr(c)&&t(dt(c))},{data:i}=w(H.all,()=>Ze(),{refetchInterval:1e3*30,select:o=>we(o,[c=>c.name.toLowerCase()],["asc"])}),{data:l}=w(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30,select:o=>we(o,[c=>c.name.toLowerCase()],["asc"])});S.exports.useEffect(()=>{if(s!=null&&n.length>0){const o=n.map(b=>b.id),c=n.filter(b=>{var y;return(y=b==null?void 0:b.models)==null?void 0:y.includes(s.name)}),m=c.map(b=>b.id);dn(o,m)||t(ye(c))}else s==null&&n.length>0&&t(ye([]))},[i,l,n,s]);const g=(i!=null?i:[]).filter(o=>{var c;return s==null?!0:(c=o==null?void 0:o.models)==null?void 0:c.includes(s.name)});return r(p,{children:[r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:ht},children:"Model"}),e(Se,{fullWidth:!0,disablePortal:!0,options:l!=null?l:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:o=>Ie(o)?o:o.name,isOptionEqualToValue:(o,c)=>o.name===c.name,filterSelectedOptions:!0,renderInput:o=>e(A,{...o,label:"Selected Model"}),onChange:a})]}),r(p,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:ht},children:"Workers"}),e(Se,{fullWidth:!0,multiple:!0,disablePortal:!0,options:g,value:n,getOptionLabel:o=>o.name,isOptionEqualToValue:(o,c)=>o.id===c.id,filterSelectedOptions:!0,renderInput:o=>e(A,{...o,label:"Selected Workers"}),onChange:u})]})]})},Mr=()=>r(x,{container:!0,spacing:2,children:[e(x,{item:!0,xs:12,xl:4,children:r(Y,{sx:{p:2},children:[r(p,{sx:{position:"relative"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(p,{sx:{position:"absolute",top:0,right:0},children:e(Fr,{})})]}),e(Ar,{}),e(Wr,{})]})}),e(x,{item:!0,xs:12,xl:8,children:r(Y,{sx:{p:2,height:"100%"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(Tr,{})]})})]}),Dt={format:"json",limit:100},Gr=t=>Fe.get("user/ratings",{params:Object.assign({},Dt,t)}).then(n=>n.data),$r=(t,n)=>Fe.get(`user/validate/${t}`,{params:Object.assign({},Dt,n)}).then(s=>s.data),Er=t=>Fe.post(`user/flag/${t}`).then(n=>n.data),Z={all:["ratings"],lists:()=>[...Z.all,"list"],list:t=>[...Z.lists(),{filters:t}],details:()=>[...Z.all,"detail"],detail:t=>[...Z.details(),t],validates:()=>[...Z.all,"validate"],validate:t=>[...Z.validates(),t]},Rr=()=>{const{data:t,isLoading:n}=w(["user/ratings"],()=>Gr()),s=D();if(n)return e(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(ge,{})})});const u=i=>{const l=bt(i.username.split("#"));l!=null&&(s(He(parseInt(l))),s(wt("1")))},a=i=>r(p,{sx:{display:"flex"},children:[e(h,{sx:{textDecoration:"underline"},onClick:()=>u(i),children:i.username}),r(h,{children:["\xA0- r: ",i.rating,", a: ",i.artifacts,", avg: ",i.average,", n: ",i.times_rated]})]});return t==null?e(k,{}):e(p,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:t.ratings.map(i=>r(ce,{children:[e("img",{src:i.image}),e(ue,{title:a(i)})]},i.image_id))})})},Ot=()=>{const t=D(),n=v(a=>a.persist.apikey),s=v(a=>a.settingsPanel.showPassword);return r(Le,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(Ue,{children:"API Key"}),e(re,{defaultValue:n,onBlur:a=>{t(Zn(a.target.value)),t(Re(!1))},type:s?"text":"password",endAdornment:e(cn,{position:"end",children:e($,{onClick:()=>t(Re(!s)),children:s?e(un,{}):e(hn,{})})})})]})},Hr=()=>e(x,{container:!0,spacing:2,children:e(x,{item:!0,md:12,lg:6,xl:4,children:e(Y,{children:e(Ot,{})})})}),Ke="#0583B0",J="#FF6962",jr="#7c0500",Br="#ef9b0f",pt=t=>t.type==="image"&&parseFloat(t.performance)>3,mt=t=>t.type==="image"&&parseFloat(t.performance)<.4,Wt=t=>{var N,d;const{worker:n}=t,s=_e(),[u,a]=S.exports.useState(!1),[i,l]=S.exports.useState(!1),[g,o]=S.exports.useState("setFlagged"),[c,m]=S.exports.useState(""),b=f=>f.maintenance_mode||f.paused||f.flagged?jr:pt(f)||mt(f)?Br:"background.paper",y=he(f=>br(f.id,f.data),{onSuccess:(f,O)=>{a(!0),s.invalidateQueries({queryKey:H.detail(O.id)}),s.invalidateQueries({queryKey:H.all})}}),P=(f,O)=>{O!=="clickaway"&&a(!1)};return r(k,{children:[e(le,{open:i,onClose:()=>l(!1),children:(f=>{var O;switch(f){case"setFlagged":return r(k,{children:[r(U,{children:['Set "',n.name,'" as Flagged']}),r(G,{children:[e(C,{onClick:()=>{l(!1)},children:"Cancel"}),e(C,{onClick:()=>{l(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(k,{children:[r(U,{children:['Unset "',n.name,'" as Flagged']}),r(G,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{l(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(k,{children:[r(U,{children:['Set "',n.name,'" Maintenance Mode']}),e(oe,{children:e(A,{value:c,onChange:R=>{m(R.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(G,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{const R={maintenance:!0};ee(c)||(R.maintenance_msg=c),y.mutate({id:n.id,data:R}),l(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(k,{children:[r(U,{children:['Unset "',n.name,'" Maintenance Mode']}),r(G,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{maintenance:!1,maintenance_msg:""}}),l(!1)},children:"Confirm"})]})]});case"setPaused":return r(k,{children:[r(U,{children:['Set "',n.name,'" Paused Mode']}),r(G,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{paused:!0}}),l(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(k,{children:[r(U,{children:['Unset "',n.name,'" Paused Mode']}),r(G,{children:[e(C,{onClick:()=>l(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{paused:!1}}),l(!1)},children:"Confirm"})]})]});case"listModels":return r(k,{children:[r(U,{children:['"',n.name,'" Models']}),e(oe,{children:e(h,{variant:"body1",children:we((O=n==null?void 0:n.models)!=null?O:[],[R=>R.toLowerCase()]).join(", ")})})]})}})(g)}),e(ze,{open:u,autoHideDuration:6e3,onClose:P,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Qe,{onClose:P,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(x,{item:!0,xs:12,lg:6,xl:3,children:r(pn,{sx:{backgroundColor:b(n)},children:[e(mn,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:n.online&&!n.paused&&!n.maintenance_mode&&!n.flagged?e(W,{title:"Worker Online",children:e(gn,{sx:{color:Ke}})}):e(W,{title:"Worker Issue",children:e(fn,{sx:{color:J}})}),action:r(p,{children:[mt(n)?e(W,{title:"Worker Low Speed Warning",children:e(Ye,{sx:{color:J,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,pt(n)?e(W,{title:"Worker High Speed Warning",children:e(Ye,{sx:{color:J,mt:.5,mr:1}})}):null,n.paused?e(W,{title:"Worker Paused",children:e(et,{sx:{color:J,mt:.5,mr:1}})}):null,n.maintenance_mode?e(W,{title:"Worker Maintenance",children:e(tt,{sx:{color:J,mt:.5,mr:1}})}):null,n.flagged?e(W,{title:"User Flagged",children:e(xn,{sx:{color:J,mt:.5,mr:1}})}):null,n.trusted?e(W,{title:"Trusted Worker",children:e(yn,{sx:{color:Ke,mt:.5,mr:1}})}):null]}),title:e(h,{variant:"h5",children:bn(n.name,{length:30})}),subheader:n.id}),r(vn,{children:[r(h,{variant:"body2",children:["Full Name: ",n.name]}),r(h,{variant:"body2",children:["Owner: ",n.owner]}),r(h,{variant:"body2",children:["Bridge Agent: ",n.bridge_agent]}),r(h,{variant:"body2",children:["Uptime: ",X.fromObject({seconds:n.uptime}).toHuman()]}),n.type!=="interrogation"?r(h,{variant:"body2",children:["Models Loaded: ",(d=(N=n==null?void 0:n.models)==null?void 0:N.length)!=null?d:"None"]}):null,n.type==="image"?r(h,{variant:"body2",children:["MPS Generated: ",n.megapixelsteps_generated]}):null,r(h,{variant:"body2",children:["Speed: ",n.performance]}),r(h,{variant:"body2",children:["Threads: ",n.threads]}),r(h,{variant:"body2",children:["Requests Fulfilled: ",n.requests_fulfilled]}),r(h,{variant:"body2",children:["NSFW: ",n.nsfw?"true":"false"]})]}),r(kn,{disableSpacing:!0,children:[e(W,{title:"Show Worker Models",children:e($,{onClick:()=>{o("listModels"),l(!0)},children:e(Cn,{})})}),n.maintenance_mode?e(W,{title:"Unset Worker Maintenance",children:e($,{onClick:()=>{o("unsetMaintenance"),l(!0)},children:e(Sn,{})})}):e(W,{title:"Set Worker Maintenance",children:e($,{onClick:()=>{o("setMaintenance"),l(!0)},children:e(tt,{})})}),n.paused?e(W,{title:"Unset Worker Pause",children:e($,{onClick:()=>{o("unsetPaused"),l(!0)},children:e(wn,{})})}):e(W,{title:"Set Worker Pause",children:e($,{onClick:()=>{o("setPaused"),l(!0)},children:e(et,{})})})]})]})},n.id)]})},Kr=t=>{const{workerId:n}=t,{data:s}=w(H.detail(n),()=>yr(n),{staleTime:1e3*61,select:u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})});return s==null?e(k,{}):e(Wt,{worker:s})},qr=t=>{const{userId:n}=t,{data:s}=w(E.detail(n),()=>Ve(n));if(s==null)return e(k,{});const u=s.worker_ids;return u==null||(u==null?void 0:u.length)===0?e(x,{item:!0,md:12,lg:6,xl:4,children:e(h,{variant:"body1",children:"This user has no workers."})}):e(k,{children:u.map(a=>e(Kr,{workerId:a},a))})},[Nr,zr,Qr]=In(),Vr=t=>t!=null&&"username"in t&&"id"in t,ie=t=>{const n=bt(t.split("#"));return n==null?null:Pn(n)},Zr=()=>{var o;const t=D(),[n,s]=S.exports.useState(""),[u]=vt(n,400),{data:a}=w(E.all,_t),{data:i,refetch:l}=w(E.detail((o=ie(u))!=null?o:-1),()=>{var c;return Ve((c=ie(u))!=null?c:-1)},{enabled:!1});if(S.exports.useEffect(()=>{l()},[u]),a==null)return e(k,{});const g=(c,m)=>{var b;if(Ie(m)){const y=ie(m);m!=="0"&&y!==0&&t(He((b=ie(m))!=null?b:-1))}else Vr(m)&&m.id!==0&&t(He(m.id))};return e(Se,{disablePortal:!0,options:[...i!=null?[i]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:c=>Ie(c)?c:c.username,isOptionEqualToValue:(c,m)=>c.id===m.id,renderInput:c=>e(A,{...c,variant:"standard",label:"User Lookup",size:"small"}),onChange:g,onInputChange:(c,m)=>{m!=="0"&&ie(m)!==0&&s(m)}})},Jr=()=>{const t=v(d=>{var f;return(f=d.userPanel.selectedUser)!=null?f:-1}),n=_e(),[s,u]=S.exports.useState("setFlagged"),[a,i]=S.exports.useState(!1),[l,g]=S.exports.useState(!1),{data:o,isInitialLoading:c,isLoading:m}=w(E.detail(t),()=>Ve(t),{refetchInterval:1e3*15}),b=he(d=>Tt(d.id,d.data),{onSuccess:(d,f)=>{n.invalidateQueries({queryKey:E.detail(f.id)})}}),y=he(d=>Er(d.id),{}),P=zr();if(S.exports.useEffect(()=>{if(o!=null){const d={trusted:o.trusted,flagged:o.flagged,worker_invite:o.worker_invited.toString()};P.setValues(d),P.resetDirty(d)}},[c]),m)return e(p,{py:4,sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(ge,{})});if(o==null)return e(k,{});const M=(d,f)=>{f!=="clickaway"&&i(!1)};return r(k,{children:[e(le,{open:l,onClose:()=>g(!1),children:(d=>{switch(d){case"resetSuspicion":return r(k,{children:[r(U,{children:['Reset "',o.username,'" Suspicion']}),r(G,{children:[e(C,{onClick:()=>{g(!1)},children:"Cancel"}),e(C,{onClick:()=>{const f={reset_suspicion:!0};b.mutate({id:t,data:f}),g(!1)},children:"Confirm"})]})]});case"setFlagged":return r(k,{children:[r(U,{children:['Flag "',o.username,'" ratings and delete?']}),r(G,{children:[e(C,{onClick:()=>{g(!1)},children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:t}),g(!1)},children:"Confirm"})]})]})}})(s)}),e(ze,{open:a,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Qe,{onClose:M,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(_n,{component:p,children:e(Fn,{size:"small",children:r(Tn,{children:[r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Username"})}),e(F,{align:"right",children:r(h,{variant:"body1",children:[o.username," ",o.moderator?"(moderator)":""]})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Trusted"})}),e(F,{align:"right",children:e(nt,{...P.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flagged"})}),e(F,{align:"right",children:e(nt,{...P.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Invites"})}),e(F,{align:"right",children:e(A,{variant:"standard",type:"number",...P.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Count"})}),e(F,{align:"right",children:e(h,{variant:"body1",children:o.worker_count})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Kudos"})}),e(F,{align:"right",children:e(h,{variant:"body1",children:o.kudos})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Suspicious"})}),r(F,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[e(h,{sx:{order:0},variant:"body1",children:o.suspicious}),o.suspicious>0?e(pe,{onClick:async()=>{u("resetSuspicion"),g(!0)},loading:b.isLoading,variant:"contained",color:"error",sx:{ml:4},children:"Reset"}):null]})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(F,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flag User Ratings"})}),e(F,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:e(pe,{onClick:async()=>{u("setFlagged"),g(!0)},loading:y.isLoading,variant:"contained",color:"error",sx:{order:0},children:"Flag"})})]})]})})})]})},Xr=()=>{const t=_e(),n=v(g=>g.userPanel.selectedUser),[s,u]=S.exports.useState(!1),a=Qr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),i=he(g=>Tt(g.id,g.data),{onSuccess:(g,o)=>{var m,b,y,P;t.setQueryData(E.detail(o.id),M=>M!=null?{...M,...g}:g);const c={trusted:(m=g.trusted)!=null?m:!1,flagged:(b=g.flagged)!=null?b:!1,worker_invite:(P=(y=g.worker_invite)==null?void 0:y.toString())!=null?P:"0"};ee(c)||(a.setValues(c),a.resetDirty(c)),u(!0)}}),l=(g,o)=>{o!=="clickaway"&&u(!1)};return r(Y,{elevation:1,sx:{p:2,height:"100%"},children:[e(ze,{open:s,autoHideDuration:6e3,onClose:l,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Qe,{onClose:l,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((g,o)=>{if(n!=null){const c={trusted:g.trusted,flagged:g.flagged,worker_invite:parseInt(g.worker_invite)};i.mutate({id:n,data:c})}}),children:[r(p,{display:"flex",justifyContent:"space-between",children:[e(Zr,{}),n!=null?e(p,{display:"flex",alignItems:"center",children:a.isDirty()?e(C,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null}):null]}),e(Nr,{form:a,children:e(p,{display:"flex",children:n!=null&&n!=-1?e(Jr,{}):null})})]})]})},Yr=t=>{_e();const{userId:n}=t;S.exports.useState(!1);const{data:s,isInitialLoading:u,isLoading:a}=w(Z.validate(n),()=>$r(n),{refetchInterval:1e3*15}),i=l=>e(p,{sx:{display:"flex"},children:r(h,{children:["r: ",l.rating,", a: ",l.artifacts,", avg: ",l.average,", n: ",l.times_rated]})});return a?e(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(ge,{})})}):s==null?e(k,{}):e(p,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:s.ratings.map(l=>r(ce,{children:[e("img",{src:l.image}),e(ue,{title:i(l)})]},l.image_id))})})},ea=()=>{const t=D(),n=v(a=>a.userPanel.selectedUser),s=v(a=>a.userPanel.expandedPanel),u=a=>(i,l)=>{(a==="workers"||a==="ratings")&&t(rr(l?a:!1))};return r(x,{container:!0,spacing:2,children:[e(x,{item:!0,md:12,lg:6,xl:4,children:e(Xr,{})}),e(x,{item:!0,md:12,lg:12,xl:12,children:r(p,{children:[r(rt,{expanded:s==="workers",onChange:u("workers"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:e(h,{sx:{width:"33%",flexShrink:0},children:"Workers"})}),e(it,{sx:{backgroundColor:"background.default"},children:e(x,{container:!0,spacing:2,children:n!=null?e(qr,{userId:n}):null})})]}),r(rt,{expanded:s==="ratings",onChange:u("ratings"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:e(h,{sx:{width:"33%",flexShrink:0},children:"Ratings"})}),e(it,{sx:{backgroundColor:"background.default"},children:s==="ratings"&&n!=null?e(Yr,{userId:n}):null})]})]})})]})},ta=()=>{const t=D(),n=v(l=>l.utilityPanel.ipAddr),{data:s,refetch:u,isFetching:a}=w(["deleteIpAddr",n],()=>Ir({ipaddr:n}),{enabled:!1,cacheTime:0});return e(Y,{elevation:1,sx:{p:2,height:"100%"},children:r(p,{children:[r(p,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Clear IP Timeout"}),e(pe,{onClick:()=>{ee(n)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(A,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:l=>{t(ir(l.target.value))},placeholder:"Enter IP"}),s!=null?e(p,{pt:2,children:r(h,{variant:"body1",children:["Response: ",s.message]})}):null]})})},na=()=>{const t=D(),n=v(l=>l.utilityPanel.prompt),{data:s,refetch:u,isFetching:a}=w(["promptCheck",n],()=>vr({filter_type:0,prompt:n}),{enabled:!1});return e(Y,{elevation:1,sx:{p:2,height:"100%"},children:r(p,{children:[r(p,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Prompt Checker"}),e(pe,{onClick:()=>{ee(n)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(A,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:l=>{t(sr(l.target.value))},placeholder:"Enter prompt"}),s!=null?r(p,{pt:2,children:[r(h,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(h,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},ra=()=>r(x,{container:!0,spacing:2,children:[e(x,{item:!0,md:12,lg:6,xl:4,children:e(na,{})}),e(x,{item:!0,md:12,lg:6,xl:4,children:e(ta,{})})]}),aa=()=>{const t=v(i=>i.workerPanel.workerFilter),[n,s]=S.exports.useState(t!=null?t:""),[u]=vt(n,400),a=D();return S.exports.useEffect(()=>{a(dr(u))},[u]),e(A,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:n,onChange:i=>{s(i.target.value)}})},gt={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},sa=()=>{const t=D(),n=v(c=>c.workerPanel.sortKey),s=v(c=>c.workerPanel.order),u=v(c=>c.workerPanel.workerFilter),a=v(c=>c.workerPanel.workerType),{data:i}=w(H.all,()=>Ze(),{refetchInterval:1e3*30,select:c=>{const m=u==null?void 0:u.toLowerCase();return we(c.filter(b=>{var y;return b.type!==a?!1:m==null?!0:b.name.toLowerCase().includes(m)||((y=b.owner)!=null?y:"").toLowerCase().includes(m)||b.id.toLowerCase().includes(m)||b.bridge_agent.toLowerCase().includes(m)}),[b=>{const y=b[n];return Ie(y)?n==="performance"&&parseFloat(y)?parseFloat(y):y.toLowerCase():y}],[s])}}),l=c=>{var b,y;const m=c.target.value;t(or(m)),t(ut((y=(b=Wn(gt[m]))==null?void 0:b.parameter)!=null?y:"name"))},g=c=>{t(ut(c.target.value))},o=c=>{t(cr(c))};return i==null?e(k,{}):r(k,{children:[r(p,{display:"flex",justifyContent:"space-between",pb:2,children:[r(p,{display:"flex",alignItems:"center",children:[e(h,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(aa,{})]}),r(p,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(Le,{sx:{mr:1},children:[e(Ue,{children:"Worker Type"}),r(We,{value:a,label:"Worker Type",onChange:l,sx:{".MuiSelect-select":{py:1}},children:[e(q,{value:"image",children:"Image"}),e(q,{value:"interrogation",children:"Interrogation"}),e(q,{value:"text",children:"Text"})]})]}),r(Le,{sx:{mr:1},children:[e(Ue,{children:"Sort Key"}),e(We,{value:n,label:"Sort Key",onChange:g,sx:{".MuiSelect-select":{py:1}},children:gt[a].map(c=>e(q,{value:c.parameter,children:c.label},c.label))})]}),s==="asc"?e($,{onClick:()=>o("desc"),children:e(Dn,{})}):e($,{onClick:()=>o("asc"),children:e(On,{})})]})]}),e(x,{container:!0,spacing:2,children:i.map(c=>e(Wt,{worker:c},c.id))})]})},ft=()=>{const{data:t,isLoading:n,error:s}=w(["mode"],It);if(n)return e(h,{variant:"h6",children:"Loading Horde status ..."});if(t==null||s)return console.log("HordeStatus error",s),e(h,{variant:"h6",children:"Error loading Horde status"});const u=a=>a?e(lt,{sx:{color:J,ml:1}}):e(lt,{sx:{color:Ke,ml:1}});return r(Ce,{children:[r(B,{children:[e(Oe,{children:u(t.maintenance_mode)}),e(K,{primary:"Maintenance"})]}),r(B,{children:[e(Oe,{children:u(t.invite_only_mode)}),e(K,{primary:"Invite Only"})]}),t.raid_mode!=null?r(B,{children:[e(Oe,{children:u(t.raid_mode)}),e(K,{primary:"Raid"})]}):null]})},xt=()=>{const{data:t,isLoading:n,error:s}=w(["performance"],Pt);return n?e(h,{variant:"h6",children:"Loading Horde status ..."}):t==null||s?e(h,{variant:"h6",children:"Error loading Horde status"}):r(Ce,{children:[e(B,{children:e(K,{primary:`Queued Requests: ${t.queued_requests}`})}),e(B,{children:e(K,{primary:`Queued MPS: ${t.queued_megapixelsteps}`})}),e(B,{children:e(K,{primary:`Past Minute MPS: ${t.past_minute_megapixelsteps}`})}),e(B,{children:e(K,{primary:`Workers: ${t.worker_count}`})})]})},be=240,ia=()=>{const t=D(),n=v(u=>u.localState.sidebarOpen);return r(k,{children:[r(ot,{variant:"temporary",open:n,onClose:()=>{t(St(!n))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:be,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:be}},children:[e(Ae,{}),r(p,{sx:{overflow:"auto"},children:[e(xt,{}),e(de,{}),e(ft,{})]})]}),r(ot,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:be,flexShrink:0,["& .MuiDrawer-paper"]:{width:be,boxSizing:"border-box"}},children:[e(Ae,{}),r(p,{sx:{overflow:"auto"},children:[e(xt,{}),e(de,{}),e(ft,{})]})]})]})},la=()=>{const t=D(),n=v(u=>u.persist.selectedTab);return r(p,{display:"flex",children:[e(ia,{}),e(p,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(Ln,{value:n,children:[e(p,{sx:{borderBottom:1,borderColor:"divider"},children:r(Un,{onChange:(u,a)=>{a!="4"&&t(Re(!1)),t(wt(a))},"aria-label":"lab API tabs example",children:[e(Q,{label:"User Lookup",value:"1"}),e(Q,{label:"Workers",value:"2"}),e(Q,{label:"Comparator",value:"3"}),e(Q,{label:"Ratings",value:"4"}),e(Q,{label:"Utilities",value:"5"}),e(Q,{label:"Settings",value:"6"}),e(Q,{label:"About",value:"7"})]})}),e(V,{value:"1",children:e(ea,{})}),e(V,{value:"2",children:e(sa,{})}),e(V,{value:"3",children:e(Mr,{})}),e(V,{value:"4",children:e(Rr,{})}),e(V,{value:"5",children:e(ra,{})}),e(V,{value:"6",children:e(Hr,{})}),e(V,{value:"7",children:e(_r,{})})]})})]})},ve=()=>{const t=D(),n=v(u=>u.localState.sidebarOpen);return e(An,{position:"sticky",sx:{zIndex:u=>u.zIndex.drawer+1},children:r(Ae,{children:[e($,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{t(St(!n))},sx:{mr:2,display:{md:"none"}},children:e(Mn,{})}),e(h,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Horde Control Tower"}),null]})})},oa=async t=>{const n=window.document.createElement("canvas"),s=window.Image,u=(await Promise.allSettled([t].map(async i=>await new Promise((l,g)=>{let o;Gn(i,"src")?o=i:o={src:i};const c=new s;c.onerror=()=>g(new Error("Couldn't load image")),c.onload=()=>l({...o,img:c}),c.src=o.src,c.crossOrigin="anonymous"})))).filter(i=>i.status==="fulfilled").map(i=>i.value),a=n.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const i=l=>Math.max(...u.map(g=>{var o,c;return(c=(o=g==null?void 0:g.img)==null?void 0:o[l])!=null?c:0}));return n.width=i("width"),n.height=i("height"),u.forEach(l=>{var g,o;if(l!=null&&(a.globalAlpha=l.opacity!=null?l.opacity:1,l.img!=null))return a.drawImage(l.img,(g=l.x)!=null?g:0,(o=l.y)!=null?o:0)}),n.toDataURL("image/webp")}},da=t=>{const{gen:n,...s}=t,u=D();return w(["check",n.id],()=>Cr(n.id),{refetchInterval:2e3,enabled:n.state==="check",onSuccess:a=>{if(n.state==="check"){let i=n.state;a.faulted?i="error":a.done&&(i="status"),u(ke({...n,state:i,check:a}))}}}),w(["status",n.id],()=>Sr(n.id),{refetchInterval:!1,enabled:n.state==="status",onSuccess:async a=>{if(n.state==="status"){let i=n.state;if(a.faulted)i="error";else if(a.done){i="complete";const l=await oa(a.generations[0].img);a.generations[0].img=l}u(ke({...n,state:i,status:a}))}}}),w(["delete",n.id],()=>wr(n.id),{refetchInterval:!1,retry:!1,enabled:n.state==="delete",onSuccess:async a=>{u(ke({...n,state:"complete",status:a}))}}),e(k,{})},ca=()=>{const t=v(n=>n.persist.imageGens);return ee(t)?e(k,{}):e(k,{children:t.map(n=>e(da,{gen:n},n.id))})},ua=()=>{const t=v(a=>a.persist.apikey),{data:n,refetch:s,isLoading:u}=w(["findUser"],()=>xr(t),{enabled:!ee(t),retry:1});return S.exports.useEffect(()=>{s()},[t]),u?r(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ve,{}),e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(ge,{})})]}):ee(t)||n==null?r(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ve,{}),r(p,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(h,{variant:"h4",children:"Please enter your API key."}),e(Ot,{})]})]}):n.moderator?r(p,{sx:{display:"flex",flexDirection:"column"},children:[e(ca,{}),e(Pr,{}),e(ve,{}),e(la,{})]}):r(p,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ve,{}),e(p,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(h,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};X.prototype.__toHuman__=X.prototype.toHuman;X.prototype.toHuman=function(t={stripZeroUnits:"all"}){let n=this.normalize(),s=[],u=typeof t.precision=="object"?X.fromObject(t.precision):X.fromMillis(0),a=n;const i=["years","months","days","hours","minutes","seconds","milliseconds"];let l,g;t.smallestUnit&&(l=i.indexOf(t.smallestUnit)),t.biggestUnit&&(g=i.indexOf(t.biggestUnit)),(!l||!(l>=0&&l<i.length))&&(l=i.indexOf("seconds")),(!g||!(g<=l&&g<i.length))&&(g=i.indexOf("years"));for(let o of i.slice(g,l+1)){if(a.as(o)>=1){s.push(o);let m={};if(m[o]=Math.floor(a.as(o)),a=a.minus(X.fromObject(m)).normalize(),a<u)break}if(t.maxUnits&&s.length>=t.maxUnits)break}if(n=n.minus(a).normalize(),n=n.shiftTo(...s),t.stripZeroUnits=="all")s=s.filter(o=>n.values[o]>0);else if(t.stripZeroUnits=="end"){let o=!0;s=s.reverse().filter(c=>o?n.values[c]==0?!1:(o=!1,!0):!0)}return s.length||s.push(i[l]),n.shiftTo(...s).__toHuman__(t)};const ha=$n({key:"mui",prepend:!0}),pa=En({palette:{mode:"dark"}}),ma=new Rn({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});Hn(document.getElementById("root")).render(e(jn,{value:ha,children:r(Bn,{theme:pa,children:[e(Kn,{}),r(qn,{client:ma,children:[e(Nn,{store:fe,children:e(zn,{loading:null,persistor:gr,children:e(ua,{})})}),null]})]})}));
