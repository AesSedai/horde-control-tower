import{c as te,a as Rt,b as Ht,p as jt,d as Kt,e as Bt,s as qt,f as Nt,F as zt,R as Vt,P as Qt,g as Zt,h as Jt,i as Xt,j as qe,u as w,k as e,l as C,B as g,m as Y,n as r,T as h,L as Je,o as Yt,q as en,r as S,D as ce,t as U,v as ue,w as Te,x as Se,y as q,z as Xe,A as N,C as W,E as k,G as A,I as E,H as tn,M as nn,J as z,K as he,N as rn,O as Ne,Q as pe,S as fe,U as me,V as ae,W as an,X as sn,Y as x,Z as P,_ as ln,$ as on,a0 as Ue,a1 as oe,a2 as re,a3 as we,a4 as De,a5 as se,a6 as yt,a7 as Ie,a8 as dn,a9 as Pe,aa as bt,ab as Le,ac as We,ad as cn,ae as un,af as hn,ag as Fe,ah as ze,ai as Ve,aj as pn,ak as mn,al as L,am as gn,an as fn,ao as Ye,ap as et,aq as tt,ar as xn,as as yn,at as bn,au as vn,av as X,aw as kn,ax as Cn,ay as Sn,az as wn,aA as ee,aB as In,aC as vt,aD as Pn,aE as _n,aF as Fn,aG as Tn,aH as B,aI as I,aJ as nt,aK as rt,aL as at,aM as st,aN as it,aO as Dn,aP as On,aQ as Un,aR as Oe,aS as lt,aT as ot,aU as Me,aV as Ln,aW as Wn,aX as Q,aY as Z,aZ as Mn,a_ as An,a$ as Gn,b0 as $n,b1 as En,b2 as Rn,b3 as Hn,b4 as jn,b5 as Kn,b6 as Bn,b7 as qn,b8 as Nn,b9 as zn}from"./vendor.5271c6d0.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function u(a){if(a.ep)return;a.ep=!0;const d=s(a);fetch(a.href,d)}})();const Vn={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},Ae=te({name:"comparatorPanel",initialState:Vn,reducers:{setSelectedModel:(t,n)=>{t.selectedModel=n.payload},setSelectedWorkers:(t,n)=>{t.selectedWorkers=n.payload},setGenForm:(t,n)=>{t.genForm=structuredClone(n.payload)},setReload:(t,n)=>{t.reload=n.payload}}}),{setSelectedModel:dt,setSelectedWorkers:be,setGenForm:kt,setReload:Ct}=Ae.actions,Qn={sidebarOpen:!1},Ge=te({name:"localState",initialState:Qn,reducers:{setSidebarOpen:(t,n)=>{t.sidebarOpen=n.payload}}}),{setSidebarOpen:St}=Ge.actions,$e={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},ge=te({name:"persist",initialState:$e,reducers:{setKey:(t,n)=>{t.apikey=n.payload},setSelectedTab:(t,n)=>{t.selectedTab=n.payload},resetImageGens:t=>{t.imageGens=[]},addImageGen:(t,n)=>{t.imageGens.find(u=>u.id===n.payload.id)||t.imageGens.push(n.payload)},updateImageGen:(t,n)=>{const s=t.imageGens.findIndex(u=>u.id===n.payload.id);s!=null&&(t.imageGens[s]=n.payload)},addGenFavorite:(t,n)=>{t.genFavorites.push(n.payload)},updateGenFavorite:(t,n)=>{t.genFavorites[n.payload.idx]={name:t.genFavorites[n.payload.idx].name,form:n.payload.form}},deleteGenFavorite:(t,n)=>{t.genFavorites.splice(n.payload)},resetExceptApiKey:t=>(t={...$e,apikey:t.apikey},t)}}),{setKey:Zn,setSelectedTab:wt,resetImageGens:ct,addImageGen:Jn,updateImageGen:Ce,addGenFavorite:Xn,resetExceptApiKey:ya,updateGenFavorite:Yn,deleteGenFavorite:er}=ge.actions,tr={showPassword:!1},Ee=te({name:"settingsPanel",initialState:tr,reducers:{setShowPassword:(t,n)=>{t.showPassword=n.payload}}}),{setShowPassword:Re}=Ee.actions,nr={expandedPanel:"workers"},_e=te({name:"userPanel",initialState:nr,reducers:{setUser:(t,n)=>{t.selectedUser=n.payload},setExpandedPanel:(t,n)=>{t.expandedPanel=n.payload}}}),{setUser:He,setExpandedPanel:rr}=_e.actions,ar={prompt:"",ipAddr:""},je=te({name:"utilityPanel",initialState:ar,reducers:{setPrompt:(t,n)=>{t.prompt=n.payload},setIpAddr:(t,n)=>{t.ipAddr=n.payload}}}),{setPrompt:sr,setIpAddr:ir}=je.actions,lr={workerType:"image",sortKey:"name",order:"asc"},Ke=te({name:"workerPanel",initialState:lr,reducers:{setWorkerType:(t,n)=>{t.workerType=n.payload},setWorkerFilter:(t,n)=>{t.workerFilter=n.payload},setSortKey:(t,n)=>{t.sortKey=n.payload},setOrder:(t,n)=>{t.order=n.payload}}}),{setWorkerType:or,setWorkerFilter:dr,setSortKey:ut,setOrder:cr}=Ke.actions,ur=Rt((t,n)=>t,(t,n)=>Object.assign({},$e,t),{whitelist:[ge.name]}),hr={key:"root",storage:Nt,whitelist:[ge.name,_e.name],transforms:[ur]},pr=Ht({[ge.name]:ge.reducer,[Ge.name]:Ge.reducer,[Ee.name]:Ee.reducer,[_e.name]:_e.reducer,[je.name]:je.reducer,[Ke.name]:Ke.reducer,[Ae.name]:Ae.reducer}),mr=jt(hr,pr),xe=Kt({reducer:mr,middleware:t=>t({serializableCheck:{ignoredActions:[zt,Vt,Qt,Zt,Jt,Xt]}}),devTools:!1}),gr=Bt(xe);qt(xe.dispatch);const T=qe.create({baseURL:"https://aihorde.net/api/v2/"});T.interceptors.request.use(function(t){const n=xe.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.6"),t},function(t){return Promise.reject(t)});const fr=qe.create({baseURL:"/horde-control-tower/"}),ie=qe.create({baseURL:"https://ratings.aihorde.net/api/v1/"});ie.interceptors.request.use(function(t){const n=xe.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.6"),t},function(t){return Promise.reject(t)});const xr=t=>T.get("find_user",{headers:{apikey:t}}).then(n=>n.data),It=()=>T.get("status/modes").then(t=>t.data),Pt=()=>T.get("status/performance").then(t=>t.data),_t=()=>fr.get("users.json").then(t=>t.data),Qe=t=>T.get(`users/${t}`).then(n=>n.data),Ze=()=>T.get("workers").then(t=>t.data),yr=t=>T.get(`workers/${t}`).then(n=>n.data),Ft=()=>T.get("status/models").then(t=>t.data),Tt=(t,n)=>T.put(`users/${t}`,n).then(s=>s.data),br=(t,n)=>T.put(`workers/${t}`,n).then(s=>s.data),vr=t=>T.post("filters",t).then(n=>n.data),kr=t=>T.post("generate/async",t).then(n=>n.data),Cr=t=>T.get(`generate/check/${t}`).then(n=>n.data),Sr=t=>T.get(`generate/status/${t}`).then(n=>n.data),wr=t=>T.delete(`generate/status/${t}`).then(n=>n.data),Ir=t=>T.delete("operations/ipaddr",{data:t}).then(n=>n.data),R={all:["users"],lists:()=>[...R.all,"list"],list:t=>[...R.lists(),{filters:t}],details:()=>[...R.all,"detail"],detail:t=>[...R.details(),t]},j={all:["workers"],lists:()=>[...j.all,"list"],list:t=>[...j.lists(),{filters:t}],details:()=>[...j.all,"detail"],detail:t=>[...j.details(),t]},Pr=()=>(w(R.all,_t,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["performance"],Pt,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["mode"],It,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30}),e(C,{})),_r=()=>e(g,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(Y,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(g,{children:[e(h,{variant:"h4",textAlign:"center",children:"About"}),r(h,{variant:"body1",children:["Horde Control Tower is an open source"," ",e(Je,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(h,{variant:"body1",children:["The project source is available on"," ",e(Je,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),D=()=>en(),v=Yt,Fr=()=>{const t=D(),n=v(F=>F.comparatorPanel.genForm),s=v(F=>F.persist.genFavorites),[u,a]=S.exports.useState(!1),[d,c]=S.exports.useState(-1),[p,i]=S.exports.useState(!1),[l,m]=S.exports.useState(-1),[b,y]=S.exports.useState(!1),[_,G]=S.exports.useState(""),[V,o]=S.exports.useState(null),f=Boolean(V),O=F=>{o(F.currentTarget)},H=()=>{o(null)},ye=()=>{y(!1)},ne=()=>{t(Xn({name:_,form:n})),G(""),y(!1)},le=()=>{c(-1),a(!1)},Lt=()=>{t(Yn({idx:d,form:n})),c(-1),a(!1)},Wt=()=>{m(-1),i(!1)},Mt=()=>{t(er(l)),m(-1),i(!1)},At=F=>{t(kt(F)),t(Ct(!0)),o(null)},Gt=()=>{y(!0),o(null)},$t=()=>{a(!0),o(null)},Et=()=>{i(!0),o(null)};return r(C,{children:[r(ce,{open:p,onClose:le,children:[e(U,{children:"Delete Preset"}),r(ue,{children:[e(Te,{children:"Select a preset to delete."}),e(Se,{children:s.map((F,K)=>e(q,{disablePadding:!0,sx:{backgroundColor:l===K?"error.dark":""},onClick:()=>{m(K)},children:e(Xe,{children:e(N,{primary:F.name})})},K))})]}),r(W,{children:[e(k,{onClick:Wt,children:"Cancel"}),e(k,{disabled:l===-1,onClick:Mt,children:"Select"})]})]}),r(ce,{open:u,onClose:le,children:[e(U,{children:"Overwrite Preset"}),r(ue,{children:[e(Te,{children:"Select a preset to overwrite."}),e(Se,{children:s.map((F,K)=>e(q,{disablePadding:!0,sx:{backgroundColor:d===K?"success.dark":""},onClick:()=>{c(K)},children:e(Xe,{children:e(N,{primary:F.name})})},K))})]}),r(W,{children:[e(k,{onClick:le,children:"Cancel"}),e(k,{disabled:d===-1,onClick:Lt,children:"Select"})]})]}),r(ce,{open:b,onClose:ye,children:[e(U,{children:"Add New Preset"}),r(ue,{children:[e(Te,{children:"Enter a friendly name for this new preset."}),e(A,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:_,onChange:F=>{G(F.target.value)}})]}),r(W,{children:[e(k,{onClick:ye,children:"Cancel"}),e(k,{onClick:ne,children:"Create"})]})]}),e(E,{onClick:O,children:e(tn,{})}),r(nn,{anchorEl:V,open:f,onClose:H,children:[s.map((F,K)=>e(z,{onClick:()=>{At(F.form)},children:F.name},K)),s.length>0?e(he,{}):null,s.length>0?e(z,{onClick:Et,children:"Delete Preset"}):null,s.length>0?e(he,{}):null,s.length>0?e(z,{onClick:$t,children:"Overwrite Preset"}):null,s.length>0?e(he,{}):null,e(z,{onClick:Gt,children:"Add New Preset"})]})]})},Tr=()=>{const t=v(a=>a.persist.imageGens),{data:n}=w(j.all,()=>Ze(),{refetchInterval:1e3*30,select:a=>rn(a.map(d=>[d.id,d.name]))}),s=a=>{var c,p,i;const d=a.status!=null?a.status:a.check;return a.state!=="complete"&&d!=null?r(pe,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(fe,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(me,{title:n==null?"":n[(c=a.payload.workers[0])!=null?c:""],subtitle:`Position: ${d.queue_position}, wait time: ${d.wait_time}`})]},a.id):a.state==="complete"?u(a).length===0?r(pe,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(h,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(me,{title:n==null?"":n[(p=a.payload.workers[0])!=null?p:""]})]},a.id):r(pe,{sx:{paddingTop:u(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:u(a)}),e(me,{title:n==null?"":n[(i=a.payload.workers[0])!=null?i:""]})]},a.id):e(C,{})},u=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(g,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:4,children:t.map(a=>s(a))})})},Dr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Or=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],M="175px",Ur=()=>{const t=D(),n=v(o=>o.comparatorPanel.selectedWorkers),s=v(o=>o.comparatorPanel.selectedModel),u=v(o=>o.comparatorPanel.genForm),a=v(o=>o.persist.imageGens),d=v(o=>o.persist.imageGens.length>0),c=v(o=>o.comparatorPanel.reload),p=v(o=>o.persist.imageGens.some(f=>["pending","check"].includes(f.state))),{mutate:i}=ae({mutationFn:kr,onSuccess:(o,f,O)=>{t(Jn({id:o.id,payload:f,state:"check",check:null,status:null}))}}),{handleSubmit:l,control:m,formState:{errors:b},watch:y,setValue:_,reset:G}=an({defaultValues:u}),V=o=>{s!=null&&n.length>0&&(t(ct()),n.forEach(f=>{const O={...o,workers:[f.id],models:[s.name]};i(O)}))};return S.exports.useEffect(()=>{const o=y(sn((f,{name:O,type:H})=>{t(kt(f))},300));return()=>o.unsubscribe()},[y]),S.exports.useEffect(()=>{c&&(t(Ct(!1)),G(u))},[c]),e(g,{children:r("form",{onSubmit:l(V),children:[r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Prompt"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(P,{name:"prompt",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(A,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...o})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Seed"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(P,{name:"params.seed",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(A,{fullWidth:!0,placeholder:"Seed",...o})})}),e(x,{item:!0,children:e(E,{"aria-label":"randomize seed",onClick:()=>{_("params.seed",ln(1e8,999999999).toString())},children:e(on,{})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Sampler"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(P,{name:"params.sampler_name",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(Ue,{...o,fullWidth:!0,children:Or.map(f=>e(z,{value:f,children:f},f))})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Steps"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(P,{name:"params.steps",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(oe,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...o})})}),e(P,{name:"params.steps",control:m,render:({field:o})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Width"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(P,{name:"params.width",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(oe,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...o})})}),e(P,{name:"params.width",control:m,render:({field:o})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Height"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(P,{name:"params.height",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(oe,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...o})})}),e(P,{name:"params.height",control:m,render:({field:o})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"CFG"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(P,{name:"params.cfg_scale",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(oe,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...o})})}),e(P,{name:"params.cfg_scale",control:m,render:({field:o})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Clip Skip"}),r(x,{container:!0,spacing:2,alignItems:"center",children:[e(P,{name:"params.clip_skip",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(oe,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...o})})}),e(P,{name:"params.clip_skip",control:m,render:({field:o})=>e(x,{item:!0,children:e(re,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...o,onChange:f=>{o.onChange(parseInt(f.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Post-Processors"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(P,{name:"params.post_processing",control:m,render:({field:{onChange:o,onBlur:f,value:O,name:H,ref:ye}})=>e(x,{item:!0,xs:!0,children:e(we,{fullWidth:!0,multiple:!0,onBlur:f,ref:ye,value:O,onChange:(ne,le)=>{o(le)},options:Dr,getOptionLabel:ne=>ne,renderInput:ne=>e(A,{...ne})})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"High Res Fix"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(P,{name:"params.hires_fix",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(De,{...o,checked:o.value})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Karras"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(P,{name:"params.karras",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(De,{...o,checked:o.value})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:M},children:"Tiling"}),e(x,{container:!0,spacing:2,alignItems:"center",children:e(P,{name:"params.tiling",control:m,render:({field:o})=>e(x,{item:!0,xs:!0,children:e(De,{...o,checked:o.value})})})})]}),e(se,{type:"submit",loading:p,variant:"contained",children:"Submit"}),p?e(k,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(o=>["pending","check"].includes(o.state)).forEach(o=>{t(Ce({...o,state:"delete"}))})},children:"Cancel"}):null,d?e(k,{sx:{ml:2},variant:"contained",onClick:()=>{t(ct())},children:"Clear Output"}):null]})})},Lr=t=>t!=null&&"name"in t,Wr=t=>t!=null&&yt(t)&&"name"in t[0]&&"id"in t[0],ht="175px",Mr=()=>{const t=D(),n=v(i=>i.comparatorPanel.selectedWorkers),s=v(i=>i.comparatorPanel.selectedModel),u=(i,l)=>{yt(l)&&l.length===0?t(be([])):Wr(l)&&t(be(l))},a=(i,l)=>{l==null?t(dt(null)):Lr(l)&&t(dt(l))},{data:d}=w(j.all,()=>Ze(),{refetchInterval:1e3*30,select:i=>Ie(i,[l=>l.name.toLowerCase()],["asc"])}),{data:c}=w(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30,select:i=>Ie(i,[l=>l.name.toLowerCase()],["asc"])});S.exports.useEffect(()=>{if(s!=null&&n.length>0){const i=n.map(b=>b.id),l=n.filter(b=>{var y;return(y=b==null?void 0:b.models)==null?void 0:y.includes(s.name)}),m=l.map(b=>b.id);dn(i,m)||t(be(l))}else s==null&&n.length>0&&t(be([]))},[d,c,n,s]);const p=(d!=null?d:[]).filter(i=>{var l;return s==null?!0:(l=i==null?void 0:i.models)==null?void 0:l.includes(s.name)});return r(g,{children:[r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:ht},children:"Model"}),e(we,{fullWidth:!0,disablePortal:!0,options:c!=null?c:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:i=>Pe(i)?i:i.name,isOptionEqualToValue:(i,l)=>i.name===l.name,filterSelectedOptions:!0,renderInput:i=>e(A,{...i,label:"Selected Model"}),onChange:a})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(h,{variant:"body1",sx:{width:ht},children:"Workers"}),e(we,{fullWidth:!0,multiple:!0,disablePortal:!0,options:p,value:n,getOptionLabel:i=>i.name,isOptionEqualToValue:(i,l)=>i.id===l.id,filterSelectedOptions:!0,renderInput:i=>e(A,{...i,label:"Selected Workers"}),onChange:u})]})]})},Ar=()=>r(x,{container:!0,spacing:2,children:[e(x,{item:!0,xs:12,xl:4,children:r(Y,{sx:{p:2},children:[r(g,{sx:{position:"relative"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(g,{sx:{position:"absolute",top:0,right:0},children:e(Fr,{})})]}),e(Mr,{}),e(Ur,{})]})}),e(x,{item:!0,xs:12,xl:8,children:r(Y,{sx:{p:2,height:"100%"},children:[e(h,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(Tr,{})]})})]}),Dt={format:"json",limit:100},Gr=t=>ie.get("user/ratings",{params:Object.assign({},Dt,t)}).then(n=>n.data),$r=(t,n)=>ie.get(`user/validate/${t}`,{params:Object.assign({},Dt,n)}).then(s=>s.data),Er=t=>ie.get(`user/check/${t}`).then(n=>n.data),Rr=t=>ie.post(`user/flag/${t}`).then(n=>n.data),Hr=(t,n)=>ie.post(`user/modify/${t}`,n).then(s=>s.data),$={all:["ratings"],lists:()=>[...$.all,"list"],list:t=>[...$.lists(),{filters:t}],details:()=>[...$.all,"detail"],detail:t=>[...$.details(),t],validates:()=>[...$.all,"validate"],validate:t=>[...$.validates(),t],checks:()=>[...$.all,"check"],check:t=>[...$.checks(),t]},jr=()=>{const{data:t,isLoading:n}=w(["user/ratings"],()=>Gr()),s=D();if(n)return e(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(fe,{})})});const u=d=>{const c=bt(d.username.split("#"));c!=null&&(s(He(parseInt(c))),s(wt("1")))},a=d=>r(g,{sx:{display:"flex"},children:[e(h,{sx:{textDecoration:"underline"},onClick:()=>u(d),children:d.username}),r(h,{children:["\xA0- r: ",d.rating,", a: ",d.artifacts,", avg: ",d.average,", n: ",d.times_rated]})]});return t==null?e(C,{}):e(g,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:t.ratings.map(d=>r(pe,{children:[e("img",{src:d.image}),e(me,{title:a(d)})]},d.image_id))})})},Ot=()=>{const t=D(),n=v(a=>a.persist.apikey),s=v(a=>a.settingsPanel.showPassword);return r(Le,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(We,{children:"API Key"}),e(re,{defaultValue:n,onBlur:a=>{t(Zn(a.target.value)),t(Re(!1))},type:s?"text":"password",endAdornment:e(cn,{position:"end",children:e(E,{onClick:()=>t(Re(!s)),children:s?e(un,{}):e(hn,{})})})})]})},Kr=()=>e(x,{container:!0,spacing:2,children:e(x,{item:!0,md:12,lg:6,xl:4,children:e(Y,{children:e(Ot,{})})})}),Be="#0583B0",J="#FF6962",Br="#7c0500",qr="#ef9b0f",pt=t=>t.type==="image"&&parseFloat(t.performance)>3,mt=t=>t.type==="image"&&parseFloat(t.performance)<.4,Ut=t=>{var V,o;const{worker:n}=t,s=Fe(),[u,a]=S.exports.useState(!1),[d,c]=S.exports.useState(!1),[p,i]=S.exports.useState("setFlagged"),[l,m]=S.exports.useState(""),b=f=>f.maintenance_mode||f.paused||f.flagged?Br:pt(f)||mt(f)?qr:"background.paper",y=ae(f=>br(f.id,f.data),{onSuccess:(f,O)=>{a(!0),s.invalidateQueries({queryKey:j.detail(O.id)}),s.invalidateQueries({queryKey:j.all})}}),_=(f,O)=>{O!=="clickaway"&&a(!1)};return r(C,{children:[e(ce,{open:d,onClose:()=>c(!1),children:(f=>{var O;switch(f){case"setFlagged":return r(C,{children:[r(U,{children:['Set "',n.name,'" as Flagged']}),r(W,{children:[e(k,{onClick:()=>{c(!1)},children:"Cancel"}),e(k,{onClick:()=>{c(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(C,{children:[r(U,{children:['Unset "',n.name,'" as Flagged']}),r(W,{children:[e(k,{onClick:()=>c(!1),children:"Cancel"}),e(k,{onClick:()=>{c(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(C,{children:[r(U,{children:['Set "',n.name,'" Maintenance Mode']}),e(ue,{children:e(A,{value:l,onChange:H=>{m(H.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(W,{children:[e(k,{onClick:()=>c(!1),children:"Cancel"}),e(k,{onClick:()=>{const H={maintenance:!0};ee(l)||(H.maintenance_msg=l),y.mutate({id:n.id,data:H}),c(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(C,{children:[r(U,{children:['Unset "',n.name,'" Maintenance Mode']}),r(W,{children:[e(k,{onClick:()=>c(!1),children:"Cancel"}),e(k,{onClick:()=>{y.mutate({id:n.id,data:{maintenance:!1,maintenance_msg:""}}),c(!1)},children:"Confirm"})]})]});case"setPaused":return r(C,{children:[r(U,{children:['Set "',n.name,'" Paused Mode']}),r(W,{children:[e(k,{onClick:()=>c(!1),children:"Cancel"}),e(k,{onClick:()=>{y.mutate({id:n.id,data:{paused:!0}}),c(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(C,{children:[r(U,{children:['Unset "',n.name,'" Paused Mode']}),r(W,{children:[e(k,{onClick:()=>c(!1),children:"Cancel"}),e(k,{onClick:()=>{y.mutate({id:n.id,data:{paused:!1}}),c(!1)},children:"Confirm"})]})]});case"listModels":return r(C,{children:[r(U,{children:['"',n.name,'" Models']}),e(ue,{children:e(h,{variant:"body1",children:Ie((O=n==null?void 0:n.models)!=null?O:[],[H=>H.toLowerCase()]).join(", ")})})]})}})(p)}),e(ze,{open:u,autoHideDuration:6e3,onClose:_,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ve,{onClose:_,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(x,{item:!0,xs:12,lg:6,xl:3,children:r(pn,{sx:{backgroundColor:b(n)},children:[e(mn,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:n.online&&!n.paused&&!n.maintenance_mode&&!n.flagged?e(L,{title:"Worker Online",children:e(gn,{sx:{color:Be}})}):e(L,{title:"Worker Issue",children:e(fn,{sx:{color:J}})}),action:r(g,{children:[mt(n)?e(L,{title:"Worker Low Speed Warning",children:e(Ye,{sx:{color:J,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,pt(n)?e(L,{title:"Worker High Speed Warning",children:e(Ye,{sx:{color:J,mt:.5,mr:1}})}):null,n.paused?e(L,{title:"Worker Paused",children:e(et,{sx:{color:J,mt:.5,mr:1}})}):null,n.maintenance_mode?e(L,{title:"Worker Maintenance",children:e(tt,{sx:{color:J,mt:.5,mr:1}})}):null,n.flagged?e(L,{title:"User Flagged",children:e(xn,{sx:{color:J,mt:.5,mr:1}})}):null,n.trusted?e(L,{title:"Trusted Worker",children:e(yn,{sx:{color:Be,mt:.5,mr:1}})}):null]}),title:e(h,{variant:"h5",children:bn(n.name,{length:30})}),subheader:n.id}),r(vn,{children:[r(h,{variant:"body2",children:["Full Name: ",n.name]}),r(h,{variant:"body2",children:["Owner: ",n.owner]}),r(h,{variant:"body2",children:["Bridge Agent: ",n.bridge_agent]}),r(h,{variant:"body2",children:["Uptime: ",X.fromObject({seconds:n.uptime}).toHuman()]}),n.type!=="interrogation"?r(h,{variant:"body2",children:["Models Loaded: ",(o=(V=n==null?void 0:n.models)==null?void 0:V.length)!=null?o:"None"]}):null,n.type==="image"?r(h,{variant:"body2",children:["MPS Generated: ",n.megapixelsteps_generated]}):null,r(h,{variant:"body2",children:["Speed: ",n.performance]}),r(h,{variant:"body2",children:["Threads: ",n.threads]}),r(h,{variant:"body2",children:["Requests Fulfilled: ",n.requests_fulfilled]}),r(h,{variant:"body2",children:["NSFW: ",n.nsfw?"true":"false"]})]}),r(kn,{disableSpacing:!0,children:[e(L,{title:"Show Worker Models",children:e(E,{onClick:()=>{i("listModels"),c(!0)},children:e(Cn,{})})}),n.maintenance_mode?e(L,{title:"Unset Worker Maintenance",children:e(E,{onClick:()=>{i("unsetMaintenance"),c(!0)},children:e(Sn,{})})}):e(L,{title:"Set Worker Maintenance",children:e(E,{onClick:()=>{i("setMaintenance"),c(!0)},children:e(tt,{})})}),n.paused?e(L,{title:"Unset Worker Pause",children:e(E,{onClick:()=>{i("unsetPaused"),c(!0)},children:e(wn,{})})}):e(L,{title:"Set Worker Pause",children:e(E,{onClick:()=>{i("setPaused"),c(!0)},children:e(et,{})})})]})]})},n.id)]})},Nr=t=>{const{workerId:n}=t,{data:s}=w(j.detail(n),()=>yr(n),{staleTime:1e3*61,select:u=>({...u,performance:u.performance.replace(" megapixelsteps per second","")})});return s==null?e(C,{}):e(Ut,{worker:s})},zr=t=>{const{userId:n}=t,{data:s}=w(R.detail(n),()=>Qe(n));if(s==null)return e(C,{});const u=s.worker_ids;return u==null||(u==null?void 0:u.length)===0?e(x,{item:!0,md:12,lg:6,xl:4,children:e(h,{variant:"body1",children:"This user has no workers."})}):e(C,{children:u.map(a=>e(Nr,{workerId:a},a))})},[Vr,Qr,Zr]=In(),Jr=t=>t!=null&&"username"in t&&"id"in t,de=t=>{const n=bt(t.split("#"));return n==null?null:Pn(n)},Xr=()=>{var i;const t=D(),[n,s]=S.exports.useState(""),[u]=vt(n,400),{data:a}=w(R.all,_t),{data:d,refetch:c}=w(R.detail((i=de(u))!=null?i:-1),()=>{var l;return Qe((l=de(u))!=null?l:-1)},{enabled:!1});if(S.exports.useEffect(()=>{c()},[u]),a==null)return e(C,{});const p=(l,m)=>{var b;if(Pe(m)){const y=de(m);m!=="0"&&y!==0&&t(He((b=de(m))!=null?b:-1))}else Jr(m)&&m.id!==0&&t(He(m.id))};return e(we,{disablePortal:!0,options:[...d!=null?[d]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:l=>Pe(l)?l:l.username,isOptionEqualToValue:(l,m)=>l.id===m.id,renderInput:l=>e(A,{...l,variant:"standard",label:"User Lookup",size:"small"}),onChange:p,onInputChange:(l,m)=>{m!=="0"&&de(m)!==0&&s(m)}})},Yr=()=>{const t=v(o=>{var f;return(f=o.userPanel.selectedUser)!=null?f:-1}),n=Fe(),[s,u]=S.exports.useState("setFlagged"),[a,d]=S.exports.useState(!1),[c,p]=S.exports.useState(!1),i=w(R.detail(t),()=>Qe(t),{refetchInterval:1e3*15}),l=w($.check(t),()=>Er(t)),m=ae(o=>Tt(o.id,o.data),{onSuccess:(o,f)=>{n.invalidateQueries({queryKey:R.detail(f.id)})}}),b=ae(o=>Rr(o.id),{}),y=ae(o=>Hr(o.id,o.data),{onSuccess:(o,f)=>{n.invalidateQueries({queryKey:$.check(f.id)})}}),_=Qr();if(S.exports.useEffect(()=>{if(i.data!=null){const o={trusted:i.data.trusted,flagged:i.data.flagged,worker_invite:i.data.worker_invited.toString()};_.setValues(o),_.resetDirty(o)}},[i.isInitialLoading]),i.isLoading||l.isLoading)return e(g,{py:4,sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(fe,{})});if(i.data==null||l.data==null)return e(C,{});l.data.validated;const G=(o,f)=>{f!=="clickaway"&&d(!1)};return r(C,{children:[e(ce,{open:c,onClose:()=>p(!1),children:(o=>{switch(o){case"resetSuspicion":return r(C,{children:[r(U,{children:['Reset "',i.data.username,'" Suspicion']}),r(W,{children:[e(k,{onClick:()=>{p(!1)},children:"Cancel"}),e(k,{onClick:()=>{const f={reset_suspicion:!0};m.mutate({id:t,data:f}),p(!1)},children:"Confirm"})]})]});case"setFlagged":return r(C,{children:[r(U,{children:['Flag "',i.data.username,'" ratings and delete?']}),r(W,{children:[e(k,{onClick:()=>{p(!1)},children:"Cancel"}),e(k,{onClick:()=>{b.mutate({id:t}),p(!1)},children:"Confirm"})]})]});case"setValidated":return r(C,{children:[r(U,{children:['Set "',i.data.username,'" ratings as validated']}),r(W,{children:[e(k,{onClick:()=>{p(!1)},children:"Cancel"}),e(k,{onClick:async()=>{const f={validated:!0};await y.mutate({id:t,data:f}),p(!1)},children:"Confirm"})]})]});case"setUnvalidated":return r(C,{children:[r(U,{children:['Set "',i.data.username,'" ratings as unvalidated']}),r(W,{children:[e(k,{onClick:()=>{p(!1)},children:"Cancel"}),e(k,{onClick:async()=>{const f={validated:!1};await y.mutate({id:t,data:f}),p(!1)},children:"Confirm"})]})]})}})(s)}),e(ze,{open:a,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ve,{onClose:G,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(_n,{component:g,children:e(Fn,{size:"small",children:r(Tn,{children:[r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Username"})}),e(I,{align:"right",children:r(h,{variant:"body1",children:[i.data.username," ",i.data.moderator?"(moderator)":""]})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Trusted"})}),e(I,{align:"right",children:e(nt,{..._.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flagged"})}),e(I,{align:"right",children:e(nt,{..._.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Invites"})}),e(I,{align:"right",children:e(A,{variant:"standard",type:"number",..._.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Worker Count"})}),e(I,{align:"right",children:e(h,{variant:"body1",children:i.data.worker_count})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Kudos"})}),e(I,{align:"right",children:e(h,{variant:"body1",children:i.data.kudos})})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Suspicious"})}),r(I,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[e(h,{sx:{order:0},variant:"body1",children:i.data.suspicious}),i.data.suspicious>0?e(se,{onClick:async()=>{u("resetSuspicion"),p(!0)},loading:m.isLoading,variant:"contained",color:"error",sx:{ml:4},children:"Reset"}):null]})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Ratings Validated"})}),r(I,{align:"right",sx:{display:"flex",alignItems:"center"},children:[e(h,{sx:{order:1},variant:"body1",children:l.data.validated?"True":"False"}),e(se,{onClick:async()=>{l.data.validated?u("setUnvalidated"):u("setValidated"),p(!0)},loading:y.isLoading,variant:"contained",color:l.data.validated?"error":"success",sx:{order:0,ml:4},children:l.data.validated?"Unvalidate":"Validate"})]})]}),r(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(I,{component:"th",scope:"row",children:e(h,{variant:"body1",children:"Flag User Ratings"})}),e(I,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:e(se,{onClick:async()=>{u("setFlagged"),p(!0)},loading:b.isLoading,variant:"contained",color:"error",sx:{order:0},children:"Flag"})})]})]})})})]})},ea=()=>{const t=Fe(),n=v(p=>p.userPanel.selectedUser),[s,u]=S.exports.useState(!1),a=Zr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),d=ae(p=>Tt(p.id,p.data),{onSuccess:(p,i)=>{var m,b,y,_;t.setQueryData(R.detail(i.id),G=>G!=null?{...G,...p}:p);const l={trusted:(m=p.trusted)!=null?m:!1,flagged:(b=p.flagged)!=null?b:!1,worker_invite:(_=(y=p.worker_invite)==null?void 0:y.toString())!=null?_:"0"};ee(l)||(a.setValues(l),a.resetDirty(l)),u(!0)}}),c=(p,i)=>{i!=="clickaway"&&u(!1)};return r(Y,{elevation:1,sx:{p:2,height:"100%"},children:[e(ze,{open:s,autoHideDuration:6e3,onClose:c,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ve,{onClose:c,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((p,i)=>{if(n!=null){const l={trusted:p.trusted,flagged:p.flagged,worker_invite:parseInt(p.worker_invite)};d.mutate({id:n,data:l})}}),children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(Xr,{}),n!=null?e(g,{display:"flex",alignItems:"center",children:a.isDirty()?e(k,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null}):null]}),e(Vr,{form:a,children:e(g,{display:"flex",children:n!=null&&n!=-1?e(Yr,{}):null})})]})]})},ta=t=>{Fe();const{userId:n}=t;S.exports.useState(!1);const{data:s,isInitialLoading:u,isLoading:a}=w($.validate(n),()=>$r(n),{refetchInterval:1e3*15}),d=c=>e(g,{sx:{display:"flex"},children:r(h,{children:["r: ",c.rating,", a: ",c.artifacts,", avg: ",c.average,", n: ",c.times_rated]})});return a?e(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(fe,{})})}):s==null?e(C,{}):e(g,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:s.ratings.map(c=>r(pe,{children:[e("img",{src:c.image}),e(me,{title:d(c)})]},c.image_id))})})},na=()=>{const t=D(),n=v(a=>a.userPanel.selectedUser),s=v(a=>a.userPanel.expandedPanel),u=a=>(d,c)=>{(a==="workers"||a==="ratings")&&t(rr(c?a:!1))};return r(x,{container:!0,spacing:2,children:[e(x,{item:!0,md:12,lg:6,xl:4,children:e(ea,{})}),e(x,{item:!0,md:12,lg:12,xl:12,children:r(g,{children:[r(rt,{expanded:s==="workers",onChange:u("workers"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:e(h,{sx:{width:"33%",flexShrink:0},children:"Workers"})}),e(it,{sx:{backgroundColor:"background.default"},children:e(x,{container:!0,spacing:2,children:n!=null?e(zr,{userId:n}):null})})]}),r(rt,{expanded:s==="ratings",onChange:u("ratings"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:e(h,{sx:{width:"33%",flexShrink:0},children:"Ratings"})}),e(it,{sx:{backgroundColor:"background.default"},children:s==="ratings"&&n!=null?e(ta,{userId:n}):null})]})]})})]})},ra=()=>{const t=D(),n=v(c=>c.utilityPanel.ipAddr),{data:s,refetch:u,isFetching:a}=w(["deleteIpAddr",n],()=>Ir({ipaddr:n}),{enabled:!1,cacheTime:0});return e(Y,{elevation:1,sx:{p:2,height:"100%"},children:r(g,{children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Clear IP Timeout"}),e(se,{onClick:()=>{ee(n)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(A,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:c=>{t(ir(c.target.value))},placeholder:"Enter IP"}),s!=null?e(g,{pt:2,children:r(h,{variant:"body1",children:["Response: ",s.message]})}):null]})})},aa=()=>{const t=D(),n=v(c=>c.utilityPanel.prompt),{data:s,refetch:u,isFetching:a}=w(["promptCheck",n],()=>vr({filter_type:0,prompt:n}),{enabled:!1});return e(Y,{elevation:1,sx:{p:2,height:"100%"},children:r(g,{children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(h,{variant:"h4",children:"Prompt Checker"}),e(se,{onClick:()=>{ee(n)||u()},loading:a,variant:"contained",children:"Submit"})]}),e(A,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:c=>{t(sr(c.target.value))},placeholder:"Enter prompt"}),s!=null?r(g,{pt:2,children:[r(h,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(h,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},sa=()=>r(x,{container:!0,spacing:2,children:[e(x,{item:!0,md:12,lg:6,xl:4,children:e(aa,{})}),e(x,{item:!0,md:12,lg:6,xl:4,children:e(ra,{})})]}),ia=()=>{const t=v(d=>d.workerPanel.workerFilter),[n,s]=S.exports.useState(t!=null?t:""),[u]=vt(n,400),a=D();return S.exports.useEffect(()=>{a(dr(u))},[u]),e(A,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:n,onChange:d=>{s(d.target.value)}})},gt={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},la=()=>{const t=D(),n=v(l=>l.workerPanel.sortKey),s=v(l=>l.workerPanel.order),u=v(l=>l.workerPanel.workerFilter),a=v(l=>l.workerPanel.workerType),{data:d}=w(j.all,()=>Ze(),{refetchInterval:1e3*30,select:l=>{const m=u==null?void 0:u.toLowerCase();return Ie(l.filter(b=>{var y;return b.type!==a?!1:m==null?!0:b.name.toLowerCase().includes(m)||((y=b.owner)!=null?y:"").toLowerCase().includes(m)||b.id.toLowerCase().includes(m)||b.bridge_agent.toLowerCase().includes(m)}),[b=>{const y=b[n];return Pe(y)?n==="performance"&&parseFloat(y)?parseFloat(y):y.toLowerCase():y}],[s])}}),c=l=>{var b,y;const m=l.target.value;t(or(m)),t(ut((y=(b=Un(gt[m]))==null?void 0:b.parameter)!=null?y:"name"))},p=l=>{t(ut(l.target.value))},i=l=>{t(cr(l))};return d==null?e(C,{}):r(C,{children:[r(g,{display:"flex",justifyContent:"space-between",pb:2,children:[r(g,{display:"flex",alignItems:"center",children:[e(h,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(ia,{})]}),r(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(Le,{sx:{mr:1},children:[e(We,{children:"Worker Type"}),r(Ue,{value:a,label:"Worker Type",onChange:c,sx:{".MuiSelect-select":{py:1}},children:[e(z,{value:"image",children:"Image"}),e(z,{value:"interrogation",children:"Interrogation"}),e(z,{value:"text",children:"Text"})]})]}),r(Le,{sx:{mr:1},children:[e(We,{children:"Sort Key"}),e(Ue,{value:n,label:"Sort Key",onChange:p,sx:{".MuiSelect-select":{py:1}},children:gt[a].map(l=>e(z,{value:l.parameter,children:l.label},l.label))})]}),s==="asc"?e(E,{onClick:()=>i("desc"),children:e(Dn,{})}):e(E,{onClick:()=>i("asc"),children:e(On,{})})]})]}),e(x,{container:!0,spacing:2,children:d.map(l=>e(Ut,{worker:l},l.id))})]})},ft=()=>{const{data:t,isLoading:n,error:s}=w(["mode"],It);if(n)return e(h,{variant:"h6",children:"Loading Horde status ..."});if(t==null||s)return console.log("HordeStatus error",s),e(h,{variant:"h6",children:"Error loading Horde status"});const u=a=>a?e(lt,{sx:{color:J,ml:1}}):e(lt,{sx:{color:Be,ml:1}});return r(Se,{children:[r(q,{children:[e(Oe,{children:u(t.maintenance_mode)}),e(N,{primary:"Maintenance"})]}),r(q,{children:[e(Oe,{children:u(t.invite_only_mode)}),e(N,{primary:"Invite Only"})]}),t.raid_mode!=null?r(q,{children:[e(Oe,{children:u(t.raid_mode)}),e(N,{primary:"Raid"})]}):null]})},xt=()=>{const{data:t,isLoading:n,error:s}=w(["performance"],Pt);return n?e(h,{variant:"h6",children:"Loading Horde status ..."}):t==null||s?e(h,{variant:"h6",children:"Error loading Horde status"}):r(Se,{children:[e(q,{children:e(N,{primary:`Queued Requests: ${t.queued_requests}`})}),e(q,{children:e(N,{primary:`Queued MPS: ${t.queued_megapixelsteps}`})}),e(q,{children:e(N,{primary:`Past Minute MPS: ${t.past_minute_megapixelsteps}`})}),e(q,{children:e(N,{primary:`Workers: ${t.worker_count}`})})]})},ve=240,oa=()=>{const t=D(),n=v(u=>u.localState.sidebarOpen);return r(C,{children:[r(ot,{variant:"temporary",open:n,onClose:()=>{t(St(!n))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ve,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ve}},children:[e(Me,{}),r(g,{sx:{overflow:"auto"},children:[e(xt,{}),e(he,{}),e(ft,{})]})]}),r(ot,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ve,flexShrink:0,["& .MuiDrawer-paper"]:{width:ve,boxSizing:"border-box"}},children:[e(Me,{}),r(g,{sx:{overflow:"auto"},children:[e(xt,{}),e(he,{}),e(ft,{})]})]})]})},da=()=>{const t=D(),n=v(u=>u.persist.selectedTab);return r(g,{display:"flex",children:[e(oa,{}),e(g,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(Ln,{value:n,children:[e(g,{sx:{borderBottom:1,borderColor:"divider"},children:r(Wn,{onChange:(u,a)=>{a!="4"&&t(Re(!1)),t(wt(a))},"aria-label":"lab API tabs example",children:[e(Q,{label:"User Lookup",value:"1"}),e(Q,{label:"Workers",value:"2"}),e(Q,{label:"Comparator",value:"3"}),e(Q,{label:"Ratings",value:"4"}),e(Q,{label:"Utilities",value:"5"}),e(Q,{label:"Settings",value:"6"}),e(Q,{label:"About",value:"7"})]})}),e(Z,{value:"1",children:e(na,{})}),e(Z,{value:"2",children:e(la,{})}),e(Z,{value:"3",children:e(Ar,{})}),e(Z,{value:"4",children:e(jr,{})}),e(Z,{value:"5",children:e(sa,{})}),e(Z,{value:"6",children:e(Kr,{})}),e(Z,{value:"7",children:e(_r,{})})]})})]})},ke=()=>{const t=D(),n=v(u=>u.localState.sidebarOpen);return e(Mn,{position:"sticky",sx:{zIndex:u=>u.zIndex.drawer+1},children:r(Me,{children:[e(E,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{t(St(!n))},sx:{mr:2,display:{md:"none"}},children:e(An,{})}),r(h,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Horde Control Tower v","0.0.6"]}),null]})})},ca=async t=>{const n=window.document.createElement("canvas"),s=window.Image,u=(await Promise.allSettled([t].map(async d=>await new Promise((c,p)=>{let i;Gn(d,"src")?i=d:i={src:d};const l=new s;l.onerror=()=>p(new Error("Couldn't load image")),l.onload=()=>c({...i,img:l}),l.src=i.src,l.crossOrigin="anonymous"})))).filter(d=>d.status==="fulfilled").map(d=>d.value),a=n.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const d=c=>Math.max(...u.map(p=>{var i,l;return(l=(i=p==null?void 0:p.img)==null?void 0:i[c])!=null?l:0}));return n.width=d("width"),n.height=d("height"),u.forEach(c=>{var p,i;if(c!=null&&(a.globalAlpha=c.opacity!=null?c.opacity:1,c.img!=null))return a.drawImage(c.img,(p=c.x)!=null?p:0,(i=c.y)!=null?i:0)}),n.toDataURL("image/webp")}},ua=t=>{const{gen:n,...s}=t,u=D();return w(["check",n.id],()=>Cr(n.id),{refetchInterval:2e3,enabled:n.state==="check",onSuccess:a=>{if(n.state==="check"){let d=n.state;a.faulted?d="error":a.done&&(d="status"),u(Ce({...n,state:d,check:a}))}}}),w(["status",n.id],()=>Sr(n.id),{refetchInterval:!1,enabled:n.state==="status",onSuccess:async a=>{if(n.state==="status"){let d=n.state;if(a.faulted)d="error";else if(a.done){d="complete";const c=await ca(a.generations[0].img);a.generations[0].img=c}u(Ce({...n,state:d,status:a}))}}}),w(["delete",n.id],()=>wr(n.id),{refetchInterval:!1,retry:!1,enabled:n.state==="delete",onSuccess:async a=>{u(Ce({...n,state:"complete",status:a}))}}),e(C,{})},ha=()=>{const t=v(n=>n.persist.imageGens);return ee(t)?e(C,{}):e(C,{children:t.map(n=>e(ua,{gen:n},n.id))})},pa=()=>{const t=v(a=>a.persist.apikey),{data:n,refetch:s,isLoading:u}=w(["findUser"],()=>xr(t),{enabled:!ee(t),retry:1});return S.exports.useEffect(()=>{s()},[t]),u?r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(fe,{})})]}):ee(t)||n==null?r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),r(g,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(h,{variant:"h4",children:"Please enter your API key."}),e(Ot,{})]})]}):n.moderator?r(g,{sx:{display:"flex",flexDirection:"column"},children:[e(ha,{}),e(Pr,{}),e(ke,{}),e(da,{})]}):r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(h,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};X.prototype.__toHuman__=X.prototype.toHuman;X.prototype.toHuman=function(t={stripZeroUnits:"all"}){let n=this.normalize(),s=[],u=typeof t.precision=="object"?X.fromObject(t.precision):X.fromMillis(0),a=n;const d=["years","months","days","hours","minutes","seconds","milliseconds"];let c,p;t.smallestUnit&&(c=d.indexOf(t.smallestUnit)),t.biggestUnit&&(p=d.indexOf(t.biggestUnit)),(!c||!(c>=0&&c<d.length))&&(c=d.indexOf("seconds")),(!p||!(p<=c&&p<d.length))&&(p=d.indexOf("years"));for(let i of d.slice(p,c+1)){if(a.as(i)>=1){s.push(i);let m={};if(m[i]=Math.floor(a.as(i)),a=a.minus(X.fromObject(m)).normalize(),a<u)break}if(t.maxUnits&&s.length>=t.maxUnits)break}if(n=n.minus(a).normalize(),n=n.shiftTo(...s),t.stripZeroUnits=="all")s=s.filter(i=>n.values[i]>0);else if(t.stripZeroUnits=="end"){let i=!0;s=s.reverse().filter(l=>i?n.values[l]==0?!1:(i=!1,!0):!0)}return s.length||s.push(d[c]),n.shiftTo(...s).__toHuman__(t)};const ma=$n({key:"mui",prepend:!0}),ga=En({palette:{mode:"dark"}}),fa=new Rn({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});Hn(document.getElementById("root")).render(e(jn,{value:ma,children:r(Kn,{theme:ga,children:[e(Bn,{}),r(qn,{client:fa,children:[e(Nn,{store:xe,children:e(zn,{loading:null,persistor:gr,children:e(pa,{})})}),null]})]})}));
