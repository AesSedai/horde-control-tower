import{c as re,a as Rt,b as Ht,p as jt,d as Kt,e as Bt,s as qt,f as Nt,F as zt,R as Vt,P as Qt,g as Zt,h as Jt,i as Xt,j as Fe,u as w,k as e,l as v,B as g,m as te,n as r,T as p,L as Je,o as Yt,q as en,r as S,D as ue,t as L,v as he,w as De,x as Se,y as V,z as Xe,A as Q,C as E,E as C,G as H,I as K,H as tn,M as nn,J as Z,K as pe,N as rn,O as Ne,Q as me,S as xe,U as ge,V as se,W as an,X as sn,Y as f,Z as F,_ as ln,$ as on,a0 as Le,a1 as de,a2 as ae,a3 as we,a4 as Oe,a5 as ie,a6 as yt,a7 as Ie,a8 as dn,a9 as Pe,aa as bt,ab as We,ac as Ae,ad as cn,ae as un,af as hn,ag as Te,ah as ze,ai as Ve,aj as pn,ak as mn,al as G,am as gn,an as fn,ao as Ye,ap as et,aq as tt,ar as xn,as as yn,at as bn,au as vn,av as ee,aw as kn,ax as Cn,ay as Sn,az as wn,aA as ne,aB as In,aC as vt,aD as Pn,aE as _n,aF as Fn,aG as Tn,aH as z,aI as _,aJ as nt,aK as rt,aL as at,aM as st,aN as it,aO as Dn,aP as On,aQ as Un,aR as Ue,aS as lt,aT as ot,aU as Me,aV as Ln,aW as Wn,aX as J,aY as X,aZ as An,a_ as Mn,a$ as Gn,b0 as En,b1 as $n,b2 as Rn,b3 as Hn,b4 as jn,b5 as Kn,b6 as Bn,b7 as qn,b8 as Nn,b9 as zn}from"./vendor.0884a784.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))d(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&d(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}})();const Vn={reload:!1,selectedModel:null,selectedWorkers:[],genForm:{prompt:"",params:{sampler_name:"k_euler",toggles:[1,4],cfg_scale:7,seed:"",height:512,width:512,seed_variation:1,post_processing:[],karras:!0,tiling:!1,hires_fix:!1,clip_skip:1,steps:20,n:1},nsfw:!0,trusted_workers:!1,censor_nsfw:!1,workers:[],models:[],r2:!0,shared:!0}},Ge=re({name:"comparatorPanel",initialState:Vn,reducers:{setSelectedModel:(t,n)=>{t.selectedModel=n.payload},setSelectedWorkers:(t,n)=>{t.selectedWorkers=n.payload},setGenForm:(t,n)=>{t.genForm=structuredClone(n.payload)},setReload:(t,n)=>{t.reload=n.payload}}}),{setSelectedModel:dt,setSelectedWorkers:be,setGenForm:kt,setReload:Ct}=Ge.actions,Qn={sidebarOpen:!1},Ee=re({name:"localState",initialState:Qn,reducers:{setSidebarOpen:(t,n)=>{t.sidebarOpen=n.payload}}}),{setSidebarOpen:St}=Ee.actions,$e={apikey:"",selectedTab:"1",genFavorites:[],imageGens:[]},fe=re({name:"persist",initialState:$e,reducers:{setKey:(t,n)=>{t.apikey=n.payload},setSelectedTab:(t,n)=>{t.selectedTab=n.payload},resetImageGens:t=>{t.imageGens=[]},addImageGen:(t,n)=>{t.imageGens.find(d=>d.id===n.payload.id)||t.imageGens.push(n.payload)},updateImageGen:(t,n)=>{const s=t.imageGens.findIndex(d=>d.id===n.payload.id);s!=null&&(t.imageGens[s]=n.payload)},addGenFavorite:(t,n)=>{t.genFavorites.push(n.payload)},updateGenFavorite:(t,n)=>{t.genFavorites[n.payload.idx]={name:t.genFavorites[n.payload.idx].name,form:n.payload.form}},deleteGenFavorite:(t,n)=>{t.genFavorites.splice(n.payload)},resetExceptApiKey:t=>(t={...$e,apikey:t.apikey},t)}}),{setKey:Zn,setSelectedTab:wt,resetImageGens:ct,addImageGen:Jn,updateImageGen:Ce,addGenFavorite:Xn,resetExceptApiKey:ya,updateGenFavorite:Yn,deleteGenFavorite:er}=fe.actions,tr={showPassword:!1},Re=re({name:"settingsPanel",initialState:tr,reducers:{setShowPassword:(t,n)=>{t.showPassword=n.payload}}}),{setShowPassword:He}=Re.actions,nr={expandedPanel:"workers"},_e=re({name:"userPanel",initialState:nr,reducers:{setUser:(t,n)=>{t.selectedUser=n.payload},setExpandedPanel:(t,n)=>{t.expandedPanel=n.payload}}}),{setUser:je,setExpandedPanel:rr}=_e.actions,ar={prompt:"",ipAddr:""},Ke=re({name:"utilityPanel",initialState:ar,reducers:{setPrompt:(t,n)=>{t.prompt=n.payload},setIpAddr:(t,n)=>{t.ipAddr=n.payload}}}),{setPrompt:sr,setIpAddr:ir}=Ke.actions,lr={workerType:"image",sortKey:"name",order:"asc"},Be=re({name:"workerPanel",initialState:lr,reducers:{setWorkerType:(t,n)=>{t.workerType=n.payload},setWorkerFilter:(t,n)=>{t.workerFilter=n.payload},setSortKey:(t,n)=>{t.sortKey=n.payload},setOrder:(t,n)=>{t.order=n.payload}}}),{setWorkerType:or,setWorkerFilter:dr,setSortKey:ut,setOrder:cr}=Be.actions,ur=Rt((t,n)=>t,(t,n)=>Object.assign({},$e,t),{whitelist:[fe.name]}),hr={key:"root",storage:Nt,whitelist:[fe.name,_e.name],transforms:[ur]},pr=Ht({[fe.name]:fe.reducer,[Ee.name]:Ee.reducer,[Re.name]:Re.reducer,[_e.name]:_e.reducer,[Ke.name]:Ke.reducer,[Be.name]:Be.reducer,[Ge.name]:Ge.reducer}),mr=jt(hr,pr),ye=Kt({reducer:mr,middleware:t=>t({serializableCheck:{ignoredActions:[zt,Vt,Qt,Zt,Jt,Xt]}}),devTools:!1}),gr=Bt(ye);qt(ye.dispatch);const D=Fe.create({baseURL:"https://aihorde.net/api/v2/"});D.interceptors.request.use(function(t){const n=ye.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.7"),t},function(t){return Promise.reject(t)});const fr=Fe.create({baseURL:"/horde-control-tower/"}),le=Fe.create({baseURL:"https://ratings.aihorde.net/api/v1/"});le.interceptors.request.use(function(t){const n=ye.getState().persist.apikey;return t.headers!=null&&(n!=null&&(t.headers.apikey=n),t.headers["Client-Agent"]="HordeControlTower/0.0.7"),t},function(t){return Promise.reject(t)});const xr=t=>D.get("find_user",{headers:{apikey:t}}).then(n=>n.data),It=()=>D.get("status/modes").then(t=>t.data),Pt=()=>D.get("status/performance").then(t=>t.data),_t=()=>fr.get("users.json").then(t=>t.data),Qe=t=>D.get(`users/${t}`).then(n=>n.data),Ze=()=>D.get("workers").then(t=>t.data),yr=t=>D.get(`workers/${t}`).then(n=>n.data),Ft=()=>D.get("status/models").then(t=>t.data),Tt=(t,n)=>D.put(`users/${t}`,n).then(s=>s.data),br=(t,n)=>D.put(`workers/${t}`,n).then(s=>s.data),vr=t=>D.post("filters",t).then(n=>n.data),kr=t=>D.post("generate/async",t).then(n=>n.data),Cr=t=>D.get(`generate/check/${t}`).then(n=>n.data),Sr=t=>D.get(`generate/status/${t}`).then(n=>n.data),wr=t=>D.delete(`generate/status/${t}`).then(n=>n.data),Ir=t=>D.delete("operations/ipaddr",{data:t}).then(n=>n.data),B={all:["users"],lists:()=>[...B.all,"list"],list:t=>[...B.lists(),{filters:t}],details:()=>[...B.all,"detail"],detail:t=>[...B.details(),t]},q={all:["workers"],lists:()=>[...q.all,"list"],list:t=>[...q.lists(),{filters:t}],details:()=>[...q.all,"detail"],detail:t=>[...q.details(),t]},Pr=()=>(w(B.all,_t,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["performance"],Pt,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["mode"],It,{staleTime:1e3*30,refetchInterval:1e3*30}),w(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30}),e(v,{})),_r=()=>e(g,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e(te,{elevation:1,sx:{p:2,height:"100%",minWidth:"400px"},children:r(g,{children:[e(p,{variant:"h4",textAlign:"center",children:"About"}),r(p,{variant:"body1",children:["Horde Control Tower is an open source"," ",e(Je,{href:"https://aihorde.net/",target:"_blank",rel:"noreferrer",children:"AI Horde"})," ","moderation utility developed by AesSedai (Aes Sedai#5565)."]}),r(p,{variant:"body1",children:["The project source is available on"," ",e(Je,{href:"https://github.com/AesSedai/horde-control-tower",target:"_blank",rel:"noreferrer",children:"Github"})]})]})})}),U=()=>en(),k=Yt,Fr=()=>{const t=U(),n=k(T=>T.comparatorPanel.genForm),s=k(T=>T.persist.genFavorites),[d,a]=S.exports.useState(!1),[l,o]=S.exports.useState(-1),[m,u]=S.exports.useState(!1),[i,h]=S.exports.useState(-1),[b,y]=S.exports.useState(!1),[W,$]=S.exports.useState(""),[A,c]=S.exports.useState(null),x=Boolean(A),O=T=>{c(T.currentTarget)},M=()=>{c(null)},I=()=>{y(!1)},P=()=>{t(Xn({name:W,form:n})),$(""),y(!1)},oe=()=>{o(-1),a(!1)},Lt=()=>{t(Yn({idx:l,form:n})),o(-1),a(!1)},Wt=()=>{h(-1),u(!1)},At=()=>{t(er(i)),h(-1),u(!1)},Mt=T=>{t(kt(T)),t(Ct(!0)),c(null)},Gt=()=>{y(!0),c(null)},Et=()=>{a(!0),c(null)},$t=()=>{u(!0),c(null)};return r(v,{children:[r(ue,{open:m,onClose:oe,children:[e(L,{children:"Delete Preset"}),r(he,{children:[e(De,{children:"Select a preset to delete."}),e(Se,{children:s.map((T,N)=>e(V,{disablePadding:!0,sx:{backgroundColor:i===N?"error.dark":""},onClick:()=>{h(N)},children:e(Xe,{children:e(Q,{primary:T.name})})},N))})]}),r(E,{children:[e(C,{onClick:Wt,children:"Cancel"}),e(C,{disabled:i===-1,onClick:At,children:"Select"})]})]}),r(ue,{open:d,onClose:oe,children:[e(L,{children:"Overwrite Preset"}),r(he,{children:[e(De,{children:"Select a preset to overwrite."}),e(Se,{children:s.map((T,N)=>e(V,{disablePadding:!0,sx:{backgroundColor:l===N?"success.dark":""},onClick:()=>{o(N)},children:e(Xe,{children:e(Q,{primary:T.name})})},N))})]}),r(E,{children:[e(C,{onClick:oe,children:"Cancel"}),e(C,{disabled:l===-1,onClick:Lt,children:"Select"})]})]}),r(ue,{open:b,onClose:I,children:[e(L,{children:"Add New Preset"}),r(he,{children:[e(De,{children:"Enter a friendly name for this new preset."}),e(H,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,variant:"standard",value:W,onChange:T=>{$(T.target.value)}})]}),r(E,{children:[e(C,{onClick:I,children:"Cancel"}),e(C,{onClick:P,children:"Create"})]})]}),e(K,{onClick:O,children:e(tn,{})}),r(nn,{anchorEl:A,open:x,onClose:M,children:[s.map((T,N)=>e(Z,{onClick:()=>{Mt(T.form)},children:T.name},N)),s.length>0?e(pe,{}):null,s.length>0?e(Z,{onClick:$t,children:"Delete Preset"}):null,s.length>0?e(pe,{}):null,s.length>0?e(Z,{onClick:Et,children:"Overwrite Preset"}):null,s.length>0?e(pe,{}):null,e(Z,{onClick:Gt,children:"Add New Preset"})]})]})},Tr=()=>{const t=k(a=>a.persist.imageGens),{data:n}=w(q.all,()=>Ze(),{refetchInterval:1e3*30,select:a=>rn(a.map(l=>[l.id,l.name]))}),s=a=>{var o,m,u;const l=a.status!=null?a.status:a.check;return a.state!=="complete"&&l!=null?r(me,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(xe,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),e(ge,{title:n==null?"":n[(o=a.payload.workers[0])!=null?o:""],subtitle:`Position: ${l.queue_position}, wait time: ${l.wait_time}`})]},a.id):a.state==="complete"?d(a).length===0?r(me,{sx:{paddingTop:"100%",border:"1px solid black"},children:[e(p,{variant:"h3",sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:"Canceled"}),e(ge,{title:n==null?"":n[(m=a.payload.workers[0])!=null?m:""]})]},a.id):r(me,{sx:{paddingTop:d(a).length>0?"0%":"100%",border:"1px solid black"},children:[e("img",{src:d(a)}),e(ge,{title:n==null?"":n[(u=a.payload.workers[0])!=null?u:""]})]},a.id):e(v,{})},d=a=>a.status!=null&&a.status.generations.length>0?a.status.generations[0].img:"";return e(g,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:4,children:t.map(a=>s(a))})})},Dr=["GFPGAN","RealESRGAN_x4plus","CodeFormers"],Or=["k_lms","k_heun","k_euler","k_euler_a","k_dpm_2","k_dpm_2_a","k_dpm_fast","k_dpm_adaptive","k_dpmpp_2m","k_dpmpp_2s_a","k_dpmpp_sde"],R="175px",Ur=()=>{const t=U(),n=k(c=>c.comparatorPanel.selectedWorkers),s=k(c=>c.comparatorPanel.selectedModel),d=k(c=>c.comparatorPanel.genForm),a=k(c=>c.persist.imageGens),l=k(c=>c.persist.imageGens.length>0),o=k(c=>c.comparatorPanel.reload),m=k(c=>c.persist.imageGens.some(x=>["pending","check"].includes(x.state))),{mutate:u}=se({mutationFn:kr,onSuccess:(c,x,O)=>{t(Jn({id:c.id,payload:x,state:"check",check:null,status:null}))}}),{handleSubmit:i,control:h,formState:{errors:b},watch:y,setValue:W,reset:$}=an({defaultValues:d}),A=c=>{s!=null&&n.length>0&&(t(ct()),n.forEach(x=>{const O={...c,workers:[x.id],models:[s.name]};u(O)}))};return S.exports.useEffect(()=>{const c=y(sn((x,{name:O,type:M})=>{t(kt(x))},300));return()=>c.unsubscribe()},[y]),S.exports.useEffect(()=>{o&&(t(Ct(!1)),$(d))},[o]),e(g,{children:r("form",{onSubmit:i(A),children:[r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Prompt"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"prompt",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(H,{fullWidth:!0,required:!0,multiline:!0,placeholder:"Enter prompt here",...c})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Seed"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.seed",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(H,{fullWidth:!0,placeholder:"Seed",...c})})}),e(f,{item:!0,children:e(K,{"aria-label":"randomize seed",onClick:()=>{W("params.seed",ln(1e8,999999999).toString())},children:e(on,{})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Sampler"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.sampler_name",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Le,{...c,fullWidth:!0,children:Or.map(x=>e(Z,{value:x,children:x},x))})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Steps"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.steps",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:100,...c})})}),e(F,{name:"params.steps",control:h,render:({field:c})=>e(f,{item:!0,children:e(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:100,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Width"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.width",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...c})})}),e(F,{name:"params.width",control:h,render:({field:c})=>e(f,{item:!0,children:e(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Height"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.height",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:64,min:64,max:1024,...c})})}),e(F,{name:"params.height",control:h,render:({field:c})=>e(f,{item:!0,children:e(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:64,min:64,max:1024,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"CFG"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.cfg_scale",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:24,...c})})}),e(F,{name:"params.cfg_scale",control:h,render:({field:c})=>e(f,{item:!0,children:e(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:24,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Clip Skip"}),r(f,{container:!0,spacing:2,alignItems:"center",children:[e(F,{name:"params.clip_skip",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(de,{valueLabelDisplay:"auto",marks:!0,step:1,min:1,max:12,...c})})}),e(F,{name:"params.clip_skip",control:h,render:({field:c})=>e(f,{item:!0,children:e(ae,{type:"number",sx:{width:"60px",ml:1},inputProps:{step:1,min:1,max:12,type:"number"},...c,onChange:x=>{c.onChange(parseInt(x.target.value))}})})})]})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Post-Processors"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.post_processing",control:h,render:({field:{onChange:c,onBlur:x,value:O,name:M,ref:I}})=>e(f,{item:!0,xs:!0,children:e(we,{fullWidth:!0,multiple:!0,onBlur:x,ref:I,value:O,onChange:(P,oe)=>{c(oe)},options:Dr,getOptionLabel:P=>P,renderInput:P=>e(H,{...P})})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"High Res Fix"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.hires_fix",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Oe,{...c,checked:c.value})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Karras"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.karras",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Oe,{...c,checked:c.value})})})})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:R},children:"Tiling"}),e(f,{container:!0,spacing:2,alignItems:"center",children:e(F,{name:"params.tiling",control:h,render:({field:c})=>e(f,{item:!0,xs:!0,children:e(Oe,{...c,checked:c.value})})})})]}),e(ie,{type:"submit",loading:m,variant:"contained",children:"Submit"}),m?e(C,{sx:{ml:2},color:"error",variant:"contained",onClick:()=>{a.filter(c=>["pending","check"].includes(c.state)).forEach(c=>{t(Ce({...c,state:"delete"}))})},children:"Cancel"}):null,l?e(C,{sx:{ml:2},variant:"contained",onClick:()=>{t(ct())},children:"Clear Output"}):null]})})},Lr=t=>t!=null&&"name"in t,Wr=t=>t!=null&&yt(t)&&"name"in t[0]&&"id"in t[0],ht="175px",Ar=()=>{const t=U(),n=k(u=>u.comparatorPanel.selectedWorkers),s=k(u=>u.comparatorPanel.selectedModel),d=(u,i)=>{yt(i)&&i.length===0?t(be([])):Wr(i)&&t(be(i))},a=(u,i)=>{i==null?t(dt(null)):Lr(i)&&t(dt(i))},{data:l}=w(q.all,()=>Ze(),{refetchInterval:1e3*30,select:u=>Ie(u,[i=>i.name.toLowerCase()],["asc"])}),{data:o}=w(["models"],Ft,{staleTime:1e3*30,refetchInterval:1e3*30,select:u=>Ie(u,[i=>i.name.toLowerCase()],["asc"])});S.exports.useEffect(()=>{if(s!=null&&n.length>0){const u=n.map(b=>b.id),i=n.filter(b=>{var y;return(y=b==null?void 0:b.models)==null?void 0:y.includes(s.name)}),h=i.map(b=>b.id);dn(u,h)||t(be(i))}else s==null&&n.length>0&&t(be([]))},[l,o,n,s]);const m=(l!=null?l:[]).filter(u=>{var i;return s==null?!0:(i=u==null?void 0:u.models)==null?void 0:i.includes(s.name)});return r(g,{children:[r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:ht},children:"Model"}),e(we,{fullWidth:!0,disablePortal:!0,options:o!=null?o:[],blurOnSelect:!0,value:s,autoHighlight:!0,getOptionLabel:u=>Pe(u)?u:u.name,isOptionEqualToValue:(u,i)=>u.name===i.name,filterSelectedOptions:!0,renderInput:u=>e(H,{...u,label:"Selected Model"}),onChange:a})]}),r(g,{sx:{display:"flex",alignItems:"center",py:1},children:[e(p,{variant:"body1",sx:{width:ht},children:"Workers"}),e(we,{fullWidth:!0,multiple:!0,disablePortal:!0,options:m,value:n,getOptionLabel:u=>u.name,isOptionEqualToValue:(u,i)=>u.id===i.id,filterSelectedOptions:!0,renderInput:u=>e(H,{...u,label:"Selected Workers"}),onChange:d})]})]})},Mr=()=>r(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,xl:4,children:r(te,{sx:{p:2},children:[r(g,{sx:{position:"relative"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Generation Settings"}),e(g,{sx:{position:"absolute",top:0,right:0},children:e(Fr,{})})]}),e(Ar,{}),e(Ur,{})]})}),e(f,{item:!0,xs:12,xl:8,children:r(te,{sx:{p:2,height:"100%"},children:[e(p,{align:"center",variant:"h4",sx:{pb:1},children:"Output"}),e(Tr,{})]})})]}),Dt={format:"json",limit:100},Gr=t=>le.get("user/ratings",{params:Object.assign({},Dt,t)}).then(n=>n.data),Er=(t,n)=>le.get(`user/validate/${t}`,{params:Object.assign({},Dt,n)}).then(s=>s.data),$r=t=>le.get(`user/check/${t}`).then(n=>n.data),Rr=t=>le.post(`user/flag/${t}`).then(n=>n.data),Hr=(t,n)=>le.post(`user/modify/${t}`,n).then(s=>s.data),j={all:["ratings"],lists:()=>[...j.all,"list"],list:t=>[...j.lists(),{filters:t}],details:()=>[...j.all,"detail"],detail:t=>[...j.details(),t],validates:()=>[...j.all,"validate"],validate:t=>[...j.validates(),t],checks:()=>[...j.all,"check"],check:t=>[...j.checks(),t]},jr=()=>{const{data:t,isLoading:n}=w(["user/ratings"],()=>Gr()),s=U();if(n)return e(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(xe,{})})});const d=l=>{const o=bt(l.username.split("#"));o!=null&&(s(je(parseInt(o))),s(wt("1")))},a=l=>r(g,{sx:{display:"flex"},children:[e(p,{sx:{textDecoration:"underline"},onClick:()=>d(l),children:l.username}),r(p,{children:["\xA0- r: ",l.rating,", a: ",l.artifacts,", avg: ",l.average,", n: ",l.times_rated]})]});return t==null?e(v,{}):e(g,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:t.ratings.map(l=>r(me,{children:[e("img",{src:l.image}),e(ge,{title:a(l)})]},l.image_id))})})},Ot=()=>{const t=U(),n=k(a=>a.persist.apikey),s=k(a=>a.settingsPanel.showPassword);return r(We,{sx:{m:1,width:"35ch"},variant:"standard",children:[e(Ae,{children:"API Key"}),e(ae,{defaultValue:n,onBlur:a=>{t(Zn(a.target.value)),t(He(!1))},type:s?"text":"password",endAdornment:e(cn,{position:"end",children:e(K,{onClick:()=>t(He(!s)),children:s?e(un,{}):e(hn,{})})})})]})},Kr=()=>e(f,{container:!0,spacing:2,children:e(f,{item:!0,md:12,lg:6,xl:4,children:e(te,{children:e(Ot,{})})})}),qe="#0583B0",Y="#FF6962",Br="#7c0500",qr="#ef9b0f",pt=t=>t.type==="image"&&parseFloat(t.performance)>3,mt=t=>t.type==="image"&&parseFloat(t.performance)<.4,Ut=t=>{var A,c;const{worker:n}=t,s=Te(),[d,a]=S.exports.useState(!1),[l,o]=S.exports.useState(!1),[m,u]=S.exports.useState("setFlagged"),[i,h]=S.exports.useState(""),b=x=>x.maintenance_mode||x.paused||x.flagged?Br:pt(x)||mt(x)?qr:"background.paper",y=se(x=>br(x.id,x.data),{onSuccess:(x,O)=>{a(!0),s.invalidateQueries({queryKey:q.detail(O.id)}),s.invalidateQueries({queryKey:q.all})}}),W=(x,O)=>{O!=="clickaway"&&a(!1)};return r(v,{children:[e(ue,{open:l,onClose:()=>o(!1),children:(x=>{var O;switch(x){case"setFlagged":return r(v,{children:[r(L,{children:['Set "',n.name,'" as Flagged']}),r(E,{children:[e(C,{onClick:()=>{o(!1)},children:"Cancel"}),e(C,{onClick:()=>{o(!1)},children:"Confirm"})]})]});case"unsetFlagged":return r(v,{children:[r(L,{children:['Unset "',n.name,'" as Flagged']}),r(E,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{o(!1)},children:"Confirm"})]})]});case"setMaintenance":return r(v,{children:[r(L,{children:['Set "',n.name,'" Maintenance Mode']}),e(he,{children:e(H,{value:i,onChange:M=>{h(M.target.value)},multiline:!0,autoFocus:!0,margin:"dense",id:"name",label:"Maintenance Reason (optional)",fullWidth:!0,variant:"standard"})}),r(E,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{const M={maintenance:!0};ne(i)||(M.maintenance_msg=i),y.mutate({id:n.id,data:M}),o(!1)},children:"Confirm"})]})]});case"unsetMaintenance":return r(v,{children:[r(L,{children:['Unset "',n.name,'" Maintenance Mode']}),r(E,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{maintenance:!1,maintenance_msg:""}}),o(!1)},children:"Confirm"})]})]});case"setPaused":return r(v,{children:[r(L,{children:['Set "',n.name,'" Paused Mode']}),r(E,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{paused:!0}}),o(!1)},children:"Confirm"})]})]});case"unsetPaused":return r(v,{children:[r(L,{children:['Unset "',n.name,'" Paused Mode']}),r(E,{children:[e(C,{onClick:()=>o(!1),children:"Cancel"}),e(C,{onClick:()=>{y.mutate({id:n.id,data:{paused:!1}}),o(!1)},children:"Confirm"})]})]});case"listModels":return r(v,{children:[r(L,{children:['"',n.name,'" Models']}),e(he,{children:e(p,{variant:"body1",children:Ie((O=n==null?void 0:n.models)!=null?O:[],[M=>M.toLowerCase()]).join(", ")})})]})}})(m)}),e(ze,{open:d,autoHideDuration:6e3,onClose:W,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ve,{onClose:W,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(f,{item:!0,xs:12,lg:6,xl:3,children:r(pn,{sx:{backgroundColor:b(n)},children:[e(mn,{sx:{".MuiCardHeader-action":{alignSelf:"center"}},avatar:n.online&&!n.paused&&!n.maintenance_mode&&!n.flagged?e(G,{title:"Worker Online",children:e(gn,{sx:{color:qe}})}):e(G,{title:"Worker Issue",children:e(fn,{sx:{color:Y}})}),action:r(g,{children:[mt(n)?e(G,{title:"Worker Low Speed Warning",children:e(Ye,{sx:{color:Y,mt:.5,mr:1,transform:"scaleX(-1)"}})}):null,pt(n)?e(G,{title:"Worker High Speed Warning",children:e(Ye,{sx:{color:Y,mt:.5,mr:1}})}):null,n.paused?e(G,{title:"Worker Paused",children:e(et,{sx:{color:Y,mt:.5,mr:1}})}):null,n.maintenance_mode?e(G,{title:"Worker Maintenance",children:e(tt,{sx:{color:Y,mt:.5,mr:1}})}):null,n.flagged?e(G,{title:"User Flagged",children:e(xn,{sx:{color:Y,mt:.5,mr:1}})}):null,n.trusted?e(G,{title:"Trusted Worker",children:e(yn,{sx:{color:qe,mt:.5,mr:1}})}):null]}),title:e(p,{variant:"h5",children:bn(n.name,{length:30})}),subheader:n.id}),r(vn,{children:[r(p,{variant:"body2",children:["Full Name: ",n.name]}),r(p,{variant:"body2",children:["Owner: ",n.owner]}),r(p,{variant:"body2",children:["Bridge Agent: ",n.bridge_agent]}),r(p,{variant:"body2",children:["Uptime: ",ee.fromObject({seconds:n.uptime}).toHuman()]}),n.type!=="interrogation"?r(p,{variant:"body2",children:["Models Loaded: ",(c=(A=n==null?void 0:n.models)==null?void 0:A.length)!=null?c:"None"]}):null,n.type==="image"?r(p,{variant:"body2",children:["MPS Generated: ",n.megapixelsteps_generated]}):null,r(p,{variant:"body2",children:["Speed: ",n.performance]}),r(p,{variant:"body2",children:["Threads: ",n.threads]}),r(p,{variant:"body2",children:["Requests Fulfilled: ",n.requests_fulfilled]}),r(p,{variant:"body2",children:["NSFW: ",n.nsfw?"true":"false"]})]}),r(kn,{disableSpacing:!0,children:[e(G,{title:"Show Worker Models",children:e(K,{onClick:()=>{u("listModels"),o(!0)},children:e(Cn,{})})}),n.maintenance_mode?e(G,{title:"Unset Worker Maintenance",children:e(K,{onClick:()=>{u("unsetMaintenance"),o(!0)},children:e(Sn,{})})}):e(G,{title:"Set Worker Maintenance",children:e(K,{onClick:()=>{u("setMaintenance"),o(!0)},children:e(tt,{})})}),n.paused?e(G,{title:"Unset Worker Pause",children:e(K,{onClick:()=>{u("unsetPaused"),o(!0)},children:e(wn,{})})}):e(G,{title:"Set Worker Pause",children:e(K,{onClick:()=>{u("setPaused"),o(!0)},children:e(et,{})})})]})]})},n.id)]})},Nr=t=>{const{workerId:n}=t,{data:s}=w(q.detail(n),()=>yr(n),{staleTime:1e3*61,select:d=>({...d,performance:d.performance.replace(" megapixelsteps per second","")})});return s==null?e(v,{}):e(Ut,{worker:s})},zr=t=>{const{userId:n}=t,{data:s}=w(B.detail(n),()=>Qe(n));if(s==null)return e(v,{});const d=s.worker_ids;return d==null||(d==null?void 0:d.length)===0?e(f,{item:!0,md:12,lg:6,xl:4,children:e(p,{variant:"body1",children:"This user has no workers."})}):e(v,{children:d.map(a=>e(Nr,{workerId:a},a))})},[Vr,Qr,Zr]=In(),Jr=t=>t!=null&&"username"in t&&"id"in t,ce=t=>{const n=bt(t.split("#"));return n==null?null:Pn(n)},Xr=()=>{var u;const t=U(),[n,s]=S.exports.useState(""),[d]=vt(n,400),{data:a}=w(B.all,_t),{data:l,refetch:o}=w(B.detail((u=ce(d))!=null?u:-1),()=>{var i;return Qe((i=ce(d))!=null?i:-1)},{enabled:!1});if(S.exports.useEffect(()=>{o()},[d]),a==null)return e(v,{});const m=(i,h)=>{var b;if(Pe(h)){const y=ce(h);h!=="0"&&y!==0&&t(je((b=ce(h))!=null?b:-1))}else Jr(h)&&h.id!==0&&t(je(h.id))};return e(we,{disablePortal:!0,options:[...l!=null&&l.id>4769?[l]:[],...a!=null?a:[]],sx:{width:300},blurOnSelect:!0,autoHighlight:!0,freeSolo:!0,loading:a==null,loadingText:"Loading users...",getOptionLabel:i=>Pe(i)?i:i.username,isOptionEqualToValue:(i,h)=>i.id===h.id,renderInput:i=>e(H,{...i,variant:"standard",label:"User Lookup",size:"small"}),onChange:m,onInputChange:(i,h)=>{h!=="0"&&ce(h)!==0&&s(h)}})},Yr=()=>{var M;const t=k(I=>{var P;return(P=I.userPanel.selectedUser)!=null?P:-1}),n=Te(),[s,d]=S.exports.useState("setFlagged"),[a,l]=S.exports.useState(!1),[o,m]=S.exports.useState(!1),[u,i]=S.exports.useState(!1),h=w(B.detail(t),()=>Qe(t),{refetchInterval:1e3*15}),b=w(j.check(t),()=>$r(t),{enabled:!u,onError:I=>i(!0),refetchInterval:1e3*15}),y=se(I=>Tt(I.id,I.data),{onSuccess:(I,P)=>{n.invalidateQueries({queryKey:B.detail(P.id)})}}),W=se(I=>Rr(I.id),{}),$=se(I=>Hr(I.id,I.data),{onSuccess:(I,P)=>{n.invalidateQueries({queryKey:j.check(P.id)})}}),A=Qr();if(S.exports.useEffect(()=>{if(h.data!=null){const I={trusted:h.data.trusted,flagged:h.data.flagged,worker_invite:h.data.worker_invited.toString()};A.setValues(I),A.resetDirty(I)}},[h.isInitialLoading]),h.isLoading)return e(g,{py:4,sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(xe,{})});if(h.data==null)return e(v,{});const c=(M=b.data)!=null?M:null,x=(I,P)=>{P!=="clickaway"&&l(!1)};return r(v,{children:[e(ue,{open:o,onClose:()=>m(!1),children:(I=>{switch(I){case"resetSuspicion":return r(v,{children:[r(L,{children:['Reset "',h.data.username,'" Suspicion']}),r(E,{children:[e(C,{onClick:()=>{m(!1)},children:"Cancel"}),e(C,{onClick:()=>{const P={reset_suspicion:!0};y.mutate({id:t,data:P}),m(!1)},children:"Confirm"})]})]});case"setFlagged":return r(v,{children:[r(L,{children:['Flag "',h.data.username,'" ratings and delete?']}),r(E,{children:[e(C,{onClick:()=>{m(!1)},children:"Cancel"}),e(C,{onClick:()=>{W.mutate({id:t}),m(!1)},children:"Confirm"})]})]});case"setValidated":return r(v,{children:[r(L,{children:['Set "',h.data.username,'" ratings as validated']}),r(E,{children:[e(C,{onClick:()=>{m(!1)},children:"Cancel"}),e(C,{onClick:async()=>{const P={validated:!0};await $.mutate({id:t,data:P}),m(!1)},children:"Confirm"})]})]});case"setUnvalidated":return r(v,{children:[r(L,{children:['Set "',h.data.username,'" ratings as unvalidated']}),r(E,{children:[e(C,{onClick:()=>{m(!1)},children:"Cancel"}),e(C,{onClick:async()=>{const P={validated:!1};await $.mutate({id:t,data:P}),m(!1)},children:"Confirm"})]})]})}})(s)}),e(ze,{open:a,autoHideDuration:6e3,onClose:x,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ve,{onClose:x,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),e(_n,{component:g,children:e(Fn,{size:"small",children:r(Tn,{children:[r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Username"})}),e(_,{align:"right",children:r(p,{variant:"body1",children:[h.data.username," ",h.data.moderator?"(moderator)":""]})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Trusted"})}),e(_,{align:"right",children:e(nt,{...A.getInputProps("trusted",{type:"checkbox"}),size:"small"})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Flagged"})}),e(_,{align:"right",children:e(nt,{...A.getInputProps("flagged",{type:"checkbox"}),size:"small"})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Invites"})}),e(_,{align:"right",children:e(H,{variant:"standard",type:"number",...A.getInputProps("worker_invite"),sx:{maxWidth:"100px"},InputProps:{inputProps:{min:0},sx:{"& input":{p:"0",textAlign:"right"}}}})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Worker Count"})}),e(_,{align:"right",children:e(p,{variant:"body1",children:h.data.worker_count})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Kudos"})}),e(_,{align:"right",children:e(p,{variant:"body1",children:h.data.kudos})})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Suspicious"})}),r(_,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:[e(p,{sx:{order:0},variant:"body1",children:h.data.suspicious}),h.data.suspicious>0?e(ie,{onClick:async()=>{d("resetSuspicion"),m(!0)},loading:y.isLoading,variant:"contained",color:"error",sx:{ml:4},children:"Reset"}):null]})]}),c!=null?r(v,{children:[r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Ratings Validated"})}),r(_,{align:"right",sx:{display:"flex",alignItems:"center"},children:[e(p,{sx:{order:1},variant:"body1",children:c.validated?"True":"False"}),e(ie,{onClick:async()=>{c.validated?d("setUnvalidated"):d("setValidated"),m(!0)},loading:$.isLoading,variant:"contained",color:c.validated?"error":"success",sx:{order:0,ml:4},children:c.validated?"Unvalidate":"Validate"})]})]}),r(z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(_,{component:"th",scope:"row",children:e(p,{variant:"body1",children:"Flag User Ratings"})}),e(_,{sx:{display:"flex",flex:"1 1 0",alignItems:"center",justifyContent:"flex-end",flexDirection:"row"},children:e(ie,{onClick:async()=>{d("setFlagged"),m(!0)},loading:W.isLoading,variant:"contained",color:"error",sx:{order:0},children:"Flag"})})]})]}):null]})})})]})},ea=()=>{const t=Te(),n=k(m=>m.userPanel.selectedUser),[s,d]=S.exports.useState(!1),a=Zr({initialValues:{trusted:!1,flagged:!1,worker_invite:"0"}}),l=se(m=>Tt(m.id,m.data),{onSuccess:(m,u)=>{var h,b,y,W;t.setQueryData(B.detail(u.id),$=>$!=null?{...$,...m}:m);const i={trusted:(h=m.trusted)!=null?h:!1,flagged:(b=m.flagged)!=null?b:!1,worker_invite:(W=(y=m.worker_invite)==null?void 0:y.toString())!=null?W:"0"};ne(i)||(a.setValues(i),a.resetDirty(i)),d(!0)}}),o=(m,u)=>{u!=="clickaway"&&d(!1)};return r(te,{elevation:1,sx:{p:2,height:"100%"},children:[e(ze,{open:s,autoHideDuration:6e3,onClose:o,anchorOrigin:{vertical:"top",horizontal:"right"},children:e(Ve,{onClose:o,severity:"success",sx:{width:"100%",border:"2px solid #a3a3a3"},children:"Changes successfully saved!"})}),r("form",{onSubmit:a.onSubmit((m,u)=>{if(n!=null){const i={trusted:m.trusted,flagged:m.flagged,worker_invite:parseInt(m.worker_invite)};l.mutate({id:n,data:i})}}),children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(Xr,{}),n!=null?e(g,{display:"flex",alignItems:"center",children:a.isDirty()?e(C,{sx:{mr:2},variant:"contained",type:"submit",children:"Save"}):null}):null]}),e(Vr,{form:a,children:e(g,{display:"flex",children:n!=null&&n!=-1?e(Yr,{}):null})})]})]})},ta=t=>{Te();const{userId:n}=t;S.exports.useState(!1);const[s,d]=S.exports.useState(!1),{data:a,isInitialLoading:l,isLoading:o,isError:m}=w(j.validate(n),()=>Er(n),{enabled:!s,onError:i=>d(!0),refetchInterval:1e3*15}),u=i=>e(g,{sx:{display:"flex"},children:r(p,{children:["r: ",i.rating,", a: ",i.artifacts,", avg: ",i.average,", n: ",i.times_rated]})});return o?e(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(xe,{})})}):m?e(p,{children:"User has no ratings."}):a==null?e(v,{}):e(g,{children:e(Ne,{sx:{width:"100%",height:"100%"},cols:6,variant:"masonry",children:a.ratings.map(i=>r(me,{children:[e("img",{src:i.image}),e(ge,{title:u(i)})]},i.image_id))})})},na=()=>{const t=U(),n=k(a=>a.userPanel.selectedUser),s=k(a=>a.userPanel.expandedPanel),d=a=>(l,o)=>{(a==="workers"||a==="ratings")&&t(rr(o?a:!1))};return r(f,{container:!0,spacing:2,children:[e(f,{item:!0,md:12,lg:6,xl:4,children:e(ea,{})}),e(f,{item:!0,md:12,lg:12,xl:12,children:r(g,{children:[r(rt,{expanded:s==="workers",onChange:d("workers"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:e(p,{sx:{width:"33%",flexShrink:0},children:"Workers"})}),e(it,{sx:{backgroundColor:"background.default"},children:e(f,{container:!0,spacing:2,children:n!=null?e(zr,{userId:n}):null})})]}),r(rt,{expanded:s==="ratings",onChange:d("ratings"),sx:{boxShadow:"none"},children:[e(at,{expandIcon:e(st,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:e(p,{sx:{width:"33%",flexShrink:0},children:"Ratings"})}),e(it,{sx:{backgroundColor:"background.default"},children:s==="ratings"&&n!=null?e(ta,{userId:n}):null})]})]})})]})},ra=()=>{const t=U(),n=k(o=>o.utilityPanel.ipAddr),{data:s,refetch:d,isFetching:a}=w(["deleteIpAddr",n],()=>Ir({ipaddr:n}),{enabled:!1,cacheTime:0});return e(te,{elevation:1,sx:{p:2,height:"100%"},children:r(g,{children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Clear IP Timeout"}),e(ie,{onClick:()=>{ne(n)||d()},loading:a,variant:"contained",children:"Submit"})]}),e(H,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:o=>{t(ir(o.target.value))},placeholder:"Enter IP"}),s!=null?e(g,{pt:2,children:r(p,{variant:"body1",children:["Response: ",s.message]})}):null]})})},aa=()=>{const t=U(),n=k(o=>o.utilityPanel.prompt),{data:s,refetch:d,isFetching:a}=w(["promptCheck",n],()=>vr({filter_type:0,prompt:n}),{enabled:!1});return e(te,{elevation:1,sx:{p:2,height:"100%"},children:r(g,{children:[r(g,{display:"flex",justifyContent:"space-between",children:[e(p,{variant:"h4",children:"Prompt Checker"}),e(ie,{onClick:()=>{ne(n)||d()},loading:a,variant:"contained",children:"Submit"})]}),e(H,{sx:{my:2},variant:"standard",multiline:!0,fullWidth:!0,value:n,onChange:o=>{t(sr(o.target.value))},placeholder:"Enter prompt"}),s!=null?r(g,{pt:2,children:[r(p,{variant:"body1",children:["Suspicion: ",s.suspicion]}),s.suspicion>0?r(p,{variant:"body1",children:["Matches: ",JSON.stringify(s.matches)]}):null]}):null]})})},sa=()=>r(f,{container:!0,spacing:2,children:[e(f,{item:!0,md:12,lg:6,xl:4,children:e(aa,{})}),e(f,{item:!0,md:12,lg:6,xl:4,children:e(ra,{})})]}),ia=()=>{const t=k(l=>l.workerPanel.workerFilter),[n,s]=S.exports.useState(t!=null?t:""),[d]=vt(n,400),a=U();return S.exports.useEffect(()=>{a(dr(d))},[d]),e(H,{sx:{mr:2},label:"Search & Filter",variant:"outlined",value:n,onChange:l=>{s(l.target.value)}})},gt={image:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"},{parameter:"megapixelsteps_generated",label:"MPS Generated"}],interrogation:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}],text:[{parameter:"name",label:"Name"},{parameter:"performance",label:"Performance"},{parameter:"bridge_agent",label:"Bridge Agent"},{parameter:"uptime",label:"Uptime"}]},la=()=>{const t=U(),n=k(i=>i.workerPanel.sortKey),s=k(i=>i.workerPanel.order),d=k(i=>i.workerPanel.workerFilter),a=k(i=>i.workerPanel.workerType),{data:l}=w(q.all,()=>Ze(),{refetchInterval:1e3*30,select:i=>{const h=d==null?void 0:d.toLowerCase();return Ie(i.filter(b=>{var y;return b.type!==a?!1:h==null?!0:b.name.toLowerCase().includes(h)||((y=b.owner)!=null?y:"").toLowerCase().includes(h)||b.id.toLowerCase().includes(h)||b.bridge_agent.toLowerCase().includes(h)}),[b=>{const y=b[n];return Pe(y)?n==="performance"&&parseFloat(y)?parseFloat(y):y.toLowerCase():y}],[s])}}),o=i=>{var b,y;const h=i.target.value;t(or(h)),t(ut((y=(b=Un(gt[h]))==null?void 0:b.parameter)!=null?y:"name"))},m=i=>{t(ut(i.target.value))},u=i=>{t(cr(i))};return l==null?e(v,{}):r(v,{children:[r(g,{display:"flex",justifyContent:"space-between",pb:2,children:[r(g,{display:"flex",alignItems:"center",children:[e(p,{variant:"h5",sx:{mr:{xs:1,md:2}},children:"Worker List"}),e(ia,{})]}),r(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:[r(We,{sx:{mr:1},children:[e(Ae,{children:"Worker Type"}),r(Le,{value:a,label:"Worker Type",onChange:o,sx:{".MuiSelect-select":{py:1}},children:[e(Z,{value:"image",children:"Image"}),e(Z,{value:"interrogation",children:"Interrogation"}),e(Z,{value:"text",children:"Text"})]})]}),r(We,{sx:{mr:1},children:[e(Ae,{children:"Sort Key"}),e(Le,{value:n,label:"Sort Key",onChange:m,sx:{".MuiSelect-select":{py:1}},children:gt[a].map(i=>e(Z,{value:i.parameter,children:i.label},i.label))})]}),s==="asc"?e(K,{onClick:()=>u("desc"),children:e(Dn,{})}):e(K,{onClick:()=>u("asc"),children:e(On,{})})]})]}),e(f,{container:!0,spacing:2,children:l.map(i=>e(Ut,{worker:i},i.id))})]})},ft=()=>{const{data:t,isLoading:n,error:s}=w(["mode"],It);if(n)return e(p,{variant:"h6",children:"Loading Horde status ..."});if(t==null||s)return console.log("HordeStatus error",s),e(p,{variant:"h6",children:"Error loading Horde status"});const d=a=>a?e(lt,{sx:{color:Y,ml:1}}):e(lt,{sx:{color:qe,ml:1}});return r(Se,{children:[r(V,{children:[e(Ue,{children:d(t.maintenance_mode)}),e(Q,{primary:"Maintenance"})]}),r(V,{children:[e(Ue,{children:d(t.invite_only_mode)}),e(Q,{primary:"Invite Only"})]}),t.raid_mode!=null?r(V,{children:[e(Ue,{children:d(t.raid_mode)}),e(Q,{primary:"Raid"})]}):null]})},xt=()=>{const{data:t,isLoading:n,error:s}=w(["performance"],Pt);return n?e(p,{variant:"h6",children:"Loading Horde status ..."}):t==null||s?e(p,{variant:"h6",children:"Error loading Horde status"}):r(Se,{children:[e(V,{children:e(Q,{primary:`Queued Requests: ${t.queued_requests}`})}),e(V,{children:e(Q,{primary:`Queued MPS: ${t.queued_megapixelsteps}`})}),e(V,{children:e(Q,{primary:`Past Minute MPS: ${t.past_minute_megapixelsteps}`})}),e(V,{children:e(Q,{primary:`Workers: ${t.worker_count}`})})]})},ve=240,oa=()=>{const t=U(),n=k(d=>d.localState.sidebarOpen);return r(v,{children:[r(ot,{variant:"temporary",open:n,onClose:()=>{t(St(!n))},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},width:ve,flexShrink:0,"& .MuiDrawer-paper":{boxSizing:"border-box",width:ve}},children:[e(Me,{}),r(g,{sx:{overflow:"auto"},children:[e(xt,{}),e(pe,{}),e(ft,{})]})]}),r(ot,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:ve,flexShrink:0,["& .MuiDrawer-paper"]:{width:ve,boxSizing:"border-box"}},children:[e(Me,{}),r(g,{sx:{overflow:"auto"},children:[e(xt,{}),e(pe,{}),e(ft,{})]})]})]})},da=()=>{const t=U(),n=k(d=>d.persist.selectedTab);return r(g,{display:"flex",children:[e(oa,{}),e(g,{display:"flex",flexDirection:"column",flex:"1 1 auto",children:r(Ln,{value:n,children:[e(g,{sx:{borderBottom:1,borderColor:"divider"},children:r(Wn,{onChange:(d,a)=>{a!="4"&&t(He(!1)),t(wt(a))},"aria-label":"lab API tabs example",children:[e(J,{label:"User Lookup",value:"1"}),e(J,{label:"Workers",value:"2"}),e(J,{label:"Comparator",value:"3"}),e(J,{label:"Ratings",value:"4"}),e(J,{label:"Utilities",value:"5"}),e(J,{label:"Settings",value:"6"}),e(J,{label:"About",value:"7"})]})}),e(X,{value:"1",children:e(na,{})}),e(X,{value:"2",children:e(la,{})}),e(X,{value:"3",children:e(Mr,{})}),e(X,{value:"4",children:e(jr,{})}),e(X,{value:"5",children:e(sa,{})}),e(X,{value:"6",children:e(Kr,{})}),e(X,{value:"7",children:e(_r,{})})]})})]})},ke=()=>{const t=U(),n=k(d=>d.localState.sidebarOpen);return e(An,{position:"sticky",sx:{zIndex:d=>d.zIndex.drawer+1},children:r(Me,{children:[e(K,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{t(St(!n))},sx:{mr:2,display:{md:"none"}},children:e(Mn,{})}),r(p,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Horde Control Tower v","0.0.7"]}),null]})})},ca=async t=>{const n=window.document.createElement("canvas"),s=window.Image,d=(await Promise.allSettled([t].map(async l=>await new Promise((o,m)=>{let u;Gn(l,"src")?u=l:u={src:l};const i=new s;i.onerror=()=>m(new Error("Couldn't load image")),i.onload=()=>o({...u,img:i}),i.src=u.src,i.crossOrigin="anonymous"})))).filter(l=>l.status==="fulfilled").map(l=>l.value),a=n.getContext("2d");if(a==null)throw new Error("Couldn't create canvas context");{const l=o=>Math.max(...d.map(m=>{var u,i;return(i=(u=m==null?void 0:m.img)==null?void 0:u[o])!=null?i:0}));return n.width=l("width"),n.height=l("height"),d.forEach(o=>{var m,u;if(o!=null&&(a.globalAlpha=o.opacity!=null?o.opacity:1,o.img!=null))return a.drawImage(o.img,(m=o.x)!=null?m:0,(u=o.y)!=null?u:0)}),n.toDataURL("image/webp")}},ua=t=>{const{gen:n,...s}=t,d=U();return w(["check",n.id],()=>Cr(n.id),{refetchInterval:2e3,enabled:n.state==="check",onSuccess:a=>{if(n.state==="check"){let l=n.state;a.faulted?l="error":a.done&&(l="status"),d(Ce({...n,state:l,check:a}))}}}),w(["status",n.id],()=>Sr(n.id),{refetchInterval:!1,enabled:n.state==="status",onSuccess:async a=>{if(n.state==="status"){let l=n.state;if(a.faulted)l="error";else if(a.done){l="complete";const o=await ca(a.generations[0].img);a.generations[0].img=o}d(Ce({...n,state:l,status:a}))}}}),w(["delete",n.id],()=>wr(n.id),{refetchInterval:!1,retry:!1,enabled:n.state==="delete",onSuccess:async a=>{d(Ce({...n,state:"complete",status:a}))}}),e(v,{})},ha=()=>{const t=k(n=>n.persist.imageGens);return ne(t)?e(v,{}):e(v,{children:t.map(n=>e(ua,{gen:n},n.id))})},pa=()=>{const t=k(a=>a.persist.apikey),{data:n,refetch:s,isLoading:d}=w(["findUser"],()=>xr(t),{enabled:!ne(t),retry:1});return S.exports.useEffect(()=>{s()},[t]),d?r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(xe,{})})]}):ne(t)||n==null?r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),r(g,{display:"flex",flex:"1 1 auto",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[e(p,{variant:"h4",children:"Please enter your API key."}),e(Ot,{})]})]}):n.moderator?r(g,{sx:{display:"flex",flexDirection:"column"},children:[e(ha,{}),e(Pr,{}),e(ke,{}),e(da,{})]}):r(g,{display:"flex",flexDirection:"column",sx:{height:"100%"},children:[e(ke,{}),e(g,{sx:{display:"flex",flex:"1 1 auto"},justifyContent:"center",alignItems:"center",children:e(p,{variant:"h4",children:"Sorry, you really need to be a moderator to access these utilities :("})})]})};ee.prototype.__toHuman__=ee.prototype.toHuman;ee.prototype.toHuman=function(t={stripZeroUnits:"all"}){let n=this.normalize(),s=[],d=typeof t.precision=="object"?ee.fromObject(t.precision):ee.fromMillis(0),a=n;const l=["years","months","days","hours","minutes","seconds","milliseconds"];let o,m;t.smallestUnit&&(o=l.indexOf(t.smallestUnit)),t.biggestUnit&&(m=l.indexOf(t.biggestUnit)),(!o||!(o>=0&&o<l.length))&&(o=l.indexOf("seconds")),(!m||!(m<=o&&m<l.length))&&(m=l.indexOf("years"));for(let u of l.slice(m,o+1)){if(a.as(u)>=1){s.push(u);let h={};if(h[u]=Math.floor(a.as(u)),a=a.minus(ee.fromObject(h)).normalize(),a<d)break}if(t.maxUnits&&s.length>=t.maxUnits)break}if(n=n.minus(a).normalize(),n=n.shiftTo(...s),t.stripZeroUnits=="all")s=s.filter(u=>n.values[u]>0);else if(t.stripZeroUnits=="end"){let u=!0;s=s.reverse().filter(i=>u?n.values[i]==0?!1:(u=!1,!0):!0)}return s.length||s.push(l[o]),n.shiftTo(...s).__toHuman__(t)};const ma=En({key:"mui",prepend:!0}),ga=$n({palette:{mode:"dark"}}),fa=new Rn({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:(t,n)=>{var s;if(Fe.isAxiosError(n)){if(((s=n.response)==null?void 0:s.status)!=null&&n.response.status>=400&&n.response.status<500)return!1}else return t<3;return t<3}}}});Hn(document.getElementById("root")).render(e(jn,{value:ma,children:r(Kn,{theme:ga,children:[e(Bn,{}),r(qn,{client:fa,children:[e(Nn,{store:ye,children:e(zn,{loading:null,persistor:gr,children:e(pa,{})})}),null]})]})}));
